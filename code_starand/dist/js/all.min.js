var port=":8060",url="192.168.2.200",BASEURL="http://"+url+port,NEWBASEURL="http://"+url+port,CAR_BRAND_URL=BASEURL+"/api2/res/brand?device=1",PROVINCE_URL=BASEURL+"/api2/area/provinces?device=1",UPLOAD_URL=BASEURL+"/api2/file/upload?device=1",imgUrl="http://oss2.yicheku.com.cn",app=angular.module("app",["ng","ui.router","angular-md5","ngCookies"]);function sideClick(e){pageInitModule.setSidebar(e)}function changeSidebar(){pageInitModule.changeSide()}function returnTop(){pageInitModule.goTop()}function contentClick(){$(window).width()<768&&($(".sidebar").animate({left:-160}),$(".all").animate({marginLeft:0}))}app.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(e,t,a){a.defaults.withCredentials=!0,t.otherwise("login"),e.state("login",{url:"/login",templateUrl:"./views/login/login.html",controller:"loginCtrl"}).state("home",{url:"/home",templateUrl:"./views/app.html"}).state("home.unit",{url:"/cms/unit?unit_id&co_name",templateUrl:"./views/unit/unit.html",controller:"unitCtrl"}).state("home.addUnit",{url:"/cms/addUnit?unit_id&co_name",templateUrl:"./views/addUnit/addUnit.html",controller:"addUnitCtrl"}).state("home.power",{url:"/cms/power",templateUrl:"./views/power/power.html",controller:"powerCtrl"}).state("home.authorityAssignment",{url:"/cms/authorityAssignment?page_index&page_size",templateUrl:"./views/authorityAssignment/authorityAssignment.html",controller:"authorityAssignmentCtrl"}).state("home.peopleManagement",{url:"/cms/peopleManagement",templateUrl:"./views/peopleManagement/peopleManagement.html",controller:"peopleManagementCtrl"}).state("home.peopleDetail",{url:"/cms/peopleDetail/:mobile",templateUrl:"./views/peopleManagement/peopleDetail.html",controller:"peopleDetailCtrl"}).state("home.menu",{url:"/cms/menu?page_index&assortment_id",templateUrl:"./views/menu/menu.html",controller:"menuCtrl"}).state("home.menuCategory",{url:"/cms/menuCategory?page_index",templateUrl:"./views/menuCategory/menuCategory.html",controller:"menuCategoryCtrl"}).state("home.addMenu",{url:"/cms/addMenu",templateUrl:"./views/addMenu/addMenu.html",controller:"addMenuCtrl"}).state("home.adv",{url:"/cms/adv?page_index&location&type&enable",templateUrl:"./views/adv/adv.html",controller:"advCtrl"}).state("home.addAdv",{url:"/cms/addAdv",templateUrl:"./views/addAdv/addAdv.html",controller:"addAdvCtrl"}).state("home.editAdv",{url:"/cms/editAdv/:id",templateUrl:"./views/editAdv/editAdv.html",controller:"editAdvCtrl"}).state("home.advDetail",{url:"/advDetail/:aid",templateUrl:"./views/advDetail/advDetail.html",controller:"advDetailCtrl"}).state("home.order",{url:"/cms/order?page_index&state&id&account&code",templateUrl:"./views/order/order.html",controller:"orderCtrl"}).state("home.orderDetail",{url:"/orderDetail/:oid",templateUrl:"./views/orderDetail/orderDetail.html",controller:"orderDetailCtrl"}).state("home.orderState",{url:"/orderState/:oid",templateUrl:"./views/orderState/orderState.html",controller:"orderStateCtrl"}).state("printConfirmation",{url:"/printConfirmation",templateUrl:"./views/printConfirmation/printConfirmation.html",controller:"printInfoCtrl"}).state("printInfo",{url:"/printInfo",templateUrl:"./views/printInfo/printInfo.html",controller:"printInfoCtrl"}).state("printDrawerInfo",{url:"/printDrawerInfo",templateUrl:"./views/printDrawerInfo/printDrawerInfo.html",controller:"printInfoCtrl"}).state("home.category",{url:"/cms/ask/category?page_index",templateUrl:"./views/category/category.html",controller:"categoryCtrl"}).state("home.addCategory",{url:"/addCategory",templateUrl:"./views/addCategory/addCategory.html",controller:"addCategoryCtrl"}).state("home.ask",{url:"/cms/ask/ask?page_index",templateUrl:"./views/ask/ask.html",controller:"askCtrl"}).state("home.askDetail",{url:"/askDetail/:qid",templateUrl:"./views/askDetail/askDetail.html",controller:"askDetailCtrl"}).state("home.addAsk",{url:"/addAsk",templateUrl:"./views/addAsk/addAsk.html",controller:"addAskCtrl"}).state("home.user",{url:"/cms/user?pageIndex&statePerson&stateCompany&stateManager&staff_state&account&co_name",templateUrl:"./views/user/user.html",controller:"userCtrl"}).state("home.userDetail",{url:"/cms/userDetail/:uid",templateUrl:"./views/userDetail/userDetail.html",controller:"userDetailCtrl"}).state("home.checkUser",{url:"/cms/checkUser/:mobile",templateUrl:"./views/checkUser/checkUser.html",controller:"checkUserCtrl"}).state("home.personAuth",{url:"/personAuth/:user_id",templateUrl:"./views/personAuth/personAuth.html",controller:"personAuthCtrl"}).state("home.authentication",{url:"/cms/authentication/:uid",templateUrl:"./views/authentication/authentication.html",controller:"authenticationCtrl"}).state("largeImg",{url:"/largeImg/:url",templateUrl:"./views/largeImg/largeImg.html",controller:"largeImgCtrl"}).state("home.supplier",{url:"/cms/supplier?pageindex&province_id&city_id&supplier_name",templateUrl:"./views/supplier/supplier.html",controller:"supplierCtrl"}).state("home.addSupplier",{url:"/addSupplier",templateUrl:"./views/addSupplier/addSupplier.html",controller:"addSupplierCtrl"}).state("home.supplierDetail",{url:"/supplierDetail/:sid",templateUrl:"./views/supplierDetail/supplierDetail.html",controller:"supplierDetailCtrl"}).state("home.leader",{url:"/cms/supplierLeader?page_index&province_id&city_id&supplier_name",templateUrl:"./views/leader/supplierLeader.html",controller:"supplierLeaderCtrl"}).state("home.addSupplierLeader",{url:"/addSupplierLeader",templateUrl:"./views/addSupplierLeader/addSupplierLeader.html",controller:"addSupplierLeaderCtrl"}).state("home.seek",{url:"/cms/seek?page_index",templateUrl:"./views/seek/seek.html",controller:"seekCtrl"}).state("home.resource",{url:"/cms/resource?page_index&sub_brand&model_name&user_name&mobile&code",templateUrl:"./views/resource/resource.html",controller:"resourceListCtrl"}).state("home.resourceDetail",{url:"/resourceDetail/:rid",templateUrl:"./views/resourceDetail/resourceDetail.html",controller:"resourceDetailCtrl"}).state("home.addResource",{url:"/addResource",templateUrl:"./views/addResource/addResource.html",controller:"addResourceCtrl"}).state("home.userNum",{url:"/cms/userNum?start_time&end_time",templateUrl:"./views/userNum/userNum.html",controller:"userNumCtrl"}).state("home.driverOrderList",{url:"/cms/driverOrderList?page_index&start_time&end_time",templateUrl:"./views/driverOrderList/driverOrderList.html",controller:"orderListCtrl"}).state("home.driverOrderNum",{url:"/cms/driverOrderNum?page_index&start_time&end_time",templateUrl:"./views/driverOrderNum/driverOrderNum.html",controller:"orderNumCtrl"}).state("home.handle4s",{url:"/cms/handle4s?page_index",templateUrl:"./views/handle4s/handle4s.html",controller:"handle4sCtrl"}).state("home.pageStayTime",{url:"/cms/pageStayTime",templateUrl:"./views/pageStayTime/pageStayTime.html"}).state("home.map",{url:"/cms/map",templateUrl:"./map/map.html",controller:"mapCtrl"}).state("home.company",{url:"/cms/company?page_index&province_id&city_id&co_type&company_name",templateUrl:"./views/company/company.html",controller:"companyCtrl"}).state("home.addCompany",{url:"/cms/addCompany",templateUrl:"./views/addCompany/addCompany.html",controller:"addCompanyCtrl"}).state("home.companyDetail",{url:"/cms/companyDetail/:company_id",templateUrl:"./views/companyDetail/companyDetail.html",controller:"companyDetailCtrl"}).state("home.certifiedLogistics",{url:"/cms/certifiedLogistics/:company_id",templateUrl:"./views/certifiedLogistics/certifiedLogistics.html",controller:"certifiedLogisticsCtrl"}).state("home.complain",{url:"/cms/complain?page_index",templateUrl:"./views/complain/complain.html",controller:"complainCtrl"}).state("home.complainDetail",{url:"/cms/complainDetail/:id",templateUrl:"./views/complainDetail/complainDetail.html",controller:"complainDetailCtrl"}).state("home.invoice",{url:"/cms/invoice?pageIndex&pageSize&startDate&endDate&orderType&keywords",templateUrl:"./views/invoice/invoice.html",controller:"invoiceCtrl"}).state("home.invoiceDetail",{url:"/cms/invoiceDetail?:invoiceCode",templateUrl:"./views/invoiceDetail/invoiceDetail.html",controller:"invoiceDetailCtrl"}).state("home.withdrawDeposit",{url:"/cms/withdrawDeposit?pageindex",templateUrl:"./views/withdrawDeposit/withdrawDeposit.html",controller:"withdrawDepositCtrl"}).state("home.bankinfo",{url:"/cms/bankinfo?page_index",templateUrl:"./views/bankinfo/bankinfo.html",controller:"bankinfoCtrl"}).state("home.resourceApply",{url:"/cms/resourceApply?page_index&state",templateUrl:"./views/resourceApply/resourceApply.html",controller:"resourceApplyCtrl"}).state("home.resourceApplyDetail",{url:"/cms/resourceApplyDetail/:id",templateUrl:"./views/resourceApplyDetail/resourceApplyDetail.html",controller:"resourceApplyDetailCtrl"}).state("home.marketing",{url:"/cms/marketing?page_index&page_size",templateUrl:"./views/marketing/marketing.html",controller:"marketingCtrl"}).state("home.marketingDetail",{url:"/cms/marketingDetail/:id",templateUrl:"./views/marketingDetail/marketingDetail.html",controller:"marketingDetailCtrl"}).state("home.authenticationTask",{url:"/cms/authenticationTask?page_index&page_size",templateUrl:"./views/authenticationTask/authenticationTask.html",controller:"authenticationTaskCtrl"}).state("home.companyAudit",{url:"/cms/companyAudit?page_index&page_size&state",templateUrl:"./views/companyAudit/companyAudit.html",controller:"companyAuditCtrl"}).state("home.companyAuditDetail",{url:"/cms/companyAuditDetail/:company_id",templateUrl:"./views/companyAuditDetail/companyAuditDetail.html",controller:"companyAuditDetailCtrl"}).state("home.counselManagement",{url:"/cms/counselManagement?page_index&page_size&start_time&end_time&dir_id&state",templateUrl:"./views/counselManagement/counselManagement.html",controller:"counselManagementCtrl"}).state("home.releaseManagement",{url:"/cms/releaseManagement",templateUrl:"./views/releaseManagement/releaseManagement.html",controller:"releaseManagementCtrl"}).state("home.storeSort",{url:"/cms/store/sort",templateUrl:"./views/storeSort/sort.html",controller:"storeSortCtrl"}).state("home.storeTemplate",{url:"/cms/store/template?page_index&assortment_id&is_up",templateUrl:"./views/storeTemplate/template.html",controller:"storeTemplateCtrl"}).state("home.addTemplate",{url:"/cms/store/addTemplate",templateUrl:"./views/addTemplate/addTemplate.html",controller:"storeAddTemplateCtrl"}).state("home.info",{url:"/cms/info?page_index&page_size",templateUrl:"./views/info/info.html",controller:"infoCtrl"}).state("home.test",{url:"/cms/test",templateUrl:"./views/test/test.html",controller:"testCtrl"}).state("home.area",{url:"/cms/area",templateUrl:"./views/area/area.html",controller:"areaCtrl"}).state("home.backResource",{url:"/cms/backResource?page_index&page_size&brand_id&subrand_id&modle_id&end_time",templateUrl:"./views/backResource/backResource.html",controller:"backResourceCtrl"}).state("home.backProgram",{url:"/cms/backProgram?page_index&page_size&compamu_id&name&province_id&last_time&finance_type",templateUrl:"./views/backProgram/backProgram.html",controller:"backProgramCtrl"}).state("home.releaseBackResource",{url:"/cms/releaseBackResource?id",templateUrl:"./views/releaseBackResource/releaseBackResource.html",controller:"releaseBackResourceCtrl"}).state("home.addBackProgram",{url:"/cms/addBackProgram?id",templateUrl:"./views/addBackProgram/addBackProgram.html",controller:"addBackProgramCtrl"}).state("home.justRentLists",{url:"/cms/justRentLists?page_index&brand_id&subrand_id&modle_id&end_time",templateUrl:"./views/justRentLists/justRentLists.html",controller:"justRentListsCtrl"}).state("home.justRentProgram",{url:"/cms/justRentProgram?page_index&page_size&compamu_id&name&province_id&last_time&finance_type",templateUrl:"./views/justRentProgram/justRentProgram.html",controller:"justRentProgramCtrl"}).state("home.releaseJustRentProgram",{url:"/cms/releaseJustRentProgram?id",templateUrl:"./views/releaseJustRentProgram/releaseJustRentProgram.html",controller:"releaseJustRentProgramCtrl"}).state("home.addJustRent",{url:"/cms/addJustRent?id",templateUrl:"./views/addJustRent/addJustRent.html",controller:"addJustRentCtrl"}).state("home.resourcesOrderLists",{url:"/cms/resourcesOrderLists?page_index&page_size&state&order_code&resource_type&user_name&user_mobile&start_time&end_time&province_id&city_id&area_id",templateUrl:"./views/resourcesOrderLists/resourcesOrderLists.html",controller:"resourcesOrderListsCtrl"}).state("home.resourcesOrderDetail",{url:"/cms/resourcesOrderDetail/:oid",templateUrl:"./views/resourcesOrderDetail/resourcesOrderDetail.html",controller:"resourcesOrderDetailCtrl"}).state("home.resOrder",{url:"/cms/resOrder?page_index&state&order_code&order_type&user_name&user_mobile&start_time&end_time&province_id&city_id&area_id",templateUrl:"./views/resOrder/resOrder.html",controller:"resOrderCtrl"}).state("home.resOrderDetail",{url:"/cms/resOrderDetail/:oid",templateUrl:"./views/resOrderDetail/resOrderDetail.html",controller:"resOrderDetailCtrl"}).state("home.advTemp",{url:"/cms/advTemp?page_index&state&start_time&end_time&title",templateUrl:"./views/advTemp/advlist.html",controller:"advTempListCtrl"}).state("home.advTempDetail",{url:"/cms/advTempDetail/:id",templateUrl:"./views/advTempDetail/advTempDetail.html",controller:"advTempDetailCtrl"}).state("home.addAdvTemp",{url:"/cms/addAdvTemp",templateUrl:"./views/addAdvTemp/addAdvTemp.html",controller:"addAdvTempCtrl"}).state("home.editAdvTemp",{url:"/cms/editAdvTemp/:id",templateUrl:"./views/editAdvTemp/editAdvTemp.html",controller:"editAdvTempCtrl"}).state("home.brandAlerts",{url:"/cms/brandAlerts?page_index",templateUrl:"./views/brandAlerts/brandAlerts.html",controller:"brandAlertsCtrl"}).state("home.addBrandAlerts",{url:"/cms/addBrandAlerts",templateUrl:"./views/addBrandAlerts/addBrandAlerts.html",controller:"addBrandAlertsCtrl"}).state("home.noticeList",{url:"/cms/noticeList?page_index&page_size&send_state&send_start_time&send_end_time&title",templateUrl:"./views/noticeList/noticeList.html",controller:"noticeListCtrl"}).state("home.editNotice",{url:"/cms/editNotice?sid",templateUrl:"./views/editNotice/editNotice.html",controller:"editNoticeCtrl"}).state("home.bestSellingbrand",{url:"/cms/bestSellingbrand",templateUrl:"./views/bestSellingbrand/bestSellingbrand.html",controller:"bestSellingbrandCtrl"}).state("home.editbestSellingbrand",{url:"/cms/editbestSellingbrand?province_id",templateUrl:"./views/bestSellingbrand/editbestSellingbrand.html",controller:"editbestSellingbrandCtrl"}).state("home.specialResourcesLists",{url:"/cms/specialResourcesLists?page_index&province_id&city_id&brand_id&sub_brand_id&model_id&state",templateUrl:"./views/specialResourcesLists/specialResourcesLists.html",controller:"specialResourcesListsCtrl"}).state("home.editspecialResources",{url:"/editspecialResources/:rid/:type",templateUrl:"./views/editspecialResources/editspecialResources.html",controller:"editspecialResourcesCtrl"}).state("home.addspecialResources",{url:"/addspecialResources?rid",templateUrl:"./views/addspecialResources/addspecialResources.html",controller:"addspecialResourcesCtrl"}).state("home.specialResourcesDetail",{url:"/cms/specialResourcesDetail/:rid",templateUrl:"./views/specialResourcesDetail/specialResourcesDetail.html",controller:"specialResourcesDetailCtrl"}).state("home.specialResOrderList",{url:"/cms/specialResOrderList",templateUrl:"./views/specialResourcesLists/resOrder.html",controller:"resOrderCtrl"}).state("home.specialResOrderDetail",{url:"/cms/specialResOrderDetail/:orderId",templateUrl:"./views/specialResourcesLists/resOrderDetail.html",controller:"specialResOrderDetail"}).state("home.enteringOrder",{url:"/cms/enteringOrder",templateUrl:"./views/specialResourcesLists/enteringOrder.html",controller:"enteringOrder"}).state("home.activity",{url:"/cms/activity?page_index",templateUrl:"./views/activity/activity.html",controller:"activityCtrl"}).state("home.addActivity",{url:"/cms/addActivity",templateUrl:"./views/addActivity/addActivity.html",controller:"addActivityCtrl"}).state("home.menuIcon",{url:"/cms/menuIcon",templateUrl:"./views/menuIcon/menuIcon.html",controller:"menuIconCtrl"}).state("home.marketPrice",{url:"/cms/marketPrice?page_index&page_size&province_id&&city_id&brand_id&sub_brand_id&operation_account&seeting_price&supplier_name",templateUrl:"./views/marketPrice/marketPrice.html",controller:"marketPriceCtrl"}).state("home.priceUpdateLog",{url:"/cms/priceUpdateLog",templateUrl:"./views/marketPrice/priceUpdateLog.html",controller:"priceUpdateLogCtrl"}).state("home.priceUpdateDetail",{url:"/cms/priceUpdateDetail?logId",templateUrl:"./views/marketPrice/priceUpdateDetail.html",controller:"priceUpdateDetailCtrl"}).state("home.4sStores",{url:"/cms/4sStores?page_index&page_size&province_id&city_id&manufactor_id&is_leader&user_account&supplier_name",templateUrl:"./views/4sStores/4sStores.html",controller:"4sStoresCtrl"}).state("home.add4s",{url:"/cms/add4s?type",templateUrl:"./views/4sStores/add4s.html",controller:"add4sCtrl"}).state("home.updatePrice",{url:"/cms/updatePrice?supplierId",templateUrl:"./views/4sStores/updatePrice.html",controller:"updatePriceCtrl"}).state("home.dispatchOrder",{url:"/cms/dispatchOrder",templateUrl:"./views/dispatchOrder/dispatchOrder.html",controller:"dispatchOrderCtrl"}).state("home.addFinanciaLabel",{url:"/cms/addFinanciaLabel?financeid",templateUrl:"./views/addFinanciaLabel/addFinanciaLabel.html",controller:"addFinanciaLabelCtrl"}).state("home.FinanciaLabelList",{url:"/cms/FinanciaLabelList?page_index&page_size&province_id&city_id&brand_id&policy_detail",templateUrl:"./views/FinanciaLabelList/FinanciaLabelList.html",controller:"FinanciaLabelListCtrl"}).state("home.insuranceList",{url:"/cms/insuranceList?page_index&page_size&proviceId&cityId&startDate&endDate&status&keywords&statusType",templateUrl:"./views/addInsurance/insuranceList.html",controller:"insuranceListCtrl"}).state("home.insuranceDetail",{url:"/cms/insuranceDetail/:orderSeq",templateUrl:"./views/InsuranceDeatail/insuranceDetail.html",controller:"insuranceDetailCtrl"}).state("home.buyInsurance",{url:"/cms/buyInsurance/:orderSeq",templateUrl:"./views/InsuranceDeatail/buy.html",controller:"buyInsuranceCtrl"}).state("home.askPrice",{url:"/cms/askPrice/:orderSeq",templateUrl:"./views/askPrice/priceManager.html",controller:"askPriceCtrl"})}]),app.directive("areaThree",function(){return{restrict:"AEC",templateUrl:"./views/area/area.html",scope:{selAreaLists:"=selAreaLists",selAreaIdLists:"=selAreaIdLists",isShow:"=isShowArea",showSelAreaLists:"=showSelAreaLists"},controller:function(s,i){s.selAreaLists=[],s.showSelAreaLists=[],s.selAreaIdLists=[],s.defaultProId="over",s.defaultCityId=0,s.defaultTownId=0,s.defaultProName="全国",s.defaultCityName="全省",s.defaultTownName="全城";var e=function(){this.cityUrl="/api2/area/cities?device=1",this.townUrl="/api2/area/areas?device=1",s.selectProvice=function(e,t,a){s.cityLists=[],s.townLists=[],s.defaultCityId=0,s.defaultTownId=0,s.defaultCityName="全省",s.defaultTownName="全城";var i=e.currentTarget;$(i).hasClass("active")?($(i).removeClass("active"),s.defaultProId="over"):($(i).addClass("active"),$(i).siblings().removeClass("active"),0!=t?(s.defaultProId=t,s.defaultProName=a,r.getCity(t)):(s.defaultProId=0,s.defaultProName="全国"))},s.selectCity=function(e,t,a){s.townLists=[],s.defaultTownId=0,s.defaultTownName="全城";var i=e.currentTarget;$(i).hasClass("active")?($(i).removeClass("active"),s.defaultCityId=0,s.defaultCityName="全省"):($(i).addClass("active"),$(i).siblings().removeClass("active"),s.defaultCityName=a,0!=t?(r.getTown(t),s.defaultCityId=t):s.defaultCityId=0)},s.selectTown=function(e,t,a){var i=e.currentTarget;$(i).hasClass("active")?($(i).removeClass("active"),s.defaultTownName="全城",s.defaultTownId=0):($(i).addClass("active"),$(i).siblings().removeClass("active"),s.defaultTownName=a,s.defaultTownId=t)},s.orderSelectArea=function(){"over"!=s.defaultProId?(r.removal(),areaJoin=s.selAreaLists.join("|")):layer.msg("请求选择区域",{icon:5,time:1e3})},s.delete=function(e){r.trimData(e),areaJoin=s.selAreaLists.join("|")},s.showSelectArea=function(){s.isShow=!1}};e.prototype={httpErrorTip:function(){layer.msg("请求失败",{icon:5})},stateErrorTip:function(e){layer.msg(e)},setProvice:function(e){1===e.status?(s.proviceLists=e.list,s.proviceLists.unshift({id:0,name:"全国"})):this.stateErrorTip(e.msg)},setCity:function(e){1===e.status?(s.cityLists=e.list,s.cityLists.unshift({id:0,name:"全省"})):this.stateErrorTip(e.msg)},setTown:function(e){1===e.status?(s.townLists=e.list,s.townLists.unshift({id:0,name:"全城"})):this.stateErrorTip(e.msg)},getProvice:function(){var e={req_data:{method:"GET",url:PROVINCE_URL},requestSuccess:this.setProvice,requestError:this.httpErrorTip};i.getData(e)},getCity:function(e){var t={province:e},a={req_data:{method:"GET",url:BASEURL+this.cityUrl,params:t},requestSuccess:this.setCity,requestError:this.httpErrorTip};i.getData(a)},getTown:function(e){var t={province:e},a={req_data:{method:"GET",url:BASEURL+this.townUrl,params:t},requestSuccess:this.setTown,requestError:this.httpErrorTip};i.getData(a)},modify:function(e,t){s.selAreaIdLists.push(e),s.selAreaLists.push(t),s.showSelAreaLists=s.selAreaLists},trimData:function(e){s.selAreaIdLists.splice(e,1),s.selAreaLists.splice(e,1),s.showSelAreaLists=s.selAreaLists},removal:function(){var i=this,e=s.defaultProId+","+s.defaultCityId+","+s.defaultTownId,t={p_name:s.defaultProName,c_name:s.defaultCityName,t_name:s.defaultTownName};if(s.selAreaIdLists.length<=0)i.modify(e,t);else{if(0==s.defaultProId)return s.selAreaLists=[],s.selAreaIdLists=[],i.modify(e,t),!1;if(s.selAreaIdLists.forEach(function(e,t){0==e.split(",")[0]&&i.trimData(t)}),0==s.defaultCityId){for(var a=s.selAreaIdLists.length;a--;){(r=s.selAreaIdLists[a].split(",")[0])==s.defaultProId&&i.trimData(a)}return this.modify(e,t),!1}if(0==s.defaultTownId){for(a=s.selAreaIdLists.length;a--;){var r=s.selAreaIdLists[a].split(",")[0],n=s.selAreaIdLists[a].split(",")[1];n!=s.defaultCityId&&0!=n||r!=s.defaultProId||i.trimData(a)}return s.selAreaIdLists.forEach(function(e,t){e.split(",")[1]==s.defaultCityId&&i.trimData(t)}),this.modify(e,t),!1}s.selAreaIdLists.forEach(function(e,t){var a=e.split(",")[0];0==e.split(",")[2]&&a==s.defaultProId&&i.trimData(t)}),-1==$.inArray(e,s.selAreaIdLists)?i.modify(e,t):layer.msg("当前区域已选择！",{icon:1})}},init:function(){this.getProvice()}};var r=new e;r.init()}}}),app.directive("ckchartlist",function(n,e){return{restrict:"E",template:'<div id="region-1" style="width:98%; height:450px;margin-top: 50px"></div>',replace:!0,link:function(e,t,a){var i=[];function r(e,t){var a=echarts.init(document.getElementById("region-1")),i=e,r=[],n=[];if(1==t)for(var s=0;s<i.datas.length;s++)r.push(Math.round(i.datas[s].avg_time)),n.push(i.datas[s].name);else if(2==t)for(s=0;s<i.datas.length;s++)r.push(i.datas[s].sum_time),n.push(i.datas[s].name);var o=["页面平均停留时间","页面总停留时间"],c={title:{text:o[--t],x:"center",textStyle:{fontSize:16,color:"#c1232b"}},tooltip:{trigger:"axis"},legend:{data:o[t]},toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,xAxis:[{axisLabel:{rotate:30,interval:0},type:"category",data:n}],yAxis:[{type:"value",axisLabel:{formatter:"{value} s"}}],series:[{name:o[t],type:"bar",data:r,barWidth:"40%",itemStyle:{normal:{color:function(e){return["#C1232B","#B5C334","#FCCE10","#E87C25","#27727B","#FE8463","#9BCA63","#FAD860","#F3A43B","#60C0DD","#D7504B","#C6E579","#F4E001","#F0805A","#26C0C0"][e.dataIndex]},label:{show:!0,position:"top",formatter:"{c}"}}}}]};a.setOption(c)}n.getDataList().then(function(e){r(i=e,1)}),e.Tab=function(){r(i,e.selectPage)}}}}),app.directive("ckContent",function(){return{restrict:"A",templateUrl:"./views/commonsContent/content.html"}}),app.directive("ckHead",function(){return{restrict:"A",templateUrl:"./views/commonsHeader/head.html",controller:"headCtrl"}}),app.directive("ckMain",function(){return{restrict:"A",templateUrl:"./views/commonsMain/main.html"}}),app.directive("ckSidebar",function(){return{restrict:"A",templateUrl:"./views/siderBar/sidebar.html",controller:"sidebarCtrl"}}),app.directive("ckPage",function(){return{restrict:"A",templateUrl:"./views/pageNumber/page.html"}}),app.directive("pagination",function(){return{restrict:"AE",templateUrl:"./views/pagination/pagination.html",scope:{pageNumber:"=pageNumber",pageCount:"=pageCount",pageSize:"=pageSize",recordCount:"=recordCount",listsLength:"=listsLength",sendData:"=sendData",method:"&method"},controller:function(n){n.$watch("pageCount + pageNumber",function(){n.pageCount&&n.pageNumber&&(n.pageList=function(e,t){var a="",i="",r=[];for(e<=7?(a=1,i=parseInt(e)):parseInt(t)+3>parseInt(e)?(a=parseInt(e)-6,i=parseInt(e)):parseInt(t)-3<=1?(a=1,i=7):(a=parseInt(t)-3,i=parseInt(t)+3);a<=i;a++)r.push(a);return n.startData=0==n.recordCount?0:(t-1)*n.pageSize+1,n.endData=n.listsLength<n.pageSize?(t-1)*n.pageSize+n.listsLength:n.pageNumber*n.pageSize,r}(n.pageCount,n.pageNumber))}),n.clickPageNum=function(e){var t,a,i,r;n.sendData.page_index=(t=e,a=n.pageNumber,i=n.pageCount,"first"==(r=$(t.currentTarget).attr("data-text"))?1:"last"==r?i:"prev"==r?1<a?a-1:a:"next"==r?a<i?a+1:i:r),n.method()}}}}),app.directive("select2",function(s){return{restrict:"A",scope:{config:"=",ngModel:"=",select2Model:"="},link:function(e,t,a){var i=t[0].tagName,r={allowClear:!0,multiple:!!a.multiple,placeholder:a.placeholder||" "};if("SELECT"===i){var n=$(t);return delete r.multiple,angular.extend(r,e.config),n.prepend('<option value=""></option>').val("").select2(r),e.$watch("ngModel",function(e){setTimeout(function(){n.find('[value^="?"]').remove(),n.select2("val",e)},0)},!0),!1}if("INPUT"===i){n=$(t);a.query&&(e.config=s[a.query]()),e.$watch("config",function(){angular.extend(r,e.config),n.select2("destroy").select2(r)},!0),n.on("change",function(){e.$apply(function(){e.select2Model=n.select2("data")})}),e.$watch("select2Model",function(e){n.select2("data",e)},!0),e.$watch("ngModel",function(e){if(r.ajax||r.multiple)return!1;n.select2("val",e)},!0)}}}}),app.filter("location",function(){return function(e){return 1==e?"首页轮播广告":2==e?"特价资源头部广告":3==e?"热门品牌页顶部轮播广告":4==e?"火热推荐广告":5==e?"启动广告":7==e?"商城广告":8==e?"资讯广告":9==e?"模板广告":10==e?"重点推广广告":11==e?"主推活动广告":"其他"}}),app.filter("adv_type",function(){return function(e){return 0==e?"不跳转":1==e?"跳转网页":2==e?"跳转详情页":3==e?"跳转功能页":"其他"}}),app.filter("conditions_and_information",function(){return function(e,t){var a=angular.fromJson(e)[t];return a||(a="暂无"),a}}),app.filter("currencyToW",function(){return function(e){return e/1e6}}),app.filter("fun_page",function(){return function(e){return"log_order"==e?"物流下单页":"res_home"==e?"车源首页":"k_home"==e?"酷兜首页":"my_kudou"==e?"my_kudou":"k_share"==e?"酷分享页":"ibd_law"==e?"ibd法务页":void 0}}),app.filter("orderSalesArea",function(){return function(e){try{var t=$.trim(e).split("、"),a=[];return angular.forEach(t,function(e,t){e&&a.push($.trim(e))}),0<a.length?a.join("、"):"暂无"}catch(e){return"暂无"}}}),app.filter("resOrderState",function(){return function(e){var t=["资料收集中","审核中","审核通过","审核失败","审核有条件通过","合同签订中","提车中","交车中","订单完成"][e];return t||(t="暂无"),t}}),app.filter("resOrderType",function(){return function(e){var t=["正租","回租","特价"][parseInt(e)-1];return t||(t="暂无"),t}}),app.filter("resource_type",function(){return function(e){return 1==e?"4s店资源":2==e?"资源方资源":3==e?"正租资源":4==e?"回租资源":void 0}}),app.filter("retainageText",function(){return function(e,t,a){var i="";switch(parseInt(e)){case 1:break;case 2:i="一次性结清"+a/100+"元";break;case 3:i=t+"年后需支付"+a/100+"元";break;case 4:i=t+"期，每期还款"+a/100+"元";break;default:i="暂无"}return i}}),app.filter("retainageType",function(){return function(e){var t="";switch(parseInt(e)){case 1:t="无尾款";break;case 2:break;case 3:t="分期还(年还)";break;case 4:t="分期还(月还)";break;default:t="暂无"}return t}}),app.filter("stampTOtime",function(){return function(e){var t=new Date(e);return t.getFullYear()+"-"+((t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-")+(t.getDate()+" ")+(t.getHours()+":")+(t.getMinutes()+":")+t.getSeconds()}}),app.filter("state",function(){return function(e){return 3==e?"未通过":2==e?"已认证":1==e?"待审核":0==e?"未认证":"其他"}}),app.filter("strToJson",function(){return function(e,t){try{var a=e.replace(/\'/g,'"');return angular.fromJson(a)[t]}catch(e){return"暂无"}}}),app.factory("homeConfig",["$http","$q","$rootScope","$timeout",function(e,t,a,i){return{getDataList:function(){var r=t.defer();return e({method:"GET",url:BASEURL+"/cms2/count/time?device=1",data:""}).success(function(e){r.resolve(e)}).error(function(e,t,a,i){r.reject(e)}),r.promise}}}]),app.service("dateConversion",function(){this.sTot=function(e,t){var a="",i=new Date(1e3*e),r=i.getFullYear()+"-",n=(i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1)+"-",s=i.getDate()+" ";return a=r+n+s+(i.getHours()+":")+(i.getMinutes()+":")+i.getSeconds(),"date"==t&&(a=r+n+s),a},this.tTos=function(e){var t=e.replace(/\-/g,"/");return new Date(t).getTime()},this.ns=function(){return Date.parse(new Date)}}),app.service("httpData",["$http",function(n){this.getData=function(e,t,a,i,r){return n({method:e,url:BASEURL+t,params:a,timeout:1e4}).success(function(e){i&&i(e)}).error(function(e,t,a,i){r?r(e,t,a,i):alert("数据请求失败!")})}}]),app.service("httpRequestData",["$http","$timeout",function(a,i){var n=function(e){console.log(e)},s=function(){try{layer.closeAll("loading")}catch(e){}var e=document.createElement("div"),t=document.createElement("div");e.style.cssText="position:fixed; left:0;top:0;bottom:0;right:0;background-color:rgba(0,0,0,0.7);z-index:998;",t.style.cssText="position:absolute;left:50%;top:50%;width:100px;height:50px;background-color:#000;color:#fff;line-height:50px;text-align:center;z-index:999;margin-top:-25px;;;margin-left:-50px;font-size:14px;letter-spacing:2px;",t.innerText="请求错误",e.appendChild(t),document.documentElement.appendChild(e)||document.body.appendChild(e),i(function(){e.style.display="none"},2e3)};this.getData=function(e){var r=null;try{var t={req_data:{}};t.req_data.method="GET",t.req_data.url="#",t.req_data.timeout=1e4,t.requestSuccess=n,t.requestError=s,(r=angular.extend({},t,e)).req_data.params=angular.extend({},{access_token:"27f27d07-016d-4dd9-8cea-79bdb897a309"},e.req_data.params)}catch(e){return}if("{}"!=JSON.stringify(r))try{a(r.req_data).success(function(e){r.requestSuccess(e)}).error(function(e,t,a,i){r.requestError()})}catch(e){r.requestError()}}}]),app.service("imageTool",["$http","$q",function(a,e){var i=e.defer();this.upload=function(e){var t=new FormData;t.append("filedata",e);return a({method:"POST",url:UPLOAD_URL,data:t,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(e){1==e.status?i.resolve(e.data[0].normal):i.reject(e)}).error(function(e){i.reject(e)}),i.promise}}]),app.service("requestData",["$http",function(i){this.getData=function(e,t,a){return i({method:e,url:BASEURL+t,params:a,timeout:1e4}).then(function(e,t,a){return t||e})}}]),app.factory("select2Query",function(e){return{testAJAX:function(){return{minimumInputLength:1,ajax:{url:"http://api.rottentomatoes.com/api/public/v1.0/movies.json",dataType:"jsonp",data:function(e){return{q:e,page_limit:10,apikey:"ju6z9mjyajq2djue3gbvv26t"}},results:function(e,t){return{results:e.movies}}},formatResult:function(e){return e.title},formatSelection:function(e){return e.title}}}}}),app.controller("4sStoresCtrl",["$scope","$stateParams","$state","$timeout","httpRequestData","$http",function(o,c,t,e,r,a){var i=!1;o.people_list="";var n={province_url:"/api2/area/provinces?device=1",city_url:"/api2/area/cities?device=1",manu_url:"/cms2/supplier/manu?device=1",list_url:"/base_v1_0_0/supplierV2/query/4s?out=json",delete_url:"/base_v1_0_0/supplierV2/delete?out=json",operation_url:"/base_v1_0_0/supplierV2/user/operation?out=json",people_url:"/cms2/role/more/users?device=1",listsSendData:{page_index:1,page_size:10,province_id:o.user_operation="",city_id:"",manufactor_id:"",is_leader:"",user_account:"",supplier_name:""},requestError:function(){layer.close(tip),layer.msg("数据请求失败",{icon:5,time:2e3})},getDataFromUrl:function(){var e=c.page_index,t=c.province_id,a=c.city_id,i=c.manufactor_id,r=c.is_leader,n=c.user_account,s=c.supplier_name;e||(e=1),o.page_index=e,o.province_id=t,o.city_id=a,o.manufactor_id=i,o.is_leader=r,o.user_account=n,o.supplier_name=s,this.listsSendData={page_index:e,page_size:10,province_id:t,city_id:a,manufactor_id:i,is_leader:r,user_account:n,supplier_name:s}},selectData:function(){this.listsSendData.province_id=o.province_id,this.listsSendData.city_id=o.city_id,this.listsSendData.manufactor_id=o.manufactor_id,this.listsSendData.is_leader=o.is_leader,this.listsSendData.user_account=o.user_account,this.listsSendData.supplier_name=o.supplier_name,t.go("home.4sStores",this.listsSendData)},getManuList:function(){var e={req_data:{url:BASEURL+this.manu_url},requestSuccess:this.setManuList,requestError:this.requestError};r.getData(e)},setManuList:function(e){1==e.status&&(o.manu_list=e.list)},getProvinceList:function(){var e={req_data:{url:BASEURL+this.province_url},requestSuccess:this.setProvinceList,requestError:this.requestError};r.getData(e)},setProvinceList:function(e){1==e.status&&(o.province_list=e.list)},getCityList:function(e){var t={req_data:{url:BASEURL+this.city_url,params:{province:e}},requestSuccess:this.setCityList,requestError:this.requestError};r.getData(t)},setCityList:function(e){1==e.status&&(o.city_list=e.list)},get4sList:function(){tip=layer.load(1);var e={req_data:{url:BASEURL+this.list_url,params:this.listsSendData},requestSuccess:this.set4sList,requestError:this.requestError};r.getData(e)},set4sList:function(e){console.log(e),layer.close(tip),o.supplierData=e.list,console.log(o.supplierData),o.pageNumber=e.page.pageNumber,o.recordCount=e.page.recordCount,o.pageCount=e.page.pageCount,o.pageSize=e.page.pageSize,o.pageList=o.pageNum(o.pageCount,o.pageNumber),o.startData=0==o.recordCount?0:(o.pageNumber-1)*o.pageSize+1,o.endData=e.list.length<o.pageSize?(o.pageNumber-1)*o.pageSize+e.list.length:o.pageNumber*o.pageSize},delete:function(a){var i=this;layer.confirm("确定删除选中4s店？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0,anim:4},function(e){var t={req_data:{url:BASEURL+i.delete_url+"&supplier_id="+a,method:"POST"},requestSuccess:i.successFn,requestError:i.requestError};r.getData(t)},function(e){layer.close(e)})},successFn:function(e){console.log(e),1==e.status&&(layer.msg(e.data,{icon:1,time:1500}),n.get4sList())},zpoperation:function(){var e={req_data:{url:BASEURL+this.operation_url,method:"POST",params:{supplier_ids:o.ids,user_operation:o.user_operation}},requestSuccess:this.zpsuccessFn,requestError:this.requestError};r.getData(e)},zpsuccessFn:function(e){1==e.status&&(layer.msg("操作成功",{icon:1,time:1500}),n.get4sList(),o.ids=[])},getPeopleList:function(){var e={req_data:{url:BASEURL+this.people_url,params:{role_id:"1000300010030,1000300010031"}},requestSuccess:this.setPeopleList,requestError:this.requestError};r.getData(e)},setPeopleList:function(e){console.log(e),1==e.status&&(o.people_list=e.list)},init:function(){this.getDataFromUrl(),this.get4sList(),this.getManuList(),this.getPeopleList()}};n.init(),n.getProvinceList(),null!=c.province_id?(n.getCityList(o.province_id),o.province_id=c.province_id):(o.city_id="",o.city_list=[]),o.changeProvince=function(){o.city_id="",o.city_list=[],n.selectData()},o.changeCity=function(){n.selectData()},o.changeManufactor=function(){n.selectData()},o.changeLeader=function(){n.selectData()},o.changeAccount=function(){n.selectData()},o.search_4s=function(){n.selectData()},o.$watch("supplier_name",function(){i&&""==o.supplier_name&&n.selectData(),i=!0}),o.changePageUrl=function(e){n.listsSendData.page_index=o.getPageIndex(e,o.pageNumber,o.pageCount),t.go("home.4sStores",n.listsSendData)},o.ids=[],Array.prototype.remove=function(e){var t=this.indexOf(e);-1<t&&this.splice(t,1)},o.selectTemplate=function(e,t){e.stopPropagation(),1==e.currentTarget.checked?o.ids.push(t):o.ids.remove(t),0<o.ids.length&&(o.idsSrting=o.ids.join(","))},o.batchdelete4s=function(){o.idsSrting&&n.delete(o.idsSrting)},o.selectPeople=function(){o.person&&(console.log(o.person),o.user_operation=o.person.account+","+o.person.realname)},o.saveManu=function(){o.idsSrting&&(n.zpoperation(),$("#myModal").modal("hide"))},o.delete4s=function(e){e&&n.delete(e)},o.deleteResource=function(e){layer.confirm("确定删除选中4s店发布的资源？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0,anim:4},function(e){a({method:"POST",url:BASEURL+"/res_v1_0_0/cms/supplier/delete?out=json&supplier_id="+o.idsSrting,timeout:1e3}).success(function(e){1==e.status?layer.msg(e.data,{icon:1,time:1500}):layer.msg(e.data,{icon:0,time:1500})}).error(function(){layer.msg("请求失败",{icon:5,time:1500})})},function(e){layer.close(e)})}}]),app.controller("add4sCtrl",["$scope","$http","$timeout","httpRequestData","$stateParams",function(a,i,r,n,e){a.title="新增",a.supplier_btn=!1,a.provincesData="";var t={province_url:"/api2/area/provinces?device=1",city_url:"/api2/area/cities?device=1",manu_url:"/cms2/supplier/manu?device=1",people_url:"/cms2/role/more/users?device=1",requestError:function(){layer.msg("数据请求失败",{icon:5,time:2e3})},getManuList:function(){var e={req_data:{url:BASEURL+this.manu_url},requestSuccess:this.setManuList,requestError:this.requestError};n.getData(e)},setManuList:function(e){1==e.status&&(a.manu_list=e.list)},getProvinceList:function(){var e={req_data:{url:BASEURL+this.province_url},requestSuccess:this.setProvinceList,requestError:this.requestError};n.getData(e)},setProvinceList:function(e){1==e.status&&(a.province_list=e.list)},getCityList:function(e){var t={req_data:{url:BASEURL+this.city_url,params:{province:e}},requestSuccess:this.setCityList,requestError:this.requestError};n.getData(t)},setCityList:function(e){1==e.status&&(a.city_list=e.list)},getPeopleList:function(e){var t={req_data:{url:BASEURL+this.people_url,params:{role_id:"1000300010030,1000300010031"}},requestSuccess:this.setPeopleList,requestError:this.requestError};n.getData(t)},setPeopleList:function(e){console.log(e),1==e.status&&(a.provincesData=e.list)},init:function(){this.getProvinceList(),this.getManuList(),this.getPeopleList()}};if(t.init(),a.changeProvince=function(){a.city_id="",a.city_list=[],a.province_id&&t.getCityList(a.province_id)},a.changeCity=function(){a.city_id&&t.getPeopleList(a.city_id)},a.people={account:"",name:""},a.selectPeople=function(){for(var e=0;e<a.provincesData.length;e++)a.supplier_people==a.provincesData[e].account&&(a.people.account=a.provincesData[e].account,a.people.name=a.provincesData[e].realname)},a.selectedManu=[],a.saveManu=function(){if(a.manuObj)if(-1==a.selectedManu.indexOf(a.manuObj)){var e={manufactorId:a.manuObj.id,manufactorName:a.manuObj.name};a.selectedManu.push(e),$("#myModal").modal("hide"),a.manuObj=""}else layer.msg("该厂商品牌已添加");else layer.msg("请选择厂商品牌")},a.deleteSelectedManu=function(e){a.selectedManu.splice(e,1)},a.supplier_leader=[{name:"",mobile:""}],a.addLeader=function(){a.supplier_leader.push({name:"",mobile:""})},a.deleteLeader=function(e){a.supplier_leader.splice(e,1)},e.type){a.title="编辑",a.add=!1,a.save=!0;var s={req_data:{url:BASEURL+"/base_v1_0_0/supplierV2/4s/detail?out=json&supplier_id="+e.type},requestSuccess:function(e){if(1==e.status){var e=e.data;a.province_id=e.supplier.provinceId+"",a.city_ID=e.supplier.cityId,a.supplier_full_name=e.supplier.supplierFullName,a.supplier_name=e.supplier.supplierName,a.selectedManu=e.manu,a.supplier_tel=e.supplier.supplierTel,a.supplier_sale_addr=e.supplier.supplierSaleAddr,a.bmap_lng=e.supplier.bmapLng+"",a.bmap_lat=e.supplier.bmapLat+"",a.supplier_people=e.user[0].account+"",a.people.account=e.user[0].account,a.people.name=e.user[0].realname,a.supplier_leader=e.leader,i({method:"GET",url:BASEURL+t.city_url,params:{province:a.province_id}}).success(function(e){if(1==e.status){a.city_list=e.list;for(var t=0;t<e.list.length;t++)a.city_ID==e.list[t].id&&(a.city_id=e.list[t].id+"")}}).error(function(){layer.msg("数据请求失败",{icon:5,time:2e3})})}},requestError:function(){layer.msg("数据请求失败",{icon:5,time:2e3})}};n.getData(s),a.editMsg=function(){if(a.supplier_btn=!0,""!=a.supplier_leader[0].name&&""!=a.supplier_leader[0].mobile&&null!=a.bmap_lng&&null!=a.bmap_lat&&0<a.selectedManu.length&&null!=a.province_id&&null!=a.supplier_sale_addr&&null!=a.supplier_full_name&&null!=a.supplier_tel&&""!=a.people){var e={lleaderLst:a.supplier_leader,lngLat:a.bmap_lng+","+a.bmap_lat,manufactorList:a.selectedManu,sourceArea:a.province_id+","+a.city_id,supplierAddress:a.supplier_sale_addr,supplierFullName:a.supplier_full_name,supplierMobile:a.supplier_tel,supplierName:a.supplier_name,userOperationList:[a.people]},t=layer.msg("数据提交中...",{icon:16,time:0});i({url:BASEURL+"/base_v1_0_0/supplierV2/update?out=json",method:"POST",timeout:1e4,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify(e)}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.data,{icon:1,time:1500}),r(function(){layer.confirm("是否还要继续添加？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0,anim:4},function(e){a.supplier_btn=!1,layer.close(e),window.location.reload()},function(e){layer.close(e),a.jump("/home/cms/4sStores"),a.$apply()})},2e3)):(layer.msg(e.data,{icon:5,time:2e3}),r(function(){a.supplier_btn=!1},2500))}).error(function(){})}else layer.msg("请把内容填写完整",{icon:5,time:2e3})}}else a.add=!0,a.save=!1,a.sendMsg=function(){if(a.supplier_btn=!0,""!=a.supplier_leader[0].name&&""!=a.supplier_leader[0].mobile&&null!=a.bmap_lng&&null!=a.bmap_lat&&0<a.selectedManu.length&&null!=a.province_id&&null!=a.supplier_sale_addr&&null!=a.supplier_full_name&&null!=a.supplier_tel&&""!=a.people){var e={lleaderLst:a.supplier_leader,lngLat:a.bmap_lng+","+a.bmap_lat,manufactorList:a.selectedManu,sourceArea:a.province_id+","+a.city_id,supplierAddress:a.supplier_sale_addr,supplierFullName:a.supplier_full_name,supplierMobile:a.supplier_tel,supplierName:a.supplier_name,userOperationList:[a.people]};console.log(JSON.stringify(e));var t=layer.msg("数据提交中...",{icon:16,time:0});i({url:BASEURL+"/base_v1_0_0/supplierV2/insert?out=json",method:"POST",timeout:1e4,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify(e)}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.data,{icon:1,time:1500}),r(function(){layer.confirm("是否还要继续添加？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0,anim:4},function(e){a.supplier_btn=!1,layer.close(e),window.location.reload()},function(e){layer.close(e),a.jump("/home/cms/4sStores"),a.$apply()})},2e3)):(layer.msg(e.data,{icon:5,time:2e3}),r(function(){a.supplier_btn=!1},2500))}).error(function(){})}else layer.msg("请把内容填写完整",{icon:5,time:2e3})}}]),app.directive("onFinishRender",function(i){return{restrict:"A",link:function(e,t,a){!0===e.$last&&i(function(){e.$emit("ngRepeatFinished")})}}}),app.controller("updatePriceCtrl",["$scope","$http","httpRequestData","$stateParams",function(i,r,e,t){var n=layer.load(1);i.supplierId=t.supplierId,i.title_type=1,i.isDown=0,i.logo_url="http://oss2.yicheku.com.cn",i.showSupplierData=0,i.showSeriesData=0;var s={manufactor_url:"/res_v1_0_0/cms/market/log/manufactor",manufactorId_url:"/res_v1_0_0/cms/market/log/sub/brand/manufactorId",pricelog_url:"/res_v1_0_0/api/market/get/by/supplier/sbid",getModelInfo:function(){var a=this;r({method:"GET",url:BASEURL+this.manufactor_url+"?device=1&supplierId="+i.supplierId}).success(function(e){console.log(e),layer.close(n),i.modelDetail=e;var t=i.modelDetail.manufactorModels[i.showSupplierData].manufactorId;a.getModelsList(t,i.supplierId)}).error(function(e){layer.msg("请求失败",{icon:5})})},getModelsList:function(e,t){var a=this;r({method:"GET",url:BASEURL+this.manufactorId_url+"?device=1&manufactorId="+e+"&supplierId="+t}).success(function(e){console.log(e),layer.close(n),i.series_list=e,a.getSeriesDetail(i.modelDetail.supplierId,e[i.showSeriesData].id)}).error(function(e){layer.msg("请求失败",{icon:5})})},getSeriesDetail:function(e,t){r({method:"GET",url:BASEURL+this.pricelog_url+"?device=1&supplier_id="+e+"&sub_brand_id="+t}).success(function(e){console.log(e),layer.close(n),i.SeriesDetail=e}).error(function(e){layer.msg("请求失败",{icon:5})})}};s.getModelInfo(),i.$on("ngRepeatFinished",function(e){$('[data-toggle="popover"]').popover()}),i.changeType=function(e){i.isDown=0==e?1:0},i.changeSeries=function(e,t,a){i.showSeriesData=e,s.getSeriesDetail(t,a)},i.getManuFactorIndex=function(e){for(var t=0;t<i.modelDetail.manufactorModels.length;t++)if(e==i.modelDetail.manufactorModels[t].manufactorId)return void(i.showSupplierData=t)},i.changeManuFactor=function(){i.getManuFactorIndex(i.manufactorModel_id),s.getModelsList(i.manufactorModel_id,i.supplierId),$("#changeManufactor").modal("hide")},i.allFinancial=function(){$("#financial_policy").modal("show")}}]),app.controller("activityCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state","$http",function(r,t,e,a,i,n,s){var o=layer.load(1);r.has_clicked=!1,r.url="http://"+url;var c={list_url:"/cms2/activity/page/list?device=1",delete_url:"/cms2/activity/page/delete?device=1",listsSendData:{page_index:1,page_size:10},init:function(){this.getDataFromUrl(),this.getActivityList()},errorData:function(){layer.close(o),r.has_clicked=!1,layer.msg("请求失败",{icon:5})},getActivityList:function(){t.getData("GET",this.list_url,this.listsSendData,this.setActivityList,this.errorData)},setActivityList:function(e){if(layer.close(o),1==e.status){r.activity_list=e.list;for(var t=(new Date).getTime(),a=0;a<e.list.length;a++){var i="";c.timestamp(e.list[a].start_time)>t?i="未开始":c.timestamp(e.list[a].start_time)<=t&&c.timestamp(e.list[a].end_time)>=t?i="使用中":c.timestamp(e.list[a].end_time)<t&&(i="已过期"),r.activity_list[a].state=i}r.pageNumber=e.page.pageNumber,r.recordCount=e.page.recordCount,r.pageCount=e.page.pageCount,r.pageSize=e.page.pageSize,r.pageList=r.pageNum(r.pageCount,r.pageNumber),r.startData=0==r.recordCount?0:(r.pageNumber-1)*r.pageSize+1,r.endData=e.list.length<r.pageSize?(r.pageNumber-1)*r.pageSize+e.list.length:r.pageNumber*r.pageSize}else layer.msg("请求失败",{icon:5})},deleteActivity:function(e){t.getData("POST",this.delete_url,{id:e},this.successFn,this.errorData)},successFn:function(e){layer.close(o),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),c.getActivityList()):layer.msg(e.msg,{icon:0,time:1500})},timestamp:function(e){return Date.parse(e.replace(/-/g,"/"))},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]},getDataFromUrl:function(){var e=i.page_index;e||(e=1),this.listsSendData={page_index:e,page_size:10}}};c.init(),r.changePageUrl=function(e){c.listsSendData.page_index=r.getPageIndex(e,r.pageNumber,r.pageCount),n.go("home.activity",c.listsSendData)},r.deleteActivity=function(e,t){e.stopPropagation(),t&&layer.confirm("确认删除该活动页面？",{title:"提示",btn:["确定","取消"],icon:0,skin:"layui-layer-molv"},function(e){c.deleteActivity(t)})},r.checkActivity=function(e,t){layer.open({title:e,type:2,shade:!1,area:["400px","667px"],offset:"rt",content:"http://"+url+t,zIndex:layer.zIndex,success:function(e){layer.setTop(e)}})}}]),app.controller("addActivityCtrl",["$scope","$http","$location","$timeout","$window","httpData",function(a,t,e,i,r,n){function s(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})}function o(e){if(console.log(e),layer.closeAll("dialog"),1==e.status){var t=e.data[0].normal,a=document.getElementById("viewId").value;document.getElementById(a).setImage(imgUrl+t)}else layer.msg("上传失败")}function c(e){if(console.log(e),layer.closeAll("dialog"),1==e.status){var t=e.data[0].normal;a.picture=t,a.$apply()}else layer.msg("上传失败")}initialization(),angular.element("#sel_activity_bg").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:s,success:o,xhrFields:{withCredentials:!0}};angular.element("#activity_bg").ajaxSubmit(e)}),angular.element("#sel_list_pic").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:s,success:c,xhrFields:{withCredentials:!0}};angular.element("#list_pic").ajaxSubmit(e)}),$("#start_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){var t=$("#start_time").val();$("#end_time").datetimepicker("setStartDate",t)}),$("#end_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){var t=$("#end_time").val();$("#start_time").datetimepicker("setEndDate",t)}),a.preview=function(){var e=document.getElementById("editorView").buildHtmlForMobile(a.title,"");layer.open({title:a.title,type:1,shade:!1,area:["480px","736px"],offset:"rt",content:e,zIndex:layer.zIndex,success:function(e){layer.setTop(e)}})},a.save=function(){if(a.title)if(a.start_time)if(a.end_time){var e=document.getElementById("editorView").buildHtmlForMobile(a.title,"");t({method:"POST",url:BASEURL+"/api2/file/upload/str?device=1",headers:{"Content-Type":"text/plain;charset=utf-8"},data:{filedata:e,filepath:"activityPage",suffixName:"html"}}).success(function(e){1==e.status?(a.link_url=e.data,t({method:"POST",url:BASEURL+"/cms2/activity/page/add?device=1",headers:{"Content-Type":"application/json;charset=UTF-8;"},params:{title:a.title,page_desc:a.page_desc,picture:a.picture,start_time:Date.parse(a.start_time.replace(/-/g,"/")),end_time:Date.parse(a.end_time.replace(/-/g,"/")),link_url:a.link_url}}).success(function(e){console.log(e),1==e.status&&(layer.msg(e.msg,{icon:1,time:1500}),i(function(){layer.confirm("是否继续添加？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),r.location.reload()},function(e){a.jumpUrl("home.activity")})},1600))}).error(function(){layer.msg("保存失败",{icon:5,time:1500})})):layer.msg(e.msg,{icon:5,time:1500})}).error(function(){layer.msg("保存失败",{icon:5,time:1500})})}else layer.msg("请选择结束时间");else layer.msg("请选择开始时间");else layer.msg("请填写标题")}}]),app.controller("addAdvCtrl",["$scope","$http","$location","$timeout","$window","httpData",function(s,a,e,t,i,r){s.province_id=0,s.provinceName="",s.city_id=0,s.cityName="";var n={};function o(e){s.areaJoin="",s.area_list="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo.cId,i=e[t].data.cityInfo.cName,r=e[t].data.pId,n=e[t].data.pName;0!=t?(s.areaJoin+="|"+r+","+a,s.area_list+="|"+n+i):(s.areaJoin=r+","+a,s.area_list+=n+i)}s.cityBtnShow=!0,console.log(s.area_list),console.log(s.areaJoin)}s.showselectArea=[],s.cityList=[],s.areaJoin="";var c={id:0,name:"全国"},l={id:0,name:"全省"};a({method:"GET",url:BASEURL+"/api2/area/provinces?device=1",timeout:1e4}).success(function(e){1==e.status?(s.provinceData=e.list,s.provinceData.unshift(c)):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}),s.before_provice_id="",s.before_city_id="",s.whole_province_list=[],s.current_change_province="",s.current_change_city="",s.first_send=!1,s.selectProvince=function(e,t){s.province_id=t,s.provinceName=e,s.current_change_province=e,s.current_change_city="",(n={}).data={},n.data.cityInfo={},0!=t?0==s.before_province_id&&s.first_send?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),s.showselectArea=[],s.before_province_id=t,n.data.pId=s.province_id,n.data.pName=s.provinceName,s.cityBtnShow=!0,o(s.showselectArea),a({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(s.cityData=e.list,s.cityData.unshift(l),s.cityBtnShow=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(s.before_province_id=t,n.data.pId=s.province_id,n.data.pName=s.provinceName,-1==$.inArray(s.province_id,s.whole_province_list)?a({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(s.cityData=e.list,s.cityData.unshift(l),s.cityBtnShow=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(s.cityBtnShow=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===s.before_province_id?(s.before_province_id=t,s.first_send=!0,n.data.pId=0,n.data.pName="全国",n.data.cityInfo.cId=0,n.data.cityInfo.cName=" ",s.current_change_province="全国",s.showselectArea.push(n),s.cityBtnShow=!0,o(s.showselectArea)):0==s.before_province_id||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),s.before_province_id=t,s.showselectArea=[],n.data.pId=0,n.data.pName="全国",n.data.cityInfo.cId=0,n.data.cityInfo.cName=" ",s.current_change_province="全国",s.showselectArea.push(n),s.cityBtnShow=!0,o(s.showselectArea),s.$apply(),s.first_send=!0},function(e){layer.close(e)})},s.selectCity=function(e,a){n.data.cityInfo.cId="",n.data.cityInfo.cName="",-1==$.inArray(a,s.cityList)&&(0!=a?(s.before_city_id=a,s.cityList.push(a),s.city_id=a,s.cityName=e,s.current_change_city=e,n.data.cityInfo.cId=s.city_id,n.data.cityInfo.cName=s.cityName,s.cityBtnShow=!0,s.showselectArea.push(n),o(s.showselectArea)):""==s.before_city_id&&0!=s.before_city_id?(n.data.pId=s.provice_id,n.data.pName=s.proviceName,n.data.cityInfo.cId=0,n.data.cityInfo.cName="全省",s.current_change_city="全省",s.whole_province_list.push(s.provice_id),s.showselectArea.push(n),o(s.showselectArea)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+s.provinceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){s.before_city_id=a,layer.close(e);for(var t=0;t<s.showselectArea.length;t++)s.showselectArea[t].data.pId==s.province_id&&(s.showselectArea.splice(t,1),t-=1);n.data.pId=s.province_id,n.data.pName=s.provinceName,n.data.cityInfo.cId=0,n.data.cityInfo.cName="全省",s.current_change_city="全省",s.whole_province_list.push(s.province_id),s.showselectArea.push(n),o(s.showselectArea),s.$apply()},function(e){layer.close(e)}))},s.removeEle=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;s.showselectArea.splice(t,1);for(var i=0;i<s.whole_province_list.length;i++)if(s.whole_province_list[i]==a){s.whole_province_list.splice(i,1);break}s.cityList.splice(t,1),0==s.showselectArea.length&&(s.before_province_id="",s.before_city_id="",s.whole_province_list=[]),o(s.showselectArea)},s.page_index=1,s.code="",s.sub_brand="",s.model_name="",s.user_name="",s.mobile="",s.res_type="1",s.uri="";var d={addAdvUrl:"/cms2/adv/add?device=1",resUrl:"/cms2/resource/datas?device=1",getLocalTime:function(e){return Date.parse(e.replace(/-/g,"/"))},errorData:function(){s.has_clicked=!1,layer.msg("请求失败",{icon:5})},uploadBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},uploadTitleSuccess:function(e){if(layer.closeAll("dialog"),1==e.status){var t=e.data[0].normal;s.adv_img=imgUrl+t,s.picture=t,s.$apply()}else layer.msg("上传失败")},getResource:function(){var e={page_index:s.page_index,page_size:10,code:s.code,sub_brand:s.sub_brand,model_name:s.model_name,user_name:s.user_name,mobile:s.mobile};r.getData("get",this.resUrl,e,this.setResource,this.errorData)},setResource:function(e){1==e.status&&(s.resource_list=e.list,s.pageNumber=e.page.pageNumber,s.recordCount=e.page.recordCount,s.pageCount=e.page.pageCount,s.pageSize=e.page.pageSize,s.pageList=s.pageNum(s.pageCount,s.pageNumber),s.startData=0==s.recordCount?0:(s.pageNumber-1)*s.pageSize+1,s.endData=e.list.length<s.pageSize?(s.pageNumber-1)*s.pageSize+e.list.length:s.pageNumber*s.pageSize)},addAdvFn:function(e){layer.msg("数据提交中...",{icon:16,time:0}),r.getData("POST",this.addAdvUrl,e,this.setSuccessAdd,this.errorData)},setSuccessAdd:function(e){s.has_clicked=!1,layer.closeAll("dialog"),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),t(function(){layer.confirm("是否继续添加？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),i.location.reload()},function(e){s.jumpUrl("home.adv")})},1600)):layer.msg(e.msg,{icon:5,time:1500})}};angular.element("#adv_picture_input").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:d.uploadBefore,success:d.uploadTitleSuccess,xhrFields:{withCredentials:!0}};angular.element("#adv_picture").ajaxSubmit(e)}),s.changeBox=function(){$("#selectResource").modal("show"),d.getResource()},s.changePageUrl=function(e){s.page_index=s.getPageIndex(e,s.pageNumber,s.pageCount),d.getResource()};var u=!1,m=!1,p=!1,_=!1;s.resource_search=function(){s.page_index=1,d.getResource()},s.$watch("code",function(){u=!0}),s.$watch("sub_brand",function(){u&&""==s.sub_brand&&s.resource_search(),u=!0}),s.$watch("model_name",function(){m&&""==s.model_name&&s.resource_search(),m=!0}),s.$watch("user_name",function(){p&&""==s.user_name&&s.resource_search(),p=!0}),s.$watch("mobile",function(){_&&""==s.mobile&&s.resource_search(),_=!0}),s.getResourceId=function(e,t){var a=$(e.currentTarget);s.resource_id=t,console.log(t);var i=a.text().replace(/(^\s*)|(\s*$)/g,""),r=i.indexOf("-");s.resource_name=i.slice(r+1),$("#selectResource").modal("hide")},s.getResourceDetail=function(){s.resource_id?a({method:"GET",url:BASEURL+"/api2/auto/resources/query/detail?device=1&res_id="+s.resource_id}).success(function(e){1==e.status?(s.resourceDetail=e.data,$("#resDetailModal").modal("show")):layer.msg(e.msg,{icon:5,time:1500})}):layer.msg("未选择资源")},s.addAdv=function(){var e="";if(s.picture)if(s.location)if(s.type){if(0==s.type)s.uri="";else if(1==s.type){if(!s.uri)return void layer.msg("请输入链接地址")}else if(2==s.type){if(!s.resource_id)return void layer.msg("请选择资源");if(!s.res_type)return void layer.msg("请选择资源类型");e='{"action": "resouce_detail","fields": {"id": '+s.resource_id+',"title": "资源详情","resource_type":'+s.res_type+"}}"}else 3==s.type&&(s.action?e='{"action": "'+s.action+'"}':layer.msg("请选择功能页面"));var t={location:s.location,type:s.type,uri:s.uri,picture:s.picture,params:e,sale_area_list:s.areaJoin};d.addAdvFn(t)}else layer.msg("请选择广告类型");else layer.msg("请选择广告位置");else layer.msg("请上传广告图片")}}]),app.controller("addAdvTempCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state","$http",function(s,t,a,i,e,r,n){s.province_id=0,s.provinceName="",s.city_id=0,s.cityName="";var o={};function c(e){s.areaJoin="",s.area_list="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo.cId,i=e[t].data.cityInfo.cName,r=e[t].data.pId,n=e[t].data.pName;0!=t?(s.areaJoin+="|"+r+","+a,s.area_list+="|"+n+i):(s.areaJoin=r+","+a,s.area_list+=n+i)}s.cityBtnShow=!0}s.showselectArea=[],s.cityList=[],s.areaJoin="";var l={id:0,name:"全国"},d={id:0,name:"全省"};n({method:"GET",url:BASEURL+"/api2/area/provinces?device=1",timeout:1e4}).success(function(e){1==e.status?(s.provinceData=e.list,s.provinceData.unshift(l)):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}),s.before_provice_id="",s.before_city_id="",s.whole_province_list=[],s.current_change_province="",s.current_change_city="",s.first_send=!1,s.selectProvince=function(e,t){s.province_id=t,s.provinceName=e,s.current_change_province=e,s.current_change_city="",(o={}).data={},o.data.cityInfo={},0!=t?0==s.before_province_id&&s.first_send?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),s.showselectArea=[],s.before_province_id=t,o.data.pId=s.province_id,o.data.pName=s.provinceName,s.cityBtnShow=!0,c(s.showselectArea),n({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(s.cityData=e.list,s.cityData.unshift(d),s.cityBtnShow=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(s.before_province_id=t,o.data.pId=s.province_id,o.data.pName=s.provinceName,-1==$.inArray(s.province_id,s.whole_province_list)?n({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(s.cityData=e.list,s.cityData.unshift(d),s.cityBtnShow=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(s.cityBtnShow=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===s.before_province_id?(s.before_province_id=t,s.first_send=!0,o.data.pId=0,o.data.pName="全国",o.data.cityInfo.cId=0,o.data.cityInfo.cName=" ",s.current_change_province="全国",s.showselectArea.push(o),s.cityBtnShow=!0,c(s.showselectArea)):0==s.before_province_id||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),s.before_province_id=t,s.showselectArea=[],o.data.pId=0,o.data.pName="全国",o.data.cityInfo.cId=0,o.data.cityInfo.cName=" ",s.current_change_province="全国",s.showselectArea.push(o),s.cityBtnShow=!0,c(s.showselectArea),s.$apply(),s.first_send=!0},function(e){layer.close(e)})},s.selectCity=function(e,a){o.data.cityInfo.cId="",o.data.cityInfo.cName="",-1==$.inArray(a,s.cityList)&&(0!=a?(s.before_city_id=a,s.cityList.push(a),s.city_id=a,s.cityName=e,s.current_change_city=e,o.data.cityInfo.cId=s.city_id,o.data.cityInfo.cName=s.cityName,s.cityBtnShow=!0,s.showselectArea.push(o),c(s.showselectArea)):""==s.before_city_id&&0!=s.before_city_id?(o.data.pId=s.provice_id,o.data.pName=s.proviceName,o.data.cityInfo.cId=0,o.data.cityInfo.cName="全省",s.current_change_city="全省",s.whole_province_list.push(s.provice_id),s.showselectArea.push(o),c(s.showselectArea)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+s.provinceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){s.before_city_id=a,layer.close(e);for(var t=0;t<s.showselectArea.length;t++)s.showselectArea[t].data.pId==s.province_id&&(s.showselectArea.splice(t,1),t-=1);o.data.pId=s.province_id,o.data.pName=s.provinceName,o.data.cityInfo.cId=0,o.data.cityInfo.cName="全省",s.current_change_city="全省",s.whole_province_list.push(s.province_id),s.showselectArea.push(o),c(s.showselectArea),s.$apply()},function(e){layer.close(e)}))},s.removeEle=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;s.showselectArea.splice(t,1);for(var i=0;i<s.whole_province_list.length;i++)if(s.whole_province_list[i]==a){s.whole_province_list.splice(i,1);break}s.cityList.splice(t,1),0==s.showselectArea.length&&(s.before_province_id="",s.before_city_id="",s.whole_province_list=[]),c(s.showselectArea)},s.temp_imgs=[{img:"images/temp_0.png",params_type:0,num:1,name:"模板1"},{img:"images/temp_1.png",params_type:1,num:2,name:"模板2"},{img:"images/temp_2.png",params_type:2,num:2,name:"模板3"},{img:"images/temp_3.png",params_type:3,num:3,name:"模板4"},{img:"images/temp_4.png",params_type:4,num:3,name:"模板5"},{img:"images/temp_5.png",params_type:5,num:4,name:"模板6"},{img:"images/temp_6.png",params_type:6,num:5,name:"模板7"},{img:"images/temp_7.png",params_type:7,num:"",name:"模板8"}],s.selectTempModal=function(){$("#selectTemp").modal("show")},s.has_clicked=!1,s.page_index=1,s.adv_list=[],s.type=[],s.action=[],s.res_id=[],s.res_name=[],s.adv_num="",s.temp_img="",s.selectTemp=function(e){if(s.adv_list=[],s.type=[],s.action=[],s.res_id=[],s.res_name=[],s.adv_num=s.temp_imgs[e].num,s.params_type=s.temp_imgs[e].params_type,s.temp_img=s.temp_imgs[e].img,$("#selectTemp").modal("hide"),""!=s.adv_num)for(var t=0;t<s.adv_num;t++){s.adv_list.push({picture:"",uri:"",type:0,params:""}),s.type.push("0"),s.action.push(""),s.res_id.push(""),s.res_name.push("")}else i(function(){$("#slideAdv").modal("show")},200)},s.saveAdvNum=function(){if($("#slideAdv").modal("hide"),s.num)for(var e=0;e<s.num;e++){s.adv_list.push({picture:"",uri:"",type:0,params:""}),s.type.push("0"),s.action.push(""),s.res_id.push(""),s.res_name.push("")}};var u={addAdvlUrl:"/cms2/adv/template/add?device=1",resUrl:"/cms2/resource/datas?device=1",getLocalTime:function(e){return Date.parse(e.replace(/-/g,"/"))},errorData:function(){s.has_clicked=!1,layer.msg("请求失败",{icon:5})},uploadBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},uploadTitleSuccess:function(e){if(layer.closeAll("dialog"),1==e.status){var t=e.data[0].normal;s.title_img=t,s.title_content=t,s.$apply()}else layer.msg("上传失败")},uploadAdvSuccess:function(e){if(layer.closeAll("dialog"),1==e.status){var t=e.data[0].normal;s.index;s.adv_list[s.index].picture=t,s.$apply()}else layer.msg("上传失败")},getResource:function(){var e={page_index:s.page_index,page_size:10,code:s.code,sub_brand:s.sub_brand,model_name:s.model_name,user_name:s.user_name,mobile:s.mobile};t.getData("get",this.resUrl,e,this.setResource,this.errorData)},setResource:function(e){1==e.status&&(s.resource_list=e.list,s.pageNumber=e.page.pageNumber,s.recordCount=e.page.recordCount,s.pageCount=e.page.pageCount,s.pageSize=e.page.pageSize,s.pageList=s.pageNum(s.pageCount,s.pageNumber),s.startData=0==s.recordCount?0:(s.pageNumber-1)*s.pageSize+1,s.endData=e.list.length<s.pageSize?(s.pageNumber-1)*s.pageSize+e.list.length:s.pageNumber*s.pageSize)},addAdvTemp:function(e){layer.msg("数据提交中...",{icon:16,time:0}),t.getData("POST",this.addAdvlUrl,e,this.setSuccessAdd,this.errorData)},setSuccessAdd:function(e){s.has_clicked=!1,layer.closeAll("dialog"),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),i(function(){layer.confirm("是否继续添加？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),a.location.reload()},function(e){s.jumpUrl("home.advTemp")})},1600)):layer.msg(e.msg,{icon:5,time:1500})}};s.changeTitleType=function(){s.title_content=""},s.selectType=function(e){s.adv_list[e].type=s.type[e]},s.selectFun=function(e){s.adv_list[e].params='{"action": "'+s.action[e]+'"}'};var m="";s.changeBox=function(e){$("#selectResource").modal("show"),u.getResource(),m=e},s.changePageUrl=function(e){s.page_index=s.getPageIndex(e,s.pageNumber,s.pageCount),u.getResource()};var p=!1,_=!1,g=!1,f=!1;s.resource_search=function(){s.page_index=1,u.getResource()},s.$watch("code",function(){p=!0}),s.$watch("sub_brand",function(){p&&""==s.sub_brand&&s.resource_search(),p=!0}),s.$watch("model_name",function(){_&&""==s.model_name&&s.resource_search(),_=!0}),s.$watch("user_name",function(){g&&""==s.user_name&&s.resource_search(),g=!0}),s.$watch("mobile",function(){f&&""==s.mobile&&s.resource_search(),f=!0}),s.getResourceId=function(e,t){var a=$(e.currentTarget).text().replace(/(^\s*)|(\s*$)/g,""),i=a.indexOf("-");s.res_name[m]=a.slice(i+1),s.res_id[m]=t,s.adv_list[m].params='{"action": "resouce_detail","fields": {"id": '+t+',"title": "资源详情","resource_type":1}}',$("#selectResource").modal("hide")},s.getResourceDetail=function(e){var t=s.res_id[e];t?n({method:"GET",url:BASEURL+"/api2/auto/resources/query/detail?device=1&res_id="+t}).success(function(e){1==e.status?(s.resourceDetail=e.data,$("#resDetailModal").modal("show")):layer.msg(e.msg,{icon:5,time:1500})}):layer.msg("未选择资源")},s.addAdv=function(){if(s.areaJoin)if(""!=s.title_type&&null!=s.title_type||0===s.title_type)if(1!=s.title_type||s.title_content)if(2!=s.title_type||s.title_content)if(s.level)if(s.level<0||99<s.level)layer.msg("优先级必须为1~99的数字");else if(s.start_time)if(s.end_time)if(""!=s.params_type&&null!=s.params_type||0===s.params_type){s.has_clicked=!0;var e={sale_area_list:s.areaJoin,title_type:s.title_type,title_content:s.title_content,level:s.level,start_time:"",end_time:"",params_type:s.params_type,adv_list:""};$(".adv_item").each(function(e){s.adv_list[e].uri=$(this).find("input[name='uri']").val()}),e.adv_list=JSON.stringify(s.adv_list),null!=s.start_time&&(e.start_time=u.getLocalTime(s.start_time)),null!=s.end_time&&(e.end_time=u.getLocalTime(s.end_time)),console.log(s.adv_list),u.addAdvTemp(e)}else layer.msg("请选择模板");else layer.msg("请选择结束时间");else layer.msg("请选择开始时间");else layer.msg("请填写优先级");else layer.msg("请上传标题图片");else layer.msg("请填写标题");else layer.msg("请选择标题形式");else layer.msg("请选择地区")},angular.element("#title_img_input").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:u.uploadBefore,success:u.uploadTitleSuccess,xhrFields:{withCredentials:!0}};angular.element("#title_img").ajaxSubmit(e)}),s.fileChanged=function(e){s.index=$(e).attr("data-index");var t={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:u.uploadBefore,success:u.uploadAdvSuccess,xhrFields:{withCredentials:!0}};angular.element(e).parent().ajaxSubmit(t)},$("#start_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){var t=$("#start_time").val();$("#end_time").datetimepicker("setStartDate",t)}),$("#end_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){var t=$("#end_time").val();$("#start_time").datetimepicker("setEndDate",t)})}]),app.controller("addAskCtrl",["$http","$scope","$location","$timeout",function(e,a,i,r){a.ask_btn=!1,a.getCategory=function(){e({method:"GET",url:BASEURL+"/cms2/category/datas?page_size=100&page_index=1&device=1"}).success(function(e){1==e.status?a.category_list=e.list:layer.msg(e.msg,{icon:5,time:1500})})},a.getCategory(),a.addAsk=function(){if(a.category_id)if(a.ask_title)if(a.ask_content){a.ask_btn=!0;var t=layer.msg("数据提交中...",{icon:16,time:0});e({method:"POST",url:BASEURL+"/cms2/question/add?device=1",params:{title:a.ask_title,content:a.ask_content,category_id:a.category_id}}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),r(function(){layer.confirm("是否还要继续添加？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],anim:4,icon:0},function(e){a.ask_btn=!1,layer.close(e),window.location.reload()},function(e){layer.close(e),i.url("home/cms/ask/ask"),a.$apply()})},2e3)):(layer.msg(e.msg,{icon:5,time:1500}),r(function(){a.ask_btn=!1},2e3))})}else layer.msg("请输入内容");else layer.msg("请输入标题");else layer.msg("请选择问题分类")}}]),app.controller("addBackProgramCtrl",["$scope","$window","$timeout","$state","$stateParams","httpRequestData",function(s,t,a,i,n,r){s.data={areas:"",carAscription:"",coefficIent:"",commission:"",commissionGps:"",commissionHead:"",commissionProcedure:"",companyCost:"",companyId:"",downPayment:"",financeDesc:"",financeGps:"",financeInsure:"",financeProcedure:"",headRate:"",id:"",isFinance:0,isZeroPayment:0,mobile:"",name:"",proposerAge:"",proposerCard:"",proposerRests:"",purchaseTax:0,financeType:2},s.coefficIentLists=[{data:""},{data:""},{data:""},{data:""},{data:""}],s.commissionLists=[{data:""},{data:""},{data:""},{data:""},{data:""}];var e=function(){this.add_program_url="/res_v1_0_0/cms/finance/program/insert",this.company_url="/cms2/company/datas?device=1&co_type=4",this.program_detail_url="/res_v1_0_0/cms/finance/program/detail?out=json",this.update_program_url="/res_v1_0_0/cms/finance/program/update?out=json"};e.prototype={stateError:function(e){layer.closeAll("loading"),s.hasClicked=!1,layer.msg(e)},httpError:function(){layer.closeAll("loading"),s.hasClicked=!1,layer.msg("请求失败",{icon:5})},companyLists:function(){layer.load(1);var e=this,t={req_data:{method:"GET",url:BASEURL+e.company_url},requestSuccess:e.setCompLists.bind(e),requestErroe:e.httpError.bind(e)};r.getData(t)},setCompLists:function(e){layer.closeAll("loading"),1==e.status?s.companyLists=e.list:this.stateError(e.data)},saveProgram:function(e){layer.load(1);var t=this,a={req_data:{method:"POST",url:BASEURL+t.add_program_url,data:e},requestSuccess:t.saveProgramSuccess.bind(t),requestErroe:t.httpError.bind(t)};r.getData(a)},saveProgramSuccess:function(e){if(layer.closeAll("loading"),1==e.status){if(layer.msg(e.msg,{icon:1,time:1500}),n.id)return void a(function(){i.go("home.backProgram")},1600);a(function(){layer.confirm("是否继续发布？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),t.location.reload()},function(e){layer.close(e),i.go("home.backProgram")})},1600)}else this.stateError(e.data)},paramsId:function(){s.title="新增回租方案";var e=n.id;e&&(s.title="编辑回租方案",s.data.id=e,this.programDetail())},programDetail:function(){var e=this,t={req_data:{method:"GET",url:BASEURL+e.program_detail_url,params:{id:n.id}},requestSuccess:e.setProgramDetail.bind(e),requestError:e.httpError.bind(e)};layer.load(1),r.getData(t)},setProgramDetail:function(e){if(layer.closeAll("loading"),1==e.status){var t=e.data;if(s.data.carAscription=t.finance.carAscription,s.data.mobile=t.finance.mobile,s.data.financeDesc=t.finance.financeDesc,s.data.proposerAge=t.finance.proposerAge,s.data.proposerCard=t.finance.proposerCard,s.data.proposerRests=t.finance.proposerRests,s.data.name=t.finance.name,s.data.companyId=t.finance.companyId,s.data.downPayment=parseFloat((100*t.finance.downPayment).toFixed(2)),s.data.headRate=parseFloat((100*t.finance.headRate).toFixed(2)),t.finance.purchaseTax&&(s.purchase_tax=!0),t.finance.financeGps&&(s.gps=!0,s.data.financeGps=parseFloat((t.finance.financeGps/100).toFixed(2))),t.finance.financeInsure&&(s.insurance=!0,s.data.financeInsure=parseFloat((100*t.finance.financeInsure).toFixed(2))),t.finance.financeProcedure&&(s.service_charge=!0,s.data.financeProcedure=parseFloat((t.finance.financeProcedure/100).toFixed(2))),t.finance.isFinance&&(s.is_finance=!0),t.finance.commissionHead&&(s.c_head=!0,s.data.commissionHead=parseFloat((t.finance.commissionHead/100).toFixed(2))),t.finance.commissionGps&&(s.c_gps=!0,s.data.commissionGps=parseFloat((t.finance.commissionGps/100).toFixed(2))),t.finance.commissionProcedure&&(s.c_procedure=!0,s.data.commissionProcedure=parseFloat((t.finance.commissionProcedure/100).toFixed(2))),t.finance.isZeroPayment&&(s.is_zero_payment=!0,s.c_gps=!0,s.c_procedure=!0,s.data.commissionGps="",s.data.commissionProcedure=""),0<t.commiss.length&&(s.rebate=!0,angular.forEach(t.commiss,function(e,t){var a=e.financeYear-1,i=parseFloat((100*e.commission).toFixed(2));s.commissionLists[a].data=i})),0<t.area.length){s.isShowArea=!0;var r=[],n=[];angular.forEach(t.area,function(e,t){var a=e.provinceId+","+e.cityId+","+e.districtId,i={p_name:e.provinceName,c_name:e.cityName,t_name:e.districtName};r.push(a),n.push(i)}),s.selAreaLists=n,s.selAreaIdLists=r}0<t.coee.length&&angular.forEach(t.coee,function(e,t){var a=e.financeYear-1,i=e.coefficient;s.coefficIentLists[a].data=i})}else this.stateError(e.data)},updateProgram:function(e){layer.load(1);var t=this,a={req_data:{method:"POST",url:BASEURL+t.update_program_url,data:e},requestSuccess:t.saveProgramSuccess.bind(t),requestErroe:t.httpError.bind(t)};r.getData(a)},roundFun:function(e,t){var a=e+"",i=a.indexOf(".");return-1==i?e.toFixed(t):a.substring(0,i+parseInt(t+1))},init:function(){this.paramsId(),this.companyLists()}};var o=new e;o.init(),s.seleZeroPay=function(){s.is_zero_payment?(s.data.isZeroPayment=1,s.c_gps=!1,s.data.commissionGps="",s.c_procedure=!1,s.data.commissionProcedure=""):s.data.isZeroPayment=0},s.seleRebate=function(){s.rebate||angular.forEach(s.commissionLists,function(e,t){e.data=""})},s.selePurchaseTax=function(){s.purchase_tax?s.data.purchaseTax=1:s.data.purchaseTax=0},s.seleGps=function(){s.gps||(s.data.financeGps="")},s.seleInsurance=function(){s.insurance||(s.data.financeInsure="")},s.seleFinanceProcedure=function(){s.service_charge||(s.data.financeProcedure="")},s.seleFinance=function(){s.is_finance?s.data.isFinance=1:s.data.isFinance=0},s.seleCommissionHead=function(){s.c_head||(s.data.commissionHead="")},s.seleCommissionGps=function(){s.c_gps||(s.data.commissionGps="")},s.seleCommissionProcedure=function(){s.c_procedure||(s.data.commissionProcedure="")},s.saveProgram=function(){s.hasClicked=!0;var e=angular.copy(s.data),t=s.selAreaIdLists.join("|");e.areas=t;var i=[];angular.forEach(s.coefficIentLists,function(e,t){if(e.data){var a=t+1+","+e.data;i.push(a)}}),e.coefficIent=i.join("|");var r=[];angular.forEach(s.commissionLists,function(e,t){if(e.data){var a=t+1+","+o.roundFun(e.data/100,3);r.push(a)}}),e.commission=r.join("|"),e.downPayment=o.roundFun(s.data.downPayment/100,3),e.headRate=o.roundFun(s.data.headRate/100,3),s.data.financeGps&&(e.financeGps=100*s.data.financeGps),s.data.financeInsure&&(e.financeInsure=o.roundFun(s.data.financeInsure/100,3)),s.data.financeProcedure&&(e.financeProcedure=100*s.data.financeProcedure),s.data.commissionHead&&(e.commissionHead=o.roundFun(s.data.commissionHead/100,3)),s.data.commissionGps&&(e.commissionGps=100*s.data.commissionGps),s.data.commissionProcedure&&(e.commissionProcedure=100*s.data.commissionProcedure),n.id?o.updateProgram(e):o.saveProgram(e)}}]),app.controller("addBrandAlertsCtrl",["$scope","httpData","$timeout","$window","$http",function(a,e,i,t,r){a.title="",a.brand_id="",a.titLen=0,a.has_save=!1;var n=layer.load(1),s={addNewsUrl:"/cms2/news/add?device=1",brandUrl:"/api2/res/brand?device=1",errorData:function(){layer.close(n),a.has_clicked=!1,layer.msg("请求失败",{icon:5})},uploadeFaceBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},uploadeListFaceSuccess:function(e){if(layer.closeAll("dialog"),1==e.status){var t=e.data[0].normal;a.listFace=imgUrl+t,a.picture=t,a.$apply()}else layer.msg("上传失败")},uploadeLinkFaceSuccess:function(e){layer.closeAll("dialog"),1==e.status?(company_id_image=e.data[0].normal,a.linkFace=imgUrl+company_id_image,a.linkFaceAddress=company_id_image,a.$apply()):layer.msg("上传失败")},getBrandList:function(){e.getData("GET",this.brandUrl,"",this.setBrandList,this.errorData)},setBrandList:function(e){layer.close(n),1==e.status&&(a.brand_list=e.list)},addNewsSuccess:function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),i(function(){layer.confirm("是否继续添加？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),t.location.reload()},function(e){a.jumpUrl("home.brandAlerts")})},1600)):layer.msg(e.msg,{icon:5,time:1500})},getNowFormatDate:function(){var e=new Date,t=e.getMonth()+1,a=e.getDate();return 1<=t&&t<=9&&(t="0"+t),0<=a&&a<=9&&(a="0"+a),e.getFullYear()+"-"+t+"-"+a+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},init:function(){this.getBrandList()}};s.init(),a.inputTit=function(){var e=a.title.length;38<=(a.titLen=e)&&(a.title=a.title.substr(0,37),a.titLen=38)},$("#start_time").datetimepicker({format:"yyyy-mm-dd hh:ii",autoclose:!0,minView:"hour",todayHighlight:1,clearBtn:!0,startDate:new Date}),angular.element("#list_face_input").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:s.uploadeFaceBefore,success:s.uploadeListFaceSuccess,xhrFields:{withCredentials:!0}};angular.element("#list_face").ajaxSubmit(e)}),angular.element("#link_face_input").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:s.uploadeFaceBefore,success:s.uploadeLinkFaceSuccess,xhrFields:{withCredentials:!0}};angular.element("#link_face").ajaxSubmit(e)});$("#summernote").summernote({height:700,lang:"zh-CN",toolbar:[["style",["style","bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["insert",["link","picture","video","codeview"]],["table",["table"]],["hr",["hr"]],["image",["undo","redo","removeMedia","help"]],["mybutton",["preview"]]],buttons:{preview:function(e){return $.summernote.ui.button({contents:'<i class="icon-columns"/> 预览',tooltip:"预览",click:function(){var e=$("#summernote").summernote("code"),t={title:a.title,picture:a.listFace,content:encodeURIComponent(e)};sessionStorage.preview_content=JSON.stringify(t),window.open("views/test/preview.html","预览","width=375,height=667")}}).render()},save:function(e){return $.summernote.ui.button({contents:'<i class="icon-save"/> 保存',tooltip:"保存",click:function(){}}).render()}}}),a.save=function(){if(a.has_save=!0,a.has_prev=!0,i(function(){a.has_save=!1,a.has_prev=!1},1500),a.title)if(a.brand_id)if(a.start_time)if(a.desc){var e={title:"",picture:"",future_time:"",content:"",desc:""},t=$("#summernote").summernote("code");e.title=a.title,e.desc=a.desc,e.picture=a.picture,e.future_time=Date.parse(a.start_time.replace(/-/g,"/")),e.content=encodeURIComponent(t),e.brand_id=a.brand_id,r({method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},url:BASEURL+s.addNewsUrl,data:e}).success(function(e){s.addNewsSuccess(e)}).error(function(e){s.errorData(e)})}else layer.msg("请填写快讯描述",{icon:5});else layer.msg("请选择推送时间",{icon:5});else layer.msg("请选择品牌",{icon:5});else layer.msg("请填写标题",{icon:5})}}]),app.controller("addCategoryCtrl",["$http","$scope","$location","$timeout",function(e,a,i,r){a.category_btn=!1,a.has_img=!1,a.filename="选择图片",a.category_picture="",a.fileChanged=function(e){if(a.files=e.files,a.files[0]){a.has_category=!0,a.filename=a.files[0].name,a.$apply();var t=a.files[0].name.lastIndexOf(".");a.format=a.files[0].name.slice(t+1)}};var t={url:BASEURL+"/api2/file/upload?device=1",type:"post",resetForm:!0,success:function(e){layer.close(n),1==e.status?(layer.msg("上传成功",{icon:1,time:1500}),a.category_picture=e.data[0].normal,a.has_img=!0,a.filename="选择图片",a.$apply()):layer.msg("上传失败",{icon:5,time:1500})},xhrFields:{withCredentials:!0}},n="";a.uploadImg=function(){if(a.filename){if("jpg"==a.format||"png"==a.format)return layer.msg("图片上传中...",{icon:16,time:0}),$("#advForm").ajaxSubmit(t),!1;layer.msg("图片格式不对，请重新选择！",{icon:5,time:1500})}else layer.msg("未选择图片！",{icon:5,time:1500})},a.addCategory=function(){a.category_btn=!0;var t=layer.msg("数据提交中...",{icon:16,time:0});e({method:"POST",url:BASEURL+"/cms2/category/add?device=1",params:{name:a.name,picture:a.category_picture}}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),r(function(){layer.confirm("是否还要继续添加？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0,anim:4},function(e){a.category_btn=!1,layer.close(e),window.location.reload()},function(e){layer.close(e),i.url("home/cms/ask/category"),a.$apply()})},2e3)):(layer.msg(e.msg,{icon:5,time:1500}),r(function(){a.category_btn=!1},2e3))})}}]),app.controller("addCompanyCtrl",["$scope","requestData","$window","$timeout",function(a,i,e,r){var n="",s={provinceUrl:"/api2/area/provinces?device=1",cityUrl:"/api2/area/cities?device=1",uploadUrl:"/api2/file/upload?device=1",submitUrl:"/cms2/company/add?device=1",provinceId:"",cityId:"",sendData:{account:"",company_name:"",company_id_code:"",corporation_name:"",corporation_idcard:"",province_id:"",city_id:"",company_lat:"",company_lng:"",company_id_image:"",company_address:""},setProvinceList:function(e){e.then(function(e){var t=e.data.list,a="";angular.forEach(t,function(e,t){a+='<option value="'+e.id+'">'+e.name+"</option>"}),angular.element("#province_lists").append(a),layui.use("form",function(){layui.form().render()})})},getProvinceData:function(){var e=i.getData("GET",this.provinceUrl,"");this.setProvinceList(e)},setCityList:function(e){e.then(function(e){var t=e.data.list,a="";angular.forEach(t,function(e,t){a+='<option value="'+e.id+'">'+e.name+"</option>"}),angular.element("#city_lists").append(a),layui.use("form",function(){layui.form().render()})})},getCityData:function(e){var t={province:e},a=i.getData("GET",this.cityUrl,t);this.setCityList(a)},uploadeLicenseBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},uploadeLicenseSuccess:function(e){if(layer.closeAll("dialog"),1==e.status){n=e.data[0].normal;var t=imgUrl+n;angular.element("#show_upload_img").attr("src",t)}else layer.msg("上传失败")},submitData:function(){var e=i.getData("POST",this.submitUrl,s.sendData);this.submitSuccessData(e)},submitSuccessData:function(e){e.then(function(e){var t=e.data;1==t.status?(layer.msg("添加成功",{icon:1,time:1e3}),r(function(){a.jump("/home/cms/company")},1500)):-1==t.status&&(layer.msg(t.msg,{icon:1,time:1e3}),layer.msg("统一信用代码重复",{icon:1,time:1e3}))})},init:function(){this.getProvinceData()}};s.init(),layui.use("form",function(){var e=layui.form();e.on("select(province)",function(e){var t=e.value;s.provinceId=t,angular.element("#city_lists").empty().append('<option value="">选择城市</option>'),s.getCityData(t)}),e.on("select(city)",function(e){var t=e.value;s.cityId=t}),e.on("submit(resource-management-form)",function(e){var t=angular.element("#resource-management"),a=t.find("input[name=logandlat]").val().split(",");s.sendData.account=t.find("input[name=account]").val(),s.sendData.company_name=t.find("input[name=company_name]").val(),s.sendData.company_id_code=t.find("input[name=company_id_code]").val(),s.sendData.company_id_image=n,s.sendData.corporation_name=t.find("input[name=corporation_name]").val(),s.sendData.corporation_idcard=t.find("input[name=corporation_idcard]").val(),s.sendData.province_id=t.find("select[name=province_id]").val(),s.sendData.city_id=t.find("select[name=city_id]").val(),s.sendData.company_address=t.find("input[name=company_address]").val(),s.sendData.company_lat=a[1],s.sendData.company_lng=a[0],s.submitData()})}),angular.element("#license").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:s.uploadeLicenseBefore,success:s.uploadeLicenseSuccess,xhrFields:{withCredentials:!0}};angular.element("#upload-license").ajaxSubmit(e)})}]),app.controller("addFinanciaLabelCtrl",["$scope","$http","$timeout","httpRequestData","$stateParams",function(a,i,r,n,e){a.title="新增",a.brand_list="";var s={province_url:"/api2/area/provinces?device=1",city_url:"/api2/area/cities?device=1",brand_url:"/api2/res/brand?device=1",requestError:function(){layer.msg("数据请求失败",{icon:5,time:2e3})},getProvinceList:function(){var e={req_data:{url:BASEURL+this.province_url},requestSuccess:this.setProvinceList,requestError:this.requestError};n.getData(e)},setProvinceList:function(e){1==e.status&&(a.province_list=e.list)},getCityList:function(e){var t={req_data:{url:BASEURL+this.city_url,params:{province:e}},requestSuccess:this.setCityList,requestError:this.requestError};n.getData(t)},setCityList:function(e){1==e.status&&(a.city_list=e.list)},getBrandList:function(){var e={req_data:{url:BASEURL+this.brand_url},requestSuccess:this.setBrandList,requestError:this.requestError};n.getData(e)},setBrandList:function(e){1==e.status&&(a.brand_list=e.list)},getSubBrandList:function(e){var t={req_data:{url:BASEURL+"/api2/res/brand/"+e+"?device=1"},requestSuccess:this.setSubBrandList,requestError:this.requestError};n.getData(t)},setSubBrandList:function(e){1==e.status&&(a.sub_brand_list=e.list)},init:function(){this.getProvinceList(),this.getBrandList()}};if(s.init(),a.changeProvince=function(){a.city_id="",a.city_list=[],a.province_id&&s.getCityList(a.province_id)},a.changeCity=function(){a.supplier_province_id="",a.provincesData=[]},a.brand_name="",a.changeBrand=function(){if(a.sub_brand_id="",a.sub_brand_list=[],a.brand_id){for(var e=0;e<a.brand_list.length;e++)a.brand_id==a.brand_list[e].id&&(a.brand_name=a.brand_list[e].name);s.getSubBrandList(a.brand_id)}},a.sub_brand_name="",a.changeSubBrand=function(){if(a.sub_brand_id)for(var e=0;e<a.sub_brand_list.length;e++)a.sub_brand_id==a.sub_brand_list[e].id&&(a.sub_brand_name=a.sub_brand_list[e].name)},a.financialData=[],a.add_fincal_name=function(){null==a.policy_detail||""==a.policy_detail?layer.msg("请填写内容",{icon:5,time:2e3}):(a.financialData.push(a.policy_detail),console.log(a.financialData),a.policy_detail="")},a.deleteFinancial=function(e){a.financialData.splice(e,1)},e.financeid){a.title="编辑",a.add=!1,a.save=!0;var t={req_data:{method:"GET",url:BASEURL+"/res_v1_0_0/cms/policy/detail?out=json&id="+e.financeid,timeout:1e4},requestSuccess:function(e){if(console.log(e),1==e.status){a.finance_id=e.data.financeId,a.province_id=e.data.provinceId+"",a.city_ID=e.data.cityId,a.brand_id=e.data.brandId+"",a.sub_brand_ID=e.data.subBrandId,-1!=e.data.policyDetail.indexOf(",")?a.financialData=e.data.policyDetail.split(","):a.financialData=new Array(e.data.policyDetail),a.brandname=e.data.brandName,a.subbrandname=e.data.subBrandName,a.city_id="",a.sub_brand_id="",a.sub_brand_name="",a.brand_name="";for(var t=0;t<a.brand_list.length;t++)a.brand_id==a.brand_list[t].id&&(a.brand_name=a.brand_list[t].name);i({method:"GET",url:BASEURL+s.city_url,params:{province:a.province_id}}).success(function(e){if(1==e.status){a.city_list=e.list;for(var t=0;t<e.list.length;t++)a.city_ID==e.list[t].id&&(a.city_id=e.list[t].id+"")}}).error(function(){layer.msg("数据请求失败",{icon:5,time:2e3})}),i({method:"GET",url:BASEURL+"/api2/res/brand/"+a.brand_id+"?device=1"}).success(function(e){if(1==e.status){a.sub_brand_list=e.list;for(var t=0;t<e.list.length;t++)a.sub_brand_ID==e.list[t].id&&(a.sub_brand_id=e.list[t].id+"",a.sub_brand_name=e.list[t].name)}}).error(function(){layer.msg("数据请求失败",{icon:5,time:2e3})})}},requestError:function(){layer.msg("数据请求失败",{icon:5,time:2e3})}};n.getData(t),a.editMsg=function(){if(null!=a.province_id&&null!=a.city_id&&null!=a.finance_id&&null!=a.brand_id&&null!=a.sub_brand_id&&0<a.financialData.length){var t=layer.msg("数据提交中...",{icon:16,time:0}),e={finance_id:a.finance_id,brand_id:a.brand_id,brand_name:a.brand_name,sub_brand_id:a.sub_brand_id,sub_brand_name:a.sub_brand_name,policy_name:"哈哈",policy_detail:a.financialData,province_id:a.province_id,city_id:a.city_id};console.log(JSON.stringify(e)),i({url:BASEURL+"/res_v1_0_0/cms/policy/edit?out=json",method:"POST",timeout:1e4,headers:{"Content-Type":"application/json;charset=UTF-8"},params:{finance_id:a.finance_id,brand_id:a.brand_id,brand_name:a.brand_name,sub_brand_id:a.sub_brand_id,sub_brand_name:a.sub_brand_name,policy_name:"哈哈",policy_detail:a.financialData,province_id:a.province_id,city_id:a.city_id}}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.data,{icon:1,time:1500}),r(function(){layer.confirm("是否还要继续添加？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0,anim:4},function(e){a.supplier_btn=!1,layer.close(e),window.location.reload()},function(e){layer.close(e),a.jump("/home/cms/FinanciaLabelList"),a.$apply()})},2e3)):(layer.msg(e.data,{icon:5,time:2e3}),r(function(){a.supplier_btn=!1},2500))}).error(function(){})}else layer.msg("请把内容填写完整",{icon:5,time:2e3})}}else{a.add=!0,a.save=!1;var o=[{detail_id:15615156,content:"金融政策1"},{detail_id:15615156,content:"金融政策1"},{detail_id:15615156,content:"金融政策1"},{detail_id:15615156,content:"金融政策1"}];a.sendMsg=function(){if(null!=a.province_id&&null!=a.city_id&&null!=a.brand_id&&null!=a.sub_brand_id&&0<a.financialData.length){var t=layer.msg("数据提交中...",{icon:16,time:0});i({url:BASEURL+"/res_v1_0_0/cms/policy/insert?out=json",method:"POST",timeout:1e4,headers:{"Content-Type":"application/json;charset=UTF-8"},params:{brand_id:a.brand_id,brand_name:a.brand_name,sub_brand_id:a.sub_brand_id,sub_brand_name:a.sub_brand_name,policy_name:"哈哈",policy_detail:JSON.stringify(o),province_id:a.province_id,city_id:a.city_id}}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.data,{icon:1,time:1500}),r(function(){layer.confirm("是否还要继续添加？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0,anim:4},function(e){a.supplier_btn=!1,layer.close(e),window.location.reload()},function(e){layer.close(e),a.jump("/home/cms/FinanciaLabelList"),a.$apply()})},2e3)):(layer.msg(e.data,{icon:5,time:2e3}),r(function(){a.supplier_btn=!1},2500))}).error(function(){})}else layer.msg("请把内容填写完整",{icon:5,time:2e3})}}}]),app.controller("addJustRentCtrl",["$scope","$window","$timeout","$state","$stateParams","httpRequestData",function(s,t,a,i,n,r){s.data={areas:"",carAscription:"",coefficIent:"",commission:"",commissionGps:"",commissionHead:"",commissionProcedure:"",companyCost:"",companyId:"",downPayment:"",financeDesc:"",financeGps:"",financeInsure:"",financeProcedure:"",headRate:"",id:"",isFinance:0,isZeroPayment:0,mobile:"",name:"",proposerAge:"",proposerCard:"",proposerRests:"",purchaseTax:0,financeType:1},s.coefficIentLists=[{data:""},{data:""},{data:""},{data:""},{data:""}],s.commissionLists=[{data:""},{data:""},{data:""},{data:""},{data:""}];var e=function(){this.add_program_url="/res_v1_0_0/cms/finance/program/insert",this.company_url="/cms2/company/datas?device=1&co_type=4",this.program_detail_url="/res_v1_0_0/cms/finance/program/detail?out=json",this.update_program_url="/res_v1_0_0/cms/finance/program/update?out=json"};e.prototype={stateError:function(e){layer.closeAll("loading"),s.hasClicked=!1,layer.msg(e)},httpError:function(){layer.closeAll("loading"),s.hasClicked=!1,layer.msg("请求失败",{icon:5})},companyLists:function(){layer.load(1);var e=this,t={req_data:{method:"GET",url:BASEURL+e.company_url},requestSuccess:e.setCompLists.bind(e),requestErroe:e.httpError.bind(e)};r.getData(t)},setCompLists:function(e){layer.closeAll("loading"),1==e.status?s.companyLists=e.list:this.stateError(e.data)},saveProgram:function(e){layer.load(1);var t=this,a={req_data:{method:"POST",url:BASEURL+t.add_program_url,data:e},requestSuccess:t.saveProgramSuccess.bind(t),requestErroe:t.httpError.bind(t)};r.getData(a)},saveProgramSuccess:function(e){if(layer.closeAll("loading"),1==e.status){if(layer.msg(e.msg,{icon:1,time:1500}),n.id)return void a(function(){i.go("home.justRentProgram")},1600);a(function(){layer.confirm("是否继续发布？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),t.location.reload()},function(e){layer.close(e),i.go("home.justRentProgram")})},1600)}else this.stateError(e.data)},paramsId:function(){s.title="新增正租方案";var e=n.id;e&&(s.title="编辑正租方案",s.data.id=e,this.programDetail())},programDetail:function(){var e=this,t={req_data:{method:"GET",url:BASEURL+e.program_detail_url,params:{id:n.id}},requestSuccess:e.setProgramDetail.bind(e),requestError:e.httpError.bind(e)};layer.load(1),r.getData(t)},setProgramDetail:function(e){if(layer.closeAll("loading"),1==e.status){var t=e.data;if(s.data.carAscription=t.finance.carAscription,s.data.mobile=t.finance.mobile,s.data.financeDesc=t.finance.financeDesc,s.data.proposerAge=t.finance.proposerAge,s.data.proposerCard=t.finance.proposerCard,s.data.proposerRests=t.finance.proposerRests,s.data.name=t.finance.name,s.data.companyId=t.finance.companyId,s.data.downPayment=parseFloat((100*t.finance.downPayment).toFixed(2)),s.data.headRate=parseFloat((100*t.finance.headRate).toFixed(2)),t.finance.purchaseTax&&(s.purchase_tax=!0),t.finance.financeGps&&(s.gps=!0,s.data.financeGps=parseFloat((t.finance.financeGps/100).toFixed(2))),t.finance.financeInsure&&(s.insurance=!0,s.data.financeInsure=parseFloat((100*t.finance.financeInsure).toFixed(2))),t.finance.financeProcedure&&(s.service_charge=!0,s.data.financeProcedure=parseFloat((t.finance.financeProcedure/100).toFixed(2))),t.finance.isFinance&&(s.is_finance=!0),t.finance.commissionHead&&(s.c_head=!0,s.data.commissionHead=parseFloat((t.finance.commissionHead/100).toFixed(2))),t.finance.commissionGps&&(s.c_gps=!0,s.data.commissionGps=parseFloat((t.finance.commissionGps/100).toFixed(2))),t.finance.commissionProcedure&&(s.c_procedure=!0,s.data.commissionProcedure=parseFloat((t.finance.commissionProcedure/100).toFixed(2))),t.finance.isZeroPayment&&(s.is_zero_payment=!0,s.c_gps=!0,s.c_procedure=!0,s.data.commissionGps="",s.data.commissionProcedure=""),0<t.commiss.length&&(s.rebate=!0,angular.forEach(t.commiss,function(e,t){var a=e.financeYear-1,i=parseFloat((100*e.commission).toFixed(2));s.commissionLists[a].data=i})),0<t.area.length){s.isShowArea=!0;var r=[],n=[];angular.forEach(t.area,function(e,t){var a=e.provinceId+","+e.cityId+","+e.districtId,i={p_name:e.provinceName,c_name:e.cityName,t_name:e.districtName};r.push(a),n.push(i)}),s.selAreaLists=n,s.selAreaIdLists=r}0<t.coee.length&&angular.forEach(t.coee,function(e,t){var a=e.financeYear-1,i=e.coefficient;s.coefficIentLists[a].data=i})}else this.stateError(e.data)},updateProgram:function(e){layer.load(1);var t=this,a={req_data:{method:"POST",url:BASEURL+t.update_program_url,data:e},requestSuccess:t.saveProgramSuccess.bind(t),requestErroe:t.httpError.bind(t)};r.getData(a)},roundFun:function(e,t){var a=e+"",i=a.indexOf(".");return-1==i?e.toFixed(t):a.substring(0,i+parseInt(t+1))},init:function(){this.paramsId(),this.companyLists()}};var o=new e;o.init(),s.seleZeroPay=function(){s.is_zero_payment?(s.data.isZeroPayment=1,s.c_gps=!1,s.data.commissionGps="",s.c_procedure=!1,s.data.commissionProcedure=""):s.data.isZeroPayment=0},s.seleRebate=function(){s.rebate||angular.forEach(s.commissionLists,function(e,t){e.data=""})},s.selePurchaseTax=function(){s.purchase_tax?s.data.purchaseTax=1:s.data.purchaseTax=0},s.seleGps=function(){s.gps||(s.data.financeGps="")},s.seleInsurance=function(){s.insurance||(s.data.financeInsure="")},s.seleFinanceProcedure=function(){s.service_charge||(s.data.financeProcedure="")},s.seleFinance=function(){s.is_finance?s.data.isFinance=1:s.data.isFinance=0},s.seleCommissionHead=function(){s.c_head||(s.data.commissionHead="")},s.seleCommissionGps=function(){s.c_gps||(s.data.commissionGps="")},s.seleCommissionProcedure=function(){s.c_procedure||(s.data.commissionProcedure="")},s.saveProgram=function(){s.hasClicked=!0;var e=angular.copy(s.data),t=s.selAreaIdLists.join("|");e.areas=t;var i=[];angular.forEach(s.coefficIentLists,function(e,t){if(e.data){var a=t+1+","+e.data;i.push(a)}}),e.coefficIent=i.join("|");var r=[];angular.forEach(s.commissionLists,function(e,t){if(e.data){var a=t+1+","+o.roundFun(e.data/100,3);r.push(a)}}),e.commission=r.join("|"),e.downPayment=o.roundFun(s.data.downPayment/100,3),e.headRate=o.roundFun(s.data.headRate/100,3),s.data.financeGps&&(e.financeGps=100*s.data.financeGps),s.data.financeInsure&&(e.financeInsure=o.roundFun(s.data.financeInsure/100,3)),s.data.financeProcedure&&(e.financeProcedure=100*s.data.financeProcedure),s.data.commissionHead&&(e.commissionHead=o.roundFun(s.data.commissionHead/100,3)),s.data.commissionGps&&(e.commissionGps=100*s.data.commissionGps),s.data.commissionProcedure&&(e.commissionProcedure=100*s.data.commissionProcedure),n.id?o.updateProgram(e):o.saveProgram(e)}}]),app.controller("insuranceListCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state","$http",function(c,t,a,e,l,i,r){c.startDate=l.startDate,c.endDate=l.endDate,c.status=l.status?l.status:"99",c.proviceId=l.proviceId,c.cityId=l.cityId,c.keyWords=l.keywords,c.statusActive=1==l.statusType,console.log(c.status);new Date;var n=layer.load(1);c.has_clicked=!1,c.orderData=[];var s={province_url:"/api2/area/provinces?device=1",city_url:"/api2/area/cities?device=1",county_url:"/api2/area/areas?device=1",order_url:"/cms2/insurace/list?device=1",proviceId:"",cityId:"",listsSendData:{page_index:1,page_size:10,state:0,startDate:"",endDate:"",proviceId:"",cityId:"",keywords:""},init:function(){this.getDataFromUrl(),this.getProvince(),this.getOrderList()},errorData:function(){layer.close(n),c.has_clicked=!1,layer.msg("请求失败",{icon:5})},getOrderList:function(){t.getData("GET",this.order_url,this.listsSendData,this.setOrderList,this.errorData)},setOrderList:function(e){layer.close(n),1==e.status&&(1==e.status?(c.orderData=e.list,c.pageNumber=e.page.pageNumber,c.recordCount=e.page.recordCount,c.pageCount=e.page.pageCount,c.pageSize=e.page.pageSize,c.pageList=c.pageNum(c.pageCount,c.pageNumber),c.startData=0==c.recordCount?0:(c.pageNumber-1)*c.pageSize+1,c.endData=e.list.length<c.pageSize?(c.pageNumber-1)*c.pageSize+e.list.length:c.pageNumber*c.pageSize):layer.msg("请求失败",{icon:5}))},getProvince:function(){t.getData("GET",this.province_url,"",this.setProvince,this.errorData)},setProvince:function(e){1==e.status&&(c.province_list=e.list)},getCity:function(e){t.getData("GET",this.city_url,{province:e},this.setCity,this.errorData)},setCity:function(e){1==e.status&&(c.city_list=e.list)},getCounty:function(e){t.getData("GET",this.county_url,{province:e},this.setCounty,this.errorData)},setCounty:function(e){1==e.status&&(c.county_list=e.list)},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]},getDataFromUrl:function(){var e=l.page_index,t=l.startDate,a=l.endDate,i=l.status,r=l.proviceId,n=l.cityId,s=l.keywords;e||(e=1),i&&"99"!=i||(i=""),c.status=i||"99";var o="99"==c.status?1:"";i||1==e||(o=c.status=""),c.proviceId=r,c.cityId=n,this.listsSendData={pageIndex:e,pageSize:10,status:i,startDate:t,endDate:a,proviceId:r,cityId:n,keywords:s,statusType:o}},selectData:function(){var e="99"==c.status?1:"";s.listsSendData.status="99"==c.status?"":c.status,s.listsSendData.proviceId=c.proviceId,s.listsSendData.cityId=c.cityId,s.listsSendData.startDate=c.startDate,s.listsSendData.endDate=c.endDate,s.listsSendData.keywords=c.keyWords,s.listsSendData.statusType=e,i.go("home.insuranceList",this.listsSendData)}};s.init(),null!=l.proviceId?(s.getCity(l.proviceId),c.cityId=l.cityId):(c.city_list="",c.cityId="",c.county_list=""),null!=l.cityId?s.getCounty(l.cityId):c.county_list="",c.changeProvince=function(){c.county_list="",c.cityId="",c.city_list="",s.selectData()},c.changeCity=function(){c.county_list="",s.selectData()},c.changeState=function(){s.selectData()},$("#startDate").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){console.log(e),s.selectData()}),$("#endDate").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){s.selectData()}),c.changeState=function(){s.selectData()},c.order_search=function(){var e="99"==c.status?1:"";s.listsSendData.status="99"==c.status?"":c.status,s.listsSendData.proviceId=c.proviceId,s.listsSendData.cityId=c.cityId,s.listsSendData.startDate=c.startDate,s.listsSendData.endDate=c.endDate,s.listsSendData.keywords=c.keyWords,s.listsSendData.statusType=e,t.getData("GET",s.order_url,s.listsSendData,s.setOrderList,s.errorData)},c.statusFilter=function(e){c.statusActive=e,s.listsSendData.pageIndex=1,s.listsSendData.statusType=e?1:2,c.order_search()},c.pass=function(e,t){r({method:"POST",url:BASEURL+"/cms2/insurace/auditMaterial",timeout:1e4,params:{type:e,device:1,orderSeq:t}}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),a.location.reload()):layer.msg(e.msg,{icon:5,time:1500})}).error(function(e){})},c.auditFaileMaterial=function(e){""!=c.remark&&null!=c.remark?r({method:"POST",url:BASEURL+"/cms2/insurace/auditMaterial",timeout:1e4,params:{type:e,msg:c.remark,device:1,orderSeq:c.orderId}}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),a.location.reload()):layer.msg(e.msg,{icon:5,time:1500}),$("#notadopt").modal("hide")}).error(function(e){}):alert("原因必填")},c.passRefund=function(e,t){r({method:"POST",url:BASEURL+"/cms2/insurace/refund",timeout:1e4,params:{type:e,device:1,orderSeq:t}}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),a.location.reload()):layer.msg(e.msg,{icon:5,time:1500})}).error(function(e){})},c.rejectRefund=function(e){""!=c.remark&&null!=c.remark?r({method:"POST",url:BASEURL+"/cms2/insurace/refund",timeout:1e4,params:{type:e,remark:c.remark,device:1,orderSeq:c.orderId}}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),a.location.reload()):layer.msg(e.msg,{icon:5,time:1500}),$("#notadopt").modal("hide")}).error(function(e){}):alert("原因必填")},c.buyFailedRefund=function(){""!=c.remark&&null!=c.remark?r({method:"POST",url:BASEURL+"/cms2/insurace/buyFailure",timeout:1e4,params:{msg:c.remark,device:1,orderSeq:c.orderId}}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),a.location.reload()):layer.msg(e.msg,{icon:5,time:1500}),$("#notadopt").modal("hide")}).error(function(e){}):alert("原因必填")},c.getId=function(e){c.orderId=e},c.changeStatus=function(){s.listsSendData.pageIndex=1,c.order_search()},c.changePageUrl=function(e){s.listsSendData.page_index=c.getPageIndex(e,c.pageNumber,c.pageCount),s.listsSendData.status=c.status,i.go("home.insuranceList",s.listsSendData)}}]),app.controller("addMenuCtrl",["$http","$scope","$timeout","httpData",function(e,a,t,i){a.addMenu_btn=!1;var r={addMenuUrl:"/cms2/menu/add?device=1",errorData:function(){layer.closeAll("dialog"),a.addMenu_btn=!1,layer.msg("请求失败",{icon:5})},uploadBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},uploadTitleSuccess:function(e){if(layer.closeAll("dialog"),1==e.status){var t=e.data[0].normal;a.icon=imgUrl+t,a.picture=t,a.$apply()}else layer.msg("上传失败")},addMenuFn:function(e){layer.msg("数据提交中...",{icon:16,time:0}),i.getData("POST",this.addMenuUrl,e,this.setSuccessAdd,this.errorData)},setSuccessAdd:function(e){a.addMenu_btn=!1,layer.closeAll("dialog"),1==e.status?(layer.msg("添加成功",{icon:1,time:1500}),t(function(){layer.confirm("是否继续添加？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),$window.location.reload()},function(e){a.jumpUrl("home.menu")})},1600)):layer.msg(e.msg,{icon:5,time:1500})}};angular.element("#icon_input").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:r.uploadBefore,success:r.uploadTitleSuccess,xhrFields:{withCredentials:!0}};angular.element("#icon").ajaxSubmit(e)}),a.alias_name="",a.menu_uri="",a.remark="",a.picture="",a.is_new="0",a.code="",a.menu_params="",a.addMenu=function(){if(a.name)if(a.type){var e={name:a.name,alias_name:a.alias_name,code:a.code,parent_id:0,menu_uri:a.menu_uri,type:a.type,remark:a.remark,picture:a.picture,is_new:a.is_new,menu_params:a.menu_params};console.log(e),r.addMenuFn(e)}else layer.msg("请选择菜单类型");else layer.msg("请输入菜单名称")}}]),app.controller("addPlanCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state","$http",function(o,a,e,t,i,r,n){i.id;var s=i.type;o.type=s,o.title=1==s?"新增回租资源方案":"新增正租资源方案",o.orderSelectAraeData=[],o.showOrderSelectAraeData=[],o.select_id_lists=[],o.current_provice_id="over",o.current_city_id=0,o.current_town_id=0,o.current_provice_name="全国",o.current_city_name="全省",o.current_town_name="全城",o.isShow=!1;var c="",l={proviceUrl:"/api2/area/provinces?device=1",cityUrl:"/api2/area/cities?device=1",townUrl:"/api2/area/areas?device=1",errorAlert:function(){layer.msg("请求失败",{icon:5})},setProvice:function(e){1===e.status&&(o.proviceLists=e.list,o.proviceLists.unshift({id:0,name:"全国"}))},setCity:function(e){1===e.status&&(o.cityLists=e.list,o.cityLists.unshift({id:0,name:"全省"}))},setTown:function(e){1===e.status&&(o.townLists=e.list,o.townLists.unshift({id:0,name:"全城"}))},getProvice:function(){a.getData("GET",this.proviceUrl,"",this.setProvice,this.errorAlert)},getCity:function(e){var t={province:e};a.getData("GET",this.cityUrl,t,this.setCity,this.errorAlert)},getTown:function(e){var t={province:e};a.getData("GET",this.townUrl,t,this.setTown,this.errorAlert)},modify:function(e,t){o.select_id_lists.push(e),o.orderSelectAraeData.push(t),o.showOrderSelectAraeData=o.orderSelectAraeData},trimData:function(e){o.select_id_lists.splice(e,1),o.orderSelectAraeData.splice(e,1)},removal:function(){var r=this,e=o.current_provice_id+","+o.current_city_id+","+o.current_town_id,t={p_name:o.current_provice_name,c_name:o.current_city_name,t_name:o.current_town_name};if(o.select_id_lists.length<=0)r.modify(e,t);else{if(0==o.current_provice_id)return o.orderSelectAraeData=[],o.select_id_lists=[],r.modify(e,t),!1;if(o.select_id_lists.forEach(function(e,t){0==e.split(",")[0]&&r.trimData(t)}),0==o.current_city_id)return o.select_id_lists.forEach(function(e,t){e.split(",")[0]==o.current_provice_id&&r.trimData(t)}),o.select_id_lists.forEach(function(e,t){e.split(",")[0]==o.current_provice_id&&r.trimData(t)}),this.modify(e,t),!1;if(0==o.current_town_id)return o.select_id_lists.forEach(function(e,t){var a=e.split(",")[0],i=e.split(",")[1];i!=o.current_city_id&&0!=i||a!=o.current_provice_id||r.trimData(t)}),console.log(o.select_id_lists),o.select_id_lists.forEach(function(e,t){e.split(",")[1]==o.current_city_id&&r.trimData(t)}),this.modify(e,t),!1;o.select_id_lists.forEach(function(e,t){var a=e.split(",")[0];0==e.split(",")[2]&&a==o.current_provice_id&&r.trimData(t)}),-1==$.inArray(e,o.select_id_lists)?r.modify(e,t):layer.msg("当前区域已选择！",{icon:1})}},init:function(){this.getProvice()}};l.init(),o.selectProvice=function(e,t,a){o.cityLists=[],o.townLists=[],o.current_city_id=0,o.current_town_id=0,o.current_city_name="全省",o.current_town_name="全城";var i=e.currentTarget;$(i).hasClass("active")?($(i).removeClass("active"),o.current_provice_id="over"):($(i).addClass("active"),$(i).siblings().removeClass("active"),0!=t?(o.current_provice_id=t,o.current_provice_name=a,l.getCity(t)):(o.current_provice_id=0,o.current_provice_name="全国"))},o.selectCity=function(e,t,a){o.townLists=[],o.current_town_id=0,o.current_town_name="全城";var i=e.currentTarget;$(i).hasClass("active")?($(i).removeClass("active"),o.current_city_id=0,o.current_city_name="全省"):($(i).addClass("active"),$(i).siblings().removeClass("active"),o.current_city_name=a,0!=t?(l.getTown(t),o.current_city_id=t):o.current_city_id=0)},o.selectTown=function(e,t,a){var i=e.currentTarget;$(i).hasClass("active")?($(i).removeClass("active"),o.current_town_name="全城",o.current_town_id=0):($(i).addClass("active"),$(i).siblings().removeClass("active"),o.current_town_name=a,o.current_town_id=t)},o.orderSelectArea=function(){"over"!=o.current_provice_id?(l.removal(),c=o.select_id_lists.join("|"),console.log(c)):layer.msg("请求选择区域",{icon:5,time:1e3})},o.delete=function(e){l.trimData(e),c=o.select_id_lists.join("|"),console.log(c)},o.showSelectArea=function(){o.isShow=!1},o.has_click_btn=!1,o.financialCompanyList="";var d={company_url:"/cms2/company/datas?device=1",add_url:"/cms2/finance/program/add?device=1",init:function(){this.getFinancialCompany()},getFinancialCompany:function(){a.getData("GET",this.company_url,{co_type:4},this.setFinancialCompany,this.errorData)},setFinancialCompany:function(e){1==e.status&&(o.financialCompanyList=e.list)},saveProgram:function(e){a.getData("POST",this.add_url,e,this.addProgramSuccess,this.errorData)},addProgramSuccess:function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),o.has_click_btn=!1):(o.has_click_btn=!1,layer.msg(e.msg,{icon:0,time:1500}))},errorData:function(){o.has_click_btn=!1,layer.msg("请求失败",{icon:5})}};d.init(),o.company_id="",o.name="",o.down_payment="",o.finance_gps="",o.finance_insure="",o.finance_procedure="",o.finance_desc="",o.proposer_age="",o.proposer_card="",o.proposer_rests="",o.commission_gps="",o.commission_procedure="",o.purchase_tax=!1,o.is_finance=!1,o.is_zero_payment=!1,o.company_cost=1950,o.mobile="",o.head_rate="",o.commission_head="",o.saveProgram=function(){var e=0;1==o.is_zero_payment?(e=1,o.commission_gps="",o.commission_procedure=""):(0==o.c_gps&&(o.commission_gps=""),0==o.c_procedure&&(o.commission_procedure="")),0==o.gps&&(o.finance_gps=""),0==o.insurance&&(o.finance_insure=""),0==o.service_charge&&(o.finance_procedure=""),0==o.c_head&&(o.commission_head="");var t={company_id:o.company_id,name:o.name,areas:c,coefficient:"",down_payment:o.down_payment/100,purchase_tax:0,finance_gps:o.finance_gps,finance_insure:o.finance_insure/100,finance_procedure:o.finance_procedure,commission:"",is_finance:0,commission_gps:o.commission_gps,commission_procedure:o.commission_procedure,finance_desc:o.finance_desc,proposer_age:o.proposer_age,proposer_card:o.proposer_card,proposer_rests:o.proposer_rests,mobile:o.mobile,is_zero_payment:e,company_cost:o.company_cost,commission_head:o.commission_head/100,head_rate:o.head_rate/100};t.areas=c,0==o.purchase_tax?t.purchase_tax=0:t.purchase_tax=1,0==o.is_finance?t.is_finance=0:t.is_finance=1;var r=[];$("#coefficient .input-group").each(function(e){var t=$(this).find("span").attr("data-year"),a=$(this).find("input").val(),i={};i.year=t,(i.num=a)&&r.push(i)});for(var a="",i=0;i<r.length;i++)a+=r[i].year+","+r[i].num+"|";if(t.coefficient=a.slice(0,-1),o.rebate){var n=[];$("#commission .input-group").each(function(e){var t=$(this).find("span").attr("data-year"),a=$(this).find("input").val()/100,i={};i.year=t,(i.num=a)&&n.push(i)});var s="";for(i=0;i<n.length;i++)s+=n[i].year+","+n[i].num+"|";t.commission=s.slice(0,-1)}console.log(t),""==c?layer.msg("请选择地区"):""==o.company_id?layer.msg("请选择金融公司"):""==o.name?layer.msg("请输入方案名称"):""==a?layer.msg("请输入万元系数"):(o.has_click_btn=!0,d.saveProgram(t))}}]),app.controller("addResourceCtrl",["$http","$scope","$stateParams","$timeout","$cookieStore",function(d,u,e,m,p){u.requsFlag=!1,u.modelDeleteShow="",u.pinLists=!0,u.modelisthasshow=!0,u.modelLists=[];var i="";u.subPinBtn=!0;var r="";u.exteriorColor="",u.trimColor="",u.cityBtnShow=!0,u.favourableMode="money",u.editFavourableMode="money",u.current_index="",u.has_use_click=!0,u.has_use_attr_click=!0,u.has_use_attr_click=!0,u.attachment=0,u.editattachment=0,u.has_send_btn=!0,u.editFlag=!0,u.edit_btn=!1,u.editOverList=[];var t={id:0,name:"全国"},a={id:0,name:"全省"};function _(e){var t=[],a=e.split("|");if(1<a.length)for(var i=0,r=a.length;i<r;i++){var n={pid:"",spid:"",pname:""},s=a[i].split(",");n.pid=s[0],n.pname=s[1],n.spid=s[2],t.push(n)}else(n={pid:"",spid:"",pname:""}).pid=e.split(",")[0],n.pname=e.split(",")[1],n.spid=e.split(",")[2],t.push(n);return t}if(u.publishObj=[],null==p.get("hotList"))u.publishListShow=!0;else{u.publishListShow=!1;var n=p.get("hotList");null!=n&&(u.publishObj=_(n).reverse())}function s(e,t){var a=$(e).length;if($(t).find("option").remove(),"#resSubModelLists"==t){$(t).append($('<option value="">—选择子品牌—</option>'));for(var i=0;i<a;i++)$(t).append($("<option value="+e[i].id+">"+e[i].name+"</option>"))}else if("#modelBrand"==t){$(t).append($('<option value="">—选择车型—</option>'));for(i=0;i<a;i++)0==i?$(t).append($('<option value="-1" disabled>'+e[i].initial+"</option>")):e[i-1].initial==e[i].initial||$(t).append($('<option value="-1" disabled>'+e[i].initial+"</option>")),$(t).append($("<option value="+e[i].id+">"+e[i].initial+" "+e[i].name+"</option>"))}else{$(t).append($('<option value="">—选择城市—</option>')),$(t).append($('<option value="0">全省</option>'));for(i=0;i<a;i++)$(t).append($("<option value="+e[i].id+">"+e[i].name+"</option>"))}}function o(e,t){for(var a=0;a<e.length;a++)if(e[a]==t){e.splice(a,1);break}}function c(){0==u.modelLists.length&&(u.modelLists=[],u.has_send_btn=!0,u.edit_btn=!1)}function l(e,t){d({method:"GET",url:BASEURL+"/api2/res/model/"+e+"/"+t+"?device=1",timeout:1e4}).success(function(e){if(u.modelYearLists=[],u.allModelList={},1==e.status){for(var t=e.list,a=t.length,i=0;i<a;i++)0==u.modelYearLists.length?u.modelYearLists.push(t[i].year):-1==$.inArray(t[i].year,u.modelYearLists)&&u.modelYearLists.push(t[i].year);for(var r=0,n=u.modelYearLists.length;r<n;r++){u.allModelList[u.modelYearLists[r]]=[];for(var s=0;s<a;s++)t[s].year==u.modelYearLists[r]&&(u.allModelList[u.modelYearLists[r]].push(t[s]),u.pinLists=!1,u.has_use_click=!1,u.has_use_attr_click=!1)}u.modelYearLists=u.modelYearLists.sort()}else layer.msg("请求失败",{icon:5});angular.element("#pinlists").find(".active").removeClass("active")}).error(function(){})}d({method:"GET",url:BASEURL+"/api2/res/brand?device=1",timeout:1e4}).success(function(e){1==e.status?(u.resourceModelData=e.list,s(u.resourceModelData,"#modelBrand"),layui.use("form",function(){layui.form().render()})):layer.msg("请求失败",{icon:5})}).error(function(e){}),layui.use(["element","form","laydate"],function(){var e=layui.element(),a=layui.form();layui.laydate();e.init(),a.render(),a.on("select(modelBrand)",function(e){var t;u.resourceSeller="",u.sellerAddress="",u.supplier_leader_name="",u.supplier_leader_mobile="",u.resourceSellerList=[],u.editResourceSeller="",u.edit_seller="",u.edit_seller="",u.editSellerAddress="",u.edit_supplier_leader_name="",u.edit_supplier_leader_mobile="",u.editResourceSellerList=[],u.subPinBtn=!1,u.pinLists=!0,u.modelBrandId=e.value,i=$(e.elem).find("option:selected")[0].value,u.modelLists=[],u.modelisthasshow=!0,u.allModelList={},u.modelYearLists=[],u.pinLists=!0,t=e.value,d({method:"GET",url:BASEURL+"/api2/res/brand/"+t+"?device=1",timeout:1e4}).success(function(e){1==e.status?(s(e.list,"#resSubModelLists"),layui.use(["form"],function(){layui.form().render("select")})):layer.msg("请求失败",{icon:5})}).error(function(){}),a.render("select")}),u.modelYearLists=[],u.allModelList={},u.dataStateFlag=!0,u.dataColorFlag=!0,u.dataLeaderFlag=!0,u.dataCreateFlag=!0,u.dataPriceFlag=!1,u.dataTypeFlag=!0,a.on("select(modelSubBrand)",function(e){u.resourceSeller="",u.sellerAddress="",u.supplier_leader_name="",u.supplier_leader_mobile="",u.resourceSellerList=[],u.editResourceSeller="",u.edit_seller="",u.editSellerAddress="",u.edit_supplier_leader_name="",u.edit_supplier_leader_mobile="",u.editResourceSellerList=[],u.modelLists=[],u.edit_seller="",u.modelisthasshow=!0,u.modelSubBrandId=e.value,u.currentSubPin=r=$(e.elem).find("option:selected")[0].innerHTML,l(u.modelBrandId,e.value),a.render()}),e.on("tab(favourable)",function(e){switch(e.index){case 0:u.favourableMode="money",u.favourablepoint="",u.sale_price="";break;case 1:u.favourableMode="point",u.favourablemoney="",u.sale_price="";break;default:u.favourableMode="price",u.favourablepoint="",u.favourablemoney=""}}),a.on("select(type)",function(e){u.type=e.value}),a.on("select(manufacture)",function(e){u.manufacture=e.value}),a.on("switch(attachment)",function(e){this.checked?u.attachment=0:u.attachment=1}),a.on("switch(editattachment)",function(e){u.dataStateFlag=!0,this.checked?(u.modelLists[u.current_index].modelInfoData.attachment=0,u.editAttachment=0,u.shouxu=0):(u.modelLists[u.current_index].modelInfoData.attachment=1,u.editAttachment=1,u.shouxu=1)}),a.on("select(editmanufacture)",function(e){switch(u.dataCreateFlag=!0,u.editManufacture=e.value,e.value){case 0:u.modelLists[u.current_index].modelInfoData.manufacture="一年";break;case 1:u.modelLists[u.current_index].modelInfoData.manufacture="半年";break;default:u.modelLists[u.current_index].modelInfoData.manufacture="三个月"}}),a.on("select(edittype)",function(e){u.editType=e.value}),e.on("tab(editfavourable)",function(e){switch(e.index){case 0:u.editFavourableMode="money",u.editFavourablepoint="";break;case 1:u.editFavourableMode="point",u.editFavourablemoney="";break;default:u.editFavourableMode="price",u.editFavourablepoint="",u.editFavourablemoney=""}}),e.on("tab(editfavourable)",function(e){switch(e.index){case 0:u.editFavourableMode="money",u.editfavourablepoint="",u.edit_sale_price="";break;case 1:u.editFavourableMode="point",u.editfavourablemoney="",u.edit_sale_price="";break;default:u.editFavourableMode="price",u.editfavourablepoint="",u.editfavourablemoney=""}})}),u.modelYearListSelect=function(e){$(e.currentTarget).addClass("layui-this").siblings().removeClass("layui-this")},u.selectModelList=function(e,t){u.has_send_btn=!1;e.modelInfoData={pin:"",subPin:""},e.modelInfoData.pin=i,e.modelInfoData.subPin=r,u.modelisthasshow=!1,$(t.currentTarget).hasClass("active")?($(t.currentTarget).removeClass("active"),o(u.modelLists,e),o(u.editOverList,e.id),0==u.modelLists.length&&(u.modelisthasshow=!0)):($(t.currentTarget).addClass("active"),u.modelLists.push(e),u.edit_btn=!1),c()},u.edit_out_color="",u.edit_out_color_glag=!0,u.edit_in_color="",u.edit_in_color_glag=!0,u.edit_seller="",u.edit_seller_flag=!0,u.edit_area="",u.edit_area_flag=!0,u.edit_create_data="",u.edit_create_data_flag=!0,u.edit_model="",u.edit_model_ok_flag=!0,u.edit_car_type="",u.edit_car_type_flag=!0,u.edit_file="",u.edit_file_flag=!0,u.edit_show_price="",u.edit_show_price_flag=!0,u.edit_provice_id=0,u.editProviceName="",u.edit_city_id=0,u.editCityName="";var g={};function f(e){u.editAreaJoin="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo.cId,i=(e[t].data.cityInfo.cName,e[t].data.pId);e[t].data.pName;0!=t?u.editAreaJoin+="|"+i+","+a:u.editAreaJoin=i+","+a}u.editCityBtnShow=!0}function h(e,t,a){d({method:"GET",url:BASEURL+"/cms2/supplier/datas/v2?pageindex=1&pagesize=100&device=1",params:{brand_id:e,sub_brand_id:t,supplier_name:a},timeout:1e4}).success(function(e){1==e.status?(u.editResourceSellerList=e.list,0!=e.list.length?u.editSellerListShow=!0:layer.msg("没有对应的商家信息，请调整信息！",{time:1500})):layer.msg("请求失败",{icon:5})}).error(function(e){})}u.editShowselectArea=[],u.editCityList=[],u.editAreaJoin="",$("#resourceEditColor").selectpicker({noneSelectedText:"—请选择车型颜色—",tickIcon:"icon-ok",style:"btn-default",selectAllText:"选择全部",deselectAllText:"取消全选"}),u.resourceModelEdit=function(e,t){if(-1==$.inArray(t,u.editOverList)&&u.editOverList.push(t),u.dataPriceFlag=!1,u.edit_out_color_glag=!0,u.edit_in_color_glag=!0,u.edit_seller_flag=!0,u.edit_area_flag=!0,u.edit_create_data_flag=!0,u.edit_model_ok_flag=!0,u.edit_file_flag=!0,u.edit_show_price_flag=!0,u.edit_car_type_flag=!0,u.dataCreateFlag=!1,u.dataStateFlag=!1,u.dataTypeFlag=!1,u.edit_current_change_provice=!1,u.editTrimColor="",u.editShowselectArea=[],(u.editAreaJoin="")==u.modelLists[e].modelInfoData.sale_area_list&&(u.edit_extra,u.editResourceSeller=""),u.edit_supplier_id="",u.editResourceSellerList=[],u.edit_area="",u.editSellerAddress="",u.edit_supplier_leader_name="",u.edit_supplier_leader_mobile="",u.current_index=e,u.editproviceData=u.pData,$("#modalEdit").modal(),u.modelEdit=u.modelLists[e],u.editIndex=e+1,u.editModelName=u.modelEdit.year+"款 "+u.modelEdit.modelInfoData.subPin+u.modelEdit.name,null==u.modelLists[e].modelInfoData.interior&&""==u.modelLists[e].modelInfoData.interior||(u.edit_in_color=u.modelLists[e].modelInfoData.interior),null==u.modelLists[e].modelInfoData.colors&&""==u.modelLists[e].modelInfoData.colors||(u.edit_out_color=u.modelLists[e].modelInfoData.colors),null==u.modelLists[e].modelInfoData.supplier_id&&""==u.modelLists[e].modelInfoData.supplier_id||(u.edit_seller=u.modelLists[e].modelInfoData.supplier_name),null!=u.modelLists[e].modelInfoData.sale_area_list&&""!=u.modelLists[e].modelInfoData.sale_area_list){u.edit_area=u.modelLists[e].modelInfoData.sale_area_list_name;for(var a=u.modelLists[e].modelInfoData.sale_area_list_name.length,i="",r=0;r<a;r++)i=u.modelLists[e].modelInfoData.sale_area_list_name[r].data.pName+","+u.modelLists[e].modelInfoData.sale_area_list_name[r].data.cityInfo.cName,u.edit_area=0==r?i:u.edit_area+" "+i}if(null!=u.modelLists[e].modelInfoData.manufacture&&""!=u.modelLists[e].modelInfoData.manufacture)switch(u.modelLists[e].modelInfoData.manufacture){case"0":u.edit_create_data="一年";break;case"1":u.edit_create_data="半年";break;default:u.edit_create_data="三个月"}else u.edit_create_data="";if(null==u.modelLists[e].modelInfoData.expiration_date&&""==u.modelLists[e].modelInfoData.expiration_date||(u.edit_model=u.modelLists[e].modelInfoData.expiration_date),null!=u.modelLists[e].modelInfoData.type&&""!=u.modelLists[e].modelInfoData.type)switch(u.modelLists[e].modelInfoData.type){case"1":u.edit_car_type="现车";break;default:u.edit_car_type="期车"}else u.edit_car_type="";null==u.modelLists[e].modelInfoData.sellerAddress&&""==u.modelLists[e].modelInfoData.sellerAddress||(u.editSellerAddress=u.modelLists[e].modelInfoData.sellerAddress),null==u.modelLists[e].modelInfoData.supplier_leader_name&&""==u.modelLists[e].modelInfoData.supplier_leader_name||(u.edit_supplier_leader_name=u.modelLists[e].modelInfoData.supplier_leader_name),null==u.modelLists[e].modelInfoData.supplier_leader_mobile&&""==u.modelLists[e].modelInfoData.supplier_leader_mobile||(u.edit_supplier_leader_mobile=u.modelLists[e].modelInfoData.supplier_leader_mobile),null==u.modelLists[e].modelInfoData.attachment&&""==u.modelLists[e].modelInfoData.attachment||(1==u.modelLists[e].modelInfoData.attachment||null==u.modelLists[e].modelInfoData.attachment?u.edit_file="不齐全":u.edit_file="齐全"),null==u.modelLists[e].modelInfoData.sale_price&&""==u.modelLists[e].modelInfoData.sale_price||(u.edit_current_price=u.modelLists[e].modelInfoData.sale_price),d({method:"GET",url:BASEURL+"/api2/res/model/colors?modelid="+u.modelEdit.id+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.editColorData=e.list,function(e){var t=$(e).length;$("#resourceEditColor").find("option").remove();for(var a=0;a<t;a++)$("#resourceEditColor").append($("<option value="+e[a].id+" data-rgb="+e[a].rgb+">"+e[a].name+"</option>"));$("#resourceEditColor").selectpicker("refresh")}(u.editColorData)):layer.msg("请求失败",{icon:5})}).error(function(){})},u.editSeller=function(){u.edit_seller_flag=!1,u.edit_seller="",u.edit_supplier_leader_name="",u.edit_supplier_leader_mobile="",u.editSellerAddress="",u.editResourceSeller="",u.edit_supplier_id=""},u.editPrice=function(){u.edit_show_price_flag=!1,u.editfavourablepoint="",u.editfavourablemoney="",u.edit_sale_price="",u.dataPriceFlag=!0},u.editCreatData=function(){u.dataCreateFlag=!0,u.edit_create_data_flag=!1},u.editFile=function(){u.dataStateFlag=!0,null==u.modelLists[u.current_index].attachment&&(u.editAttachment=0),u.edit_file_flag=!1},u.editCarType=function(){u.edit_car_type_flag=!1,u.dataTypeFlag=!0},u.edit_before_provice_id="",u.edit_before_city_id="",u.edit_whole_province_list=[],u.edit_current_change_provice="",u.edit_current_change_city="",u.edit_first_send=!1,u.editCityBtnShow=!0,u.edit_has_add_money=!0,u.edit_has_add_point=!0,u.editRequsFlag=!1,u.editJiFlag=!0,u.editSellerName=!0,u.editSelectSellerState=!1,u.editSelectProvice=function(e,t){u.edit_seller="",u.editResourceSeller="",u.editSellerAddress="",u.edit_supplier_leader_name="",u.edit_supplier_leader_mobile="",u.editResourceSellerList=[],u.modelLists[u.current_index].modelInfoData.sellerAddress="",u.modelLists[u.current_index].modelInfoData.supplier_leader_name="",u.modelLists[u.current_index].modelInfoData.supplier_name="",u.modelLists[u.current_index].modelInfoData.supplier_id="",u.modelLists[u.current_index].modelInfoData.supplier_leader_mobile="",u.edit_provice_id=t,u.edit_seller="",u.editProviceName=$(e.currentTarget).text(),u.edit_current_change_provice=$(e.currentTarget).text(),u.edit_current_change_city="",(g={}).data={},g.data.cityInfo={},0!=t?0==u.edit_before_provice_id&&u.edit_first_send?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.editShowselectArea=[],u.edit_before_provice_id=t,g.data.pId=u.edit_provice_id,g.data.pName=u.editProviceName,u.editCityBtnShow=!0,f(u.editShowselectArea),d({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.editCityData=e.list,u.editCityData.unshift(a),u.editCityBtnShow=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(u.edit_before_provice_id=t,g.data.pId=u.edit_provice_id,g.data.pName=u.editProviceName,-1==$.inArray(u.edit_provice_id,u.edit_whole_province_list)?d({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.editCityData=e.list,u.editCityData.unshift(a),u.editCityBtnShow=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(u.editCityBtnShow=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===u.edit_before_provice_id?(u.edit_before_provice_id=t,u.edit_first_send=!0,g.data.pId=0,g.data.pName="全国",g.data.cityInfo.cId=0,g.data.cityInfo.cName=" ",u.edit_current_change_provice="全国",u.editShowselectArea.push(g),u.editCityBtnShow=!0,f(u.editShowselectArea)):0==u.edit_before_provice_id||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.edit_before_provice_id=t,u.editShowselectArea=[],g.data.pId=0,g.data.pName="全国",g.data.cityInfo.cId=0,g.data.cityInfo.cName=" ",u.edit_current_change_provice="全国",u.editShowselectArea.push(g),u.editCityBtnShow=!0,f(u.editShowselectArea),u.$apply(),u.edit_first_send=!0},function(e){layer.close(e)})},u.editSelectCity=function(e,a){g.data.cityInfo.cId="",g.data.cityInfo.cName="",-1==$.inArray(a,u.editCityList)&&(0!=a?(u.edit_before_city_id=a,u.editCityList.push(a),u.edit_city_id=a,u.editCityName=$(e.currentTarget).text(),u.edit_current_change_city=$(e.currentTarget).text(),g.data.cityInfo.cId=u.edit_city_id,g.data.cityInfo.cName=u.editCityName,u.editCityBtnShow=!0,u.editShowselectArea.push(g),f(u.editShowselectArea)):""==u.edit_before_city_id&&0!=u.edit_before_city_id?(g.data.pId=u.edit_provice_id,g.data.pName=u.editProviceName,g.data.cityInfo.cId=0,g.data.cityInfo.cName="全省",u.edit_current_change_city="全省",u.edit_whole_province_list.push(u.edit_provice_id),u.editShowselectArea.push(g),f(u.editShowselectArea)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+u.editProviceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.edit_before_city_id=a;for(var t=0;t<u.editShowselectArea.length;t++)u.editShowselectArea[t].data.pId==u.edit_provice_id&&(u.editShowselectArea.splice(t,1),t-=1);g.data.pId=u.edit_provice_id,g.data.pName=u.editProviceName,g.data.cityInfo.cId=0,g.data.cityInfo.cName="全省",u.edit_current_change_city="全省",u.edit_whole_province_list.push(u.edit_provice_id),u.editShowselectArea.push(g),f(u.editShowselectArea),u.$apply()},function(e){layer.close(e)}))},u.editRemoveEle=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;u.editShowselectArea.splice(t,1);for(var i=0;i<u.edit_whole_province_list.length;i++)if(u.edit_whole_province_list[i]==a){u.edit_whole_province_list.splice(i,1);break}u.editCityList.splice(t,1),0==u.editShowselectArea.length&&(u.edit_before_provice_id="",u.edit_before_city_id="",u.edit_whole_province_list=[]),f(u.editShowselectArea)},u.editFavourableMoney=function(e){u.edit_has_add_money=-1==e},u.editFavourablePoint=function(e){u.edit_has_add_point=-1==e},u.editSelectSellerBlur=function(){m(function(){u.editSellerListShow=!1,u.editResourceSellerList=[],u.editSelectSellerState=!1},500)},u.editSelectSeller=function(){u.editSelectSellerState=!0,(null!=u.modelBrandId&&""!=u.modelBrandId||null!=u.modelSubBrandId&&""!=u.modelSubBrandId||null!=u.areaJoin&&""!=u.areaJoin)&&(null==u.modelBrandId&&(u.modelBrandId=""),null==u.modelSubBrandId&&(u.modelSubBrandId=""),null==u.editAreaJoin&&(u.editAreaJoin=""),null==u.editResourceSeller&&(u.editResourceSeller=""),""==u.modelLists[u.current_index].modelInfoData.sale_area_list?u.editAreaJoin:u.modelLists[u.current_index].modelInfoData.sale_area_list,h(u.modelBrandId,u.modelSubBrandId,u.editResourceSeller))},u.$watch("editResourceSeller",function(e,t){(null!=e&&u.editSelectSellerState&&e!=t||""==e&&u.editSelectSellerState)&&(u.editSellerAddress="",u.edit_supplier_leader_name="",(u.edit_supplier_leader_mobile="")==u.modelLists[u.current_index].modelInfoData.sale_area_list?u.editAreaJoin:u.modelLists[u.current_index].modelInfoData.sale_area_list,h(u.modelBrandId,u.modelSubBrandId,u.editResourceSeller))}),u.editSellerListSelect=function(e){u.editSelectSellerState=!1;var t=u.editResourceSeller=$(e.currentTarget).find("span").text(),a=u.edit_supplier_id=$(e.currentTarget).attr("data-seller-id");u.edit_seller_provice=$(e.currentTarget).attr("data-seller-provice"),u.edit_seller_city=$(e.currentTarget).attr("data-seller-city");var i=u.editSellerAddress=u.edit_seller_provice+" , "+u.edit_seller_city;u.editSellerListShow=!1,u.modelLists[u.current_index].modelInfoData.supplier_name=t,u.modelLists[u.current_index].modelInfoData.supplier_id=a,u.modelLists[u.current_index].modelInfoData.sellerAddress=i,d({method:"GET",url:BASEURL+"/cms2/supplier/leader?supplier_id="+u.edit_supplier_id+"&device=1",timeout:1e4}).success(function(e){var t="",a="";1==e.status?(u.editSellerName=!0,u.edit_supplier_leader_name=e.datas[0].name,u.edit_supplier_leader_mobile=e.datas[0].mobile,t=e.datas[0].name,a=e.datas[0].mobile):(layer.msg("没有对应的二网经理信息，请手动输入！",{time:1500}),u.edit_supplier_leader_name="",a=t=u.edit_supplier_leader_mobile="",u.editSellerName=!1),u.modelLists[u.current_index].modelInfoData.supplier_leader_name=t,u.modelLists[u.current_index].modelInfoData.supplier_leader_mobile=a}).error(function(e){})},u.$watch("editfavourablemoney",function(e,t){Math.ceil(e);e<0&&null!=e&&""!=e&&(layer.msg("输入的点数必须是数字，且不能小于0！",{time:1500}),u.editfavourablemoney="")}),u.$watch("editfavourablepoint",function(e,t){(100<Math.ceil(e)||e<0)&&null!=e&&""!=e&&(layer.msg("输入的点数必须是数字，且不能小于0或大于100！",{time:1500}),u.editfavourablepoint="")}),u.$watch("edit_sale_price",function(e,t){/[1-9][0-9]*/.test(e)||null==e||""==e||(layer.msg("输入的价格必须是数字，且不能小于0！",{time:1500}),u.edit_sale_price="")}),u.singleSave=function(){if(u.editJiFlag=!0,null!=u.editColorList&&""!=u.editColorList&&u.dataColorFlag&&(u.modelLists[u.current_index].modelInfoData.colors=u.editColorList),null!=u.editTrimColor&&""!=u.editTrimColor&&(u.modelLists[u.current_index].modelInfoData.interior=u.editTrimColor),null!=u.editResourceSeller&&""!=u.editResourceSeller&&u.dataLeaderFlag&&(u.modelLists[u.current_index].modelInfoData.supplier_name=u.editResourceSeller,u.modelLists[u.current_index].modelInfoData.supplier_id=u.edit_supplier_id,u.modelLists[u.current_index].modelInfoData.sellerAddress=u.editSellerAddress),null!=u.edit_supplier_leader_name&&""!=u.edit_supplier_leader_name&&u.dataLeaderFlag&&(u.modelLists[u.current_index].modelInfoData.supplier_leader_name=u.edit_supplier_leader_name),null!=u.edit_supplier_leader_mobile&&""!=u.edit_supplier_leader_mobile&&u.dataLeaderFlag&&(u.modelLists[u.current_index].modelInfoData.supplier_leader_mobile=u.edit_supplier_leader_mobile),null!=u.editAreaJoin&&""!=u.editAreaJoin&&(u.modelLists[u.current_index].modelInfoData.sale_area_list=u.editAreaJoin,u.modelLists[u.current_index].modelInfoData.sale_area_list_name=u.editShowselectArea),null!=u.editManufacture&&""!=u.editManufacture&&u.dataCreateFlag&&(u.modelLists[u.current_index].modelInfoData.manufacture=u.editManufacture),!u.edit_model_ok_flag){var e=angular.element("#edit_expiration_date").val().toString().replace(/-/g,"/");null!=(e=angular.element("#edit_expiration_date").val().toString().replace(/-/g,"/"))&&""!=e&&(u.modelLists[u.current_index].modelInfoData.expiration_date=e,u.modelLists[u.current_index].modelInfoData.expiration_date_stamp=Date.parse(new Date(e)))}null!=u.editType&&""!=u.editType&&u.dataTypeFlag&&(u.modelLists[u.current_index].modelInfoData.type=u.editType),null==u.editAttachment||""==u.editAttachment&&0!=u.editAttachment||u.dataStateFlag&&(null==u.shouxu?u.modelLists[u.current_index].modelInfoData.attachment=u.editAttachment:u.modelLists[u.current_index].modelInfoData.attachment=u.shouxu),null!=u.edit_extra&&""!=u.edit_extra&&(u.modelLists[u.current_index].modelInfoData.extra=u.edit_extra);var t=parseFloat(u.modelLists[u.current_index].refer_price);u.dataPriceFlag&&(null==u.editfavourablemoney&&null==u.editfavourablemoney&&null==u.edit_sale_price?isNaN(parseInt(u.modelLists[u.current_index].modelInfoData.sale_price))?(u.modelLists[u.current_index].modelInfoData.sale_price=u.modelLists[u.current_index].refer_price,u.editJiFlag=!1):u.modelLists[u.current_index].modelInfoData.sale_price=parseFloat(u.modelLists[u.current_index].modelInfoData.sale_price):"money"==u.editFavourableMode?(""==u.editfavourablemoney&&(u.editfavourablemoney=0),u.edit_has_add_money?u.modelLists[u.current_index].modelInfoData.sale_price=t-parseFloat(u.editfavourablemoney):u.modelLists[u.current_index].modelInfoData.sale_price=t+parseFloat(u.editfavourablemoney)):"point"==u.editFavourableMode?(""==u.editfavourablepoint&&(u.editfavourablepoint=0),u.edit_has_add_point?u.modelLists[u.current_index].modelInfoData.sale_price=t-t*parseFloat(u.editfavourablepoint)/100:u.modelLists[u.current_index].modelInfoData.sale_price=t+t*parseFloat(u.editfavourablepoint)/100):"price"==u.editFavourableMode?u.modelLists[u.current_index].modelInfoData.sale_price=u.edit_sale_price:u.editJiFlag=!1),isNaN(parseFloat(u.modelLists[u.current_index].modelInfoData.sale_price))&&(u.modelLists[u.current_index].modelInfoData.sale_price=u.modelLists[u.current_index].refer_price,u.editJiFlag=!1),u.editJiFlag&&(u.modelLists[u.current_index].modelInfoData.sale_price=parseFloat(u.modelLists[u.current_index].modelInfoData.sale_price).toFixed(2),u.modelLists[u.current_index].modelInfoData.sale_price+="万"),$("#modalEdit").modal("hide")},u.editColorList="",$("#resourceEditColor").on("changed.bs.select",function(e){u.dataColorFlag=!1;for(var t=u.editColorList="",a=e.currentTarget.selectedOptions,i=0;i<$(a).length;i++)0==i?(u.editColorList=a[i].textContent,t=a[i].textContent):(u.editColorList+="|"+a[i].textContent,t+="|"+a[i].textContent);u.modelLists[u.current_index].modelInfoData.colors=t}),u.resourceModelShow=function(e){$("#modelShow").modal(),u.previewInfo=u.modelLists[e]},u.modelDelete=function(a,i){var e=i+1;layer.confirm("你确定要删除车型 "+e+" ？",{btn:["确定","取消"],icon:0,skin:"layui-layer-molv"},function(e){u.modelLists.splice(i,1);var t=$(a.currentTarget).attr("data-current-id");angular.element("#pinlists").find("a[data-model-id="+t+"]").removeClass("active"),o(u.editOverList,i),0==u.modelLists.length&&(u.modelLists=[],u.modelisthasshow=!0,u.edit_btn=!1,u.has_send_btn=!0,u.$apply()),layer.close(e)},function(e){layer.close(e)}),c()},u.provice_id=0,u.proviceName="",u.city_id=0,u.cityName="";var y={};function v(e){u.areaJoin="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo.cId,i=(e[t].data.cityInfo.cName,e[t].data.pId);e[t].data.pName;0!=t?u.areaJoin+="|"+i+","+a:u.areaJoin=i+","+a}u.cityBtnShow=!0}function b(e,t,a){d({method:"GET",url:BASEURL+"/cms2/supplier/datas/v2?pageindex=1&pagesize=100&device=1",params:{brand_id:e,sub_brand_id:t,supplier_name:a},timeout:1e4}).success(function(e){1==e.status?(u.resourceSellerList=e.list,0!=e.list.length?u.SellerListShow=!0:layer.msg("没有对应的商家信息，请调整信息！",{time:1500})):layer.msg("请求失败",{icon:5})}).error(function(e){})}function D(e,t){for(var a=!1,i={},r=e.split("|"),n=0,s=r.length;n<s;n++)if(r[n].split(",")[2]==t){r.splice(n,1),a=!0;break}return i.state=a,i.lists=r.join("|"),i}u.showselectArea=[],u.cityList=[],u.areaJoin="",d({method:"GET",url:BASEURL+"/api2/area/provinces?device=1",timeout:1e4}).success(function(e){1==e.status?(u.proviceData=e.list,u.pData=e.list,u.proviceData.unshift(t)):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}),u.before_provice_id="",u.before_city_id="",u.whole_province_list=[],u.current_change_provice="",u.current_change_city="",u.first_send=!1,u.selectProvice=function(e,t){u.resourceSeller="",u.sellerAddress="",u.supplier_leader_name="",u.supplier_leader_mobile="",u.resourceSellerList=[],u.provice_id=t,u.proviceName=$(e.currentTarget).text(),u.current_change_provice=$(e.currentTarget).text(),u.current_change_city="",(y={}).data={},y.data.cityInfo={},0!=t?0==u.before_provice_id&&u.first_send?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.showselectArea=[],u.before_provice_id=t,y.data.pId=u.provice_id,y.data.pName=u.proviceName,u.cityBtnShow=!0,v(u.showselectArea),d({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.cityData=e.list,u.cityData.unshift(a),u.cityBtnShow=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(u.before_provice_id=t,y.data.pId=u.provice_id,y.data.pName=u.proviceName,-1==$.inArray(u.provice_id,u.whole_province_list)?d({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.cityData=e.list,u.cityData.unshift(a),u.cityBtnShow=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(u.cityBtnShow=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===u.before_provice_id?(u.before_provice_id=t,u.first_send=!0,y.data.pId=0,y.data.pName="全国",y.data.cityInfo.cId=0,y.data.cityInfo.cName=" ",u.current_change_provice="全国",u.showselectArea.push(y),u.cityBtnShow=!0,v(u.showselectArea)):0==u.before_provice_id||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.before_provice_id=t,u.showselectArea=[],y.data.pId=0,y.data.pName="全国",y.data.cityInfo.cId=0,y.data.cityInfo.cName=" ",u.current_change_provice="全国",u.showselectArea.push(y),u.cityBtnShow=!0,v(u.showselectArea),u.$apply(),u.first_send=!0},function(e){layer.close(e)})},u.selectCity=function(e,a){y.data.cityInfo.cId="",y.data.cityInfo.cName="",-1==$.inArray(a,u.cityList)&&(0!=a?(u.before_city_id=a,u.cityList.push(a),u.city_id=a,u.cityName=$(e.currentTarget).text(),u.current_change_city=$(e.currentTarget).text(),y.data.cityInfo.cId=u.city_id,y.data.cityInfo.cName=u.cityName,u.cityBtnShow=!0,u.showselectArea.push(y),v(u.showselectArea)):""==u.before_city_id&&0!=u.before_city_id?(y.data.pId=u.provice_id,y.data.pName=u.proviceName,y.data.cityInfo.cId=0,y.data.cityInfo.cName="全省",u.current_change_city="全省",u.whole_province_list.push(u.provice_id),u.showselectArea.push(y),v(u.showselectArea)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+u.proviceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){u.before_city_id=a,layer.close(e);for(var t=0;t<u.showselectArea.length;t++)u.showselectArea[t].data.pId==u.provice_id&&(u.showselectArea.splice(t,1),t-=1);y.data.pId=u.provice_id,y.data.pName=u.proviceName,y.data.cityInfo.cId=0,y.data.cityInfo.cName="全省",u.current_change_city="全省",u.whole_province_list.push(u.provice_id),u.showselectArea.push(y),v(u.showselectArea),u.$apply()},function(e){layer.close(e)}))},u.removeEle=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;u.showselectArea.splice(t,1);for(var i=0;i<u.whole_province_list.length;i++)if(u.whole_province_list[i]==a){u.whole_province_list.splice(i,1);break}u.cityList.splice(t,1),0==u.showselectArea.length&&(u.before_provice_id="",u.before_city_id="",u.whole_province_list=[]),v(u.showselectArea)},u.SellerListShow=!1,u.sellerName=!0,u.selectSellerState=!1,u.selectSellerBlur=function(){m(function(){u.resourceSellerList=[],u.SellerListShow=!1,u.selectSellerState=!1},500)},u.$watch("resourceSeller",function(e,t){(null!=e&&u.selectSellerState&&e!=t||""==e&&u.selectSellerState)&&(u.sellerAddress="",u.supplier_leader_name="",u.supplier_leader_mobile="",b(u.modelBrandId,u.modelSubBrandId,u.resourceSeller))}),u.selectSeller=function(){u.selectSellerState=!0,(null!=u.modelBrandId&&""!=u.modelBrandId||null!=u.modelSubBrandId&&""!=u.modelSubBrandId||null!=u.areaJoin&&""!=u.areaJoin)&&(null==u.modelBrandId&&(u.modelBrandId=""),null==u.modelSubBrandId&&(u.modelSubBrandId=""),null==u.areaJoin&&(u.areaJoin=""),null==u.resourceSeller&&(u.resourceSeller=""),b(u.modelBrandId,u.modelSubBrandId,u.resourceSeller))},u.SellerListSelect=function(e){u.selectSellerState=!1,u.resourceSeller=$(e.currentTarget).find("span").text(),u.supplier_id=$(e.currentTarget).attr("data-seller-id"),u.seller_provice=$(e.currentTarget).attr("data-seller-provice"),u.seller_city=$(e.currentTarget).attr("data-seller-city"),u.sellerAddress=u.seller_provice+" , "+u.seller_city,u.SellerListShow=!1,d({method:"GET",url:BASEURL+"/cms2/supplier/leader?supplier_id="+u.supplier_id+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.sellerName=!0,u.supplier_leader_name=e.datas[0].name,u.supplier_leader_mobile=e.datas[0].mobile):(layer.msg("没有对应的二网经理信息，请手动输入！",{time:1500}),u.supplier_leader_name="",u.supplier_leader_mobile="",u.sellerName=!1)}).error(function(e){})},u.has_add_money=!0,u.has_add_point=!0,u.jiFlag=!0,u.favourableMoney=function(e){u.has_add_money=-1==e},u.favourablePoint=function(e){u.has_add_point=-1==e},u.$watch("favourablemoney",function(e,t){Math.ceil(e);e<0&&null!=e&&""!=e&&(layer.msg("输入的点数必须是数字，且不能小于0！",{time:1500}),u.favourablemoney="")}),u.$watch("favourablepoint",function(e,t){(100<Math.ceil(e)||e<0)&&null!=e&&""!=e&&(layer.msg("输入的点数必须是数字，且不能小于0或大于100！",{time:1500}),u.favourablepoint="")}),u.$watch("sale_price",function(e,t){/[1-9][0-9]*/.test(e)||null==e||""==e||(layer.msg("输入的价格必须是数字，且不能小于0！",{time:1500}),u.sale_price="")}),u.resourceAttribute=function(){u.editFlag=!1,0==u.modelLists.length?layer.msg("请添加车型列表后再操作！",{time:1500}):layer.confirm("你确定要同意修改所有车型列表属性吗？",{btn:["确定","取消"],icon:0,skin:"layui-layer-molv"},function(e){u.edit_btn=!0,u.jiFlag=!0;for(var t=0,a=u.modelLists.length;t<a;t++)if(-1==$.inArray(u.modelLists[t].id,u.editOverList)){u.modelLists[t].modelInfoData.supplier_id=u.supplier_id,u.modelLists[t].modelInfoData.supplier_name=u.resourceSeller,u.modelLists[t].modelInfoData.colors=u.exteriorColor,u.modelLists[t].modelInfoData.interior=u.trimColor,u.modelLists[t].modelInfoData.sale_area_list=u.areaJoin,u.modelLists[t].modelInfoData.sale_area_list_name=u.showselectArea,u.modelLists[t].modelInfoData.manufacture=u.manufacture,u.modelLists[t].modelInfoData.attachment=u.attachment,u.modelLists[t].modelInfoData.type=u.type,u.modelLists[t].modelInfoData.expiration_date=angular.element("#expiration_date").val(),u.modelLists[t].modelInfoData.expiration_date_stamp=Date.parse(new Date(angular.element("#expiration_date").val().toString().replace(/-/g,"/"))),u.modelLists[t].modelInfoData.supplier_leader_name=u.supplier_leader_name,u.modelLists[t].modelInfoData.supplier_leader_mobile=u.supplier_leader_mobile;if(/\d+/.test(u.modelLists[t].refer_price)){var i=parseFloat(u.modelLists[t].refer_price);"money"==u.favourableMode?(null!=u.favourablemoney&&""!=u.favourablemoney||(u.favourablemoney=0),u.has_add_money?u.modelLists[t].modelInfoData.sale_price=i-parseFloat(u.favourablemoney):u.modelLists[t].modelInfoData.sale_price=i+parseFloat(u.favourablemoney)):"point"==u.favourableMode?(null!=u.favourablepoint&&""!=u.favourablepoint||(u.favourablepoint=0),u.has_add_point?u.modelLists[t].modelInfoData.sale_price=i-i*parseFloat(u.favourablepoint)/100:u.modelLists[t].modelInfoData.sale_price=i+i*parseFloat(u.favourablepoint)/100):"price"==u.favourableMode?u.modelLists[t].modelInfoData.sale_price=u.sale_price:(u.modelLists[t].modelInfoData.sale_price=u.modelLists[t].refer_price,u.jiFlag=!1)}else null==u.sale_price||""==u.sale_price?u.modelLists[t].modelInfoData.sale_price=u.modelLists[t].refer_price:u.modelLists[t].modelInfoData.sale_price=u.sale_price;isNaN(parseFloat(u.modelLists[t].modelInfoData.sale_price))&&(u.modelLists[t].modelInfoData.sale_price=u.modelLists[t].modelInfoData.sale_price,u.jiFlag=!1),u.jiFlag&&(u.modelLists[t].modelInfoData.sale_price=parseFloat(u.modelLists[t].modelInfoData.sale_price).toFixed(2),u.modelLists[t].modelInfoData.sale_price+="万"),u.modelLists[t].modelInfoData.extra=u.extra,u.modelLists[t].modelInfoData.sellerAddress=u.sellerAddress}u.$apply(),layer.msg("信息应用成功，请在车型列表中点击预览查看！",{icon:1,time:2e3}),layer.close(e)},function(e){layer.close(e)}),u.has_use_attr_click=!0,m(function(){u.has_use_attr_click=!1},5e3)},u.submitData=function(){var e=function(e){var t=e.length,a={state:!1,index:"",info:""};u.editFlag&&(e.modelInfoData={colors:"",interior:"",sale_area_list:"",manufacture:"",type:"",expiration_date:"",supplier_id:"",supplier_leader_name:"",supplier_leader_mobile:"",sale_price:"",attachment:0});for(var i=0;i<t;i++){if(!(e[i].hasOwnProperty("id")&&""!=e[i].id&&e[i].hasOwnProperty("modelInfoData")&&e[i].modelInfoData.hasOwnProperty("colors")&&""!=e[i].modelInfoData.colors&&e[i].modelInfoData.hasOwnProperty("interior")&&""!=e[i].modelInfoData.interior&&e[i].modelInfoData.hasOwnProperty("sale_area_list")&&""!=e[i].modelInfoData.sale_area_list&&e[i].modelInfoData.hasOwnProperty("manufacture")&&""!=e[i].modelInfoData.manufacture&&e[i].modelInfoData.hasOwnProperty("type")&&""!=e[i].modelInfoData.type&&e[i].modelInfoData.hasOwnProperty("expiration_date")&&""!=e[i].modelInfoData.expiration_date&&e[i].modelInfoData.hasOwnProperty("supplier_id")&&""!=e[i].modelInfoData.supplier_id&&e[i].modelInfoData.hasOwnProperty("supplier_leader_name")&&""!=e[i].modelInfoData.supplier_leader_name&&e[i].modelInfoData.hasOwnProperty("supplier_leader_mobile")&&""!=e[i].modelInfoData.supplier_leader_mobile&&e[i].modelInfoData.hasOwnProperty("sale_price")&&""!=e[i].modelInfoData.sale_price)){a.state=!0,a.index=i;break}/\d+/.test(e[i].modelInfoData.sale_price)||(a.info="且价格格式不正确",a.index=i,a.state=!0)}return a}(u.modelLists),t=parseInt(e.index)+1;if(e.state)layer.msg("车型列表 <em style='font-weight: bold; font-style: normal; color: #d9534f'>"+t+"</em> 信息不完整，请补充后再提交！"+e.info,{icon:1,time:2e3});else{!function a(i,e){u.edit_btn=!1,u.has_send_btn=!0;var t={model_id:"",colors:"",interior:"",sale_area_list:"",manufacture:"",attachment:"",type:"",expiration_date:"",supplier_id:"",supplier_leader_name:"",supplier_leader_mobile:"",sale_price:"",extra:""},r=e;r>i.length-1?(layer.confirm("选择车型发布完成，是否继续发布？",{btn:["确定","取消"],icon:0,skin:"layui-layer-molv",closeBtn:0},function(){window.location.reload()},function(){u.jumpUrl("home.resource")}),u.has_send_btn=!1):(t.model_id=i[r].id,t.colors=i[r].modelInfoData.colors,t.interior=i[r].modelInfoData.interior,t.sale_area_list=i[r].modelInfoData.sale_area_list,t.attachment=i[r].modelInfoData.manufacture,0==i[r].modelInfoData.manufacture?t.manufacture="一年":1==i[r].modelInfoData.manufacture?t.manufacture="半年":t.manufacture="三个月",t.type=i[r].modelInfoData.type,t.expiration_date=i[r].modelInfoData.expiration_date_stamp,t.supplier_id=i[r].modelInfoData.supplier_id,t.supplier_leader_name=i[r].modelInfoData.supplier_leader_name,t.supplier_leader_mobile=i[r].modelInfoData.supplier_leader_mobile,t.sale_price=parseInt(1e4*parseFloat(i[r].modelInfoData.sale_price)),t.extra=i[r].modelInfoData.extra,d({method:"POST",url:BASEURL+"/cms2/resource/add?device=1",params:t,timeout:1e4}).success(function(e){var t=parseInt(r)+1;1==e.status?(layer.msg("车型<em style='font-weight: bold; font-style: normal; color: #d9534f'>"+t+"</em> "+e.msg,{icon:1,time:1500}),r+=1,m(function(){a(i,r)},2e3)):(layer.msg("车型<em style='font-weight: bold; font-style: normal; color: #d9534f'>"+t+"</em> "+e.msg,{icon:1,time:1500}),u.has_send_btn=!1)}).error(function(e){}))}(u.modelLists,0);var a=u.modelBrandId,i=u.currentSubPin,r=u.modelSubBrandId,n=a+","+i+","+r,s=p.get("hotList");if(null!=s){var o=_(s);if(10<=o.length){var c=D(s,r),l="";c.state?l=c.lists+"|"+n:((l=s.split("|")).splice(0,1),l=l.join("|")+"|"+n),p.put("hotList",l)}else{if(0==o.length)s=n;else s=D(s,r).lists+"|"+n;p.put("hotList",s)}}else p.put("hotList",n)}},u.fastEntry=function(e){$("#editPanl").find(".hot-show").hasClass("layui-show")||$("#editPanl").find(".hot-show").addClass("layui-show"),$("#resourceSubPin").find(".layui-select-title").find("input").addClass("layui-disabled");var t=e.currentTarget,a=$(t).attr("data-pid"),i=$(t).attr("data-spid"),r=$("#resourcePin").find(".layui-anim-upbit").find("dd");u.modelBrandId=a,u.modelSubBrandId=i,u.currentSubPin=$(t).text();for(var n=0,s=r.length;n<s;n++)if($(r[n]).attr("lay-value")==a){$("#resourcePin").find(".layui-select-title").find("input").val($(r[n]).text()),$("#resourceSubPin").find(".layui-select-title").find("input").val($(t).text()),l(a,i);break}}}]),app.controller("addspecialResourcesCtrl",["$http","$scope","$stateParams","$timeout","$cookieStore",function(d,u,e,m,p){u.requsFlag=!1,u.modelDeleteShow="",u.pinLists=!0,u.modelisthasshow=!0,u.modelLists=[];var i="",r="";u.subPinBtn=!0;var n="",s="";u.exteriorColor="",u.trimColor="",u.cityBtnShow=!0,u.cityBtnShow1=!0,u.favourableMode="money",u.editFavourableMode="money",u.current_index="",u.has_use_click=!0,u.has_use_attr_click=!0,u.has_use_attr_click=!0,u.attachment=0,u.editattachment=0,u.has_send_btn=!0,u.editFlag=!0,u.edit_btn=!1,u.editOverList=[];var t={id:0,name:"全国"},a={id:0,name:"全省"},o={id:0,name:"全省"};function _(e){var t=[],a=e.split("|");if(1<a.length)for(var i=0,r=a.length;i<r;i++){var n={pid:"",spid:"",pname:""},s=a[i].split(",");n.pid=s[0],n.pname=s[1],n.spid=s[2],t.push(n)}else(n={pid:"",spid:"",pname:""}).pid=e.split(",")[0],n.pname=e.split(",")[1],n.spid=e.split(",")[2],t.push(n);return t}if(u.publishObj=[],null==p.get("hotList"))u.publishListShow=!0;else{u.publishListShow=!1;var c=p.get("hotList");null!=c&&(u.publishObj=_(c).reverse())}function l(e,t){var a=$(e).length;if($(t).find("option").remove(),"#resSubModelLists"==t){$(t).append($('<option value="">—选择子品牌—</option>'));for(var i=0;i<a;i++)$(t).append($("<option value="+e[i].id+" title="+e[i].picture+">"+e[i].name+"</option>"))}else if("#modelBrand"==t){$(t).append($('<option value="">—选择车型—</option>'));for(i=0;i<a;i++)0==i?$(t).append($('<option value="-1" disabled>'+e[i].initial+"</option>")):e[i-1].initial==e[i].initial||$(t).append($('<option value="-1" disabled>'+e[i].initial+"</option>")),$(t).append($("<option value="+e[i].id+">"+e[i].initial+" "+e[i].name+"</option>"))}else{$(t).append($('<option value="">—选择城市—</option>')),$(t).append($('<option value="0">全省</option>'));for(i=0;i<a;i++)$(t).append($("<option value="+e[i].id+">"+e[i].name+"</option>"))}}function g(e,t){for(var a=0;a<e.length;a++)if(e[a]==t){e.splice(a,1);break}}function f(){0==u.modelLists.length&&(u.modelLists=[],u.has_send_btn=!0,u.edit_btn=!1)}function h(e,t){d({method:"GET",url:BASEURL+"/api2/res/model/"+e+"/"+t+"?device=1",timeout:1e4}).success(function(e){if(u.modelYearLists=[],u.allModelList={},1==e.status){for(var t=e.list,a=t.length,i=0;i<a;i++)0==u.modelYearLists.length?u.modelYearLists.push(t[i].year):-1==$.inArray(t[i].year,u.modelYearLists)&&u.modelYearLists.push(t[i].year);for(var r=0,n=u.modelYearLists.length;r<n;r++){u.allModelList[u.modelYearLists[r]]=[];for(var s=0;s<a;s++)t[s].year==u.modelYearLists[r]&&(u.allModelList[u.modelYearLists[r]].push(t[s]),u.pinLists=!1,u.has_use_click=!1,u.has_use_attr_click=!1)}u.modelYearLists=u.modelYearLists.sort()}else layer.msg("请求失败",{icon:5});angular.element("#pinlists").find(".active").removeClass("active")}).error(function(){})}d({method:"GET",url:BASEURL+"/api2/res/brand?device=1",timeout:1e4}).success(function(e){1==e.status?(u.resourceModelData=e.list,l(u.resourceModelData,"#modelBrand"),layui.use("form",function(){layui.form().render()})):layer.msg("请求失败",{icon:5})}).error(function(e){}),layui.use(["element","form","laydate"],function(){var e=layui.element(),a=layui.form();layui.laydate();e.init(),a.render(),a.on("select(modelBrand)",function(e){var t;u.resourceSeller="",u.resourceSeller1="",u.resourceSellerList=[],u.resourceSellerList1=[],u.editResourceSellerList=[],u.subPinBtn=!1,u.pinLists=!0,u.modelBrandId=e.value,i=$(e.elem).find("option:selected")[0].value,r=$(e.elem).find("option:selected")[0].text,s=e.elem[e.elem.selectedIndex].title,u.modelLists=[],u.modelisthasshow=!0,u.allModelList={},u.modelYearLists=[],u.pinLists=!0,t=e.value,d({method:"GET",url:BASEURL+"/api2/res/brand/"+t+"?device=1",timeout:1e4}).success(function(e){1==e.status?(l(e.list,"#resSubModelLists"),layui.use(["form"],function(){layui.form().render("select")})):layer.msg("请求失败",{icon:5})}).error(function(){}),a.render("select")}),u.modelYearLists=[],u.allModelList={},u.dataStateFlag=!0,u.dataColorFlag=!0,u.dataCreateFlag=!0,u.dataPriceFlag=!1,u.dataTypeFlag=!0,a.on("select(modelSubBrand)",function(e){u.resourceSeller="",u.resourceSeller1="",u.sellerAddress="",u.sellerAddress1="",u.resourceSellerList=[],u.resourceSellerList1=[],u.editResourceSellerList=[],u.modelLists=[],u.modelisthasshow=!0,u.modelSubBrandId=e.value,u.currentSubPin=n=$(e.elem).find("option:selected")[0].innerHTML,u.sub_brand_picture=s=e.elem[e.elem.selectedIndex].title,h(u.modelBrandId,e.value),a.render()}),e.on("tab(favourable)",function(e){switch(e.index){case 0:u.favourableMode="money",u.favourablepoint="",u.sale_price="";break;case 1:u.favourableMode="point",u.favourablemoney="",u.sale_price="";break;default:u.favourableMode="price",u.favourablepoint="",u.favourablemoney=""}}),a.on("select(car_type)",function(e){u.car_type=e.value}),a.on("select(manufacture)",function(e){u.manufacture=e.value}),a.on("select(attachment)",function(e){u.attachment=e.value}),a.on("switch(attachment)",function(e){switch(this.checked){case 0:u.attachment=0;break;case 1:u.attachment=1;break;case 2:u.attachment=2;break;default:u.attachment=""}}),a.on("select(editattachment)",function(e){switch(u.dataCreateFlag=!0,u.editattachment=e.value,e.value){case 0:u.modelLists[u.current_index].modelInfoData.attachment="随车发",u.editattachment=0,u.shouxu=0;break;case 1:u.modelLists[u.current_index].modelInfoData.attachment="3天内发",u.editattachment=1,u.shouxu=1;break;default:u.modelLists[u.current_index].modelInfoData.attachment="7天内发",u.editattachment=2,u.shouxu=2}}),a.on("select(editmanufacture)",function(e){switch(u.dataCreateFlag=!0,u.editManufacture=e.value,e.value){case 0:u.modelLists[u.current_index].modelInfoData.manufacture="一年以内",u.editManufacture=0;break;case 1:u.modelLists[u.current_index].modelInfoData.manufacture="半年内",u.editManufacture=1;break;case 2:u.modelLists[u.current_index].modelInfoData.manufacture="三个月内",u.editManufacture=2;break;default:u.modelLists[u.current_index].modelInfoData.manufacture="一年以上",u.editManufacture=3}}),a.on("select(editcartype)",function(e){u.editcartype=e.value}),e.on("tab(editfavourable)",function(e){switch(e.index){case 0:u.editFavourableMode="money",u.editFavourablepoint="";break;case 1:u.editFavourableMode="point",u.editFavourablemoney="";break;default:u.editFavourableMode="price",u.editFavourablepoint="",u.editFavourablemoney=""}})}),u.modelYearListSelect=function(e){$(e.currentTarget).addClass("layui-this").siblings().removeClass("layui-this")},u.selectModelList=function(e,t){u.has_send_btn=!1;e.modelInfoData={pin:"",subPin:"",sub_brand_picture:"",brand_name:""},e.modelInfoData.pin=i,e.modelInfoData.subPin=n,console.log(s),e.modelInfoData.sub_brand_picture=s,e.modelInfoData.brand_name=r.replace(/\s*/g,"").substr(1),u.modelisthasshow=!1,$(t.currentTarget).hasClass("active")?($(t.currentTarget).removeClass("active"),g(u.modelLists,e),g(u.editOverList,e.id),0==u.modelLists.length&&(u.modelisthasshow=!0)):($(t.currentTarget).addClass("active"),u.modelLists.push(e),u.edit_btn=!1),f()},u.edit_out_color="",u.edit_out_color_glag=!0,u.edit_shoudong_color="",u.edit_out_color_glag1=!0,u.edit_in_color="",u.edit_in_color_glag=!0,u.edit_area="",u.edit_area1="",u.edit_area_flag=!0,u.edit_area_flag1=!0,u.edit_create_data="",u.edit_create_data_flag=!0,u.edit_model="",u.edit_model_ok_flag=!0,u.edit_car_type="",u.edit_car_type_flag=!0,u.edit_file="",u.edit_file_flag=!0,u.edit_show_price="",u.edit_show_price_flag=!0,u.edit_show_price1="",u.edit_show_price_flag1=!0,u.edit_provice_id=0,u.edit_provice_id1=0,u.editProviceName="",u.editProviceName1="",u.edit_city_id=0,u.edit_city_id1=0,u.editCityName="",u.editCityName1="";var y={},v={};function b(e){u.editAreaJoin="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo.cId,i=(e[t].data.cityInfo.cName,e[t].data.pId);e[t].data.pName;0!=t?u.editAreaJoin+="|"+i+","+a:u.editAreaJoin=i+","+a}u.editCityBtnShow=!0}function D(e){console.log(e),u.editAreaJoin1="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo1.cId1,i=(e[t].data.cityInfo1.cName1,e[t].data.pId1);e[t].data.pName1;0!=t?u.editAreaJoin1+="|"+i+","+a:u.editAreaJoin1=i+","+a}u.editCityBtnShow1=!0}u.editShowselectArea=[],u.editShowselectArea1=[],u.editCityList=[],u.editCityList1=[],u.editAreaJoin="",u.editAreaJoin1="",$("#resourceEditColor").selectpicker({noneSelectedText:"—请选择车型颜色—",tickIcon:"icon-ok",style:"btn-default",selectAllText:"选择全部",deselectAllText:"取消全选"}),u.resourceModelEdit=function(e,t){if(-1==$.inArray(t,u.editOverList)&&u.editOverList.push(t),u.dataPriceFlag=!1,u.edit_out_color_glag=!0,u.edit_in_color_glag=!0,u.edit_area_flag=!0,u.edit_area_flag1=!0,u.edit_create_data_flag=!0,u.edit_model_ok_flag=!0,u.edit_file_flag=!0,u.edit_show_price_flag=!0,u.edit_show_price_flag1=!0,u.edit_car_type_flag=!0,u.dataCreateFlag=!1,u.dataStateFlag=!1,u.dataTypeFlag=!1,u.edit_current_change_provice=!1,u.editTrimColor="",u.editShowselectArea=[],(u.editAreaJoin="")==u.modelLists[e].modelInfoData.area_list&&u.edit_area,""==u.modelLists[e].modelInfoData.area_list1&&u.edit_area1,u.editResourceSellerList=[],u.edit_area="",u.edit_area1="",u.current_index=e,u.editproviceData=u.pData,$("#modalEdit").modal(),u.modelEdit=u.modelLists[e],u.editIndex=e+1,u.editModelName=u.modelEdit.year+"款 "+u.modelEdit.modelInfoData.subPin+u.modelEdit.name,null==u.modelLists[e].modelInfoData.extra&&""==u.modelLists[e].modelInfoData.extra||(u.edit_extra=u.modelLists[e].modelInfoData.extra),null==u.modelLists[e].modelInfoData.interior&&""==u.modelLists[e].modelInfoData.interior||(u.edit_in_color=u.modelLists[e].modelInfoData.interior),null==u.modelLists[e].modelInfoData.colors&&""==u.modelLists[e].modelInfoData.colors||(u.edit_out_color=u.modelLists[e].modelInfoData.colors),null!=u.modelLists[e].modelInfoData.area_list&&""!=u.modelLists[e].modelInfoData.area_list){u.edit_area=u.modelLists[e].modelInfoData.sale_area_list_name;for(var a=u.modelLists[e].modelInfoData.sale_area_list_name.length,i="",r=0;r<a;r++)i=u.modelLists[e].modelInfoData.sale_area_list_name[r].data.pName+","+u.modelLists[e].modelInfoData.sale_area_list_name[r].data.cityInfo.cName,u.edit_area=0==r?i:u.edit_area+" "+i}if(null!=u.modelLists[e].modelInfoData.area_list1&&""!=u.modelLists[e].modelInfoData.area_list1){u.edit_area1=u.modelLists[e].modelInfoData.sale_area_list_name1;var n=u.modelLists[e].modelInfoData.sale_area_list_name1.length,s="";for(r=0;r<n;r++)s=u.modelLists[e].modelInfoData.sale_area_list_name1[r].data.pName1+","+u.modelLists[e].modelInfoData.sale_area_list_name1[r].data.cityInfo1.cName1,u.edit_area1=0==r?s:u.edit_area1+" "+s}if(null!=u.modelLists[e].modelInfoData.manufacture&&""!=u.modelLists[e].modelInfoData.manufacture)switch(u.modelLists[e].modelInfoData.manufacture){case"0":u.edit_create_data="一年以内";break;case"1":u.edit_create_data="半年内";break;case"2":u.edit_create_data="三个月内";break;default:u.edit_create_data="一年以上"}else u.edit_create_data="";if(null==u.modelLists[e].modelInfoData.end_time&&""==u.modelLists[e].modelInfoData.end_time||(u.edit_model=u.modelLists[e].modelInfoData.end_time),null!=u.modelLists[e].modelInfoData.car_type&&""!=u.modelLists[e].modelInfoData.car_type)switch(u.modelLists[e].modelInfoData.car_type){case"1":u.edit_car_type="现车";break;default:u.edit_car_type="期车"}else u.edit_car_type="";if(null!=u.modelLists[e].modelInfoData.attachment&&""!=u.modelLists[e].modelInfoData.attachment)switch(u.modelLists[e].modelInfoData.attachment){case"0":u.edit_file="随车发";break;case"1":u.edit_file="3天内发";break;default:u.edit_file="7天内发"}else u.edit_file="";null==u.modelLists[e].modelInfoData.sale_price&&""==u.modelLists[e].modelInfoData.sale_price||(u.edit_current_price=u.modelLists[e].modelInfoData.sale_price),null==u.modelLists[e].modelInfoData.front_price&&""==u.modelLists[e].modelInfoData.front_price||(u.edit_current_price1=u.modelLists[e].modelInfoData.front_price),d({method:"GET",url:BASEURL+"/api2/res/model/colors?modelid="+u.modelEdit.id+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.editColorData=e.list,function(e){var t=$(e).length;$("#resourceEditColor").find("option").remove();for(var a=0;a<t;a++)$("#resourceEditColor").append($("<option value="+e[a].id+" data-rgb="+e[a].rgb+">"+e[a].name+"</option>"));$("#resourceEditColor").selectpicker("refresh")}(u.editColorData)):layer.msg("请求失败",{icon:5})}).error(function(){})},u.editPrice=function(){u.edit_show_price_flag=!1,u.editfavourablepoint="",u.editfavourablemoney="",u.edit_sale_price="",u.dataPriceFlag=!0},u.editCreatData=function(){u.dataCreateFlag=!0,u.edit_create_data_flag=!1},u.editFile=function(){u.dataCreateFlag=!0,u.edit_file_flag=!1},u.editCarType=function(){u.edit_car_type_flag=!1,u.dataTypeFlag=!0},u.editPrice1=function(){u.edit_show_price_flag1=!1,u.dataCreateFlag=!0},u.edit_before_provice_id="",u.edit_before_provice_id1="",u.edit_before_city_id="",u.edit_before_city_id1="",u.edit_whole_province_list=[],u.edit_whole_province_list1=[],u.edit_current_change_provice="",u.edit_current_change_provice1="",u.edit_current_change_city="",u.edit_current_change_city1="",u.edit_first_send=!1,u.edit_first_send1=!1,u.editCityBtnShow=!0,u.editCityBtnShow1=!0,u.edit_has_add_money=!0,u.edit_has_add_point=!0,u.editRequsFlag=!1,u.editJiFlag=!0,u.editJiFlag1=!0,u.editSelectSellerState=!1,u.editSelectProvice=function(e,t){u.editResourceSellerList=[],u.modelLists[u.current_index].modelInfoData.sellerAddress="",console.log(u.modelLists[u.current_index]),u.edit_provice_id=t,u.editProviceName=$(e.currentTarget).text(),u.edit_current_change_provice=$(e.currentTarget).text(),u.edit_current_change_city="",(y={}).data={},y.data.cityInfo={},0!=t?0==u.edit_before_provice_id&&u.edit_first_send?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.editShowselectArea=[],u.edit_before_provice_id=t,y.data.pId=u.edit_provice_id,y.data.pName=u.editProviceName,u.editCityBtnShow=!0,b(u.editShowselectArea),d({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.editCityData=e.list,u.editCityData.unshift(a),u.editCityBtnShow=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(u.edit_before_provice_id=t,y.data.pId=u.edit_provice_id,y.data.pName=u.editProviceName,-1==$.inArray(u.edit_provice_id,u.edit_whole_province_list)?d({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.editCityData=e.list,u.editCityData.unshift(a),u.editCityBtnShow=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(u.editCityBtnShow=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===u.edit_before_provice_id?(u.edit_before_provice_id=t,u.edit_first_send=!0,y.data.pId=0,y.data.pName="全国",y.data.cityInfo.cId=0,y.data.cityInfo.cName=" ",u.edit_current_change_provice="全国",u.editShowselectArea.push(y),u.editCityBtnShow=!0,b(u.editShowselectArea)):0==u.edit_before_provice_id||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.edit_before_provice_id=t,u.editShowselectArea=[],y.data.pId=0,y.data.pName="全国",y.data.cityInfo.cId=0,y.data.cityInfo.cName=" ",u.edit_current_change_provice="全国",u.editShowselectArea.push(y),u.editCityBtnShow=!0,b(u.editShowselectArea),u.$apply(),u.edit_first_send=!0},function(e){layer.close(e)})},u.editSelectProvice1=function(e,t){u.editResourceSellerList1=[],u.modelLists[u.current_index].modelInfoData.sellerAddress1="",u.edit_provice_id1=t,u.editProviceName1=$(e.currentTarget).text(),u.edit_current_change_provice1=$(e.currentTarget).text(),u.edit_current_change_city1="",(v={}).data={},v.data.cityInfo1={},0!=t?0==u.edit_before_provice_id1&&u.edit_first_send1?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.editShowselectArea1=[],u.edit_before_provice_id1=t,v.data.pId1=u.edit_provice_id1,v.data.pName1=u.editProviceName,u.editCityBtnShow1=!0,console.log(u.editShowselectArea1),D(u.editShowselectArea1),d({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.editCityData1=e.list,u.editCityData1.unshift(a),u.editCityBtnShow1=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(u.edit_before_provice_id11=t,v.data.pId1=u.edit_provice_id1,v.data.pName1=u.editProviceName,-1==$.inArray(u.edit_provice_id1,u.edit_whole_province_list1)?d({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.editCityData1=e.list,u.editCityData1.unshift(a),u.editCityBtnShow1=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(u.editCityBtnShow1=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===u.edit_before_provice_id1?(u.edit_before_provice_id1=t,u.edit_first_send1=!0,v.data.pId1=0,v.data.pName1="全国",v.data.cityInfo1.cId1=0,v.data.cityInfo1.cName1=" ",u.edit_current_change_provice1="全国",u.editShowselectArea1=[],u.editShowselectArea1.push(v),console.log(u.editShowselectArea1),u.editCityBtnShow1=!0,D(u.editShowselectArea1)):0==u.edit_before_provice_id1||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.edit_before_provice_id1=t,u.editShowselectArea1=[],v.data.pId1=0,v.data.pName1="全国",v.data.cityInfo1.cId1=0,v.data.cityInfo1.cName1=" ",u.edit_current_change_provice1="全国",u.editShowselectArea1=[],u.editShowselectArea1.push(v),u.editCityBtnShow1=!0,console.log(u.editShowselectArea1),D(u.editShowselectArea1),u.$apply(),u.edit_first_send1=!0},function(e){layer.close(e)})},u.editSelectCity=function(e,a){y.data.cityInfo.cId="",y.data.cityInfo.cName="",-1==$.inArray(a,u.editCityList)&&(0!=a?(u.edit_before_city_id=a,u.editCityList.push(a),u.edit_city_id=a,u.editCityName=$(e.currentTarget).text(),u.edit_current_change_city=$(e.currentTarget).text(),y.data.cityInfo.cId=u.edit_city_id,y.data.cityInfo.cName=u.editCityName,u.editCityBtnShow=!0,u.editShowselectArea.push(y),b(u.editShowselectArea)):""==u.edit_before_city_id&&0!=u.edit_before_city_id?(y.data.pId=u.edit_provice_id,y.data.pName=u.editProviceName,y.data.cityInfo.cId=0,y.data.cityInfo.cName="全省",u.edit_current_change_city="全省",u.edit_whole_province_list.push(u.edit_provice_id),u.editShowselectArea.push(y),b(u.editShowselectArea)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+u.editProviceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.edit_before_city_id=a;for(var t=0;t<u.editShowselectArea.length;t++)u.editShowselectArea[t].data.pId==u.edit_provice_id&&(u.editShowselectArea.splice(t,1),t-=1);y.data.pId=u.edit_provice_id,y.data.pName=u.editProviceName,y.data.cityInfo.cId=0,y.data.cityInfo.cName="全省",u.edit_current_change_city="全省",u.edit_whole_province_list.push(u.edit_provice_id),u.editShowselectArea.push(y),b(u.editShowselectArea),u.$apply()},function(e){layer.close(e)}))},u.editSelectCity1=function(e,a){v.data.cityInfo1.cId1="",v.data.cityInfo1.cName1="",-1==$.inArray(a,u.editCityList1)&&(0!=a?(u.edit_before_city_id1=a,u.editCityList1.push(a),u.edit_city_id1=a,u.editCityName1=$(e.currentTarget).text(),u.edit_current_change_city1=$(e.currentTarget).text(),v.data.cityInfo1.cId1=u.edit_city_id1,v.data.cityInfo1.cName1=u.editCityName1,u.editCityBtnShow1=!0,console.log(u.editShowselectArea1),u.editShowselectArea1=[],u.editShowselectArea1.push(v),D(u.editShowselectArea1)):""==u.edit_before_city_id1&&0!=u.edit_before_city_id1?(v.data.pId1=u.edit_provice_id1,v.data.pName1=u.editProviceName1,v.data.cityInfo1.cId1=0,v.data.cityInfo1.cName1="全省",u.edit_current_change_city1="全省",u.edit_whole_province_list1.push(u.edit_provice_id1),u.editShowselectArea1=[],u.editShowselectArea1.push(v),console.log(u.editShowselectArea1),D(u.editShowselectArea1)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+u.editProviceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.edit_before_city_id1=a;for(var t=0;t<u.editShowselectArea1.length;t++)u.editShowselectArea1[t].data.pId1==u.edit_provice_id1&&(u.editShowselectArea1.splice(t,1),t-=1);v.data.pId1=u.edit_provice_id1,v.data.pName1=u.editProviceName1,v.data.cityInfo1.cId1=0,v.data.cityInfo1.cName1="全省",u.edit_current_change_city1="全省",u.edit_whole_province_list1.push(u.edit_provice_id1),u.editShowselectArea1=[],u.editShowselectArea1.push(v),console.log(u.editShowselectArea1),D(u.editShowselectArea1),u.$apply()},function(e){layer.close(e)}))},u.editRemoveEle=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;u.editShowselectArea.splice(t,1);for(var i=0;i<u.edit_whole_province_list.length;i++)if(u.edit_whole_province_list[i]==a){u.edit_whole_province_list.splice(i,1);break}u.editCityList.splice(t,1),0==u.editShowselectArea.length&&(u.edit_before_provice_id="",u.edit_before_city_id="",u.edit_whole_province_list=[]),b(u.editShowselectArea)},u.editRemoveEle1=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;u.editShowselectArea1.splice(t,1);for(var i=0;i<u.edit_whole_province_list1.length;i++)if(u.edit_whole_province_list1[i]==a){u.edit_whole_province_list1.splice(i,1);break}u.editCityList1.splice(t,1),0==u.editShowselectArea1.length&&(u.edit_before_provice_id1="",u.edit_before_city_id1="",u.edit_whole_province_list1=[]),D(u.editShowselectArea1)},u.editFavourableMoney=function(e){u.edit_has_add_money=-1==e},u.editFavourablePoint=function(e){u.edit_has_add_point=-1==e},u.$watch("editfavourablemoney",function(e,t){Math.ceil(e);e<0&&null!=e&&""!=e&&(layer.msg("输入的点数必须是数字，且不能小于0！",{time:1500}),u.editfavourablemoney="")}),u.$watch("editfavourablepoint",function(e,t){(100<Math.ceil(e)||e<0)&&null!=e&&""!=e&&(layer.msg("输入的点数必须是数字，且不能小于0或大于100！",{time:1500}),u.editfavourablepoint="")}),u.$watch("edit_sale_price",function(e,t){/[1-9][0-9]*/.test(e)||null==e||""==e||(layer.msg("输入的价格必须是数字，且不能小于0！",{time:1500}),u.edit_sale_price="")}),u.singleSave=function(){if(u.editJiFlag=!0,u.editJiFlag1=!0,null!=u.editColorList&&""!=u.editColorList&&u.dataColorFlag&&(u.modelLists[u.current_index].modelInfoData.colors=u.editColorList),null!=u.editTrimColor&&""!=u.editTrimColor&&(u.modelLists[u.current_index].modelInfoData.interior=u.editTrimColor),null!=u.editAreaJoin&&""!=u.editAreaJoin&&(u.modelLists[u.current_index].modelInfoData.area_list=u.editAreaJoin,u.modelLists[u.current_index].modelInfoData.sale_area_list_name=u.editShowselectArea),null!=u.editAreaJoin1&&""!=u.editAreaJoin1&&(u.modelLists[u.current_index].modelInfoData.area_list1=u.editAreaJoin1,u.modelLists[u.current_index].modelInfoData.sale_area_list_name1=u.editShowselectArea1),null!=u.editManufacture&&""!=u.editManufacture&&u.dataCreateFlag&&(u.modelLists[u.current_index].modelInfoData.manufacture=u.editManufacture),!u.edit_model_ok_flag){var e=angular.element("#edit_expiration_date").val().toString().replace(/-/g,"/");null!=(e=angular.element("#edit_expiration_date").val().toString().replace(/-/g,"/"))&&""!=e&&(u.modelLists[u.current_index].modelInfoData.end_time=e,u.modelLists[u.current_index].modelInfoData.expiration_date_stamp=Date.parse(new Date(e)))}null!=u.editcartype&&""!=u.editcartype&&u.dataTypeFlag&&(u.modelLists[u.current_index].modelInfoData.car_type=u.editcartype),null==u.editAttachment||""==u.editAttachment&&0!=u.editAttachment||u.dataStateFlag&&(null==u.shouxu?u.modelLists[u.current_index].modelInfoData.attachment=u.editAttachment:u.modelLists[u.current_index].modelInfoData.attachment=u.shouxu),null==u.edit_extra&&""==u.edit_extra||(u.modelLists[u.current_index].modelInfoData.extra=u.edit_extra);var t=parseFloat(u.modelLists[u.current_index].refer_price);u.dataPriceFlag&&(null==u.editfavourablemoney&&null==u.editfavourablemoney&&null==u.edit_sale_price?isNaN(parseInt(u.modelLists[u.current_index].modelInfoData.sale_price))?(u.modelLists[u.current_index].modelInfoData.sale_price=u.modelLists[u.current_index].refer_price,u.editJiFlag=!1):u.modelLists[u.current_index].modelInfoData.sale_price=parseFloat(u.modelLists[u.current_index].modelInfoData.sale_price):"money"==u.editFavourableMode?(""==u.editfavourablemoney&&(u.editfavourablemoney=0),u.edit_has_add_money?u.modelLists[u.current_index].modelInfoData.sale_price=t-parseFloat(u.editfavourablemoney):u.modelLists[u.current_index].modelInfoData.sale_price=t+parseFloat(u.editfavourablemoney)):"point"==u.editFavourableMode?(""==u.editfavourablepoint&&(u.editfavourablepoint=0),u.edit_has_add_point?u.modelLists[u.current_index].modelInfoData.sale_price=t-t*parseFloat(u.editfavourablepoint)/100:u.modelLists[u.current_index].modelInfoData.sale_price=t+t*parseFloat(u.editfavourablepoint)/100):"price"==u.editFavourableMode?u.modelLists[u.current_index].modelInfoData.sale_price=u.edit_sale_price:u.editJiFlag=!1,null==u.edit_current_price1&&""==u.edit_current_price1||(u.modelLists[u.current_index].modelInfoData.front_price=u.edit_current_price1)),isNaN(parseFloat(u.modelLists[u.current_index].modelInfoData.sale_price))&&(u.modelLists[u.current_index].modelInfoData.sale_price=u.modelLists[u.current_index].refer_price,u.editJiFlag=!1),u.editJiFlag&&(u.modelLists[u.current_index].modelInfoData.sale_price=parseFloat(u.modelLists[u.current_index].modelInfoData.sale_price).toFixed(2),u.modelLists[u.current_index].modelInfoData.sale_price+="万"),isNaN(u.modelLists[u.current_index].modelInfoData.front_price)&&(u.modelLists[u.current_index].modelInfoData.front_price=u.modelLists[u.current_index].edit_current_price1,u.editJiFlag1=!1),u.editJiFlag1&&(u.modelLists[u.current_index].modelInfoData.front_price=u.modelLists[u.current_index].modelInfoData.front_price,u.modelLists[u.current_index].modelInfoData.front_price+="元"),$("#modalEdit").modal("hide")},u.editColorList="",$("#resourceEditColor").on("changed.bs.select",function(e){u.dataColorFlag=!1;for(var t=u.editColorList="",a=e.currentTarget.selectedOptions,i=0;i<$(a).length;i++)0==i?(u.editColorList=a[i].textContent,t=a[i].textContent):(u.editColorList+="|"+a[i].textContent,t+="|"+a[i].textContent);u.modelLists[u.current_index].modelInfoData.colors=t}),u.resourceModelShow=function(e){$("#modelShow").modal(),u.previewInfo=u.modelLists[e]},u.modelDelete=function(a,i){var e=i+1;layer.confirm("你确定要删除车型 "+e+" ？",{btn:["确定","取消"],icon:0,skin:"layui-layer-molv"},function(e){u.modelLists.splice(i,1);var t=$(a.currentTarget).attr("data-current-id");angular.element("#pinlists").find("a[data-model-id="+t+"]").removeClass("active"),g(u.editOverList,i),0==u.modelLists.length&&(u.modelLists=[],u.modelisthasshow=!0,u.edit_btn=!1,u.has_send_btn=!0,u.$apply()),layer.close(e)},function(e){layer.close(e)}),f()},u.provice_id=0,u.provice_id1=0,u.proviceName="",u.proviceName1="",u.city_id=0,u.city_id1=0,u.cityName="",u.cityName1="";var S={},L={};function w(e){u.areaJoin="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo.cId,i=(e[t].data.cityInfo.cName,e[t].data.pId);e[t].data.pName;0!=t?u.areaJoin+="|"+i+","+a:u.areaJoin=i+","+a}u.cityBtnShow=!0}function C(e){console.log(e),u.areaJoin1="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo1.cId1,i=(e[t].data.cityInfo1.cName1,e[t].data.pId1);e[t].data.pName1;0!=t?u.areaJoin1+="|"+i+","+a:u.areaJoin1=i+","+a}u.cityBtnShow1=!0}function I(e,t){for(var a=!1,i={},r=e.split("|"),n=0,s=r.length;n<s;n++)if(r[n].split(",")[2]==t){r.splice(n,1),a=!0;break}return i.state=a,i.lists=r.join("|"),i}u.showselectArea=[],u.showselectArea1=[],u.cityList=[],u.cityList1=[],u.areaJoin="",u.areaJoin1="",d({method:"GET",url:BASEURL+"/api2/area/provinces?device=1",timeout:1e4}).success(function(e){1==e.status?(u.proviceData=e.list,u.pData=e.list,u.proviceData.unshift(t)):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}),u.before_provice_id="",u.before_provice_id1="",u.before_city_id="",u.before_city_id1="",u.whole_province_list=[],u.whole_province_list1=[],u.current_change_provice="",u.current_change_provice1="",u.current_change_city="",u.current_change_city1="",u.first_send=!1,u.first_send1=!1,u.selectProvice=function(e,t){u.resourceSeller="",u.sellerAddress="",u.resourceSellerList=[],u.provice_id=t,u.proviceName=$(e.currentTarget).text(),u.current_change_provice=$(e.currentTarget).text(),u.current_change_city="",(S={}).data={},S.data.cityInfo={},0!=t?0==u.before_provice_id&&u.first_send?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.showselectArea=[],u.before_provice_id=t,S.data.pId=u.provice_id,S.data.pName=u.proviceName,u.cityBtnShow=!0,w(u.showselectArea),d({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.cityData=e.list,u.cityData.unshift(a),u.cityBtnShow=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(u.before_provice_id=t,S.data.pId=u.provice_id,S.data.pName=u.proviceName,-1==$.inArray(u.provice_id,u.whole_province_list)?d({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.cityData=e.list,u.cityData.unshift(a),u.cityBtnShow=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(u.cityBtnShow=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===u.before_provice_id?(u.before_provice_id=t,u.first_send=!0,S.data.pId=0,S.data.pName="全国",S.data.cityInfo.cId=0,S.data.cityInfo.cName=" ",u.current_change_provice="全国",u.showselectArea.push(S),u.cityBtnShow=!0,w(u.showselectArea)):0==u.before_provice_id||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.before_provice_id=t,u.showselectArea=[],S.data.pId=0,S.data.pName="全国",S.data.cityInfo.cId=0,S.data.cityInfo.cName=" ",u.current_change_provice="全国",u.showselectArea.push(S),u.cityBtnShow=!0,w(u.showselectArea),u.$apply(),u.first_send=!0},function(e){layer.close(e)})},u.selectProvice1=function(e,t){u.resourceSeller1="",u.sellerAddress1="",u.resourceSellerList1=[],u.provice_id1=t,u.proviceName1=$(e.currentTarget).text(),u.current_change_provice1=$(e.currentTarget).text(),u.current_change_city1="",(L={}).data={},L.data.cityInfo1={},0!=t?0==u.before_provice_id1&&u.first_send1?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.showselectArea1=[],u.before_provice_id1=t,L.data.pId1=u.provice_id1,L.data.pName1=u.proviceName1,u.cityBtnShow1=!0,C(u.showselectArea1),d({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.cityData1=e.list,u.cityData1.unshift(o),u.cityBtnShow1=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(u.before_provice_id1=t,L.data.pId1=u.provice_id1,L.data.pName1=u.proviceName1,-1==$.inArray(u.provice_id1,u.whole_province_list1)?d({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.cityData1=e.list,u.cityData1.unshift(o),u.cityBtnShow1=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(u.cityBtnShow1=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===u.before_provice_id1?(u.before_provice_id1=t,u.first_send1=!0,L.data.pId1=0,L.data.pName1="全国",L.data.cityInfo1.cId1=0,L.data.cityInfo1.cName1=" ",u.current_change_provice1="全国",u.showselectArea1=[],u.showselectArea1.push(L),u.cityBtnShow1=!0,C(u.showselectArea1)):0==u.before_provice_id1||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.before_provice_id1=t,u.showselectArea1=[],L.data.pId1=0,L.data.pName1="全国",L.data.cityInfo1.cId1=0,L.data.cityInfo1.cName1=" ",u.current_change_provice1="全国",u.showselectArea1=[],u.showselectArea1.push(L),u.cityBtnShow1=!0,C(u.showselectArea1),u.$apply(),u.first_send1=!0},function(e){layer.close(e)})},u.selectCity=function(e,a){S.data.cityInfo.cId="",S.data.cityInfo.cName="",-1==$.inArray(a,u.cityList)&&(0!=a?(u.before_city_id=a,u.cityList.push(a),u.city_id=a,u.cityName=$(e.currentTarget).text(),u.current_change_city=$(e.currentTarget).text(),S.data.cityInfo.cId=u.city_id,S.data.cityInfo.cName=u.cityName,u.cityBtnShow=!0,u.showselectArea.push(S),w(u.showselectArea)):""==u.before_city_id&&0!=u.before_city_id?(S.data.pId=u.provice_id,S.data.pName=u.proviceName,S.data.cityInfo.cId=0,S.data.cityInfo.cName="全省",u.current_change_city="全省",u.whole_province_list.push(u.provice_id),u.showselectArea.push(S),w(u.showselectArea)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+u.proviceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){u.before_city_id=a,layer.close(e);for(var t=0;t<u.showselectArea.length;t++)u.showselectArea[t].data.pId==u.provice_id&&(u.showselectArea.splice(t,1),t-=1);S.data.pId=u.provice_id,S.data.pName=u.proviceName,S.data.cityInfo.cId=0,S.data.cityInfo.cName="全省",u.current_change_city="全省",u.whole_province_list.push(u.provice_id),u.showselectArea.push(S),w(u.showselectArea),u.$apply()},function(e){layer.close(e)}))},u.selectCity1=function(e,a){L.data.cityInfo1.cId1="",L.data.cityInfo1.cName1="",-1==$.inArray(a,u.cityList1)&&(0!=a?(u.before_city_id1=a,u.cityList1.push(a),u.city_id1=a,u.cityName1=$(e.currentTarget).text(),u.current_change_city1=$(e.currentTarget).text(),L.data.cityInfo1.cId1=u.city_id1,L.data.cityInfo1.cName1=u.cityName1,u.cityBtnShow1=!0,u.showselectArea1=[],u.showselectArea1.push(L),C(u.showselectArea1)):""==u.before_city_id1&&0!=u.before_city_id1?(L.data.pId1=u.provice_id1,L.data.pName1=u.proviceName1,L.data.cityInfo1.cId1=0,L.data.cityInfo1.cName1="全省",u.current_change_city1="全省",u.whole_province_list1.push(u.provice_id1),u.showselectArea1=[],u.showselectArea1.push(L),C(u.showselectArea1)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+u.proviceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){u.before_city_id1=a,layer.close(e);for(var t=0;t<u.showselectArea1.length;t++)u.showselectArea1[t].data.pId1==u.provice_id1&&(u.showselectArea1.splice(t,1),t-=1);L.data.pId1=u.provice_id1,L.data.pName1=u.proviceName1,L.data.cityInfo1.cId1=0,L.data.cityInfo1.cName1="全省",u.current_change_city1="全省",u.whole_province_list1.push(u.provice_id1),u.showselectArea1=[],u.showselectArea1.push(L),C(u.showselectArea1),u.$apply()},function(e){layer.close(e)}))},u.removeEle=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;u.showselectArea.splice(t,1);for(var i=0;i<u.whole_province_list.length;i++)if(u.whole_province_list[i]==a){u.whole_province_list.splice(i,1);break}u.cityList.splice(t,1),0==u.showselectArea.length&&(u.before_provice_id="",u.before_city_id="",u.whole_province_list=[]),w(u.showselectArea)},u.removeEle1=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;u.showselectArea1.splice(t,1);for(var i=0;i<u.whole_province_list1.length;i++)if(u.whole_province_list1[i]==a){u.whole_province_list1.splice(i,1);break}u.cityList1.splice(t,1),0==u.showselectArea1.length&&(u.before_provice_id1="",u.before_city_id1="",u.whole_province_list1=[]),C(u.showselectArea1)},u.has_add_money=!0,u.has_add_point=!0,u.jiFlag=!0,u.favourableMoney=function(e){u.has_add_money=-1==e},u.favourablePoint=function(e){u.has_add_point=-1==e},u.$watch("favourablemoney",function(e,t){Math.ceil(e);e<0&&null!=e&&""!=e&&(layer.msg("输入的点数必须是数字，且不能小于0！",{time:1500}),u.favourablemoney="")}),u.$watch("favourablepoint",function(e,t){(100<Math.ceil(e)||e<0)&&null!=e&&""!=e&&(layer.msg("输入的点数必须是数字，且不能小于0或大于100！",{time:1500}),u.favourablepoint="")}),u.$watch("sale_price",function(e,t){/[1-9][0-9]*/.test(e)||null==e||""==e||(layer.msg("输入的价格必须是数字，且不能小于0！",{time:1500}),u.sale_price="")}),u.$watch("front_price ",function(e,t){/[1-9][0-9]*/.test(e)||null==e||""==e||(layer.msg("输入的价格必须是数字，且不能小于0！",{time:1500}),u.front_price="")}),u.resourceAttribute=function(){u.editFlag=!1,0==u.modelLists.length?layer.msg("请添加车型列表后再操作！",{time:1500}):layer.confirm("你确定要同意修改所有车型列表属性吗？",{btn:["确定","取消"],icon:0,skin:"layui-layer-molv"},function(e){u.edit_btn=!0,u.jiFlag=!0,u.jiFlag1=!0;for(var t=0,a=u.modelLists.length;t<a;t++)if(-1==$.inArray(u.modelLists[t].id,u.editOverList)){u.modelLists[t].modelInfoData.colors=u.exteriorColor,u.modelLists[t].modelInfoData.interior=u.trimColor,u.modelLists[t].modelInfoData.area_list=u.areaJoin,u.modelLists[t].modelInfoData.area_list1=u.areaJoin1,u.modelLists[t].modelInfoData.sale_area_list_name=u.showselectArea,u.modelLists[t].modelInfoData.sale_area_list_name1=u.showselectArea1,u.modelLists[t].modelInfoData.manufacture=u.manufacture,u.modelLists[t].modelInfoData.attachment=u.attachment,u.modelLists[t].modelInfoData.car_type=u.car_type,u.modelLists[t].modelInfoData.end_time=angular.element("#end_time").val(),u.modelLists[t].modelInfoData.expiration_date_stamp=Date.parse(new Date(angular.element("#end_time").val().toString().replace(/-/g,"/")));if(/\d+/.test(u.modelLists[t].refer_price)){var i=parseFloat(u.modelLists[t].refer_price);"money"==u.favourableMode?(null!=u.favourablemoney&&""!=u.favourablemoney||(u.favourablemoney=0),u.has_add_money?u.modelLists[t].modelInfoData.sale_price=i-parseFloat(u.favourablemoney):u.modelLists[t].modelInfoData.sale_price=i+parseFloat(u.favourablemoney)):"point"==u.favourableMode?(null!=u.favourablepoint&&""!=u.favourablepoint||(u.favourablepoint=0),u.has_add_point?u.modelLists[t].modelInfoData.sale_price=i-i*parseFloat(u.favourablepoint)/100:u.modelLists[t].modelInfoData.sale_price=i+i*parseFloat(u.favourablepoint)/100):"price"==u.favourableMode?u.modelLists[t].modelInfoData.sale_price=u.sale_price:(u.modelLists[t].modelInfoData.sale_price=u.modelLists[t].refer_price,u.jiFlag=!1)}else null==u.sale_price||""==u.sale_price?u.modelLists[t].modelInfoData.sale_price=u.modelLists[t].refer_price:u.modelLists[t].modelInfoData.sale_price=u.sale_price;isNaN(parseFloat(u.modelLists[t].modelInfoData.sale_price))&&(u.modelLists[t].modelInfoData.sale_price=u.modelLists[t].modelInfoData.sale_price,u.jiFlag=!1),u.jiFlag&&(u.modelLists[t].modelInfoData.sale_price=parseFloat(u.modelLists[t].modelInfoData.sale_price).toFixed(2),u.modelLists[t].modelInfoData.sale_price+="万"),null==u.front_price||""==u.front_price?u.modelLists[t].modelInfoData.front_price=u.modelLists[t].front_price:u.modelLists[t].modelInfoData.front_price=u.front_price,isNaN(u.modelLists[t].modelInfoData.front_price)&&(u.modelLists[t].modelInfoData.front_price=u.modelLists[t].modelInfoData.front_price,u.jiFlag1=!1),u.jiFlag1&&(console.log(u.jiFlag1,u.modelLists[t].modelInfoData.front_price),u.modelLists[t].modelInfoData.front_price=u.modelLists[t].modelInfoData.front_price,u.modelLists[t].modelInfoData.front_price+="元"),u.modelLists[t].modelInfoData.extra=u.extra,u.modelLists[t].modelInfoData.sellerAddress=u.sellerAddress,u.modelLists[t].modelInfoData.sellerAddress1=u.sellerAddress1}u.$apply(),layer.msg("信息应用成功，请在车型列表中点击预览查看！",{icon:1,time:2e3}),layer.close(e)},function(e){layer.close(e)}),u.has_use_attr_click=!0,m(function(){u.has_use_attr_click=!1},5e3)},u.submitData=function(){console.log(u.modelLists);var e=function(e){var t=e.length;console.log(t);var a={state:!1,index:"",info:""};u.editFlag&&(e.modelInfoData={brand_id:"",brand_name:"",sub_brand_id:"",sub_brand_name:"",model_picture:"",model_id:"",model_name:"",colors:"",interior:"",car_type:"",manufacture_time:"",attachment:"",end_time:"",sale_price:"",model_price:"",resource_extra:"",front_price:"",area_list:"",source_area:""});for(var i=0;i<t;i++){if(!(e[i].hasOwnProperty("id")&&""!=e[i].id&&e[i].hasOwnProperty("modelInfoData")&&e[i].modelInfoData.hasOwnProperty("colors")&&""!=e[i].modelInfoData.colors&&e[i].modelInfoData.hasOwnProperty("interior")&&""!=e[i].modelInfoData.interior&&e[i].modelInfoData.hasOwnProperty("area_list1")&&""!=e[i].modelInfoData.area_list1&&e[i].modelInfoData.hasOwnProperty("area_list")&&""!=e[i].modelInfoData.area_list&&e[i].modelInfoData.hasOwnProperty("attachment")&&""!=e[i].modelInfoData.attachment&&e[i].modelInfoData.hasOwnProperty("car_type")&&""!=e[i].modelInfoData.car_type&&e[i].modelInfoData.hasOwnProperty("manufacture")&&""!=e[i].modelInfoData.manufacture&&e[i].modelInfoData.hasOwnProperty("end_time")&&""!=e[i].modelInfoData.end_time&&e[i].modelInfoData.hasOwnProperty("sale_price")&&""!=e[i].modelInfoData.sale_price&&e[i].modelInfoData.hasOwnProperty("front_price")&&""!=e[i].modelInfoData.front_price&&null!=e[i].modelInfoData.front_price&&e[i].modelInfoData.hasOwnProperty("extra")&&""!=e[i].modelInfoData.extra&&null!=e[i].modelInfoData.extra)){a.state=!0,a.index=i;break}/\d+/.test(e[i].modelInfoData.sale_price)||(a.info="且价格格式不正确",a.index=i,a.state=!0)}return a}(u.modelLists);console.log(e);var t=parseInt(e.index)+1;if(e.state)layer.msg("车型列表 <em style='font-weight: bold; font-style: normal; color: #d9534f'>"+t+"</em> 信息不完整，请补充后再提交！"+e.info,{icon:1,time:2e3});else{!function a(i,e){console.log(i),u.edit_btn=!1,u.has_send_btn=!0;var t={brand_id:"",brand_name:"",sub_brand_id:"",sub_brand_name:"",model_picture:"",model_id:"",model_name:"",colors:"",interior:"",car_type:"",manufacture_time:"",attachment:"",end_time:"",sale_price:"",model_price:"",resource_extra:"",front_price:"",area_list:"",source_area:""},r=e;r>i.length-1?(layer.confirm("选择车型发布完成，是否继续发布？",{btn:["确定","取消"],icon:0,skin:"layui-layer-molv",closeBtn:0},function(){window.location.reload()},function(){u.jumpUrl("home.specialResourcesLists")}),u.has_send_btn=!1):(t.brand_id=i[r].bid,t.brand_name=i[r].modelInfoData.brand_name,t.sub_brand_id=i[r].sbid,t.sub_brand_name=i[r].modelInfoData.subPin,console.log(i[r].modelInfoData.sub_brand_picture),t.model_picture=i[r].modelInfoData.sub_brand_picture,t.model_id=i[r].id,t.model_name=i[r].name,t.colors=i[r].modelInfoData.colors,t.interior=i[r].modelInfoData.interior,t.car_type=i[r].modelInfoData.car_type,0==i[r].modelInfoData.manufacture?t.manufacture_time="一年以内":1==i[r].modelInfoData.manufacture?t.manufacture_time="半年内":2==i[r].modelInfoData.manufacture?t.manufacture_time="三个月内":t.manufacture_time="一年以上",0==i[r].modelInfoData.attachment?t.attachment="随车发":1==i[r].modelInfoData.attachment?t.attachment="3天内发":t.attachment="7天内发",t.end_time=i[r].modelInfoData.expiration_date_stamp,t.sale_price=parseInt(1e4*parseFloat(i[r].modelInfoData.sale_price)),t.model_price=parseInt(1e4*parseFloat(i[r].refer_price)),t.resource_extra=i[r].modelInfoData.extra,t.front_price=parseInt(i[r].modelInfoData.front_price),t.area_list=i[r].modelInfoData.area_list,t.source_area=i[r].modelInfoData.area_list1,console.log(t),d({method:"POST",url:BASEURL+"/res_v1_0_0/cms/special/res/insert?out=json",headers:{"Content-Type":"application/json;charset=UTF-8"},params:t,timeout:1e4}).success(function(e){console.log(e),console.log(e.data);var t=parseInt(r)+1;1==e.status?(layer.msg("车型<em style='font-weight: bold; font-style: normal; color: #d9534f'>"+t+"</em> "+e.data,{icon:1,time:1500}),r+=1,m(function(){a(i,r)},2e3)):(layer.msg("车型<em style='font-weight: bold; font-style: normal; color: #d9534f'>"+t+"</em> "+e.data,{icon:1,time:1500}),u.has_send_btn=!1)}).error(function(e){}))}(u.modelLists,0);var a=u.modelBrandId,i=u.currentSubPin,r=u.modelSubBrandId,n=a+","+i+","+r,s=p.get("hotList");if(null!=s){var o=_(s);if(10<=o.length){var c=I(s,r),l="";c.state?l=c.lists+"|"+n:((l=s.split("|")).splice(0,1),l=l.join("|")+"|"+n),p.put("hotList",l)}else{if(0==o.length)s=n;else s=I(s,r).lists+"|"+n;p.put("hotList",s)}}else p.put("hotList",n)}},u.fastEntry=function(e){$("#editPanl").find(".hot-show").hasClass("layui-show")||$("#editPanl").find(".hot-show").addClass("layui-show"),$("#resourceSubPin").find(".layui-select-title").find("input").addClass("layui-disabled");var t=e.currentTarget,a=$(t).attr("data-pid"),i=$(t).attr("data-spid"),r=$("#resourcePin").find(".layui-anim-upbit").find("dd");u.modelBrandId=a,u.modelSubBrandId=i,u.currentSubPin=$(t).text();for(var n=0,s=r.length;n<s;n++)if($(r[n]).attr("lay-value")==a){$("#resourcePin").find(".layui-select-title").find("input").val($(r[n]).text()),$("#resourceSubPin").find(".layui-select-title").find("input").val($(t).text()),h(a,i);break}}}]),app.controller("addSupplierCtrl",["$scope","$http","$timeout",function(a,e,i){a.province_id="",a.city_id1="",a.cityBtn=!0,a.supplier_btn=!1,e({url:BASEURL+"/api2/area/provinces?device=1",method:"GET",timeout:1e4}).success(function(e){1==e.status?a.provincesData=e.list:layer.msg("请求失败",{icon:5})}).error(function(e){}),e({url:BASEURL+"/cms2/supplier/manu?device=1",method:"GET",timeout:1e4}).success(function(e){1==e.status?a.manufacturerData=e.list:layer.msg("请求失败",{icon:5})}).error(function(e){}),a.selectProvince=function(){null==a.province_id?a.cityBtn=!0:e({url:BASEURL+"/api2/area/cities?province="+a.supplier_province_id+"&device=1",method:"GET",timeout:1e4}).success(function(e){1==e.status?(a.cityData=e.list,a.supplier_city_id="",a.cityBtn=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},a.sendMsg=function(){a.supplier_btn=!0;var t=layer.msg("数据提交中...",{icon:16,time:0});e({url:BASEURL+"/cms2/supplier/add?device=1",method:"POST",timeout:1e4,params:{province_id:a.supplier_province_id,city_id:a.supplier_city_id,supplier_name:a.supplier_name,supplier_full_name:a.supplier_full_name,manu_id:a.manu_id,supplier_sale_addr:a.supplier_sale_addr,sale_region:a.sale_region,bmap_lng:a.bmap_lng,bmap_lat:a.bmap_lat,supplier_tel:a.supplier_tel}}).success(function(e){layer.close(t),1==e.status?(layer.msg("添加成功",{icon:1,time:1500}),i(function(){layer.confirm("是否还要继续添加？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0,anim:4},function(e){a.supplier_btn=!1,layer.close(e),window.location.reload()},function(e){layer.close(e),a.jump("/home/cms/supplier"),a.$apply()})},2e3)):(layer.msg("添加失败",{icon:5,time:2e3}),i(function(){a.supplier_btn=!1},2500))}).error(function(){})}}]),app.controller("addSupplierLeaderCtrl",["$http","$scope","$state","$timeout","$stateParams",function(e,r,t,a){r.supplierList="",r.$watch("supplier_name",function(){r.supplier_name?e({method:"GET",url:BASEURL+"/cms2/supplier/datas?pagesize=5&device=1&pageindex=1&supplier_name="+r.supplier_name}).success(function(e){console.log(e),1==e.status?(0<e.list.length||(e.list=[{supplier_name:"暂无查询到商家"}]),r.supplierList=e.list):layer.msg("请求失败",{icon:5})}).error(function(){}):r.supplierList=""}),r.selSupplier=function(e){var t=$(e.currentTarget),a=t.attr("data-supplier");r.supplier_id=a;var i=t.text().replace(/(^\s*)|(\s*$)/g,"");r.supplier_name=i,r.supplierList=""},r.addLeader=function(){console.log(r.supplier_id);var t=layer.msg("加载中...",{icon:16,time:0});e({method:"POST",url:BASEURL+"/cms2/supplier/leader/add?device=1",params:{supplier_id:r.supplier_id,supplier_leader_name:r.supplier_leader_name,supplier_leader_mobile:r.supplier_leader_mobile}}).success(function(e){layer.close(t),1==e.status?(layer.msg("添加成功",{icon:1,time:1500}),a(function(){layer.confirm("是否还要继续添加？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0,anim:4},function(e){r.transit_btn=!1,layer.close(e),window.location.reload()},function(e){layer.close(e),r.jump("/home/cms/supplierLeader"),r.$apply()})},2e3)):layer.msg("添加失败",{icon:5})})}}]),app.controller("storeAddTemplateCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state","$http",function(s,t,a,i,e,r,n){s.province_id=0,s.provinceName="",s.city_id=0,s.cityName="";var o={};function c(e){s.areaJoin="",s.area_list="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo.cId,i=e[t].data.cityInfo.cName,r=e[t].data.pId,n=e[t].data.pName;0!=t?(s.areaJoin+="|"+r+","+a,s.area_list+="|"+n+i):(s.areaJoin=r+","+a,s.area_list+=n+i)}s.cityBtnShow=!0}s.showselectArea=[],s.cityList=[],s.areaJoin="";var l={id:0,name:"全国"},d={id:0,name:"全省"};n({method:"GET",url:BASEURL+"/api2/area/provinces?device=1",timeout:1e4}).success(function(e){1==e.status?(s.provinceData=e.list,s.provinceData.unshift(l)):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}),s.before_provice_id="",s.before_city_id="",s.whole_province_list=[],s.current_change_province="",s.current_change_city="",s.first_send=!1,s.selectProvince=function(e,t){s.province_id=t,s.provinceName=e,s.current_change_province=e,s.current_change_city="",(o={}).data={},o.data.cityInfo={},0!=t?0==s.before_province_id&&s.first_send?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),s.showselectArea=[],s.before_province_id=t,o.data.pId=s.province_id,o.data.pName=s.provinceName,s.cityBtnShow=!0,c(s.showselectArea),n({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(s.cityData=e.list,s.cityData.unshift(d),s.cityBtnShow=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(s.before_province_id=t,o.data.pId=s.province_id,o.data.pName=s.provinceName,-1==$.inArray(s.province_id,s.whole_province_list)?n({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(s.cityData=e.list,s.cityData.unshift(d),s.cityBtnShow=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(s.cityBtnShow=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===s.before_province_id?(s.before_province_id=t,s.first_send=!0,o.data.pId=0,o.data.pName="全国",o.data.cityInfo.cId=0,o.data.cityInfo.cName=" ",s.current_change_province="全国",s.showselectArea.push(o),s.cityBtnShow=!0,c(s.showselectArea)):0==s.before_province_id||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),s.before_province_id=t,s.showselectArea=[],o.data.pId=0,o.data.pName="全国",o.data.cityInfo.cId=0,o.data.cityInfo.cName=" ",s.current_change_province="全国",s.showselectArea.push(o),s.cityBtnShow=!0,c(s.showselectArea),s.$apply(),s.first_send=!0},function(e){layer.close(e)})},s.selectCity=function(e,a){o.data.cityInfo.cId="",o.data.cityInfo.cName="",-1==$.inArray(a,s.cityList)&&(0!=a?(s.before_city_id=a,s.cityList.push(a),s.city_id=a,s.cityName=e,s.current_change_city=e,o.data.cityInfo.cId=s.city_id,o.data.cityInfo.cName=s.cityName,s.cityBtnShow=!0,s.showselectArea.push(o),c(s.showselectArea)):""==s.before_city_id&&0!=s.before_city_id?(o.data.pId=s.provice_id,o.data.pName=s.proviceName,o.data.cityInfo.cId=0,o.data.cityInfo.cName="全省",s.current_change_city="全省",s.whole_province_list.push(s.provice_id),s.showselectArea.push(o),c(s.showselectArea)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+s.provinceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){s.before_city_id=a,layer.close(e);for(var t=0;t<s.showselectArea.length;t++)s.showselectArea[t].data.pId==s.province_id&&(s.showselectArea.splice(t,1),t-=1);o.data.pId=s.province_id,o.data.pName=s.provinceName,o.data.cityInfo.cId=0,o.data.cityInfo.cName="全省",s.current_change_city="全省",s.whole_province_list.push(s.province_id),s.showselectArea.push(o),c(s.showselectArea),s.$apply()},function(e){layer.close(e)}))},s.removeEle=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;s.showselectArea.splice(t,1);for(var i=0;i<s.whole_province_list.length;i++)if(s.whole_province_list[i]==a){s.whole_province_list.splice(i,1);break}s.cityList.splice(t,1),0==s.showselectArea.length&&(s.before_province_id="",s.before_city_id="",s.whole_province_list=[]),c(s.showselectArea)};var u=layer.load(1);s.add_template_btn=!1,s.sortLit=[],s.name="",s.assortment_id="",s.recommend_type=0;var m={sortListUrl:"/cms2/assortment/datas?device=1",uploadUrl:"/api2/file/upload?device=1",addUrl:"/cms2/template/add?device=1",send_data:{effecte_uri:"",template_uri:s.template_uri,recommend_type:s.recommend_type,sale_area_list:s.areaJoin,desc:s.desc,share_picture:""},init:function(){this.getSortList()},is_Array:function(e){return"[object Array]"==Object.prototype.toString.call(e)},selectData:function(){this.send_data.assortment_id=s.assortment_id,this.send_data.is_up=s.is_up,r.go("home.storeTemplate",this.send_data)},getSortList:function(){t.getData("GET",this.sortListUrl,"",this.setSortList,this.errorData)},setSortList:function(e){layer.close(u),1==e.status&&(s.sortLit=e.datas)},addTempalteFn:function(e){t.getData("POST",this.addUrl,e,this.addTemplateSuccess,this.errorData)},addTemplateSuccess:function(e){1==e.status?(layer.msg("新建成功",{icon:1,time:1500}),s.add_template_btn=!1,i(function(){layer.confirm("是否继续添加？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e),a.location.reload()},function(e){s.jumpUrl("home.storeTemplate")})},1600)):(s.add_template_btn=!1,layer.msg(e.msg,{icon:0,time:1500}))},uploadImgBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("上传中...",{icon:16,time:0})},uploadFileBefore:function(e){if("text/html"!=e[0].value.type)return layer.msg("文件格式不对，请上传正确格式的文件！"),!1;angular.element("#tempalteAddress").text(e[0].value.name),layer.msg("上传中...",{icon:16,time:0})},uploadImgSuccess:function(e){if(layer.closeAll("dialog"),1==e.status){var t=imgUrl+e.data[0].normal;m.send_data.effecte_uri=e.data[0].normal,angular.element("#tempalteImg").attr("src",t),layer.msg("上传成功")}else layer.msg("上传失败")},uploadPictcureSuccess:function(e){if(layer.closeAll("dialog"),1==e.status){var t=imgUrl+e.data[0].normal;m.send_data.share_picture=e.data[0].normal,angular.element("#share_picture").attr("src",t),layer.msg("上传成功")}else layer.msg("上传失败")},errorData:function(){layer.close(u),layer.msg("请求失败",{icon:5})}};m.init(),angular.element("#sel_img").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!1,beforeSubmit:m.uploadImgBefore,success:m.uploadImgSuccess,xhrFields:{withCredentials:!0}};angular.element("#uploadImg").ajaxSubmit(e)}),angular.element("#sel_img1").on("change",function(){var e={url:BASEURL+"/api2/file/upload/?device=1",type:"POST",resetForm:!1,beforeSubmit:m.uploadImgBefore,success:m.uploadPictcureSuccess,xhrFields:{withCredentials:!0}};angular.element("#uploadImg1").ajaxSubmit(e)}),s.addTemplate=function(){m.send_data.name=s.name,m.send_data.assortment_id=s.assortment_id,m.send_data.recommend_type=s.recommend_type,m.send_data.sale_area_list=s.areaJoin,m.send_data.template_uri=s.template_uri,m.send_data.desc=s.desc,console.log(m.send_data),m.send_data.effecte_uri&&s.desc&&s.name&&s.assortment_id&&s.template_uri?(s.add_template_btn=!0,m.addTempalteFn(m.send_data)):layer.msg("请填写完整信息")}}]),app.controller("addUnitCtrl",["$http","$scope","$timeout","$stateParams",function(u,t,a,r){t.addUnit_btn=!1,t.selBtn=function(){$("#selModal").modal("show"),u({method:"GET",url:BASEURL+"/cms2/unit/datas?device=1&page_index=1&page_size=10&parent_id="+r.unit_id}).success(function(a){if(1==a.status){var i="",r="";$.each(a.list,function(e,t){r=1==a.list[e].has_children?"icon-caret-right":"",i+='<li data-parent-id="'+t.parent_id+'" data-unit-id="'+t.unit_id+'" data-children="'+t.has_children+'"><div class="menu-0"><span class="sub-unfold '+r+'"></span><span>'+t.name+"</span></div></li>"}),$("#unit_list").html(i)}})},$("#unit_list").on("click","li span:first-child",function(){var n,s,o,e=$(this),t=e.parent().parent(),a=t.attr("data-children"),r=t.attr("data-unit-id"),c=e.parent().attr("class"),l=c.lastIndexOf("-"),d=parseInt(c.slice(l+1))+1;1==a&&(e.hasClass("icon-caret-right")?(n=t,s=e,o=d,u({method:"GET",url:BASEURL+"/cms2/unit/datas?device=1&parent_id="+r}).success(function(e){if(1==e.status){s.removeClass("icon-caret-right").addClass("icon-caret-down");var t="",a="";for(i=0,len=e.list.length;i<len;i++)a=1==e.list[i].has_children?"icon-caret-right":"",t+='<li data-parent-id="'+e.list[i].parent_id+'" data-unit-id="'+e.list[i].unit_id+'" data-children="'+e.list[i].has_children+'"><div class="menu-'+o+'"><span class="sub-unfold '+a+'"></span><span>'+e.list[i].name+"</span></div>";n.after(t);var r=30*o+"px";$("#unit_list .menu-"+o).css({"padding-left":r})}})):e.hasClass("icon-caret-down")&&(e.removeClass("icon-caret-down").addClass("icon-caret-right"),$('#unit_list li[data-parent-id="'+r+'"]').each(function(){var e=$(this).attr("data-unit-id");$('#unit_list li[data-parent-id="'+e+'"]').each(function(){var e=$(this).attr("data-unit-id");$('#unit_list li[data-parent-id="'+e+'"]').each(function(){$(this).attr("data-unit-id");$(this).remove()}),$(this).remove()}),$(this).remove()})))});var n="",s="";$("#unit_list").on("click","li span:last-child",function(){var e=$(this),t=e.parent().parent(),a=e.parent().next().children(".active");n=t.attr("data-unit-id"),s=e.text(),t.addClass("active").siblings(".active").removeClass("active"),a.removeClass("active")}),$("#choose").on("click",function(){$("#selModal").modal("hide"),$("#sel_name").val(s)}),$("#addUnit").on("click",function(){""==n&&(n=r.unit_id),""==$("#unit_name").val()?layer.msg("名称为空，请输入名称",{icon:0,time:1e4}):(t.addUnit_btn=!0,u({method:"POST",url:BASEURL+"/cms2/unit/add?device=1",params:{name:$("#unit_name").val(),parent_id:n}}).success(function(e){1==e.status?(layer.msg("创建成功",{icon:1,time:1e3}),t.addUnit_btn=!1,a(function(){layer.confirm("是否还要继续添加？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0,anim:4},function(e){layer.close(e),$("#up_level_unit").val(""),$("#unit_name").val("")},function(e){layer.close(e),t.jump("/home/cms/unit?unit_id="+r.unit_id+"&co_name="+r.co_name),t.$apply()})},1500)):layer.msg(e.msg,{icon:5,time:1e3})}))})}]),app.controller("advCtrl",["$scope","$http","$stateParams","$state","$timeout","httpData",function(r,n,s,t,o,e){var a=layer.load(1),c={listUrl:"/cms2/adv/datas?device=1",sendData:{page_index:1,page_size:10,location:"",type:"",enable:""},errorData:function(){r.has_clicked=!1,layer.msg("请求失败",{icon:5})},getAdvList:function(){e.getData("GET",this.listUrl,this.sendData,this.setAdvList,this.errorData)},setAdvList:function(e){layer.close(a),1==e.status?(r.advData=e.list,r.pageNumber=e.page.pageNumber,r.recordCount=e.page.recordCount,r.pageCount=e.page.pageCount,r.pageSize=e.page.pageSize,r.pageList=r.pageNum(r.pageCount,r.pageNumber),r.startData=0==r.recordCount?0:(r.pageNumber-1)*r.pageSize+1,r.endData=e.list.length<r.pageSize?(r.pageNumber-1)*r.pageSize+e.list.length:r.pageNumber*r.pageSize):layer.msg("请求失败",{icon:5})},getDataFromUrl:function(){var e=s.page_index,t=s.location,a=s.type,i=s.enable;e||(e=1),r.location=t,r.type=a,r.enable=i,this.sendData={page_index:e,page_size:10,location:t,type:a,enable:i}},selectData:function(){this.sendData.page_index=1,this.sendData.location=r.location,this.sendData.type=r.type,this.sendData.enable=r.enable,t.go("home.adv",this.sendData)},init:function(){this.getDataFromUrl(),this.getAdvList()}};c.init(),r.selectAdvChange=function(){c.selectData()},r.changePageUrl=function(e){c.sendData.page_index=r.getPageIndex(e,r.pageNumber,r.pageCount),t.go("home.adv",c.sendData)},r.advEnable=function(e,a,i){e.stopPropagation();var t="";t=0==a?"确认启用该广告？":"确认禁用该广告？",layer.confirm(t,{btn:["确定","取消"],title:"提示",skin:"layui-layer-molv",icon:0,anim:3},function(){var t=layer.msg("数据提交中...",{icon:16,time:0});n({method:"POST",url:BASEURL+"/cms2/adv/edit?device=1",params:{id:i,enable:a},timeout:1e4}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),o(function(){c.getAdvList()},1600)):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)})}}]),app.controller("advDetailCtrl",["$scope","$http","$location","$stateParams","$timeout",function(i,e,t,r,a){i.getAdvDetail=function(){var a=layer.msg("加载中...",{icon:16,time:0});e({method:"GET",url:BASEURL+"/cms2/adv/detail/"+r.aid+"?device=1",timeout:1e4}).success(function(e){if(console.log(e),layer.close(a),1==e.status)if(i.advDetail=e.data,e.data.params){var t=JSON.parse(e.data.params);t.fields&&(i.advResourceId=JSON.parse(e.data.params).fields.id,i.res_type=JSON.parse(e.data.params).fields.resource_type),i.action=t.action}else i.advResourceId="",i.res_type="";else layer.msg("请求失败",{icon:5})}).error(function(){})},i.getAdvDetail()}]),app.controller("advTempListCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state","$http",function(n,a,e,t,s,i,r){var o=layer.load(1);n.has_clicked=!1,n.temp_imgs=[{img:"images/temp_0.png",params_type:0,num:1,name:"模板1"},{img:"images/temp_1.png",params_type:1,num:2,name:"模板2"},{img:"images/temp_2.png",params_type:2,num:2,name:"模板3"},{img:"images/temp_3.png",params_type:3,num:3,name:"模板4"},{img:"images/temp_4.png",params_type:4,num:3,name:"模板5"},{img:"images/temp_5.png",params_type:5,num:4,name:"模板6"},{img:"images/temp_6.png",params_type:6,num:5,name:"模板7"},{img:"images/temp_7.png",params_type:7,num:"",name:"模板8"}];var c={list_url:"/cms2/adv/template/query?device=1",delete_url:"/cms2/adv/template/delete?device=1",change_url:"/cms2/adv/template/lock?device=1",listsSendData:{page_index:1,page_size:10,state:"",end_time:"",start_time:"",title:""},init:function(){this.getDataFromUrl(),this.getAdvList()},errorData:function(){layer.close(o),n.has_clicked=!1,layer.msg("请求失败",{icon:5})},getAdvList:function(){a.getData("GET",this.list_url,this.listsSendData,this.setAdvList,this.errorData)},setAdvList:function(e){if(layer.close(o),1==e.status){for(var t=0;t<e.list.length;t++)for(var a=0;a<n.temp_imgs.length;a++)e.list[t].params_type==n.temp_imgs[a].params_type&&(e.list[t].temp_img=n.temp_imgs[a].img);n.adv_list=e.list,n.pageNumber=e.page.pageNumber,n.recordCount=e.page.recordCount,n.pageCount=e.page.pageCount,n.pageSize=e.page.pageSize,n.pageList=n.pageNum(n.pageCount,n.pageNumber),n.startData=0==n.recordCount?0:(n.pageNumber-1)*n.pageSize+1,n.endData=e.list.length<n.pageSize?(n.pageNumber-1)*n.pageSize+e.list.length:n.pageNumber*n.pageSize}else layer.msg("请求失败",{icon:5})},deleteAdv:function(e){a.getData("POST",this.delete_url,{template_id:e},this.successFn,this.errorData)},successFn:function(e){layer.close(o),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),c.getAdvList()):layer.msg(e.msg,{icon:0,time:1500})},changeAdvSate:function(e,t){a.getData("POST",this.change_url,{template_id:e,state:t},this.successFn,this.errorData)},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]},getDataFromUrl:function(){var e=s.page_index,t=s.start_time,a=s.end_time,i=s.state,r=s.title;e||(e=1),t?n.start_time=this.getLocalTime(t).replace(/\//g,"-"):t=null,a?n.end_time=this.getLocalTime(a).replace(/\//g,"-"):a=null,i||(i=""),n.state=i,n.title=r,this.listsSendData={page_index:e,page_size:10,state:i,start_time:t,end_time:a,title:r}},selectData:function(){this.listsSendData.page_index=1;var e="",t="";e=n.start_time?Date.parse(n.start_time.replace(/-/g,"/")):"",t=n.end_time?Date.parse(n.end_time.replace(/-/g,"/")):"",this.listsSendData.state=n.state,this.listsSendData.title=n.title,this.listsSendData.start_time=e,this.listsSendData.end_time=t,i.go("home.advTemp",this.listsSendData)}};c.init(),n.selectState=function(){c.selectData()},n.changeType=function(){c.selectData()},$("#start_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){c.selectData()}),$("#end_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){c.selectData()});var l=!1;n.adv_search=function(){c.selectData()},n.$watch("title",function(){l&&""==n.title&&c.selectData(),l=!0}),n.changePageUrl=function(e){c.listsSendData.page_index=n.getPageIndex(e,n.pageNumber,n.pageCount),i.go("home.advTemp",c.listsSendData)},n.deleteAdv=function(e,t){e.stopPropagation(),t&&layer.confirm("确认删除该条广告模板？",{title:"提示",btn:["确定","取消"],icon:0,skin:"layui-layer-molv"},function(e){c.deleteAdv(t)})},n.changeAdvSate=function(e,t,a){e.stopPropagation(),t&&(0==a?layer.confirm("确认停用该条广告模板？",{title:"提示",btn:["确定","取消"],icon:0,skin:"layui-layer-molv"},function(e){c.changeAdvSate(t,a)}):1==a&&layer.confirm("确认启用该条广告模板？",{title:"提示",btn:["确定","取消"],icon:0,skin:"layui-layer-molv"},function(e){c.changeAdvSate(t,a)}))},n.editAdvTemp=function(e,t){e.stopPropagation(),n.jump("/home/cms/editAdvTemp/"+t)}}]),app.controller("advTempDetailCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state","$http",function(n,t,e,a,i,r,s){var o=layer.load(1);n.has_clicked=!1,n.temp_imgs=[{img:"images/temp_0.png",params_type:0,num:1,name:"模板1"},{img:"images/temp_1.png",params_type:1,num:2,name:"模板2"},{img:"images/temp_2.png",params_type:2,num:2,name:"模板3"},{img:"images/temp_3.png",params_type:3,num:3,name:"模板4"},{img:"images/temp_4.png",params_type:4,num:3,name:"模板5"},{img:"images/temp_5.png",params_type:5,num:4,name:"模板6"},{img:"images/temp_6.png",params_type:6,num:5,name:"模板7"},{img:"images/temp_7.png",params_type:7,num:"",name:"模板8"}],{detail_url:"/cms2/adv/template/detail",init:function(){this.detail(i.id)},errorData:function(){layer.close(o),n.has_clicked=!1,layer.msg("请求失败",{icon:5})},detail:function(e){t.getData("GET",this.detail_url,{device:1,template_id:e},this.setDetail,this.errorData)},setDetail:function(e){if(layer.close(o),1==e.status)if(1==e.status){for(var t=0;t<n.temp_imgs.length;t++)n.temp_imgs[t].params_type==e.data.template.params_type&&(n.temp_img=n.temp_imgs[t].img);n.advTemp=e.data.template,n.adv_list=e.data.adv;for(t=0;t<e.data.adv.length;t++)if(e.data.adv[t].params){var a=JSON.parse(e.data.adv[t].params);"resouce_detail"==a.action?n.adv_list[t].id=a.fields.id:n.adv_list[t].action=a.action}var i=[];for(t=0;t<e.data.area.length;t++){var r="";r="string"==typeof e.data.area[t].province?e.data.area[t].province+e.data.area[t].city:e.data.area[t].province.name+e.data.area[t].city.name,i.push(r)}n.area_list=i.join("、")}else layer.msg("请求失败",{icon:5})},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]},getDataFromUrl:function(){}}.init(),n.getResourceDetail=function(e){s({method:"GET",url:BASEURL+"/api2/auto/resources/query/detail?device=1&res_id="+e}).success(function(e){1==e.status?(n.resourceDetail=e.data,$("#resDetailModal").modal("show")):layer.msg(e.msg,{icon:5,time:1500})})},$("#start_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){var t=$("#start_time").val();$("#end_time").datetimepicker("setStartDate",t)}),$("#end_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){var t=$("#end_time").val();$("#start_time").datetimepicker("setEndDate",t)})}]),app.controller("areaCtrl",["$scope","httpData",function(n,a){n.orderSelectAraeData=[],n.showOrderSelectAraeData=[],n.select_id_lists=[],n.current_provice_id="over",n.current_city_id=0,n.current_town_id=0,n.current_provice_name="全国",n.current_city_name="全省",n.current_town_name="全城";var r={proviceUrl:"/api2/area/provinces?device=1",cityUrl:"/api2/area/cities?device=1",townUrl:"/api2/area/areas?device=1",errorAlert:function(){layer.msg("请求失败",{icon:5})},setProvice:function(e){1===e.status&&(n.proviceLists=e.list,n.proviceLists.unshift({id:0,name:"全国"}))},setCity:function(e){1===e.status&&(n.cityLists=e.list,n.cityLists.unshift({id:0,name:"全省"}))},setTown:function(e){1===e.status&&(n.townLists=e.list,n.townLists.unshift({id:0,name:"全城"}))},getProvice:function(){a.getData("GET",this.proviceUrl,"",this.setProvice,this.errorAlert)},getCity:function(e){var t={province:e};a.getData("GET",this.cityUrl,t,this.setCity,this.errorAlert)},getTown:function(e){var t={province:e};a.getData("GET",this.townUrl,t,this.setTown,this.errorAlert)},modify:function(e,t){n.select_id_lists.push(e),n.orderSelectAraeData.push(t),n.showOrderSelectAraeData=n.orderSelectAraeData},trimData:function(e){n.select_id_lists.splice(e,1),n.orderSelectAraeData.splice(e,1)},removal:function(){var r=this,e=n.current_provice_id+","+n.current_city_id+","+n.current_town_id,t={p_name:n.current_provice_name,c_name:n.current_city_name,t_name:n.current_town_name};if(n.select_id_lists.length<=0)r.modify(e,t);else{if(0==n.current_provice_id)return n.orderSelectAraeData=[],n.select_id_lists=[],r.modify(e,t),!1;if(0==n.current_city_id)return n.select_id_lists.forEach(function(e,t){e.split(",")[0]==n.current_provice_id&&r.trimData(t)}),n.select_id_lists.forEach(function(e,t){e.split(",")[0]==n.current_provice_id&&r.trimData(t)}),this.modify(e,t),!1;if(0==n.current_town_id)return n.select_id_lists.forEach(function(e,t){var a=e.split(",")[0],i=e.split(",")[1];i!=n.current_city_id&&0!=i||a!=n.current_provice_id||r.trimData(t)}),console.log(n.select_id_lists),n.select_id_lists.forEach(function(e,t){e.split(",")[1]==n.current_city_id&&r.trimData(t)}),this.modify(e,t),!1;n.select_id_lists.forEach(function(e,t){var a=e.split(",")[0];0==e.split(",")[2]&&a==n.current_provice_id&&r.trimData(t)}),-1==$.inArray(e,n.select_id_lists)?r.modify(e,t):layer.msg("当前区域已选择！",{icon:1})}},init:function(){this.getProvice()}};r.init(),n.selectProvice=function(e,t,a){n.cityLists=[],n.townLists=[],n.current_city_id=0,n.current_town_id=0,n.current_city_name="全省",n.current_town_name="全城";var i=e.currentTarget;$(i).hasClass("active")?($(i).removeClass("active"),n.current_provice_id="over"):($(i).addClass("active"),$(i).siblings().removeClass("active"),0!=t?(n.current_provice_id=t,n.current_provice_name=a,r.getCity(t)):(n.current_provice_id=0,n.current_provice_name="全国"))},n.selectCity=function(e,t,a){n.townLists=[],n.current_town_id=0,n.current_town_name="全城";var i=e.currentTarget;$(i).hasClass("active")?($(i).removeClass("active"),n.current_city_id=0,n.current_city_name="全省"):($(i).addClass("active"),$(i).siblings().removeClass("active"),n.current_city_name=a,0!=t?(r.getTown(t),n.current_city_id=t):n.current_city_id=0)},n.selectTown=function(e,t,a){var i=e.currentTarget;$(i).hasClass("active")?($(i).removeClass("active"),n.current_town_name="全城",n.current_town_id=0):($(i).addClass("active"),$(i).siblings().removeClass("active"),n.current_town_name=a,n.current_town_id=t)},n.orderSelectArea=function(){"over"!=n.current_provice_id?r.removal():layer.msg("请求选择区域",{icon:5,time:1e3})},n.delete=function(e){r.trimData(e)},n.showSelectArea=function(){console.log(n.select_id_lists)}}]),app.controller("askCtrl",["$http","$scope","$stateParams","$state",function(a,i,r,t){i.categoryData="";var n={page_index:1};i.getAskList=function(e){null==r.page_index?e.page_index=1:e.page_index=r.page_index;var t=layer.msg("加载中...",{icon:16,time:0});a({method:"GET",url:BASEURL+"/cms2/question/datas?page_size=10&device=1",params:e}).success(function(e){layer.close(t),1==e.status?(i.askData=e.list,i.pageNumber=e.page.pageNumber,i.recordCount=e.page.recordCount,i.pageCount=e.page.pageCount,i.pageSize=e.page.pageSize,i.pageList=i.pageNum(i.pageCount,i.pageNumber),i.startData=0==i.recordCount?0:(i.pageNumber-1)*i.pageSize+1,i.endData=e.list.length<i.pageSize?(i.pageNumber-1)*i.pageSize+e.list.length:i.pageNumber*i.pageSize):layer.msg("请求失败",{icon:5})})},i.getAskList(n),i.changePageUrl=function(e){n.page_index=i.getPageIndex(e,i.pageNumber,i.pageCount),t.go("home.ask",n)}}]),app.controller("askDetailCtrl",["$http","$scope","$stateParams","$location","$timeout",function(e,a,i,t,r){a.getAskDetail=function(){var t=layer.msg("加载中...",{icon:16,time:0});e({method:"GET",url:BASEURL+"/cms2/question/detail/"+i.qid+"?device=1"}).success(function(e){layer.close(t),1==e.status&&(a.askDetail=e.data)})},a.getAskDetail(),a.askDelete=function(){layer.confirm("确认删除该问题？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(){var t=layer.msg("数据提交中...",{icon:16,time:0});e({method:"POST",url:BASEURL+"/cms2/question/delete/"+i.qid+"?device=1",timeout:1e4}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),r(function(){a.jump("/home/cms/ask/ask")},2e3)):layer.msg(e.msg,{icon:5,time:1500})}).error(function(e){})},function(e){layer.close(e)})},a.isShow=!1,a.askEdit=function(){a.isShow=!0},a.askCancel=function(){a.isShow=!1},a.askSave=function(){var t=layer.msg("数据提交中...",{icon:16,time:0});e({method:"POST",url:BASEURL+"/cms2/question/edit?device=1",timeout:1e4,params:{id:i.qid,category_id:a.askDetail.category_id,title:a.askDetail.title,content:a.askDetail.content}}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),a.isShow=!1,r(function(){a.getAskDetail()},2e3)):layer.msg(e.msg,{icon:5,time:1500})}).error(function(e){})}}]),app.controller("authenticationCtrl",["$scope","$http","$stateParams","$timeout","httpData",function(i,a,r,n,t){i.person_state="",i.company_state="",i.manager_state="";var s=layer.load(1);({person_url:"",company_url:"",manage_url:"",detail_url:"/cms2/user/detail",init:function(){this.getUserDetail(r.uid)},errorData:function(){layer.close(s),i.has_clicked=!1,layer.msg("请求失败",{icon:5})},getUserDetail:function(e){t.getData("GET",this.detail_url,{id:e,device:1},this.setUserDetail,this.errorData)},setUserDetail:function(e){if(layer.close(s),1==e.status){if(i.userDetail=e.data,i.cert_letter=[],e.data.userInfo.co_apply_letter)for(var t=e.data.userInfo.co_apply_letter.split(","),a=0;a<t.length;a++)t[a]&&i.cert_letter.push(t[a]);i.person_state=e.data.cert_person_state,i.company_state=e.data.cert_company_state,i.manager_state=e.data.cert_company_manager_state,2==e.data.cert_person_state&&2==e.data.cert_company_state&&2==e.data.cert_company_manager_state&&i.jump("/home/cms/userDetail/"+r.uid),1==i.person_state?(i.personActive=1,i.step1=1):2==i.person_state&&1==i.company_state?(i.personActive=1,i.companyActive=1,i.step1=0,i.step2=1):2==i.person_state&&2==i.company_state&&1==i.manager_state&&(i.personActive=1,i.companyActive=1,i.managerActive=1,i.step2=0,i.step3=1)}else layer.msg("请求失败",{icon:5})}}).init(),i.userDetail=function(){var t=layer.msg("加载中...",{icon:16,time:0});a({method:"GET",url:BASEURL+"/cms2/user/detail",timeout:1e4,params:{id:r.uid,device:1}}).success(function(e){console.log(e),layer.close(t),1==e.status?(i.userDetail=e.data,sessionStorage.userDetail=JSON.stringify(e.data),i.person_state=e.data.cert_person_state,i.company_state=1,i.manager_state=e.data.cert_company_manager_state,2==e.data.cert_person_state&&2==e.data.cert_company_state&&2==e.data.cert_company_manager_state&&i.jump("/home/cms/userDetail/"+r.uid),1==i.person_state?(i.personActive=1,i.step1=1):2==i.person_state&&1==i.company_state?(i.personActive=1,i.companyActive=1,i.step1=0,i.step2=1):2==i.person_state&&2==i.company_state&&1==i.manager_state&&(i.personActive=1,i.companyActive=1,i.managerActive=1,i.step2=0,i.step3=1)):layer.msg("请求失败",{icon:5})}).error(function(e){})},i.personAuth=function(e){var t=layer.msg("数据提交中...",{icon:16,time:0});a({method:"POST",url:BASEURL+"/cms2/user/cert/person",timeout:1e4,params:{device:1,state:e,real_name:i.real_name,idcard:i.idcard,uid:r.uid,message:i.person_message}}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1}),n(function(){i.jump("/home/cms/userDetail/"+r.uid)},2e3)):layer.msg(e.msg,{icon:2,time:1500})}).error(function(e){})},i.companyAuth=function(e){console.log(e);var t=layer.msg("数据提交中...",{icon:16,time:0});a({method:"POST",url:BASEURL+"/cms2/user/cert/company",timeout:1e4,params:{device:1,state:e,bmp:i.bmp,uid:r.uid,message:i.company_message}}).success(function(e){console.log(e),layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),n(function(){i.jump("/home/cms/userDetail/"+r.uid)},2e3)):layer.msg(e.msg,{icon:2,time:1500})}).error(function(e){})},i.managerAuth=function(e){var t=layer.msg("数据提交中...",{icon:16,time:0});a({method:"POST",url:BASEURL+"/cms2/user/cert/manager",timeout:1e4,params:{device:1,state:e,uid:r.uid,message:i.mananger_message}}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),n(function(){i.jump("/home/cms/userDetail/"+r.uid)},2e3)):layer.msg(e.msg,{icon:2,time:1500})}).error(function(e){})}}]),app.controller("authorityAssignmentCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state",function(i,a,t,r,n,s){var o=layer.load(1);i.show_directory=!0,i.directory_name="",i.parent_name="",i.old_name="",i.current_id="",i.current_name="",i.checked_lists=[];var c={directoryUrl:"/cms2/power/dir/data?device=1",deleteDirectoryUrl:"/cms2/power/dir/delete?device=1",authorityUrl:"/cms2/power/dir/data/powers?device=1",allAuthorityUrl:"/cms2/power/datas?device=1",addDirectoryUrl:"/cms2/power/dir/add?device=1",addDirectoryAuthorityUrl:"/cms2/power/dir/add/powers?device=1",currentAuthorityLists:[],send_data:{page_index:1,page_size:10},is_Array:function(e){return"[object Array]"==Object.prototype.toString.call(e)},getAuthorityData:function(e){var t={id:e};a.getData("GET",this.authorityUrl,t,this.setAuthorityData,this.errorData)},setAuthorityData:function(e){layer.close(o);var t=e;if(1==t.status){var a=t.datas;c.is_Array(a)?(a.forEach(function(e,t,a){c.currentAuthorityLists.push(e.power_id)}),c.getAllAuthorityData()):layer.msg("请求格式错误",{icon:5})}else layer.msg("请求格式错误",{icon:5})},getAllAuthorityData:function(){a.getData("GET",this.allAuthorityUrl,"",this.setAllAuthorityData,this.errorData)},setAllAuthorityData:function(e){layer.close(o);var t=e;if(1==t.status){var a=t.list;c.is_Array(a)?(a.forEach(function(e,t,a){var i=e.power_id,r=!1;c.currentAuthorityLists.forEach(function(e,t,a){i!=e||(r=!0)}),e.has_checked=!!r}),i.authorityLists=a):layer.msg("请求格式错误",{icon:5})}else layer.msg("请求格式错误",{icon:5})},getDirectory:function(){a.getData("GET",this.directoryUrl,this.send_data,this.setDirectoryData,this.errorData)},setDirectoryData:function(e){layer.close(o);var t=e;1==t.status?c.is_Array(t.list)&&0<t.list.length&&(i.show_directory=!1,i.directoryLists=t.list,i.pageNumber=t.page.pageNumber,i.pageCount=t.page.pageCount,i.recordCount=t.page.recordCount,i.pageSize=t.page.pageSize,i.pageList=i.pageNum(i.pageCount,i.pageNumber),i.startData=0==i.recordCount?0:(i.pageNumber-1)*i.pageSize+1,i.endData=t.list.length<i.pageSize?(i.pageNumber-1)*i.pageSize+t.list.length:i.pageNumber*i.pageSize):layer.msg("请求格式错误",{icon:5})},addDirectory:function(){var e={name:i.directory_name,parent_name:i.parent_name,old_name:i.old_name};a.getData("POST",this.addDirectoryUrl,e,this.setAddDirectoryData,this.errorData)},setAddDirectoryData:function(e){i.has_add_directory_btn=!1,layer.close(o),1==e.status?(angular.element("#addDirectory").modal("hide"),layer.msg(e.msg,{icon:1,time:1500}),r(function(){t.location.reload()},1800)):layer.msg(e.msg,{icon:5})},errorData:function(){layer.close(o),layer.msg("请求失败",{icon:5})},delDirectory:function(e){a.getData("POST",this.deleteDirectoryUrl,e,this.setDeleteDirectoryData,this.errorData)},setDeleteDirectoryData:function(e){layer.close(o),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),r(function(){t.location.reload()},1800)):layer.msg(e.msg,{icon:5})},getDataFromUrl:function(){var e=n.page_index,t=n.page_size;e||(e=1),t||(t=10),this.send_data={page_index:e,page_size:t}},addDirectoryAuthority:function(){var e={powerdir_id:i.current_id,power_id:i.checked_lists.join(",")};a.getData("POST",this.addDirectoryAuthorityUrl,e,this.setDirectoryAuthorityData,this.errorData)},setDirectoryAuthorityData:function(e){i.has_add_authority_btn=!1,layer.close(o),1==e.status?(angular.element("#addAuthority").modal("hide"),layer.msg(e.msg,{icon:1,time:1500}),r(function(){t.location.reload()},1800)):layer.msg(e.msg,{icon:5})},init:function(){i.has_add_directory_btn=!1,i.has_add_authority_btn=!1,this.getDataFromUrl(),this.getDirectory()}};i.addAuthority=function(e){var t=$(e.currentTarget).attr("data-id"),a=$(e.currentTarget).attr("data-name");$(e.currentTarget).attr("data-parent"),$(e.currentTarget).attr("data-old");i.current_name=a,i.current_id=t,angular.element("#addAuthority").modal(),c.getAuthorityData(t)},i.deleteDirectory=function(e){var t=$(e.currentTarget).attr("data-id");layer.confirm("是否删除目录？",{btn:["确定","取消"],skin:"layui-layer-molv"},function(){var e={id:t};c.delDirectory(e)},function(){layer.close()})},i.addDirectory=function(){i.directory_name&&i.parent_name&&i.old_name?(i.has_add_directory_btn=!0,c.addDirectory()):layer.msg("请填写完整信息",{icon:5,time:1500})},i.orderAddAuthority=function(){i.has_add_authority_btn=!0,i.checked_lists=[];for(var e=angular.element("#authorityLists").find("input"),t=0,a=e.length;t<a;t++)e[t].checked&&i.checked_lists.push(e[t].value);c.addDirectoryAuthority()},i.changePageUrl=function(e){c.send_data.page_index=i.getPageIndex(e,i.pageNumber,i.pageCount),s.go("home.authorityAssignment",c.send_data)},c.init()}]),app.controller("authenticationTaskCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state",function(i,r,a,n,s,t){var o=layer.load(1);i.current_id="",i.bindBtnShow=!1;var c={url:"/cms2/undistributed/task?device=1",allPeopleUrl:"/cms2/undistributed/marketing?device=1",bindUrl:"/cms2/undistributed/assign?device=1",send_data:{page_index:1,page_size:10},getData:function(){r.getData("GET",this.url,this.send_data,this.setData,this.errorData)},setData:function(e){layer.close(o);var t=e;1==t.status?(i.userDatas=t.list,i.pageNumber=t.page.pageNumber,i.pageCount=t.page.pageCount,i.recordCount=t.page.recordCount,i.pageSize=t.page.pageSize,i.pageList=i.pageNum(i.pageCount,i.pageNumber),i.startData=0==i.recordCount?0:(i.pageNumber-1)*i.pageSize+1,i.endData=t.list.length<i.pageSize?(i.pageNumber-1)*i.pageSize+t.list.length:i.pageNumber*i.pageSize):layer.msg(t.msg,{icon:5})},errorData:function(){layer.close(o),layer.msg("请求失败",{icon:5})},getAllPeople:function(){r.getData("GET",this.allPeopleUrl,"",this.setAllPeople,this.errorData)},setAllPeople:function(e){console.log(e),layer.close(o);var t=e;1==t.status?i.allPeople=t.data:layer.msg("请求失败",{icon:5})},bindPeople:function(e,t){var a={task_id:i.current_id,assign_uid:e,assign_realname:t};r.getData("POST",this.bindUrl,a,this.setBindPeople,this.errorData)},setBindPeople:function(e){layer.close(o);var t=e;1==t.status?(layer.msg(t.msg,{icon:1,time:1500}),$("#myModal").modal("hide"),n(function(){a.location.reload()},1800)):layer.msg(t.msg,{icon:5})},getDataFromUrl:function(){var e=s.page_index,t=s.page_size;e||(e=1),t||(t=10),this.send_data={page_index:e,page_size:t}},init:function(){this.getDataFromUrl(),this.getData()}};c.init(),i.distribution=function(e){var t=e.currentTarget,a=($(t).attr("data-pid"),$(t).attr("data-cid"),$(t).attr("data-sid"));i.current_id=a,$("#myModal").modal("show"),c.getAllPeople()},i.bindUser=function(e){var t=e.currentTarget,a=$(t).attr("data-rid"),i=$(t).attr("data-realname");c.bindPeople(a,i)},i.changeState=function(){c.send_data={page_index:companyAuditCtrl.sendData.page_index,page_size:companyAuditCtrl.sendData.page_size},t.go("home.authenticationTask",companyAuditCtrl.sendData)},i.changePageUrl=function(e){c.send_data.page_index=i.getPageIndex(e,i.pageNumber,i.pageCount),t.go("home.authenticationTask",c.send_data)}}]),app.controller("backProgramCtrl",["$scope","$http","$stateParams","$state","$timeout","httpRequestData","dateConversion",function(o,e,c,t,a,i,l){var r=function(){this.company_url="/cms2/company/datas?device=1&co_type=4",this.program_lists_url="/res_v1_0_0/cms/finance/program/datas?out=json",this.del_program_list_url="/res_v1_0_0/cms/finance/program/delete?out=json",this.program_detail_url="/res_v1_0_0/cms/finance/program/detail?out=json",this.default_datas={page_index:1,page_size:10,compamu_id:"",name:"",province_id:"",last_time:"",finance_type:2}};r.prototype={getDataFromUrl:function(){var e=c.page_index,t=c.page_size,a=c.compamu_id,i=c.name,r=c.province_id,n=c.last_time,s=c.finance_type;e||(e=1),t||(t=10),a||(a=""),r||(r=""),i||(i=""),s||(s=2),n?o.end_time=l.sTot(n/1e3):(n="",o.end_time=""),o.provice_id=parseInt(r),o.company_id=parseInt(a),o.plan_name=i,this.default_datas.page_index=e,this.default_datas.page_size=t,this.default_datas.compamu_id=a,this.default_datas.name=i,this.default_datas.province_id=r,this.default_datas.last_time=n,this.default_datas.finance_type=s},programLists:function(){layer.load(1);var e=this,t={req_data:{method:"GET",url:BASEURL+e.program_lists_url,params:e.default_datas},requestSuccess:e.setProgramList.bind(e),requestError:e.httpError.bind(e)};i.getData(t)},setProgramList:function(e){if(layer.closeAll("loading"),1==e.status){var t=e;o.programData=t.list,o.pageNumber=t.page.pageNumber,o.recordCount=t.page.recordCount,o.pageCount=t.page.pageCount,o.pageSize=t.page.pageSize,o.pageList=o.pageNum(o.pageCount,o.pageNumber),o.startData=0==o.recordCount?0:(o.pageNumber-1)*o.pageSize+1,o.endData=t.list.length<o.pageSize?(o.pageNumber-1)*o.pageSize+t.list.length:o.pageNumber*o.pageSize}else this.stateError(e.data)},stateError:function(e){layer.closeAll("loading"),o.has_clicked=!1,layer.msg(e)},httpError:function(){layer.closeAll("loading"),layer.msg("请求失败",{icon:5})},delSuccess:function(e){layer.closeAll("loading");1==e.status?(layer.msg("操作成功",{icon:1,time:1500}),this.programLists()):this.stateError(e.data)},setProgramDetail:function(e){layer.closeAll("loading"),1==e.status?(o.seeProgrammeData=e.data,$("#prevProgramme").modal("show")):this.stateError(e.data)},proviceLists:function(){layer.load(1);var e={req_data:{method:"GET",url:PROVINCE_URL},requestSuccess:this.setProvice.bind(this),requestError:this.httpError.bind(this)};i.getData(e)},setProvice:function(e){layer.closeAll("loading"),1==e.status?o.proviceLists=e.list:this.stateError(e.data)},companyList:function(){layer.load(1);var e=this,t={req_data:{method:"GET",url:BASEURL+e.company_url},requestSuccess:e.setCompanyList.bind(e),requestError:e.httpError.bind(e)};i.getData(t)},setCompanyList:function(e){layer.closeAll("loading"),1==e.status?o.financialCompanyList=e.list:this.stateError(e.data)},reloadPage:function(){t.go("home.backProgram",this.default_datas)},init:function(){this.getDataFromUrl(),this.programLists(),this.proviceLists(),this.companyList()}};var n=new r;n.init(),o.changePageUrl=function(e){n.default_datas.page_index=o.getPageIndex(e,o.pageNumber,o.pageCount),n.reloadPage()},o.deleteProgram=function(a){layer.confirm("确认删除该方案？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e);var t={req_data:{method:"POST",url:BASEURL+n.del_program_list_url,params:{ids:a}},requestSuccess:n.delSuccess.bind(n),requestError:n.httpError.bind(n)};layer.load(1),i.getData(t)},function(e){layer.close(e)})},o.getProgramDetail=function(e){var t={req_data:{method:"GET",url:BASEURL+n.program_detail_url,params:{id:e}},requestSuccess:n.setProgramDetail.bind(n),requestError:n.httpError.bind(n)};layer.load(1),i.getData(t)},o.selProvice=function(){o.provice_id||(o.provice_id=""),n.default_datas.province_id=o.provice_id,n.reloadPage()},$("#end_time").datetimepicker({format:"yyyy-mm-dd hh:ii",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){o.end_time?n.default_datas.last_time=l.tTos(o.end_time):(o.end_time="",n.default_datas.last_time=""),n.reloadPage()}),o.selProgram=function(){o.company_id||(o.company_id=""),n.default_datas.compamu_id=o.company_id,n.reloadPage()},o.$watch("plan_name",function(){o.plan_name||(o.plan_name=""),n.default_datas.name=o.plan_name,n.reloadPage()}),o.editProgramDetail=function(e){t.go("home.addBackProgram",{id:e})}}]),app.controller("backResourceCtrl",["$scope","$http","$stateParams","$state","$timeout","httpRequestData","dateConversion",function(n,e,s,a,t,r,o){var i=layer.load(1);n.has_clicked=!1,n.resource_list=[],n.currentRouter="home.backResource";var c={subBrandUrl:"/api2/res/brand/",modelUrl:"/api2/res/model/",resource_url:"/res_v1_0_0/cms/back/rent/dates?out=json",del_res_url:"/res_v1_0_0/cms/back/rent/delete?out=json",res_detail_url:"/res_v1_0_0/cms/back/res/detail?out=json",listsSendData:{page_index:1,page_size:10,brand_id:"",subrand_id:"",modle_id:"",end_time:""},init:function(){this.getResourceList(),this.getDataFromUrl(),this.getBrand()},stateError:function(e){layer.close(i),n.has_clicked=!1,layer.msg(e)},httpError:function(){layer.close(i),n.has_clicked=!1,layer.msg("请求失败",{icon:5})},getResourceList:function(){top;var e={req_data:{method:"GET",url:BASEURL+this.resource_url,params:this.listsSendData},requestSuccess:this.setResourceList,requestError:this.httpError};r.getData(e)},recResourceData:function(e){var n=[];return angular.forEach(e,function(e,t){var a=e,i=o.sTot(a.endTime/1e3),r="未发布";o.ns()>a.endTime?r="已过期":1==a.state&&(r="已发布"),a.currentStateTxt=r,a.endTimeTxt=i,n.push(a)}),n},setResourceList:function(e){if(layer.close(i),1==e.status){var t=e;n.resource_list=c.recResourceData(t.list),n.pageNumber=t.page.pageNumber,n.recordCount=t.page.recordCount,n.pageCount=t.page.pageCount,n.pageSize=t.page.pageSize,n.pageList=n.pageNum(n.pageCount,n.pageNumber),n.startData=0==n.recordCount?0:(n.pageNumber-1)*n.pageSize+1,n.endData=t.list.length<n.pageSize?(n.pageNumber-1)*n.pageSize+t.list.length:n.pageNumber*n.pageSize}else c.stateError(t.msg)},getBrand:function(){var e={req_data:{method:"GET",url:CAR_BRAND_URL},requestSuccess:this.setBrand,requestError:this.httpError};r.getData(e)},setBrand:function(e){layer.close(i),1==e.status?n.brand_list=e.list:c.stateError()},getSubBrand:function(e){var t={req_data:{method:"GET",url:BASEURL+this.subBrandUrl+e+"?device=1"},requestSuccess:this.setSubBrand,requestError:this.httpError};r.getData(t)},setSubBrand:function(e){1==e.status?n.sub_brand_list=e.list:c.stateError()},getModel:function(e){var t={req_data:{method:"GET",url:BASEURL+this.modelUrl+n.brand_id+"/"+e+"?device=1"},requestSuccess:this.setModel,requestError:this.httpError};r.getData(t)},setModel:function(e){1==e.status?n.model_list=e.list:c.stateError()},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]},getDataFromUrl:function(){var e=s.page_index,t=(s.page_size,s.brand_id),a=s.subrand_id,i=s.modle_id,r=s.end_time;e||(e=1),n.brand_id=t,n.subrand_id=a,n.modle_id=i,r&&(n.end_time=o.sTot(r/1e3,"date")),this.listsSendData.page_index=e,this.listsSendData.page_size=10,this.listsSendData.brand_id=t,this.listsSendData.subrand_id=a,this.listsSendData.modle_id=i,this.listsSendData.end_time=r},selectData:function(){this.listsSendData.brand_id=n.brand_id,this.listsSendData.subrand_id=n.subrand_id,this.listsSendData.modle_id=n.modle_id,this.listsSendData.end_time=n.time_stamps,a.go("home.backResource",this.listsSendData)},getResDetail:function(e){var t={resource_id:e},a={req_data:{method:"GET",url:BASEURL+this.res_detail_url,params:t},requestSuccess:this.setResDetail,requestError:this.httpError};r.getData(a)},setResDetail:function(e){1==e.status?(n.planLists=e.data.planResourceItem.program_item_list,n.detailBasicInfo=e.data.res[0],n.detailPlan=e.data.planResourceItem.program_item_list,angular.element("#showResourceDetail").modal()):c.stateError()}};c.init(),null!=s.brand_id?(c.getSubBrand(s.brand_id),n.subrand_id=s.subrand_id):(n.sub_brand_list="",n.subrand_id="",n.modle_id="",n.model_list=""),null!=s.subrand_id?(c.getModel(s.subrand_id),n.model_id=s.model_id):(n.model_list="",n.modle_id=""),n.changeBrand=function(){n.sub_brand_list="",n.subrand_id="",n.modle_id="",n.model_list="",c.selectData()},n.changeSubBrand=function(){n.model_list="",n.modle_id="",c.selectData()},n.changeModel=function(){c.selectData()},$("#end_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){n.end_time?n.time_stamps=c.listsSendData.end_time=o.tTos(n.end_time):n.time_stamps=c.listsSendData.end_time="",c.selectData()});function l(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),c.getResourceList()):c.stateError(e.msg)}n.order_search=function(){c.selectData()},n.changePageUrl=function(e){c.listsSendData.page_index=n.getPageIndex(e,n.pageNumber,n.pageCount),a.go("home.backResource",c.listsSendData)},n.deleteResource=function(i){layer.confirm("确定删除该资源？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e);var t={resource_id:i},a={req_data:{method:"POST",url:BASEURL+c.del_res_url,params:t},requestSuccess:l,requestError:c.httpError};r.getData(a)},function(e){layer.close(e)})},n.getResourceDetail=function(e){c.getResDetail(e)},n.showPlanDetail=function(e){n.planInfo=n.planLists[e],angular.element("#planInfo").modal()},n.editResource=function(e){var t={id:e};a.go("home.releaseBackResource",t)},n.Refresh=function(){}}]),app.controller("bankinfoCtrl",["$http","$scope","$stateParams","$state","$timeout",function(i,r,a,t,n){r.bankinfoData="";var s={page_index:1};function o(e){1==e.status?(layer.msg("上传成功",{icon:1,time:1500}),r.picture=e.data[0].normal,angular.element("#adv-img").attr("src",imgUrl+r.picture)):layer.msg("上传失败",{icon:5,time:1500})}function c(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})}r.getBankinfoList=function(e){null==a.page_index?e.page_index=1:e.page_index=a.page_index;var t=layer.msg("加载中...",{icon:16,time:0});i({method:"GET",url:BASEURL+"/cms2/bank/datas?device=1&page_size=10",params:e}).success(function(e){console.log(e),layer.close(t),1==e.status?(r.bankinfoData=e.list,r.pageNumber=e.page.pageNumber,r.recordCount=e.page.recordCount,r.pageCount=e.page.pageCount,r.pageSize=e.page.pageSize,r.pageList=r.pageNum(r.pageCount,r.pageNumber),r.startData=0==r.recordCount?0:(r.pageNumber-1)*r.pageSize+1,r.endData=e.list.length<r.pageSize?(r.pageNumber-1)*r.pageSize+e.list.length:r.pageNumber*r.pageSize):layer.msg("请求失败",{icon:5})}).error(function(e){})},r.getBankinfoList(s),r.changePageUrl=function(e){s.page_index=r.getPageIndex(e,r.pageNumber,r.pageCount),t.go("home.bankinfo",s)},r.bankinfoDelete=function(a){layer.confirm("确认是否删除？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e);var t=layer.msg("数据提交中...",{icon:16,time:0});i({method:"POST",url:BASEURL+"/cms2/bank/delete/"+a+"?device=1"}).success(function(e){layer.close(t),1==e.status?(layer.msg("删除成功",{icon:1,time:1500}),r.getBankinfoList(s)):layer.msg("删除失败",{icon:5,time:1500})})},function(e){layer.close(e)})},r.picture="",angular.element("#sel-adv-img").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:c,success:o,xhrFields:{withCredentials:!0}};angular.element("#uploadAdv").ajaxSubmit(e)}),r.addbankinfo=function(){var e=$("#name").val();if(!/^[\u4E00-\u9FA5]+$/.test($.trim(e)))return alert("请输入中文"),!1;i({method:"POST",url:BASEURL+"/cms2/bank/add?device=1",params:{name:r.name,picture:r.picture}}).success(function(e){1==e.status?(layer.msg("添加成功",{icon:1,time:1e3}),n(function(){$("#bankinfo-model").modal("hide"),r.getBankinfoList(s)},1500)):layer.msg("添加失败",{icon:5,time:1e3})})}}]),app.controller("bestSellingbrandCtrl",["$scope","$stateParams","$state","$timeout","httpRequestData",function(a,e,i,t,r){function n(e){layer.msg("请求失败",{icon:5})}function s(e){1==e.status&&(layer.msg("删除成功",{icon:1,time:1500}),r.getData(o))}a.bestbrandData=[];var o={req_data:{method:"GET",url:BASEURL+"/car_v1_0_0/cms/active/sellbrand/list/order?out=json",headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:function(e){if(1==e.status){var t=layer.msg("加载中...",{icon:16,time:0});a.bestbrandData=e.datas,layer.close(t)}},requestError:n};r.getData(o),a.deleteBestSellingBrand=function(e){var t={req_data:{method:"POST",url:BASEURL+"/car_v1_0_0/cms/active/sellbrand/delete?out=json&province_id="+e,headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:s,requestError:n};layer.confirm("确认是否删除？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e);layer.msg("数据提交中...",{icon:16,time:0});r.getData(t)},function(e){layer.close(e)})},a.editBestSellingBrand=function(e,t){i.go("home.editbestSellingbrand",{province_id:e})}}]),app.controller("editbestSellingbrandCtrl",["$scope","httpRequestData","$window","$timeout","$stateParams","$state",function(n,s,e,o,c,t){n.brand_title="添加畅销品牌",n.chosebrand=!0,n.brand_name="",n.brandData=[],n.isbigbrand=[],n.arr=[];var a={req_data:{method:"GET",url:BASEURL+"/api2/res/brand?device=1",headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:function(e){1==e.status&&(n.manufacturerData=e.list)},requestError:l};function l(e){layer.msg("请求失败",{icon:5})}s.getData(a);var i={req_data:{method:"GET",url:BASEURL+"/api2/area/provinces?device=1",headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:function(e){1==e.status?n.provinceData=e.list:layer.msg("请求失败",{icon:5})},requestError:l};function r(e){var t=e.split("|");n.brandData.push({id:t[0],name:t[1]});for(var a="",i=0;i<n.manufacturerData.length;i++)n.manufacturerData[i].id==t[0]&&(a=n.manufacturerData[i].diyLogo);n.isbigbrand.push({brandId:t[0],homeSell:0,diyLogo:a})}function d(e){1==e.status?(layer.msg("上传成功",{icon:1,time:1500}),n.isbigbrand[n.index].diyLogo=e.data[0].normal,angular.element("#adv-img-"+n.index).attr("src",imgUrl+e.data[0].normal)):layer.msg("上传失败",{icon:5,time:1500})}function u(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})}if(s.getData(i),n.addbrandlist=function(){0==n.arr.length?n.brand_name&&(n.arr.push(n.brand_name),r(n.brand_name),n.chosebrand=!1):n.brand_name&&(-1==$.inArray(n.brand_name,n.arr)?(n.arr.push(n.brand_name),r(n.brand_name),n.chosebrand=!1):layer.msg("该品牌已添加",{icon:5,time:1500}))},n.delbrandlist=function(e,t){e.stopPropagation(),n.arr.splice(t,1),n.brandData.splice(t,1),n.isbigbrand.splice(t,1),0===n.isbigbrand.length&&(n.brand_name="")},n.checkchose=function(e,t,a){e.stopPropagation(),1==e.target.checked?(n.isbigbrand[t].homeSell=1,layer.msg("请上传已勾选品牌LOGO",{icon:1,time:1500})):n.isbigbrand[t].homeSell=0},$(document).on("change",".sel-adv-img",function(){n.index=$(this).attr("data-index");var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:u,success:d,xhrFields:{withCredentials:!0}};angular.element("#uploadAdv_"+n.index).ajaxSubmit(e)}),c.province_id){n.provinceId=c.province_id,n.brand_title="编辑畅销品牌",n.add=!1,n.save=!0,n.chosebrand=!1;var m={req_data:{method:"GET",url:BASEURL+"/car_v1_0_0/cms/active/sellbrand/get?out=json&province_id="+c.province_id,timeout:1e4},requestSuccess:function(e){if(console.log(e),1==e.status){n.brandData=e.data.remoteActiveSellBrandEntities;for(var t=0;t<n.brandData.length;t++){var a={brandId:n.brandData[t].brandId,homeSell:n.brandData[t].homeSell,diyLogo:n.brandData[t].diyLogo};n.isbigbrand.push(a)}}},requestError:l};s.getData(m),n.savetenbrandSubmit=function(){for(var e=0,t=0;t<n.isbigbrand.length;t++)1==n.isbigbrand[t].homeSell&&null!=n.isbigbrand[t].diyLogo&&e++;if(e<10)layer.msg("少于10个品牌,请勾选10个品牌,并上传LOGO",{icon:5,time:2e3});else if(10<e)layer.msg("已超出10个品牌,只能勾选10个品牌",{icon:5,time:2e3});else{var a=0;for(t=0;t<n.isbigbrand.length;t++)null!=n.isbigbrand[t].diyLogo&&1==n.isbigbrand[t].homeSell&&a++;if(a<10)layer.msg("请上传已勾选品牌的LOGO",{icon:5,time:1500});else if(10<a)layer.msg("已超出10个LOGO,只能上传勾选品牌的LOGO",{icon:5,time:1500});else{var i={sellBrandJsonStr:JSON.stringify(n.isbigbrand)},r={req_data:{method:"POST",url:BASEURL+"/car_v1_0_0/cms/active/sellbrand/edit?out=json&province_id="+c.province_id,timeout:1e4,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify(i)},requestSuccess:function(e){1==e.status?(layer.msg(e.data,{icon:1,time:1500}),o(function(){n.jumpUrl("home.bestSellingbrand")},1500)):layer.msg(e.data,{icon:5,time:1500})},requestError:l};s.getData(r)}}}}else n.add=!0,n.save=!1,n.addtenbrandSubmit=function(){if(n.provinceId)if(0!=n.brandData.length){for(var e=0,t=0;t<n.isbigbrand.length;t++)1==n.isbigbrand[t].homeSell&&e++;if(e<10)layer.msg("少于10个品牌,请勾选10个品牌",{icon:5,time:1500});else if(10<e)layer.msg("已超出10个品牌,只能勾选10个品牌",{icon:5,time:1500});else{var a=0;for(t=0;t<n.isbigbrand.length;t++)null!=n.isbigbrand[t].diyLogo&&1==n.isbigbrand[t].homeSell&&a++;if(a<10)layer.msg("请上传已勾选品牌的LOGO",{icon:5,time:1500});else if(10<a)layer.msg("已超出10个LOGO,只能上传勾选品牌的LOGO",{icon:5,time:1500});else{var i={sellBrandJsonStr:JSON.stringify(n.isbigbrand)},r={req_data:{method:"POST",url:BASEURL+"/car_v1_0_0/cms/active/sellbrand/add?out=json&province_id="+n.provinceId,timeout:1e4,headers:{"Content-Type":"application/json;charset=UTF-8"},data:JSON.stringify(i)},requestSuccess:function(e){1==e.status?(layer.msg(e.data,{icon:1,time:1500}),o(function(){n.jumpUrl("home.bestSellingbrand")},1500)):layer.msg(e.data,{icon:5,time:1500})},requestError:l};s.getData(r)}}}else layer.msg("请选择品牌",{icon:5,time:1500});else layer.msg("请选择省份",{icon:5,time:1500})}}]),app.controller("brandAlertsCtrl",["$scope","httpData","$stateParams","$state","$window","$timeout","$http",function(r,a,i,n,e,s,o){var t=new Date,c=layer.load(1);r.has_save=!1,Array.prototype.remove=function(e){var t=this.indexOf(e);-1<t&&this.splice(t,1)};var l={newsListUrl:"/cms2/news/query?device=1",sendUrl:"/cms2/news/send?device=1",deleteUrl:"/cms2/news/delete?device=1",uploadUrl:"/api2/file/upload?device=1",codeUrl:"/transfer/get?device=1",editUrl:"/cms2/news/edit?device=1",brandUrl:"/api2/res/brand?device=1",listsSendData:{page_index:1,page_size:10},errorData:function(){layer.close(c),r.has_clicked=!1,layer.msg("请求失败",{icon:5})},getNowDate:function(){var e=t.toLocaleDateString()+"";r.start_time=r.end_time=e.replace(/\//g,"-")},getBrandList:function(){a.getData("GET",this.brandUrl,"",this.setBrandList,this.errorData)},setBrandList:function(e){1==e.status&&(r.brand_list=e.list)},setNewsLists:function(e){layer.close(c),1===e.status?(r.newsLists=e.list,r.pageNumber=e.page.pageNumber,r.pageCount=e.page.pageCount,r.recordCount=e.page.recordCount,r.pageSize=e.page.pageSize,r.pageList=r.pageNum(r.pageCount,r.pageNumber),r.startData=0==r.recordCount?0:(r.pageNumber-1)*r.pageSize+1,r.endData=e.list.length<r.pageSize?(r.pageNumber-1)*r.pageSize+e.list.length:r.pageNumber*r.pageSize):layer.msg("数据获取异常",{icon:5})},getNewsLists:function(){a.getData("GET",this.newsListUrl,this.listsSendData,this.setNewsLists,this.errorData)},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]},getDataFromUrl:function(){var e=i.page_index,t=i.page_size;e||(e=1),t||(t=10),this.listsSendData={page_index:e,page_size:t}},selectData:function(){var e="",t="";e=r.start_time?Date.parse(r.start_time.replace(/-/g,"/")):"",t=r.end_time?Date.parse(r.end_time.replace(/-/g,"/")):"",this.listsSendData.state=r.counsel_state,this.listsSendData.dir_id=r.counsel_type,this.listsSendData.start_time=e,this.listsSendData.end_time=t,n.go("home.brandAlerts",this.listsSendData)},sendNews:function(e){var t={id:e};a.getData("POST",this.sendUrl,t,this.setSuccessData,this.errorData)},setSuccessData:function(e){layer.close(c),r.has_clicked=!1,1==e.status?layer.msg(e.msg,{icon:1,time:1500}):layer.msg(e.msg,{icon:5,time:1500}),r.ids=[],s(function(){l.init()},1e3)},deleteNews:function(e){a.getData("POST",this.deleteUrl,{id:e},this.setSuccessData,this.errorData)},uploadeFaceBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},uploadeListFaceSuccess:function(e){if(layer.closeAll("dialog"),1==e.status){var t=e.data[0].normal;r.picture=t,r.$apply()}else layer.msg("上传失败")},init:function(){this.getDataFromUrl(),this.getNewsLists(),this.getBrandList()}};l.init(),r.changePageUrl=function(e){l.listsSendData.page_index=r.getPageIndex(e,r.pageNumber,r.pageCount),n.go("home.brandAlerts",l.listsSendData)},$("#start_time").datetimepicker({format:"yyyy-mm-dd hh:ii",autoclose:!0,minView:"hour",todayHighlight:1,clearBtn:!0,startDate:new Date}),r.sendNews=function(t){layer.confirm("确定发布该条快讯？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),t&&l.sendNews(t)})},r.sendAll=function(e){layer.confirm("确定发布所选快讯？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){if(layer.close(e),0<r.ids.length){var t=r.ids.join(",");l.sendNews(t)}})},r.ids=[],r.selectTemplate=function(e,t){1==e.currentTarget.checked?r.ids.push(t):r.ids.remove(t)},r.deleteAll=function(){layer.confirm("确定删除所选快讯？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){if(layer.close(e),0<r.ids.length){var t=r.ids.join(",");l.deleteNews(t)}})},r.deleteNews=function(t){layer.confirm("确定删除该条快讯？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),t&&l.deleteNews(t)})},r.editNews=function(e){$("#EditModal").modal("show"),$("#summernote").summernote("code",""),r.currentData=r.newsLists[e],r.title=r.currentData.title,r.titLen=r.currentData.title.length,r.brand_id=r.currentData.brand_id,r.desc=r.currentData.des_news,r.picture=r.currentData.information_picture,r.start_time=r.currentData.futrue_send_time.slice(0,16);var a=layer.msg("加载中...",{icon:16,time:0});$.ajax({url:BASEURL+l.codeUrl,method:"POST",data:{file_uri:r.currentData.content},cache:!0,dataType:"html",xhrFields:{withCredentials:!0},success:function(e){if(layer.close(a),1==(e=JSON.parse(e)).status){var t=$(e.data).find("#getData").html();$("#summernote").summernote("code",t)}else layer.msg(e.msg,{icon:5,time:1500})},error:function(){layer.close(a)}})},r.inputTit=function(){var e=r.title.length;38<=(r.titLen=e)&&(r.title=r.title.substr(0,37),r.titLen=38)},angular.element("#list_face_input").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:l.uploadeFaceBefore,success:l.uploadeListFaceSuccess,xhrFields:{withCredentials:!0}};angular.element("#list_face").ajaxSubmit(e)}),r.closeModel=function(){$("#EditModal").css("display","none")};$("#summernote").summernote({height:400,lang:"zh-CN",toolbar:[["style",["style","bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["insert",["link","picture","video","codeview"]],["table",["table"]],["hr",["hr"]],["image",["undo","redo","removeMedia","help"]],["mybutton",["preview"]]],buttons:{preview:function(e){return $.summernote.ui.button({contents:'<i class="icon-columns"/> 预览',tooltip:"预览",click:function(){var e=$("#summernote").summernote("code"),t={title:r.title,picture:imgUrl+r.picture,content:encodeURIComponent(e)};sessionStorage.preview_content=JSON.stringify(t),window.open("views/test/preview.html","预览","width=375,height=667")}}).render()}}}),r.save=function(e){var t=layer.msg("数据提交中...",{icon:16,time:0});if(r.has_save=!0,s(function(){r.has_save=!1},1500),r.title)if(r.brand_id)if(r.start_time)if(r.desc){var a={title:"",picture:"",future_time:"",content:"",desc:"",id:r.currentData.id,state:e},i=$("#summernote").summernote("code");a.title=r.title,a.desc=r.desc,a.picture=r.picture,a.future_time=Date.parse(r.start_time.replace(/-/g,"/")),a.content=encodeURIComponent(i),a.brand_id=r.brand_id,o({method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},url:BASEURL+l.editUrl,data:a}).success(function(e){$("#EditModal").modal("hide"),layer.close(t),l.getNewsLists(),1==e.status?layer.msg(e.msg,{icon:1,time:1500}):layer.msg(e.msg,{icon:0,time:1500})}).error(function(e){l.errorData(e),layer.close(t)})}else layer.msg("请填写快讯描述",{icon:5});else layer.msg("请选择推送时间",{icon:5});else layer.msg("请选择品牌",{icon:5});else layer.msg("请填写标题",{icon:5})}}]),app.controller("categoryCtrl",["$http","$scope","$stateParams","$state",function(a,i,r,t){i.categoryData="";var n={page_index:1};i.getCategoryList=function(e){null==r.page_index?e.page_index=1:e.page_index=r.page_index;var t=layer.msg("加载中...",{icon:16,time:0});a({method:"GET",url:BASEURL+"/cms2/category/datas?page_size=10&device=1",params:{page_index:e.page_index}}).success(function(e){layer.close(t),1==e.status?(i.categoryData=e.list,i.pageNumber=e.page.pageNumber,i.recordCount=e.page.recordCount,i.pageCount=e.page.pageCount,i.pageSize=e.page.pageSize,i.pageList=i.pageNum(i.pageCount,i.pageNumber),i.startData=0==i.recordCount?0:(i.pageNumber-1)*i.pageSize+1,i.endData=e.list.length<i.pageSize?(i.pageNumber-1)*i.pageSize+e.list.length:i.pageNumber*i.pageSize):layer.msg("请求失败",{icon:5})})},i.getCategoryList(n),i.changePageUrl=function(e){n.page_index=i.getPageIndex(e,i.pageNumber,i.pageCount),t.go("home.category",n)},i.deleteCategory=function(e){layer.confirm("确认删除该问题分类？",{title:"提示",icon:0,skin:"layui-layer-molv",btn:["确定","取消"],anim:4},function(){var t=layer.msg("数据提交中...",{icon:16,time:0});a({method:"POST",url:BASEURL+"/cms2/category/delete/"+e+"?device=1"}).success(function(e){layer.close(t),1==e.status&&(layer.msg(e.msg,{icon:1,time:1500}),window.location.reload())})},function(e){layer.close(e)})}}]),app.controller("certifiedLogisticsCtrl",["$scope","requestData","$window","$timeout","$stateParams",function(a,t,e,i,r){a.company_id=r.company_id;var n="",s="",o="",c="",l="",d="",u="",m={bankUrl:"/cms2/bank/datas?device=1",uploadUrl:"/api2/file/upload?device=1",submitUrl:"/cms2/company/change/logistice?device=1",sendData:{company_id:r.company_id,contract_valid_time:"",ensure_money:"",contract_protocol:"",road_transport_lincense:"",ensure_money_prove:"",bank_user_idcard:"",bank_user_name:"",bankId:""},setBankList:function(e){e.then(function(e){var t=e.data.list,a="";angular.forEach(t,function(e,t){a+='<option value="'+e.id+'">'+e.name+"</option>"}),angular.element("#bank_lists").append(a),layui.use("form",function(){layui.form().render()})})},getBankData:function(){var e=t.getData("GET",this.bankUrl,"");this.setBankList(e)},uploadeLicenseBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},uploadeLicenseSuccess_contract_protocol1:function(e){if(layer.closeAll("dialog"),1==e.status){s=e.data[0].normal;var t=imgUrl+s;angular.element("#show_upload_img1").attr("src",t)}else layer.msg("上传失败")},uploadeLicenseSuccess_contract_protocol2:function(e){if(layer.closeAll("dialog"),1==e.status){o=e.data[0].normal;var t=imgUrl+o;angular.element("#show_upload_img2").attr("src",t)}else layer.msg("上传失败")},uploadeLicenseSuccess_contract_protocol3:function(e){if(layer.closeAll("dialog"),1==e.status){c=e.data[0].normal;var t=imgUrl+c;angular.element("#show_upload_img3").attr("src",t)}else layer.msg("上传失败")},uploadeLicenseSuccess_contract_protocol4:function(e){if(layer.closeAll("dialog"),1==e.status){l=e.data[0].normal;var t=imgUrl+l;angular.element("#show_upload_img6").attr("src",t)}else layer.msg("上传失败")},uploadeLicenseSuccess_road_transport_lincense:function(e){if(layer.closeAll("dialog"),1==e.status){d=e.data[0].normal;var t=imgUrl+d;angular.element("#show_upload_img4").attr("src",t)}else layer.msg("上传失败")},uploadeLicenseSuccess_ensure_money_prove:function(e){if(layer.closeAll("dialog"),1==e.status){u=e.data[0].normal;var t=imgUrl+u;angular.element("#show_upload_img5").attr("src",t)}else layer.msg("上传失败")},submitData:function(){var e=t.getData("POST",this.submitUrl,m.sendData);this.submitSuccessData(e)},submitSuccessData:function(e){e.then(function(e){var t=e.data;1==t.status?(layer.msg(t.msg,{icon:1,time:1e3}),i(function(){a.jump("/home/cms/companyDetail/"+r.company_id)},1500)):-1==t.status&&layer.msg(t.msg,{icon:1,time:1e3})})},init:function(){this.getBankData()}};m.init(),layui.use("laydate",function(){var e=layui.laydate,t=document.getElementById("contract_protocol"),a={elem:this,festival:!0,choose:function(e){var t=e;n=Date.parse(new Date(t))}};t.onclick=function(){a.elem=this,e(a)}}),layui.use("form",function(){var e=layui.form();e.on("select(bank)",function(e){console.log(e);var t=e.value;m.bankId=t,console.log(m.bankId)}),e.on("submit(certified-logistics-form)",function(e){var t=angular.element("#certified-logistics");m.sendData.contract_valid_time=n,m.sendData.ensure_money=t.find("input[name=ensure_money]").val(),m.sendData.contract_protocol=s+","+o+","+c+","+l,m.sendData.road_transport_lincense=d,m.sendData.ensure_money_prove=u,m.sendData.bankId=t.find("select[name=bank_id]").val(),m.sendData.bank_user_idcard=t.find("input[name=bank_user_idcard]").val(),m.sendData.bank_user_name=t.find("input[name=bank_user_name]").val(),m.submitData()})}),angular.element("#license1").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:m.uploadeLicenseBefore,success:m.uploadeLicenseSuccess_contract_protocol1,xhrFields:{withCredentials:!0}};angular.element("#upload-license1").ajaxSubmit(e)}),angular.element("#license2").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:m.uploadeLicenseBefore,success:m.uploadeLicenseSuccess_contract_protocol2,xhrFields:{withCredentials:!0}};angular.element("#upload-license2").ajaxSubmit(e)}),angular.element("#license3").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:m.uploadeLicenseBefore,success:m.uploadeLicenseSuccess_contract_protocol3,xhrFields:{withCredentials:!0}};angular.element("#upload-license3").ajaxSubmit(e)}),angular.element("#license6").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:m.uploadeLicenseBefore,success:m.uploadeLicenseSuccess_contract_protocol4,xhrFields:{withCredentials:!0}};angular.element("#upload-license6").ajaxSubmit(e)}),angular.element("#license4").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:m.uploadeLicenseBefore,success:m.uploadeLicenseSuccess_road_transport_lincense,xhrFields:{withCredentials:!0}};angular.element("#upload-license4").ajaxSubmit(e)}),angular.element("#license5").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:m.uploadeLicenseBefore,success:m.uploadeLicenseSuccess_ensure_money_prove,xhrFields:{withCredentials:!0}};angular.element("#upload-license5").ajaxSubmit(e)})}]),app.controller("checkUserCtrl",["$scope","$http","$stateParams","$window","httpData","$state",function(r,t,a,e,i,n){var s=layer.load(1);r.account="";var o={detail_url:"/cms2/user/task/detail?device=1",edit_url:"/cms2/user/task/edit?device=1",provinceUrl:"/api2/area/provinces?device=1",cityUrl:"/api2/area/cities?device=1",errorData:function(){layer.close(s),layer.msg("请求失败",{icon:5,time:1500})},getUserDetail:function(e){i.getData("GET",this.detail_url,e,this.setDetail,this.errorData)},setDetail:function(e){layer.close(s),1==e.status?(r.data_list=e.data.extra,r.account=e.data.task.account):layer.msg(e.msg,{icon:5,time:1500})},getProvince:function(){i.getData("GET",this.provinceUrl,"",this.setProvince,this.errorData)},setProvince:function(e){layer.close(s),1==e.status&&(r.province_list=e.list)},getCity:function(e){i.getData("GET",this.cityUrl,{province:e},this.setCity,this.errorData)},setCity:function(e){layer.close(s),1==e.status&&(r.city_list=e.list)},editData:function(e){t({method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},url:BASEURL+this.edit_url,data:e,timeout:1e4}).success(function(e){layer.close(s),$("#editPerson").modal("hide"),$("#editCompany").modal("hide"),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),o.init()):layer.msg(e.msg,{icon:0,time:1500})}).error(function(e){o.errorData()})},examine:function(e,t){i.getData("POST",t,e,this.examineSuc,this.errorData)},examineSuc:function(e){layer.close(s),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),o.init()):layer.msg(e.msg,{icon:0,time:1500})},init:function(){var e={mobile:a.mobile};this.getUserDetail(e)}};o.init(),r.examineData=function(e,i){var r="";"person"==e?r="/cms2/user/task/cert/person?device=1":"company"==e?r="/cms2/user/task/cert/company?device=1":"manager"==e&&(r="/cms2/user/task/cert/manager?device=1"),layer.confirm("确定通过审核",{title:"提示",icon:0,skin:"layui-layer-molv",btn:["通过","不通过"],shadeClose:!0},function(e){layer.close(e);var t={extra_id:i,state:2,message:""};o.examine(t,r)},function(e){layer.close(e),layer.prompt({title:"不通过理由",formType:2,shadeClose:!0},function(e,t){layer.close(t),layer.close(t);var a={extra_id:i,state:3,message:e};o.examine(a,r)})})},r.checkData=function(e,t,a){"person"==t?($("#checkPerson").modal("show"),r.personData=JSON.parse(r.data_list[e].task_extra)):"company"==t?($("#checkCompany").modal("show"),r.companyData=JSON.parse(r.data_list[e].task_extra),r.companyData.store_picture?r.store_picture=r.companyData.store_picture.split(","):r.store_picture=[]):"manager"==t&&($("#checkManager").modal("show"),r.managerData=JSON.parse(r.data_list[e].task_extra),r.cert_letter=[],r.managerData.cert_letter&&(r.cert_letter=r.managerData.cert_letter.split(",")),r.company_warrant=r.managerData.company_warrant),r.extra_id=a},r.extra_id="",r.personData="",r.companyData="",r.managerData="",r.editData=function(e,t,a){if("person"==t){$("#editPerson").modal("show");var i=JSON.parse(r.data_list[e].task_extra);r.personData=i,r.mobile=i.mobile,r.real_name=i.real_name,r.idcard=i.idcard,r.idcard_a=i.idcard_a,r.idcard_b=i.idcard_b}else if("company"==t){$("#editCompany").modal("show");i=JSON.parse(r.data_list[e].task_extra);r.companyData=i,r.company_name=i.company_name?i.company_name:"",r.company_id_code=i.company_id_code?i.company_id_code:"",r.company_address=i.company_address?i.company_address:"",r.corporation_name=i.corporation_name?i.corporation_name:"",r.corporation_idcard=i.corporation_idcard?i.corporation_idcard:"",r.province_id=i.province_id?i.province_id+"":"",r.city_id=i.city_id?i.city_id+"":"",r.company_id_image=i.company_id_image,r.company_license_type=i.company_license_type||0,r.corporation_idcard_a=i.idcard_a?i.idcard_a:"",r.corporation_idcard_b=i.idcard_b?i.idcard_b:"",r.company_lng=i.company_lng?parseFloat(i.company_lng):"",r.company_lat=i.company_lat?parseFloat(i.company_lat):"",i.store_picture?r.store_picture=i.store_picture.split(","):r.store_picture=[],o.getProvince(),r.province_id&&o.getCity(r.province_id)}else"manager"==t&&($("#editManager").modal("show"),r.managerData=JSON.parse(r.data_list[e].task_extra));r.extra_id=a},r.selectProvince=function(){o.getCity(r.province_id)},r.mobile="",r.savePerson=function(){if(r.real_name)if(r.idcard){r.personData.mobile=r.mobile,r.personData.real_name=r.real_name,r.personData.idcard=r.idcard;var e={extra_id:r.extra_id,params:r.personData};o.editData(JSON.stringify(e))}else layer.msg("请输入身份证号");else layer.msg("请输入姓名")},r.saveCompany=function(){if(r.company_name)if(r.corporation_name)if(r.corporation_idcard)if(r.company_id_code)if(r.province_id)if(r.city_id)if(r.company_address)if(r.company_lng)if(r.company_lat){r.companyData.company_name=r.company_name,r.companyData.corporation_name=r.corporation_name,r.companyData.corporation_idcard=r.corporation_idcard,r.companyData.company_id_code=r.company_id_code,r.companyData.province_id=r.province_id,r.companyData.city_id=r.city_id,r.companyData.company_address=r.company_address,r.companyData.company_lng=r.company_lng,r.companyData.company_lat=r.company_lat,r.companyData.company_license_type=r.company_license_type,r.companyData.province_name=$("#province option:selected").text(),r.companyData.city_name=$("#city option:selected").text();var e={extra_id:r.extra_id,params:r.companyData};console.log(e),o.editData(JSON.stringify(e))}else layer.msg("请填写纬度");else layer.msg("请填写经度");else layer.msg("请填写公司地址");else layer.msg("请选择市");else layer.msg("请选择省");else layer.msg("请填写营业执照号");else layer.msg("请填写法人身份证号");else layer.msg("请填写法人姓名");else layer.msg("请填写公司名称")}}]),app.controller("headCtrl",["$scope","$interval","$http","$timeout","$location",function(t,e,a,i,r){t.useId=sessionStorage.id,t.card_state=!1,t.onDuty="点击值班",t.clickCard=function(){t.card_state?layer.msg("已经开始值班了，不要在点击了！",{icon:6,time:2e3,anim:4}):a({url:BASEURL+"/api2/user/duty/start?device=1",method:"GET",timeout:1e4}).success(function(e){1==e.status?(t.card_state=!0,layer.msg("开始值班",{icon:6,time:2e3,anim:4}),t.onDuty="值班中..."):layer.msg("值班失败",{icon:5,time:2e3,anim:1})}).error(function(e,t,a){layer.msg("请求超时",{icon:5,time:2e3,anim:1})})},t.exit=function(){layer.confirm("确认是否退出？",{title:"提示",btn:["确定","取消"],icon:0,skin:"layui-layer-molv",time:5e3},function(){sessionStorage.loginState=!1,a({method:"POST",url:BASEURL+"/api2/user/logout?device=1"}).success(function(e){1==e.status&&(layer.msg("退出成功",{icon:1,time:1500}),i(function(){r.url("login")},2e3),sessionStorage.loginState=!1)}).error(function(){layer.msg("退出成功",{icon:1,time:1500}),i(function(){r.url("login")},2e3),sessionStorage.loginState=!1})})}}]),app.controller("cheku",["$scope","$http","$location","$state",function(e,t,a,i){e.IP=imgUrl,e.jump=function(e){a.url(e)},e.jumpUrl=function(e,t){i.go(e,t)},e.enlargeImg=function(e){layer.photos({move:!1,photos:e,anim:5,shade:.5})},e.jump_blank=function(e){var t=i.href("largeImg",{url:e},{reload:!0});window.open(t,"_blank")},e.pageNum=function(e,t){var a="",i="",r=[];for(e<=7?(a=1,i=parseInt(e)):parseInt(t)+3>parseInt(e)?(a=parseInt(e)-6,i=parseInt(e)):parseInt(t)-3<=1?(a=1,i=7):(a=parseInt(t)-3,i=parseInt(t)+3);a<=i;a++)r.push(a);return r},e.getPageIndex=function(e,t,a){var i=$(e.currentTarget).attr("data-text");return"first"==i?1:"last"==i?a:"prev"==i?1<t?t-1:t:"next"==i?t<a?t+1:a:i}}]),app.controller("companyCtrl",["$scope","$http","requestData","$timeout","$state","$stateParams",function(t,a,i,e,r,n){t.provinceId=n.province_id,t.cityId=n.city_id,t.co_type=n.co_type,t.company_name=n.company_name,null!=n.company_name&&$("#company_name").focus();var s={companyListUrl:"/cms2/company/datas",companyListSendData:{device:1,page_index:1,page_size:10,province_id:"",city_id:"",co_type:"",company_name:""},getCurrentPage:function(){var e=n.page_index;null==e?this.companyListSendData.page_index=1:(this.companyListSendData.page_index=e,this.companyListSendData.province_id=n.province_id,this.companyListSendData.city_id=n.city_id,this.companyListSendData.co_type=n.co_type,this.companyListSendData.company_name=n.company_name)},getAllCompanyData:function(){var e=i.getData("GET",this.companyListUrl,this.companyListSendData);this.setAllCompanyData(e)},getProvinces:function(){a({method:"GET",url:BASEURL+"/api2/area/provinces?device=1",timeout:1e4}).success(function(e){1==e.status?t.provinceList=e.list:layer.msg("请求失败",{icon:5})}).error(function(e){})},setAllCompanyData:function(e){e.then(function(e){1==e.data.status?(t.companyList=e.data.list,t.pageNumber=e.data.page.pageNumber,t.recordCount=e.data.page.recordCount,t.pageCount=e.data.page.pageCount,t.pageSize=e.data.page.pageSize,t.pageList=t.pageNum(t.pageCount,t.pageNumber),t.startData=0==t.recordCount?0:(t.pageNumber-1)*t.pageSize+1,t.endData=e.data.list.length<t.pageSize?(t.pageNumber-1)*t.pageSize+e.data.list.length:t.pageNumber*t.pageSize):layer.msg(e.data.msg)})},init:function(){this.getCurrentPage(),this.getAllCompanyData(),this.getProvinces()}};s.init(),t.getCity=function(e){t.cityLists="",t.cityId="",a({method:"GET",url:BASEURL+"/api2/area/cities?province="+e+"&device=1",timeout:1e4}).success(function(e){1==e.status?t.cityLists=e.list:layer.msg("请求失败",{icon:5})}).error(function(){})},null!=n.province_id?(t.getCity(n.province_id),t.cityId=n.city_id):(t.cityLists="",t.cityId=""),t.selectProvince=function(){t.cityLists="",t.cityId="",t.company_name="",s.companyListSendData.page_index=1,s.companyListSendData.province_id=t.provinceId,s.companyListSendData.city_id=t.cityId,s.companyListSendData.co_type=t.co_type,s.companyListSendData.company_name=t.company_name,r.go("home.company",s.companyListSendData)},t.selectCity=function(){s.companyListSendData.page_index=1,s.companyListSendData.province_id=t.provinceId,s.companyListSendData.city_id=t.cityId,s.companyListSendData.co_type=t.co_type,s.companyListSendData.company_name=t.company_name,r.go("home.company",s.companyListSendData)},t.selectCompany=function(){s.companyListSendData.co_type=t.co_type,r.go("home.company",s.companyListSendData)},t.$watch("company_name",function(){""==t.company_name&&r.go("home.company",{page_index:1,province_id:t.provinceId,city_id:t.cityId,co_type:t.co_type,company_name:t.company_name})}),t.Search=function(){""==$("#company_name").val()?layer.msg("请输入公司名称"):r.go("home.company",{page_index:1,province_id:t.provinceId,city_id:t.cityId,co_type:t.co_type,company_name:t.company_name})},t.changePageUrl=function(e){s.companyListSendData.page_index=t.getPageIndex(e,t.pageNumber,t.pageCount),r.go("home.company",s.companyListSendData)}}]),app.controller("companyAuditCtrl",["$scope","httpData","$stateParams","$state",function(i,e,r,t){var a=layer.load(1),n={getAllCompanyUrl:"/cms2/company/cert/datas?device=1",sendData:{page_index:1,page_size:10,state:0},getAllCompanyData:function(){e.getData("GET",this.getAllCompanyUrl,this.sendData,this.setAllCompanyData,this.errorData)},setAllCompanyData:function(e){layer.close(a);var t=e;1==t.status?(i.companyLists=t.list,i.pageNumber=t.page.pageNumber,i.pageCount=t.page.pageCount,i.recordCount=t.page.recordCount,i.pageSize=t.page.pageSize,i.pageList=i.pageNum(i.pageCount,i.pageNumber),i.startData=0==i.recordCount?0:(i.pageNumber-1)*i.pageSize+1,i.endData=t.list.length<i.pageSize?(i.pageNumber-1)*i.pageSize+t.list.length:i.pageNumber*i.pageSize):layer.msg(t.msg,{icon:5})},errorData:function(){layer.close(a),layer.msg("请求失败",{icon:5})},getDataFromUrl:function(){var e=r.page_index,t=r.page_size,a=r.state;e||(e=1),t||(t=10),a||(a=""),this.sendData={page_index:e,page_size:t,state:a},i.company_type=a},init:function(){this.getDataFromUrl(),this.getAllCompanyData()}};n.init(),i.changeState=function(){n.sendData={page_index:n.sendData.page_index,page_size:n.sendData.page_size,state:i.company_type},t.go("home.companyAudit",n.sendData)},i.changePageUrl=function(e){n.sendData.page_index=i.getPageIndex(e,i.pageNumber,i.pageCount),t.go("home.companyAudit",n.sendData)}}]),app.controller("companyAuditDetailCtrl",["$scope","httpData","$stateParams","$window","$timeout",function(n,r,e,a,i){var s=layer.load(1);n.company_id="",n.state="",n.line=!1,n.lng_lat="";var o={detaileUrl:"/cms2/company/cert/detail?device=1",toExamineUrl:"/cms2/company/cert/company?device=1",getDetailData:function(){var e={company_id:n.company_id};r.getData("GET",this.detaileUrl,e,this.setCompanyDetailData,this.errorData)},setCompanyDetailData:function(e){layer.close(s);var t=e;if(1==t.status){var a=t.datas[0];console.log(a),""==(n.detailData=a).bmp_lat||""==a.bmp_lng?(n.line=!0,n.lng_lat=""):n.lng_lat=a.bmp_lng+","+a.bmp_lat}else layer.msg(t.msg,{icon:5})},errorData:function(){layer.close(s),layer.msg("请求失败",{icon:5})},getIdFromUrl:function(){n.company_id=e.company_id},componyExamine:function(e,t,a){var i={company_id:n.company_id,message:t,lng_lat:a,state:e};r.getData("POST",this.toExamineUrl,i,this.setComponyExamineData,this.errorData)},setComponyExamineData:function(e){layer.close(s);var t=e;1==t.status?(layer.msg(t.msg,{icon:1,time:1500}),i(function(){a.location.reload()},1800)):layer.msg(t.msg,{icon:5})},init:function(){this.getIdFromUrl(),this.getDetailData()}};n.enlargeImg=function(e){layer.photos({move:!1,photos:e,anim:5,shade:.5})},n.toExamine=function(){var i=2,r="",e=layer.confirm("是否进行公司审核?",{skin:"layui-layer-molv",btn:["失败","通过"]},function(){i=3,layer.close(e),layer.prompt({formType:2,value:"",title:"审核失败信息填写",area:["300px","100px"]},function(e,t,a){r=e,layer.close(t),o.componyExamine(i,r,"")})},function(){i=2,n.line?layer.prompt({title:"请填写经/纬度,用逗号分割"},function(e,t){layer.close(t),o.componyExamine(i,r,e)}):o.componyExamine(i,r,n.lng_lat)})},o.init()}]),app.controller("companyDetailCtrl",["$scope","$http","requestData","$stateParams","$window","$timeout",function(i,a,t,e,r,n){i.company_id=e.company_id;var s="",o={detailDataUrl:"/cms2/company/detail?device=1",uploadUrl:"/api2/file/upload?device=1",submitUrl:"/cms2/company/bind/admin?device=1",companyDetailSendData:{company_id:e.company_id,mobile:"",authorization_person:""},getCompanyId:function(){this.companyDetailSendData.company_id=e.company_id},getDetailData:function(){var e=t.getData("GET",this.detailDataUrl,this.companyDetailSendData);this.setDetailData(e)},uploadeMenuIconBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},uploadeLicenseSuccess:function(e){if(layer.closeAll("dialog"),1==e.status){s=e.data[0].normal;var t=imgUrl+s;angular.element("#show_upload_img").attr("src",t)}else layer.msg("上传失败")},submitData:function(){var e=t.getData("POST",this.submitUrl,o.companyDetailSendData);this.submitSuccessData(e)},setDetailData:function(e){e.then(function(e){if(i.detailData=e.data.data,i.contract_protocol=[],e.data.data.contract_protocol)for(var t=e.data.data.contract_protocol.split(","),a=0;a<t.length;a++)t[a]&&i.contract_protocol.push(t[a])})},submitSuccessData:function(e){e.then(function(e){var t=e.data;1==t.status?(layer.msg(t.msg,{icon:1,time:1e3}),n(function(e){layer.close(e),$("#bindUser").modal("hide"),this.getDetailData()},2e3)):layer.msg(t.msg,{icon:5,time:2e3})})},init:function(){this.getCompanyId(),this.getDetailData()}};o.init(),i.seller_ziyuan=function(){layer.confirm("是否认证为资源公司？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e);var t=layer.msg("数据提交中...",{icon:16,time:0});a({method:"POST",url:BASEURL+"/cms2/company/change?device=1",params:{company_type:"seller_ziyuan",company_id:i.company_id}}).success(function(e){layer.close(t),1==e.status?layer.msg(e.msg,{icon:1,time:1500}):layer.msg(e.msg,{icon:5,time:1500})})},function(e){layer.close(e)})},i.seller_ibd=function(){layer.confirm("是否认证为IBD公司？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e);var t=layer.msg("数据提交中...",{icon:16,time:0});a({method:"POST",url:BASEURL+"/cms2/company/change?device=1",params:{company_type:"seller_ibd",company_id:i.company_id}}).success(function(e){layer.close(t),1==e.status?layer.msg(e.msg,{icon:1,time:1500}):layer.msg(e.msg,{icon:5,time:1500})})},function(e){layer.close(e)})},layui.use("form",function(){layui.form().on("submit(bind-form)",function(e){var t=angular.element("#bind");o.companyDetailSendData.company_id=i.company_id,console.log(i.company_id),o.companyDetailSendData.mobile=t.find("input[name=mobile]").val(),o.companyDetailSendData.authorization_person=s,o.submitData()})}),angular.element("#license").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:o.uploadeMenuIconBefore,success:o.uploadeLicenseSuccess,xhrFields:{withCredentials:!0}};angular.element("#upload-license").ajaxSubmit(e)}),i.unBundling=function(){layer.confirm("是否解除此用户管理员权限？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e);var t=layer.msg("数据提交中...",{icon:16,time:0});a({method:"POST",url:BASEURL+"/cms2/company/delete/admin?device=1",params:{company_id:i.company_id,mobile:""}}).success(function(e){layer.close(t),1==e.status?layer.msg(e.msg,{icon:1,time:1500}):layer.msg(e.msg,{icon:5,time:1500})})},function(e){layer.close(e)})},i.financialCompany=function(t){layer.confirm("确认认证为金融公司？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e),a({method:"POST",url:BASEURL+"/cms2/company/change/finance?device=1&company_id="+t,timeout:1e4}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),o.init()):layer.msg(e.msg,{icon:5,time:1500})}).error(function(e){})},function(e){layer.close(e)})}}]),app.controller("complainCtrl",["$http","$scope","requestData","$timeout","$stateParams","$state",function(a,i,e,t,r,n){var s={page_index:i.complainList="",page_size:10,device:1};i.getComplainList=function(e){null==r.page_index?e.page_index=1:e.page_index=r.page_index;var t=layer.msg("加载中...",{icon:16,time:0});a({method:"GET",url:BASEURL+"/cms2/complaint/datas",params:e}).success(function(e){layer.close(t),1==e.status?(i.complainList=e.list,i.pageNumber=e.page.pageNumber,i.recordCount=e.page.recordCount,i.pageCount=e.page.pageCount,i.pageSize=e.page.pageSize,i.pageList=i.pageNum(i.pageCount,i.pageNumber),i.startData=0==i.recordCount?0:(i.pageNumber-1)*i.pageSize+1,i.endData=e.list.length<i.pageSize?(i.pageNumber-1)*i.pageSize+e.list.length:i.pageNumber*i.pageSize):layer.msg("请求失败",{icon:5})}).error(function(e){})},i.getComplainList(s),i.changePageUrl=function(e){s.page_index=i.getPageIndex(e,i.pageNumber,i.pageCount),n.go("home.complain",s)}}]),app.controller("complainDetailCtrl",["$http","$scope","requestData","$timeout","$stateParams","$state",function(a,i,e,r,t,n){function s(e){1==e.status?(layer.msg("上传成功",{icon:1,time:1500}),i.attachment=e.data[0].normal,angular.element("#adv-img").attr("src",imgUrl+i.attachment)):layer.msg("上传失败",{icon:5,time:1500})}function o(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})}i.complainDetail="",i.getComplainDetail=function(e){a({method:"GET",url:BASEURL+"/cms2/complaint/detail?device=1&id="+e}).success(function(e){1==e.status?(i.complainData=e.data,""!==e.data.complaint_picture&&"null"!=e.data.complaint_picture?i.complaint_picture=e.data.complaint_picture.split(","):i.complaint_picture=""):layer.msg("请求失败",{icon:5})}).error(function(e){})},i.getComplainDetail(t.id),i.attachment="",angular.element("#sel-adv-img").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:o,success:s,xhrFields:{withCredentials:!0}};angular.element("#uploadAdv").ajaxSubmit(e)}),i.manageComplain=function(t){a({method:"POST",url:BASEURL+"/cms2/complaint/edit",params:{device:1,id:t,feedback_contanct:i.feedback_contanct,state:1,attachment:i.attachment}}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),r(function(){$("#manage_complain").modal("hide"),i.getComplainDetail(t)},1500)):layer.msg(e.msg,{icon:5,time:1e3})})}}]),app.controller("counselManagementCtrl",["$scope","$stateParams","$state","$window","$timeout","httpRequestData",function(s,o,a,e,i,r){var t=new Date,n=layer.load(1);s.deleteManagementList=[],s.has_clicked=!1,s.listFace="",s.linkFace="",s.select_type="",s.has_save=!1;var c={counselManagementListUrl:"/cms2/counsel/getall?device=1",releaseManagementUrl:"/cms2/counsel/passed?device=1",deleteManagementUrl:"/cms2/counsel/delete?device=1",uploadUrl:"/api2/file/upload?device=1",codeUrl:"/api2/counsel/getstatic",updateCounselUrl:"/cms2/counsel/edit?device=1",classificationUrl:"/cms2/counseldir/getall?device=1",listsSendData:{page_index:1,page_size:10,start_time:"",end_time:"",dir_id:0,state:0},errorData:function(){layer.close(n),s.has_clicked=!1,layer.msg("请求失败",{icon:5})},setSuccessData:function(e){layer.close(n),1==e.status?layer.msg(e.msg,{icon:1,time:1500}):layer.msg(e.msg,{icon:5,time:1500}),i(function(){c.init()},1600)},getNowDate:function(){var e=t.toLocaleDateString()+"";s.start_time=s.end_time=e.replace(/\//g,"-")},setManagementLists:function(e){layer.close(n),1===e.status?(s.managementLists=e.list,s.pageNumber=e.page.pageNumber,s.pageCount=e.page.pageCount,s.recordCount=e.page.recordCount,s.pageSize=e.page.pageSize,s.pageList=s.pageNum(s.pageCount,s.pageNumber),s.startData=0==s.recordCount?0:(s.pageNumber-1)*s.pageSize+1,s.endData=e.list.length<s.pageSize?(s.pageNumber-1)*s.pageSize+e.list.length:s.pageNumber*s.pageSize):layer.msg("数据获取异常",{icon:5})},getCounselManagementLists:function(){var e={req_data:{url:BASEURL+this.counselManagementListUrl,params:this.listsSendData},requestSuccess:this.setManagementLists,requestError:this.errorData};r.getData(e)},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]},getDataFromUrl:function(){var e=o.page_index,t=o.page_size,a=o.start_time,i=o.end_time,r=o.dir_id,n=o.state;e||(e=1),t||(t=10),a?s.start_time=this.getLocalTime(a).replace(/\//g,"-"):a=null,i?s.end_time=this.getLocalTime(i).replace(/\//g,"-"):i=null,r||(r=0),n||(n=0),s.counsel_state=n,s.counsel_type=r,this.listsSendData={page_index:e,page_size:t,start_time:a,end_time:i,dir_id:r,state:n}},selectData:function(){var e="",t="";e=s.start_time?Date.parse(s.start_time.replace(/-/g,"/")):"",t=s.end_time?Date.parse(s.end_time.replace(/-/g,"/")):"",this.listsSendData.state=s.counsel_state,this.listsSendData.dir_id=s.counsel_type,this.listsSendData.start_time=e,this.listsSendData.end_time=t,a.go("home.counselManagement",this.listsSendData)},releaseManagement:function(e){var t={ids:e,file_name:"preview"},a={req_data:{method:"POST",url:BASEURL+this.releaseManagementUrl,params:t},requestSuccess:this.setSuccessData,requestError:this.errorData};r.getData(a)},setDeleteManyData:function(e){layer.close(n),s.has_clicked=!1,1==e.status?layer.msg(e.msg,{icon:1,time:1500}):layer.msg(e.msg,{icon:5,time:1500}),s.deleteManagementList=[],i(function(){c.init()},1600)},deleteManyManagement:function(){var e={ids:s.deleteManagementList.join(",")},t={req_data:{method:"POST",url:BASEURL+this.deleteManagementUrl,params:e},requestSuccess:this.setDeleteManyData,requestError:this.errorData};r.getData(t)},deleteOneManagement:function(e){var t={ids:e},a={req_data:{method:"POST",url:BASEURL+this.deleteManagementUrl,params:t},requestSuccess:this.setSuccessData,requestError:this.errorData};r.getData(a)},uploadeFaceBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},uploadeListFaceSuccess:function(e){layer.closeAll("dialog"),1==e.status?(company_id_image=e.data[0].normal,s.listFace=imgUrl+company_id_image,s.listFaceAddress=company_id_image,s.$apply()):layer.msg("上传失败")},uploadeLinkFaceSuccess:function(e){layer.closeAll("dialog"),1==e.status?(company_id_image=e.data[0].normal,s.linkFace=imgUrl+company_id_image,s.linkFaceAddress=company_id_image,s.$apply()):layer.msg("上传失败")},getNowFormatDate:function(){var e=new Date,t=e.getMonth()+1,a=e.getDate();return 1<=t&&t<=9&&(t="0"+t),0<=a&&a<=9&&(a="0"+a),e.getFullYear()+"-"+t+"-"+a+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},setSuccessAddCounsel:function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),i(function(){$("#EditModal").css("display","none"),c.init()},1600)):layer.msg(e.msg,{icon:5,time:1500})},setSuccessClassification:function(e){layer.close(n),1===e.status?s.classificationLists=e.list:layer.msg(e.msg,{icon:5,time:1500})},getClassification:function(){var e={req_data:{url:BASEURL+this.classificationUrl},requestSuccess:this.setSuccessClassification,requestError:this.errorData};r.getData(e)},init:function(){this.getDataFromUrl(),this.getClassification(),this.getCounselManagementLists()}};c.init(),s.changeState=function(){c.listsSendData.page_index=1,c.listsSendData.state=s.counsel_state,a.go("home.counselManagement",c.listsSendData)},s.changeType=function(){c.listsSendData.page_index=1,c.listsSendData.dir_id=s.counsel_type,a.go("home.counselManagement",c.listsSendData)},s.releaseManagement=function(e){var t=$(e.currentTarget).attr("data-id");c.releaseManagement(t)},s.checkId=function(e){var t=e.currentTarget,a=$(t).attr("data-id");if(t.checked)s.deleteManagementList.push(a);else{var i=s.deleteManagementList.indexOf(a);-1<i&&s.deleteManagementList.splice(i,1)}},s.deleteAll=function(){s.has_clicked=!0,0<s.deleteManagementList.length?c.deleteManyManagement():i(function(){s.has_clicked=!1},1500)},s.deleteOne=function(e){var t=e.currentTarget,a=$(t).attr("data-id");c.deleteOneManagement(a)},s.editManagement=function(e){$("#EditModal").css("display","block"),$("#summernote").summernote("code",""),s.currentListData=s.managementLists[e],s.id=s.currentListData.counsel_id,s.editTitle=s.currentListData.title,0===s.currentListData.is_passed?s.has_release=!1:s.has_release=!0,s.currentListData.hasOwnProperty("cover_a")?(s.listFace=imgUrl+s.currentListData.cover_a,s.listFaceAddress=s.currentListData.cover_a):(s.listFace="./images/none.png",s.listFaceAddress=""),s.currentListData.hasOwnProperty("cover_b")?(s.linkFace=imgUrl+s.currentListData.cover_b,s.linkFaceAddress=s.currentListData.cover_b):(s.linkFace="./images/none.png",s.linkFaceAddress=""),s.describe=s.currentListData.des,s.select_type=s.currentListData.dir_id,$.ajax({url:BASEURL+c.codeUrl+"?device=1",method:"get",data:{counsel_id:s.currentListData.counsel_id},cache:!1,dataType:"html",xhrFields:{withCredentials:!0},success:function(e){var t="",a=JSON.parse(e);1==a.status?(t=decodeURIComponent(a.data),$("#summernote").summernote("code",t)):layer.msg(e.msg,{icon:5,time:1500})},error:function(e){layer.msg(e.msg,{icon:5,time:1500})}})},s.changePageUrl=function(e){c.listsSendData.page_index=s.getPageIndex(e,s.pageNumber,s.pageCount),a.go("home.counselManagement",c.listsSendData)},$("#start-time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,todayBtn:!0,startView:2,minView:2,maxView:"decade",language:"zh-CN",clearBtn:!0}).on("changeDate",function(e){c.selectData()}),$("#end-time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,todayBtn:!0,startView:2,minView:2,maxView:"decade",language:"zh-CN",clearBtn:!0}).on("changeDate",function(e){c.selectData()}),angular.element("#list_face_input").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:c.uploadeFaceBefore,success:c.uploadeListFaceSuccess,xhrFields:{withCredentials:!0}};angular.element("#list_face").ajaxSubmit(e)}),angular.element("#link_face_input").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:c.uploadeFaceBefore,success:c.uploadeLinkFaceSuccess,xhrFields:{withCredentials:!0}};angular.element("#link_face").ajaxSubmit(e)}),s.closeModel=function(){$("#EditModal").css("display","none")};$("#summernote").summernote({height:400,lang:"zh-CN",toolbar:[["style",["style","bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["insert",["link","picture","video","codeview"]],["table",["table"]],["hr",["hr"]],["image",["undo","redo","removeMedia","help"]],["mybutton",["preview"]]],buttons:{preview:function(e){return $.summernote.ui.button({contents:'<i class="icon-columns"/> 预览',tooltip:"预览",click:function(){var e=$("#summernote").summernote("code"),t={title:s.releaseTitle,content:encodeURIComponent(e)};sessionStorage.preview_content=JSON.stringify(t),window.open("views/test/show.html","预览","width=360,height=640")}}).render()}}}),s.save=function(e){if(s.has_save=!0,i(function(){s.has_save=!1},1500),s.editTitle)if(s.select_type){var t={id:s.id,title:"",cover_a:" ",cover_b:" ",content:" ",is_passed:0,dir_id:"",des:"",file_name:"preview",host_img:imgUrl},a=$("#summernote").summernote("code");t.is_passed=e,t.title=s.editTitle,t.cover_a=s.listFaceAddress,t.cover_b=s.linkFaceAddress,t.content=encodeURIComponent(a),t.dir_id=s.select_type,t.des=s.describe,$.ajax({type:"POST",headers:{"Content-Type":"application/json;charset=UTF-8"},url:BASEURL+c.updateCounselUrl,data:JSON.stringify(t),timeout:1e4,success:function(e){c.setSuccessAddCounsel(e)},error:function(e,t,a,i){c.errorData(e,t,a,i)}})}else layer.msg("请选择咨讯分类",{icon:5});else layer.msg("请填写标题",{icon:5})}}]),app.controller("dispatchOrderCtrl",["$scope","$stateParams","$state","$window","$timeout","httpRequestData",function(a,t,i,e,r,n){a.data={carBrandId:"",carBrandName:"",carColor:"",carFinalPrice:"",carInteriorColor:"",carMadeDate:"",carModelId:"",carModelName:"",carModelPicture:"",carReferPrice:"",carSaleNum:"",carSaleType:"",carSubBrandId:"",carSubBrandName:"",carTicketPrice:"",ibdCompanyAreaId:0,ibdCompanyAreaName:"",ibdCompanyCityId:"",ibdCompanyCityName:"",ibdCompanyId:"",ibdCompanyName:"",ibdCompanyProvinceId:"",ibdCompanyProvinceName:"",ibdUserId:"",ibdUserMobile:"",ibdUserName:"",intentionPirce:"",orderExtra:"",orderValidTime:"",resourceType:"",supplierId:"",supplierLeaderId:"",supplierLeaderName:"",supplierName:""},a.shop4sData={page_index:1,page_size:10,province_id:a.provice_4s_id,city_id:a.city_4s_id,supplier_name:a.shop_4s_name},a.company_type="",a.shop4sName="",a.shop4sNameShow="点击选择",a.hasShop4sName=!1,a.companyName="点击选择企业",a.hasCompanyName=!1,a.hasClick=!1,a.hasShope4sLists=!1,a.hasMobile=!1;var s=function(){this.city_lists_url=BASEURL+"/api2/area/cities?device=1",this.sub_brand_lists_url=BASEURL+"/api2/res/brand/",this.model_lists_url=BASEURL+"/api2/res/model/",this.two_net_manager_url=BASEURL+"/base_v1_0_0/supplierLeader/getLeadersbyId?out=json",this.shop_4s_url=BASEURL+"/base_v1_0_0/supplierV2/query/4s?out=json",this.model_colors_url=BASEURL+"/api2/res/model/colors?device=1",this.user_lists_url=BASEURL+"/base_v1_0_0/company/4/account?out=json",this.user_mobile_lists_url=BASEURL+"/cms2/user/datas?device=1&pageIndex=1&pageSize=10",this.dispatch_order_url=BASEURL+"/order_v1_0_0/cms/order/resource/special/add?out=json"};s.prototype={constructor:s,stateError:function(e){layer.closeAll("loading"),a.hasClicked=!1,layer.msg(e)},httpError:function(){layer.closeAll("loading"),a.hasClicked=!1,layer.msg("请求失败",{icon:5})},getProData:function(){var e={req_data:{method:"GET",url:PROVINCE_URL},requestSuccess:this.setProData.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(e)},setProData:function(e){layer.closeAll("loading"),1==e.status?a.proLists=e.list:this.stateError(e.data)},getCityData:function(){var e={province:a.province_id},t={req_data:{method:"GET",url:this.city_lists_url,params:e},requestSuccess:this.setCityData.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(t)},setCityData:function(e){layer.closeAll("loading"),1==e.status?a.cityLists=e.list:this.stateError(e.data)},getCityFor4sData:function(){var e={province:a.provice_4s_id},t={req_data:{method:"GET",url:this.city_lists_url,params:e},requestSuccess:this.setCityFor4sData.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(t)},setCityFor4sData:function(e){layer.closeAll("loading"),1==e.status?a.sle4sCityLists=e.list:this.stateError(e.data)},getBrandData:function(){var e={req_data:{method:"GET",url:CAR_BRAND_URL},requestSuccess:this.setBrandData.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(e)},setBrandData:function(e){layer.closeAll("loading"),1==e.status?a.brandLists=e.list:this.stateError(e.data)},getSubBrandData:function(){var e={req_data:{method:"GET",url:this.sub_brand_lists_url+a.brand_id+"?device=1"},requestSuccess:this.setSubBrandData.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(e)},setSubBrandData:function(e){layer.closeAll("loading"),1==e.status?a.subBrandLists=e.list:this.stateError(e.data)},getModelData:function(){var e={req_data:{method:"GET",url:this.model_lists_url+a.brand_id+"/"+a.sub_brand_id+"?device=1"},requestSuccess:this.setModelData.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(e)},setModelData:function(e){layer.closeAll("loading"),1==e.status?a.modelLists=e.list:this.stateError(e.data)},getModelColorsData:function(){var e={modelid:a.model_id},t={req_data:{method:"GET",url:this.model_colors_url,params:e},requestSuccess:this.setModelColorsData.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(t)},setModelColorsData:function(e){layer.closeAll("loading"),1==e.status?a.modelColorsLists=e.list:this.stateError(e.msg)},getTwoNetManagerData:function(){var e={supplierId:a.shop4sId},t={req_data:{method:"GET",url:this.two_net_manager_url,params:e},requestSuccess:this.setTwoNetManagerData.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(t)},setTwoNetManagerData:function(e){layer.closeAll("loading"),1==e.status?a.twoNetManagerLists=e.list:this.stateError(e.data)},getShop4sData:function(){var e={req_data:{method:"GET",url:this.shop_4s_url,params:a.shop4sData},requestSuccess:this.setShop4sData.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(e)},setShop4sData:function(e){layer.closeAll("loading"),1==e.status?(a.shop4sLists=e.list,a.shop4sPageNumber=e.page.pageNumber,a.shop4sPageCount=e.page.pageCount,a.shop4sPageSize=e.page.pageSize,a.shop4sRecordCount=e.page.recordCount,a.shop4sListsLength=e.list.length):this.stateError(e.data)},getUserData:function(){var e={account:a.user_mobile},t={req_data:{method:"GET",url:this.user_mobile_lists_url,params:e},requestSuccess:this.setUserData.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(t)},setUserData:function(e){layer.closeAll("loading"),1==e.status?(a.userLists=e.list,angular.element("#userLists").fadeIn()):this.stateError(e.data)},getDetailFromMobile:function(){var e={account:a.user_mobile},t={req_data:{method:"GET",url:this.user_lists_url,params:e},requestSuccess:this.setDetailFromMobile.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(t)},setDetailFromMobile:function(e){if(layer.closeAll("loading"),1==e.status){var t=e.data;a.company_type="IBD",a.company_name=t.companyName?t.companyName:"暂无",a.company_id=t.companyId,a.company_province_id=t.companyProvince,a.company_province_name=t.provinceName,a.company_city_id=t.companyCity,a.company_city_name=t.cityName}else this.stateError(e.data)},arrangeSendData:function(){return a.data.carBrandId=a.brand_id,a.data.carBrandName=a.car_brand_name,a.data.carColor=a.car_color,a.data.carFinalPrice=a.car_final_price?1e6*a.car_final_price:"",a.data.carInteriorColor=a.car_interior_color?a.car_interior_color:"",a.data.carMadeDate=a.mode_date?a.mode_date:"",a.data.carModelId=a.model_id,a.data.carModelName=a.car_model_name,a.data.carModelPicture=a.car_model_picture,a.data.carReferPrice=a.car_refer_price?1e6*a.car_refer_price:"",a.data.carSaleNum=a.car_sale_num?a.car_sale_num:"",a.data.carSaleType=a.car_sale_type,a.data.carSubBrandId=a.sub_brand_id,a.data.carSubBrandName=a.car_sub_brand_name,a.data.carTicketPrice=a.car_ticket_price?1e6*a.car_ticket_price:"",a.data.supplierName=a.shop4sName?a.shop4sName:"",a.data.supplierLeaderName=a.suppliereader_name?a.suppliereader_name:"",a.data.supplierLeaderId=a.supplier_leader_id?a.supplier_leader_id:"",a.data.supplierId=a.shop4sId?a.shop4sId:"",a.data.resourceType=a.company_type?a.company_type:"",a.data.orderValidTime=a.order_valid_time?a.order_valid_time:"",a.data.orderExtra=a.order_extra?a.order_extra:"",a.data.intentionPirce=a.intention_pirce?100*a.intention_pirce:"",a.data.ibdCompanyCityId=a.company_city_id?a.company_city_id:"",a.data.ibdCompanyCityName=a.company_city_name?a.company_city_name:"",a.data.ibdCompanyId=a.company_id?a.company_id:"",a.data.ibdCompanyName=a.company_name?a.company_name:"暂无",a.data.ibdCompanyProvinceId=a.company_province_id?a.company_province_id:"",a.data.ibdCompanyProvinceName=a.company_province_name?a.company_province_name:"",a.data.ibdUserId=a.user_id?a.user_id:"",a.data.ibdUserName=a.user_name?a.user_name:"",a.data.ibdUserMobile=a.user_mobile?a.user_mobile:"",angular.copy(a.data)},public:function(e){var t={req_data:{method:"POST",url:this.dispatch_order_url,data:e},requestSuccess:this.publicSuccess.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(t)},publicSuccess:function(e){if(layer.closeAll("loading"),1==e.status){if(layer.msg(data.msg,{icon:1,time:1500}),t.id)return void i.go();r(function(){layer.confirm("是否还要继续添加？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],anim:4,icon:0},function(e){a.hasClick=!1,layer.close(e),window.location.reload()},function(e){layer.close(e),i.go()})},1600)}else this.stateError(e.msg)},screenDataFromId:function(e,t){var a={};try{for(var i=0,r=e.length;i<r;i++)if(e[i].id==t)return void(a=e[i])}catch(e){}finally{return a}},init:function(){this.getProData(),this.getBrandData()}};var o=new s;o.init(),a.selProvince=function(){o.getCityData()},a.selBrand=function(){var e=o.screenDataFromId(a.brandLists,a.brand_id);a.car_brand_name=e.name,o.getSubBrandData()},a.selSubBrand=function(){var e=o.screenDataFromId(a.subBrandLists,a.sub_brand_id);a.car_sub_brand_name=e.name,o.getModelData()},a.selModel=function(){var e=o.screenDataFromId(a.modelLists,a.model_id);a.car_model_name=e.name,a.car_model_picture=e.car_img,o.getModelData(),o.getModelColorsData()},a.selCarColor=function(){var e=o.screenDataFromId(a.modelColorsLists,a.color_id);a.car_color=e.name},a.sel4sShope=function(e){e.stopPropagation(),angular.element("#Shop4s").modal(),a.hasShope4sLists=!0,o.getShop4sData()},a.sel4sProv=function(){a.shop4sData.province_id=a.provice_4s_id,a.shop4sData.page_index=1,a.shop4sData.page_size=10,o.getShop4sData(),o.getCityFor4sData()},a.sel4sCity=function(){a.shop4sData.city_id=a.city_4s_id,a.shop4sData.page_index=1,a.shop4sData.page_size=10,o.getShop4sData()},a.$watch("shop_4s_name",function(){a.shop_4s_name||(a.shop_4s_name=""),a.hasShope4sLists&&(a.shop4sData.supplier_name=a.shop_4s_name,a.shop4sData.page_index=1,a.shop4sData.page_size=10,o.getShop4sData())}),a.sele4sShop=function(e){angular.element("#Shop4s").modal("hide"),e?(a.hasShop4sName=!0,a.shop4sName=e.supplierName,a.shop4sNameShow=e.supplierName,a.shop4sId=e.supplierId,o.getTwoNetManagerData()):(a.hasShop4sName=!1,a.shop4sNameShow="点击选择")},a.change4sPage=function(){o.getShop4sData()},a.$watch("user_mobile",function(){a.user_mobile||(a.hasMobile=!1,a.user_mobile="",a.userLists="",a.company_type="",a.company_name="",angular.element("#userLists").fadeOut()),a.user_mobile.length<11&&(a.company_type="",a.company_name="",a.company_id="",a.company_province_id="",a.company_province_name="",a.company_city_id="",a.company_city_name=""),a.hasMobile&&o.getUserData()}),a.selectMobile=function(e){e&&(a.user_mobile=e.mobile,a.user_name=e.loginname,a.user_id=e.id,a.userLists="",a.hasMobile=!1,angular.element("#userLists").fadeOut(),o.getDetailFromMobile())},a.userMobileFocus=function(){a.hasMobile=!0,a.user_mobile&&o.getUserData()},a.seleSupplier=function(){for(var e=0,t=a.twoNetManagerLists.length;e<t;e++)if(a.twoNetManagerLists[e].supplierId==a.supplier_leader_id)return a.suppliereader_name=a.twoNetManagerLists[e].name,a.suppliereader_id=a.twoNetManagerLists[e].supplierId,void(a.suppliereader_mobile=a.twoNetManagerLists[e].mobile)},a.dispatchOrder=function(){a.hasClick=!0;var e=o.arrangeSendData();o.public(e)}}]),app.controller("orderListCtrl",["$scope","$http","$stateParams","$state",function(a,i,r,t){a.start_time="",a.end_time="",a.order_list="",a.start_time=r.start_time,a.end_time=r.end_time;var n={page_idnex:1,start_time:"",end_time:""};a.getDriverOrderList=function(e){null==r.page_index?e.page_index=1:e.page_index=r.page_index,e.start_time=r.start_time,e.end_time=r.end_time;var t=layer.msg("加载中...",{icon:16,time:0});i({method:"GET",url:BASEURL+"/cms2/count/driver?device=1&page_size=10",params:e}).success(function(e){layer.close(t),1==e.status&&(a.order_list=e.list,a.pageNumber=e.page.pageNumber,a.recordCount=e.page.recordCount,a.pageCount=e.page.pageCount,a.pageSize=e.page.pageSize,a.pageList=a.pageNum(a.pageCount,a.pageNumber),a.startData=0==a.recordCount?0:(a.pageNumber-1)*a.pageSize+1,a.endData=e.list.length<a.pageSize?(a.pageNumber-1)*a.pageSize+e.list.length:a.pageNumber*a.pageSize)})},a.getDriverOrderList(n),a.selectDriverOrderList=function(){var e={};null!=a.start_time&&null!=a.end_time?(e.page_index=1,e.start_time=a.start_time,e.end_time=a.end_time,t.go("home.driverOrderList",e)):""!=a.start_time&&""!=a.end_time||(a.start="",a.end_time="",e.page_index=1,e.start_time="",e.end_time="",t.go("home.driverOrderList",e))},a.changePageUrl=function(e){n.pageIndex=a.getPageIndex(e,a.pageNumber,a.pageCount),t.go("home.driverOrder",n)}}]),app.controller("orderNumCtrl",["$scope","$http","$stateParams","$state",function(a,i,r,t){a.start_time="",a.end_time="",a.order_num="",a.start_time=r.start_time,a.end_time=r.end_time;var n={page_idnex:1,start_time:"",end_time:""};a.getDriverOrderNum=function(e){var t=layer.msg("加载中...",{icon:16,time:0});null==r.page_index?e.page_index=1:e.page_index=r.page_index,e.start_time=r.start_time,e.end_time=r.end_time,i({method:"GET",url:BASEURL+"/cms2/count/driversum?device=1&page_size=10&page_index=1",params:e}).success(function(e){layer.close(t),1==e.status&&(a.order_num=e.list,a.pageNumber=e.page.pageNumber,a.recordCount=e.page.recordCount,a.pageCount=e.page.pageCount,a.pageSize=e.page.pageSize,a.pageList=a.pageNum(a.pageCount,a.pageNumber),a.startData=0==a.recordCount?0:(a.pageNumber-1)*a.pageSize+1,a.endData=e.list.length<a.pageSize?(a.pageNumber-1)*a.pageSize+e.list.length:a.pageNumber*a.pageSize)})},a.getDriverOrderNum(n),a.selectDriverOrderNum=function(){var e={};null!=a.start_time&&null!=a.end_time?(e.page_index=1,e.start_time=a.start_time,e.end_time=a.end_time,t.go("home.driverOrderNum",e)):""!=a.start_time&&""!=a.end_time||(a.start="",a.end_time="",e.page_index=1,e.start_time="",e.end_time="",t.go("home.driverOrderNum",e))},a.changePageUrl=function(e){n.pageIndex=a.getPageIndex(e,a.pageNumber,a.pageCount),t.go("home.driverOrder",n)}}]),app.controller("editAdvCtrl",["$scope","$http","$location","$timeout","$window","httpData","$stateParams",function(s,a,e,t,i,r,n){s.province_id=0,s.provinceName="",s.city_id=0,s.cityName="";var o={};function c(e){s.areaJoin="",s.area_list="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo.cId,i=e[t].data.cityInfo.cName,r=e[t].data.pId,n=e[t].data.pName;0!=t?(s.areaJoin+="|"+r+","+a,s.area_list+="|"+n+i):(s.areaJoin=r+","+a,s.area_list+=n+i)}s.cityBtnShow=!0,console.log(s.area_list),console.log(s.areaJoin)}s.showselectArea=[],s.cityList=[],s.areaJoin="";var l={id:0,name:"全国"},d={id:0,name:"全省"};a({method:"GET",url:BASEURL+"/api2/area/provinces?device=1",timeout:1e4}).success(function(e){1==e.status?(s.provinceData=e.list,s.provinceData.unshift(l)):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}),s.before_provice_id="",s.before_city_id="",s.whole_province_list=[],s.current_change_province="",s.current_change_city="",s.first_send=!1,s.selectProvince=function(e,t){s.province_id=t,s.provinceName=e,s.current_change_province=e,s.current_change_city="",(o={}).data={},o.data.cityInfo={},0!=t?0==s.before_province_id&&s.first_send?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),s.showselectArea=[],s.before_province_id=t,o.data.pId=s.province_id,o.data.pName=s.provinceName,s.cityBtnShow=!0,c(s.showselectArea),a({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(s.cityData=e.list,s.cityData.unshift(d),s.cityBtnShow=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(s.before_province_id=t,o.data.pId=s.province_id,o.data.pName=s.provinceName,-1==$.inArray(s.province_id,s.whole_province_list)?a({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(s.cityData=e.list,s.cityData.unshift(d),s.cityBtnShow=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(s.cityBtnShow=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===s.before_province_id?(s.before_province_id=t,s.first_send=!0,o.data.pId=0,o.data.pName="全国",o.data.cityInfo.cId=0,o.data.cityInfo.cName=" ",s.current_change_province="全国",s.showselectArea.push(o),s.cityBtnShow=!0,c(s.showselectArea)):0==s.before_province_id||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),s.before_province_id=t,s.showselectArea=[],o.data.pId=0,o.data.pName="全国",o.data.cityInfo.cId=0,o.data.cityInfo.cName=" ",s.current_change_province="全国",s.showselectArea.push(o),s.cityBtnShow=!0,c(s.showselectArea),s.$apply(),s.first_send=!0},function(e){layer.close(e)})},s.selectCity=function(e,a){o.data.cityInfo.cId="",o.data.cityInfo.cName="",-1==$.inArray(a,s.cityList)&&(0!=a?(s.before_city_id=a,s.cityList.push(a),s.city_id=a,s.cityName=e,s.current_change_city=e,o.data.cityInfo.cId=s.city_id,o.data.cityInfo.cName=s.cityName,s.cityBtnShow=!0,s.showselectArea.push(o),c(s.showselectArea)):""==s.before_city_id&&0!=s.before_city_id?(o.data.pId=s.provice_id,o.data.pName=s.proviceName,o.data.cityInfo.cId=0,o.data.cityInfo.cName="全省",s.current_change_city="全省",s.whole_province_list.push(s.provice_id),s.showselectArea.push(o),c(s.showselectArea)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+s.provinceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){s.before_city_id=a,layer.close(e);for(var t=0;t<s.showselectArea.length;t++)s.showselectArea[t].data.pId==s.province_id&&(s.showselectArea.splice(t,1),t-=1);o.data.pId=s.province_id,o.data.pName=s.provinceName,o.data.cityInfo.cId=0,o.data.cityInfo.cName="全省",s.current_change_city="全省",s.whole_province_list.push(s.province_id),s.showselectArea.push(o),c(s.showselectArea),s.$apply()},function(e){layer.close(e)}))},s.removeEle=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;s.showselectArea.splice(t,1);for(var i=0;i<s.whole_province_list.length;i++)if(s.whole_province_list[i]==a){s.whole_province_list.splice(i,1);break}s.cityList.splice(t,1),0==s.showselectArea.length&&(s.before_province_id="",s.before_city_id="",s.whole_province_list=[]),c(s.showselectArea)},s.getAdvDetail=function(){var t=layer.msg("加载中...",{icon:16,time:0});a({method:"GET",url:BASEURL+"/cms2/adv/detail/"+n.id+"?device=1",timeout:1e4}).success(function(e){console.log(e),layer.close(t),1==e.status?(s.advDetail=e.data,s.adv_img=imgUrl+e.data.picture,s.picture=e.data.picture,s.location=e.data.location+"",s.type=e.data.type,s.uri=e.data.uri,e.data.params?(s.resource_id=JSON.parse(e.data.params).fields.id,console.log(s.resource_id),s.res_type=JSON.parse(e.data.params).fields.resource_type+""):(s.resource_id="",s.res_type="")):layer.msg("请求失败",{icon:5})}).error(function(){})},s.getAdvDetail(),s.page_index=1,s.code="",s.sub_brand="",s.model_name="",s.user_name="",s.mobile="";var u={editAdvUrl:"/cms2/adv/edit?device=1",resUrl:"/cms2/resource/datas?device=1",errorData:function(){s.has_clicked=!1,layer.msg("请求失败",{icon:5})},uploadBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},uploadTitleSuccess:function(e){if(layer.closeAll("dialog"),1==e.status){var t=e.data[0].normal;s.adv_img=imgUrl+t,s.picture=t,s.$apply()}else layer.msg("上传失败")},getResource:function(){var e={page_index:s.page_index,page_size:10,code:s.code,sub_brand:s.sub_brand,model_name:s.model_name,user_name:s.user_name,mobile:s.mobile};r.getData("get",this.resUrl,e,this.setResource,this.errorData)},setResource:function(e){1==e.status&&(s.resource_list=e.list,s.pageNumber=e.page.pageNumber,s.recordCount=e.page.recordCount,s.pageCount=e.page.pageCount,s.pageSize=e.page.pageSize,s.pageList=s.pageNum(s.pageCount,s.pageNumber),s.startData=0==s.recordCount?0:(s.pageNumber-1)*s.pageSize+1,s.endData=e.list.length<s.pageSize?(s.pageNumber-1)*s.pageSize+e.list.length:s.pageNumber*s.pageSize)},editAdvFn:function(e){layer.msg("数据提交中...",{icon:16,time:0}),r.getData("POST",this.editAdvUrl,e,this.setSuccessEdit,this.errorData)},setSuccessEdit:function(e){s.has_clicked=!1,layer.closeAll("dialog"),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),t(function(){s.jump("/home/advDetail/"+n.id)},1600)):layer.msg(e.msg,{icon:5,time:1500})}};angular.element("#adv_picture_input").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:u.uploadBefore,success:u.uploadTitleSuccess,xhrFields:{withCredentials:!0}};angular.element("#adv_picture").ajaxSubmit(e)}),s.changeBox=function(){$("#selectResource").modal("show"),u.getResource()},s.changePageUrl=function(e){s.page_index=s.getPageIndex(e,s.pageNumber,s.pageCount),u.getResource()};var m=!1,p=!1,_=!1,g=!1;s.resource_search=function(){s.page_index=1,u.getResource()},s.$watch("code",function(){m=!0}),s.$watch("sub_brand",function(){m&&""==s.sub_brand&&s.resource_search(),m=!0}),s.$watch("model_name",function(){p&&""==s.model_name&&s.resource_search(),p=!0}),s.$watch("user_name",function(){_&&""==s.user_name&&s.resource_search(),_=!0}),s.$watch("mobile",function(){g&&""==s.mobile&&s.resource_search(),g=!0}),s.getResourceId=function(e,t){var a=$(e.currentTarget);s.resource_id=t,console.log(t);var i=a.text().replace(/(^\s*)|(\s*$)/g,""),r=i.indexOf("-");s.resource_name=i.slice(r+1),$("#selectResource").modal("hide")},s.getResourceDetail=function(){s.resource_id?a({method:"GET",url:BASEURL+"/api2/auto/resources/query/detail?device=1&res_id="+s.resource_id}).success(function(e){1==e.status?(s.resourceDetail=e.data,$("#resDetailModal").modal("show")):layer.msg(e.msg,{icon:5,time:1500})}):layer.msg("未选择资源")},s.saveAdv=function(){var e="";if(s.picture)if(s.location)if(s.type){if(0==s.type)s.uri="";else if(1==s.type){if(!s.uri)return void layer.msg("请输入链接地址")}else if(2==s.type){if(!s.resource_id)return void layer.msg("请选择资源");if(!s.res_type)return void layer.msg("请选择资源类型");e='{"action": "resouce_detail","fields": {"id": '+s.resource_id+',"title": "资源详情","resource_type":'+s.res_type+"}}"}else 3==s.type&&(s.action?e='{"action": "'+s.action+'"}':layer.msg("请选择功能页面"));var t={id:n.id,location:s.location,type:s.type,uri:s.uri,picture:s.picture,params:e,sale_area_list:s.areaJoin};u.editAdvFn(t)}else layer.msg("请选择广告类型");else layer.msg("请选择广告位置");else layer.msg("请上传广告图片")},s.cancel=function(){s.jump("/home/advDetail/"+n.id)}}]),app.controller("editAdvTempCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state","$http",function(s,t,e,a,i,r,n){s.province_id=0,s.provinceName="",s.city_id=0,s.cityName="";var o={};function c(e){s.areaJoin="",s.area_list="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo.cId,i=e[t].data.cityInfo.cName,r=e[t].data.pId,n=e[t].data.pName;0!=t?(s.areaJoin+="|"+r+","+a,s.area_list+="|"+n+i):(s.areaJoin=r+","+a,s.area_list+=n+i)}s.cityBtnShow=!0,console.log(s.area_list),console.log(s.areaJoin)}s.showselectArea=[],s.cityList=[],s.areaJoin="";var l={id:0,name:"全国"},d={id:0,name:"全省"};n({method:"GET",url:BASEURL+"/api2/area/provinces?device=1",timeout:1e4}).success(function(e){1==e.status?(s.provinceData=e.list,s.provinceData.unshift(l)):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}),s.before_provice_id="",s.before_city_id="",s.whole_province_list=[],s.current_change_province="",s.current_change_city="",s.first_send=!1,s.selectProvince=function(e,t){s.province_id=t,s.provinceName=e,s.current_change_province=e,s.current_change_city="",(o={}).data={},o.data.cityInfo={},0!=t?0==s.before_province_id&&s.first_send?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),s.showselectArea=[],s.before_province_id=t,o.data.pId=s.province_id,o.data.pName=s.provinceName,s.cityBtnShow=!0,c(s.showselectArea),n({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(s.cityData=e.list,s.cityData.unshift(d),s.cityBtnShow=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(s.before_province_id=t,o.data.pId=s.province_id,o.data.pName=s.provinceName,-1==$.inArray(s.province_id,s.whole_province_list)?n({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(s.cityData=e.list,s.cityData.unshift(d),s.cityBtnShow=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(s.cityBtnShow=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===s.before_province_id?(s.before_province_id=t,s.first_send=!0,o.data.pId=0,o.data.pName="全国",o.data.cityInfo.cId=0,o.data.cityInfo.cName=" ",s.current_change_province="全国",s.showselectArea.push(o),s.cityBtnShow=!0,c(s.showselectArea)):0==s.before_province_id||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),s.before_province_id=t,s.showselectArea=[],o.data.pId=0,o.data.pName="全国",o.data.cityInfo.cId=0,o.data.cityInfo.cName=" ",s.current_change_province="全国",s.showselectArea.push(o),s.cityBtnShow=!0,c(s.showselectArea),s.$apply(),s.first_send=!0},function(e){layer.close(e)})},s.selectCity=function(e,a){o.data.cityInfo.cId="",o.data.cityInfo.cName="",-1==$.inArray(a,s.cityList)&&(0!=a?(s.before_city_id=a,s.cityList.push(a),s.city_id=a,s.cityName=e,s.current_change_city=e,o.data.cityInfo.cId=s.city_id,o.data.cityInfo.cName=s.cityName,s.cityBtnShow=!0,s.showselectArea.push(o),c(s.showselectArea)):""==s.before_city_id&&0!=s.before_city_id?(o.data.pId=s.provice_id,o.data.pName=s.proviceName,o.data.cityInfo.cId=0,o.data.cityInfo.cName="全省",s.current_change_city="全省",s.whole_province_list.push(s.provice_id),s.showselectArea.push(o),c(s.showselectArea)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+s.provinceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){s.before_city_id=a,layer.close(e);for(var t=0;t<s.showselectArea.length;t++)s.showselectArea[t].data.pId==s.province_id&&(s.showselectArea.splice(t,1),t-=1);o.data.pId=s.province_id,o.data.pName=s.provinceName,o.data.cityInfo.cId=0,o.data.cityInfo.cName="全省",s.current_change_city="全省",s.whole_province_list.push(s.province_id),s.showselectArea.push(o),c(s.showselectArea),s.$apply()},function(e){layer.close(e)}))},s.removeEle=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;s.showselectArea.splice(t,1);for(var i=0;i<s.whole_province_list.length;i++)if(s.whole_province_list[i]==a){s.whole_province_list.splice(i,1);break}s.cityList.splice(t,1),0==s.showselectArea.length&&(s.before_province_id="",s.before_city_id="",s.whole_province_list=[]),c(s.showselectArea)},s.has_clicked=!1,s.page_index=1,s.adv_list=[],s.type=[],s.action=[],s.res_id=[],s.res_name=[],s.temp_imgs=[{img:"images/temp_0.png",params_type:0,num:1,name:"模板1"},{img:"images/temp_1.png",params_type:1,num:2,name:"模板2"},{img:"images/temp_2.png",params_type:2,num:2,name:"模板3"},{img:"images/temp_3.png",params_type:3,num:3,name:"模板4"},{img:"images/temp_4.png",params_type:4,num:4,name:"模板5"},{img:"images/temp_5.png",params_type:5,num:4,name:"模板6"},{img:"images/temp_6.png",params_type:6,num:5,name:"模板7"},{img:"images/temp_7.png",params_type:7,num:10,name:"模板8"}];var u={editUrl:"/cms2/adv/template/edit?device=1",detailUrl:"/cms2/adv/template/detail",resUrl:"/cms2/resource/datas?device=1",init:function(){this.detail(i.id)},detail:function(e){t.getData("GET",this.detailUrl,{device:1,template_id:e},this.setDetail,this.errorData)},setDetail:function(e){if(1==e.status)if(1==e.status){for(var t=0;t<s.temp_imgs.length;t++)s.temp_imgs[t].params_type==e.data.template.params_type&&(s.temp_img=s.temp_imgs[t].img);s.advTemp=e.data.template,s.adv_list=e.data.adv,s.title_type=e.data.template.title_type,2==e.data.template.title_type&&(s.title_img=e.data.template.title_content),s.title_content=e.data.template.title_content,s.level=e.data.template.level,s.start_time=e.data.template.start_time.slice(0,10),s.end_time=e.data.template.end_time.slice(0,10),s.params_type=e.data.template.params_type;var a=e.data.area;for(t=0;t<a.length;t++){0==a[t].province_id&&(s.before_province_id=0,s.first_send=!0);var i={};i.pId=a[t].province_id,"string"==typeof a[t].province?i.pName=a[t].province:i.pName=a[t].province.name,i.cityInfo={},i.cityInfo.cId=a[t].city_id,"string"==typeof a[t].city?i.cityInfo.cName=a[t].city:i.cityInfo.cName=a[t].city.name,s.showselectArea.push({data:i})}c(s.showselectArea);for(t=0;t<e.data.adv.length;t++)if(s.type.push(e.data.adv[t].type),s.res_name.push(""),e.data.adv[t].params){var r=JSON.parse(e.data.adv[t].params);"resouce_detail"==r.action?(s.res_id.push(r.fields.id),s.action.push(" ")):(s.res_id.push(" "),s.action.push(r.action))}else s.res_id.push(" "),s.action.push(" ");console.log(s.action,s.res_id,s.type,s.res_name)}else layer.msg("请求失败",{icon:5})},getLocalTime:function(e){return Date.parse(e.replace(/-/g,"/"))},getResource:function(){var e={page_index:s.page_index,page_size:10,code:s.code,sub_brand:s.sub_brand,model_name:s.model_name,user_name:s.user_name,mobile:s.mobile};t.getData("get",this.resUrl,e,this.setResource,this.errorData)},setResource:function(e){1==e.status&&(s.resource_list=e.list,s.pageNumber=e.page.pageNumber,s.recordCount=e.page.recordCount,s.pageCount=e.page.pageCount,s.pageSize=e.page.pageSize,s.pageList=s.pageNum(s.pageCount,s.pageNumber),s.startData=0==s.recordCount?0:(s.pageNumber-1)*s.pageSize+1,s.endData=e.list.length<s.pageSize?(s.pageNumber-1)*s.pageSize+e.list.length:s.pageNumber*s.pageSize)},errorData:function(){s.has_clicked=!1,layer.msg("请求失败",{icon:5})},uploadBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},uploadTitleSuccess:function(e){if(layer.closeAll("dialog"),1==e.status){var t=e.data[0].normal;s.title_img=t,s.title_content=t,s.$apply()}else layer.msg("上传失败")},uploadAdvSuccess:function(e){if(layer.closeAll("dialog"),1==e.status){var t=e.data[0].normal;s.index;s.adv_list[s.index].picture=t,s.$apply()}else layer.msg("上传失败")},editAdvTemp:function(e){layer.msg("数据提交中...",{icon:16,time:0}),t.getData("POST",this.editUrl,e,this.editSuccess,this.errorData)},editSuccess:function(e){s.has_clicked=!1,layer.closeAll("dialog"),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),a(function(){s.jumpUrl("home.advTemp")},1600)):layer.msg(e.msg,{icon:5,time:1500})}};u.init(),s.changeTitleType=function(){s.title_content=""},s.changeTitleType=function(){s.title_content=""},s.selectType=function(e){1==s.type[e]||0==s.type[e]?s.adv_list[e].params="":s.adv_list[e].uri="",s.adv_list[e].type=s.type[e]},s.selectFun=function(e){s.adv_list[e].params='{"action": "'+s.action[e]+'"}'};var m="";s.changeBox=function(e){$("#selectResource").modal("show"),u.getResource(),m=e},s.changePageUrl=function(e){s.page_index=s.getPageIndex(e,s.pageNumber,s.pageCount),u.getResource()};var p=!1,_=!1,g=!1,f=!1;s.resource_search=function(){s.page_index=1,u.getResource()},s.$watch("code",function(){p=!0}),s.$watch("sub_brand",function(){p&&""==s.sub_brand&&s.resource_search(),p=!0}),s.$watch("model_name",function(){_&&""==s.model_name&&s.resource_search(),_=!0}),s.$watch("user_name",function(){g&&""==s.user_name&&s.resource_search(),g=!0}),s.$watch("mobile",function(){f&&""==s.mobile&&s.resource_search(),f=!0}),s.getResourceId=function(e,t){var a=$(e.currentTarget).text().replace(/(^\s*)|(\s*$)/g,""),i=a.indexOf("-");s.res_name[m]=a.slice(i+1),s.res_id[m]=t,s.adv_list[m].params='{"action": "resouce_detail","fields": {"id": '+t+',"title": "资源详情","resource_type":1}}',console.log(s.adv_list,s.res_name),$("#selectResource").modal("hide")},s.getResourceDetail=function(e){var t=s.res_id[e];t?n({method:"GET",url:BASEURL+"/api2/auto/resources/query/detail?device=1&res_id="+t}).success(function(e){1==e.status?(s.resourceDetail=e.data,$("#resDetailModal").modal("show")):layer.msg(e.msg,{icon:5,time:1500})}):layer.msg("未选择资源")},s.editAdv=function(){if(s.areaJoin){if(""==s.title_type)return console.log("xxx"),void layer.msg("请选择标题形式");if(1!=s.title_type||s.title_content)if(2!=s.title_type||s.title_content)if(s.level)if(s.level<0||99<s.level)layer.msg("优先级必须为1~99的数字");else if(s.start_time)if(s.end_time){s.has_clicked=!0;var e={sale_area_list:s.areaJoin,title_type:s.title_type,title_content:s.title_content,level:s.level,start_time:"",end_time:"",params_type:s.params_type,adv_list:"",template_id:i.id};$(".adv_item").each(function(e){s.adv_list[e].uri=$(this).find("input[name='uri']").val()}),e.adv_list=JSON.stringify(s.adv_list),null!=s.start_time&&(e.start_time=u.getLocalTime(s.start_time)),null!=s.end_time&&(e.end_time=u.getLocalTime(s.end_time)),console.log(s.adv_list),console.log(e),u.editAdvTemp(e)}else layer.msg("请选择结束时间");else layer.msg("请选择开始时间");else layer.msg("请填写优先级");else layer.msg("请上传标题图片");else layer.msg("请填写标题")}else layer.msg("请选择地区")},angular.element("#title_img_input").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:u.uploadBefore,success:u.uploadTitleSuccess,xhrFields:{withCredentials:!0}};angular.element("#title_img").ajaxSubmit(e)}),s.fileChanged=function(e){s.index=$(e).attr("data-index");var t={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:u.uploadBefore,success:u.uploadAdvSuccess,xhrFields:{withCredentials:!0}};angular.element(e).parent().ajaxSubmit(t)},$("#start_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){var t=$("#start_time").val();$("#end_time").datetimepicker("setStartDate",t)}),$("#end_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){var t=$("#end_time").val();$("#start_time").datetimepicker("setEndDate",t)})}]),app.controller("editNoticeCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state","$http",function(s,t,a,i,e,r,n){var o="",c="/cms2/resource/datas?device=1";s.current_title="新增通知",s.predict_time="",s.title="",s.content="",s.action_type="message_detail",s.push_sys=0,s.now_time=(new Date).toLocaleString(),s.param="",add_notice_url="/cms2/message/save/cache?device=1",resource_detail_url="/api2/auto/resources/query/detail?device=1",s.page_index=1,s.province_id=0,s.provinceName="",s.city_id=0,s.cityName="";var l={};function d(e){s.areaJoin="",s.area_list="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo.cId,i=e[t].data.cityInfo.cName,r=e[t].data.pId,n=e[t].data.pName;0!=t?(s.areaJoin+="|"+r+","+a,s.area_list+="|"+n+i):(s.areaJoin=r+","+a,s.area_list+=n+i)}s.cityBtnShow=!0}s.showselectArea=[],s.cityList=[],s.areaJoin="";var u={id:0,name:"全国"},m={id:0,name:"全省"};if(n({method:"GET",url:BASEURL+"/api2/area/provinces?device=1",timeout:1e4}).success(function(e){1==e.status?(s.provinceData=e.list,s.provinceData.unshift(u)):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}),s.before_provice_id="",s.before_city_id="",s.whole_province_list=[],s.current_change_province="",s.current_change_city="",s.first_send=!1,s.selectProvince=function(e,t){s.province_id=t,s.provinceName=e,s.current_change_province=e,s.current_change_city="",(l={}).data={},l.data.cityInfo={},0!=t?0==s.before_province_id&&s.first_send?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),s.showselectArea=[],s.before_province_id=t,l.data.pId=s.province_id,l.data.pName=s.provinceName,s.cityBtnShow=!0,d(s.showselectArea),n({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(s.cityData=e.list,s.cityData.unshift(m),s.cityBtnShow=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(s.before_province_id=t,l.data.pId=s.province_id,l.data.pName=s.provinceName,-1==$.inArray(s.province_id,s.whole_province_list)?n({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(s.cityData=e.list,s.cityData.unshift(m),s.cityBtnShow=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(s.cityBtnShow=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===s.before_province_id?(s.before_province_id=t,s.first_send=!0,l.data.pId=0,l.data.pName="全国",l.data.cityInfo.cId=0,l.data.cityInfo.cName=" ",s.current_change_province="全国",s.showselectArea.push(l),s.cityBtnShow=!0,d(s.showselectArea)):0==s.before_province_id||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),s.before_province_id=t,s.showselectArea=[],l.data.pId=0,l.data.pName="全国",l.data.cityInfo.cId=0,l.data.cityInfo.cName=" ",s.current_change_province="全国",s.showselectArea.push(l),s.cityBtnShow=!0,d(s.showselectArea),s.$apply(),s.first_send=!0},function(e){layer.close(e)})},s.selectCity=function(e,a){l.data.cityInfo.cId="",l.data.cityInfo.cName="",-1==$.inArray(a,s.cityList)&&(0!=a?(s.before_city_id=a,s.cityList.push(a),s.city_id=a,s.cityName=e,s.current_change_city=e,l.data.cityInfo.cId=s.city_id,l.data.cityInfo.cName=s.cityName,s.cityBtnShow=!0,s.showselectArea.push(l),d(s.showselectArea)):""==s.before_city_id&&0!=s.before_city_id?(l.data.pId=s.provice_id,l.data.pName=s.proviceName,l.data.cityInfo.cId=0,l.data.cityInfo.cName="全省",s.current_change_city="全省",s.whole_province_list.push(s.provice_id),s.showselectArea.push(l),d(s.showselectArea)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+s.provinceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){s.before_city_id=a,layer.close(e);for(var t=0;t<s.showselectArea.length;t++)s.showselectArea[t].data.pId==s.province_id&&(s.showselectArea.splice(t,1),t-=1);l.data.pId=s.province_id,l.data.pName=s.provinceName,l.data.cityInfo.cId=0,l.data.cityInfo.cName="全省",s.current_change_city="全省",s.whole_province_list.push(s.province_id),s.showselectArea.push(l),d(s.showselectArea),s.$apply()},function(e){layer.close(e)}))},s.removeEle=function(e,t){var a=$(e.target).parent("li").data("value");s.showselectArea.splice(t,1);for(var i=0;i<s.whole_province_list.length;i++)if(s.whole_province_list[i]==a){s.whole_province_list.splice(i,1);break}s.cityList.splice(t,1),0==s.showselectArea.length&&(s.before_province_id="",s.before_city_id="",s.whole_province_list=[]),d(s.showselectArea)},e.sid){s.current_title="编辑通知";var p=sessionStorage.getItem("singleNotice"),_=JSON.parse(p);s.title=_.title,s.now_time=_.predict_time,s.predict_time=Date.parse(new Date(_.predict_time)),s.content=_.content,s.sendDesktop=_.push_sys,s.action_type=JSON.parse(_.message_param).action_type,s.link_address=JSON.parse(_.message_param).fields.url,s.resource_id=JSON.parse(_.message_param).fields.res_id,s.resource_type=JSON.parse(_.message_param).fields.resource_type,s.resource_name=JSON.parse(_.message_param).fields.resource_name;for(var g=_.areas,f=0;f<g.length;f++){0==g[f].province_id&&(s.before_province_id=0,s.first_send=!0),(l={}).pId=g[f].province_id,l.pName=g[f].province_name,l.cityInfo={},l.cityInfo.cId=g[f].city_id?g[f].city_id:0,l.cityInfo.cName=g[f].city_name?g[f].city_name:"全省",s.showselectArea.push({data:l})}d(s.showselectArea)}else s.sendDesktop=0,s.link_address="",s.resource_type="",s.resource_id="",s.resource_name="";function h(e){layer.close(o),s.has_clicked=!1,layer.msg("请求失败",{icon:5})}function y(e){layer.close(o),s.has_clicked=!1,1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),i(function(){layer.confirm("是否继续添加？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),a.location.reload()},function(e){s.jumpUrl("home.noticeList")})},1500)):layer.msg(e.msg,{icon:5,time:1500})}function v(e){1==e.status?(s.resourceDetail=e.data,$("#resDetailModal").modal("show")):layer.msg(e.msg,{icon:5,time:1500})}function b(e){layer.close(o),$("#selectResource").modal("show"),1==e.status?(s.resource_list=e.list,s.pageNumber=e.page.pageNumber,s.recordCount=e.page.recordCount,s.pageCount=e.page.pageCount,s.pageSize=e.page.pageSize,s.pageList=s.pageNum(s.pageCount,s.pageNumber),s.startData=0==s.recordCount?0:(s.pageNumber-1)*s.pageSize+1,s.endData=e.list.length<s.pageSize?(s.pageNumber-1)*s.pageSize+e.list.length:s.pageNumber*s.pageSize):layer.msg(e.msg,{icon:5,time:1500})}function D(){var e={page_index:s.page_index,page_size:10,code:s.code,sub_brand:s.sub_brand,model_name:s.model_name,user_name:s.user_name,mobile:s.mobile};o=layer.load(1),t.getData("get",c,e,b,h)}$("#start_time").datetimepicker({format:"yyyy/mm/dd hh:ii",autoclose:!0,todayHighlight:1,clearBtn:!0,startDate:new Date}).on("changeDate",function(e){e.date?s.predict_time=Date.parse(new Date(e.date)):s.predict_time=(new Date).getTime()}),s.hasSendDesktop=function(e){s.push_sys=e},s.changeType=function(){s.link_address="",s.resource_type="",s.resource_id="",s.resource_name=""},s.addSubmit=function(){if(s.title.trim())if(s.areaJoin){s.predict_time||(s.predict_time=(new Date).getTime()),s.has_clicked=!0;var e={title:s.title,area_ids:s.areaJoin,content:s.content,predict_time:s.predict_time,push_sys:s.push_sys,params:{action_type:s.action_type,fields:{url:s.link_address,res_id:s.resource_id,title:"资源详情",resource_type:s.resource_type,resource_name:s.resource_name}}};e.params=JSON.stringify(e.params),o=layer.load(1),t.getData("POST",add_notice_url,e,y,h)}else layer.msg("请选择发送范围",{icon:5,time:1500});else layer.msg("请填写标题",{icon:5,time:1500})},s.getResourceDetail=function(){if(s.resource_id){var e={res_id:s.resource_id};t.getData("get",resource_detail_url,e,v,h)}else layer.msg("未选择资源")},s.changeBox=function(){D()},s.getResourceId=function(e,t,a){var i=$(e.currentTarget);s.resource_id=t,s.resource_type=a;var r=i.text().replace(/(^\s*)|(\s*$)/g,""),n=r.indexOf("-");s.resource_name=r.slice(n+1),$("#selectResource").modal("hide")},s.changePageUrl=function(e){s.page_index=s.getPageIndex(e,s.pageNumber,s.pageCount),D()}}]),app.controller("editspecialResourcesCtrl",["$http","$scope","$stateParams","$timeout","$cookieStore",function(r,u,e,t,a){u.requsFlag=!1,u.modelDeleteShow="",u.pinLists=!0,u.modelisthasshow=!0,u.modelLists=[];u.subPinBtn=!0;u.exteriorColor="",u.trimColor="",u.cityBtnShow=!0,u.cityBtnShow1=!0,u.favourableMode="money",u.editFavourableMode="money",u.current_index="",u.has_use_click=!0,u.has_use_attr_click=!0,u.has_use_attr_click=!0,u.attachment=0,u.editattachment=0,u.has_send_btn=!0,u.editFlag=!0,u.edit_btn=!1;var i={id:0,name:"全国"},n={id:0,name:"全省"};u.publishObj=[],layui.use(["element","form","laydate"],function(){var e=layui.element(),t=layui.form();layui.laydate();e.init(),t.render(),u.allModelList={},u.dataStateFlag=!0,u.dataColorFlag=!0,u.dataCreateFlag=!0,u.dataPriceFlag=!1,u.dataTypeFlag=!0,e.on("tab(favourable)",function(e){switch(e.index){case 0:u.favourableMode="money",u.favourablepoint="",u.sale_price="";break;case 1:u.favourableMode="point",u.favourablemoney="",u.sale_price="";break;default:u.favourableMode="price",u.favourablepoint="",u.favourablemoney=""}}),t.on("select(car_type)",function(e){u.car_type=e.value}),t.on("select(manufacture)",function(e){u.manufacture=e.value}),t.on("select(attachment)",function(e){u.attachment=e.value}),t.on("switch(attachment)",function(e){switch(this.checked){case 0:u.attachment=0;break;case 1:u.attachment=1;break;case 2:u.attachment=2;break;default:u.attachment=""}}),t.on("select(editattachment)",function(e){switch(u.dataCreateFlag=!0,u.editattachment=e.value,e.value){case 0:u.modelLists[u.current_index].modelInfoData.attachment="随车发",u.editattachment=0,u.shouxu=0;break;case 1:u.modelLists[u.current_index].modelInfoData.attachment="3天内发",u.editattachment=1,u.shouxu=1;break;default:u.modelLists[u.current_index].modelInfoData.attachment="7天内发",u.editattachment=2,u.shouxu=2}}),t.on("select(editmanufacture)",function(e){switch(u.dataCreateFlag=!0,u.editManufacture=e.value,e.value){case 0:u.modelLists[u.current_index].modelInfoData.manufacture="一年以内",u.editManufacture=0;break;case 1:u.modelLists[u.current_index].modelInfoData.manufacture="半年内",u.editManufacture=1;break;case 2:u.modelLists[u.current_index].modelInfoData.manufacture="三个月内",u.editManufacture=2;break;default:u.modelLists[u.current_index].modelInfoData.manufacture="一年以上",u.editManufacture=3}}),t.on("select(editcartype)",function(e){u.editcartype=e.value}),e.on("tab(editfavourable)",function(e){switch(e.index){case 0:u.editFavourableMode="money",u.editFavourablepoint="";break;case 1:u.editFavourableMode="point",u.editFavourablemoney="";break;default:u.editFavourableMode="price",u.editFavourablepoint="",u.editFavourablemoney=""}})}),u.edit_out_color="",u.edit_out_color_glag=!0,u.edit_shoudong_color="",u.edit_out_color_glag1=!0,u.edit_in_color="",u.edit_in_color_glag=!0,u.edit_area="",u.edit_area1="",u.edit_area_flag=!0,u.edit_area_flag1=!0,u.edit_create_data="",u.edit_create_data_flag=!0,u.edit_model="",u.edit_model_ok_flag=!0,u.edit_car_type="",u.edit_car_type_flag=!0,u.edit_file="",u.edit_file_flag=!0,u.edit_show_price="",u.edit_show_price_flag=!0,u.edit_show_price1="",u.edit_show_price_flag1=!0,u.edit_provice_id=0,u.edit_provice_id1=0,u.editProviceName="",u.editProviceName1="",u.edit_city_id=0,u.edit_city_id1=0,u.editCityName="",u.editCityName1="";var s={},o={};function c(e){u.editAreaJoin="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo.cId,i=(e[t].data.cityInfo.cName,e[t].data.pId);e[t].data.pName;0!=t?u.editAreaJoin+="|"+i+","+a:u.editAreaJoin=i+","+a}u.editCityBtnShow=!0}function l(e){u.editAreaJoin1="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo1.cId1,i=(e[t].data.cityInfo1.cName1,e[t].data.pId1);e[t].data.pName1;0!=t?u.editAreaJoin1+="|"+i+","+a:u.editAreaJoin1=i+","+a}u.editCityBtnShow1=!0}u.editShowselectArea=[],u.editShowselectArea1=[],u.editCityList=[],u.editCityList1=[],u.editAreaJoin="",u.editAreaJoin1="",$("#resourceEditColor").selectpicker({noneSelectedText:"—请选择车型颜色—",tickIcon:"icon-ok",style:"btn-default",selectAllText:"选择全部",deselectAllText:"取消全选"}),u.editresData={brand_id:"",brand_name:"",sub_brand_id:"",sub_brand_name:"",model_picture:"",model_id:"",editModelName:"",edit_in_color:"",edit_out_color:"",edit_car_type:"",edit_create_data:"",edit_file:"",edit_model:"",edit_current_price:"",model_price:"",edit_extra:"",edit_current_price1:"",edit_area:"",edit_area1:"",resource_id:""};var m="",p="";function d(e){var t,a,i,r,n,s,o;console.log(e),u.editresData.resource_id=e.res.resourceId,u.editresData.brand_id=e.res.brandId,u.editresData.brand_name=e.res.brandName,u.editresData.sub_brand_id=e.res.subBrandId,u.editresData.sub_brand_name=e.res.subBrandName,u.editresData.model_picture=e.res.modelPicture,u.editresData.model_id=e.res.modelId,u.editresData.model_price=e.res.modelPrice,u.editresData.editModelName=e.res.modelName,u.editresData.edit_out_color=e.res.colors,u.editresData.edit_in_color=e.res.interior,1==e.res.carType?u.editresData.edit_car_type="现车":u.editresData.edit_car_type="期车",u.editresData.edit_create_data=e.res.manufactureTime,u.editresData.edit_file=e.res.attachment,u.editresData.edit_model=(t=e.res.endTime,a=(t=new Date(t)).getFullYear()+"-",i=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",r=(t.getDate()<10?"0"+t.getDate():t.getDate())+" ",n=(t.getHours()<10?"0"+t.getHours():t.getHours())+":",s=(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":",o=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds(),a+i+r+n+s+o),u.editresData.edit_create_data=e.res.manufactureTime,u.editresData.edit_current_price=e.res.salePrice/1e4+"万",u.editresData.edit_current_price1=e.res.frontPrice+"元",u.editresData.edit_extra=e.res.resourceExtra;for(var c=e.saleArea,l=[],d=0;d<c.length;d++)l.push(c[d].provinceName+"-"+c[d].cityName),0!=d?m+="|"+c[d].provinceId+","+c[d].cityId:m=c[d].provinceId+","+c[d].cityId;u.editresData.edit_area=l.toString(),u.editresData.edit_area1=e.sourceArea[0].provinceName+"-"+e.sourceArea[0].cityName,p=e.sourceArea[0].provinceId+","+e.sourceArea[0].cityId}function _(e){console.log(e),1==e.status&&(layer.msg(e.data,{icon:1,time:1500}),t(function(){u.jumpUrl("home.specialResourcesLists")},1500))}u.specialEdit=function(e,t,a){e.stopPropagation();var i={req_data:{method:"GET",url:BASEURL+"/res_v1_0_0/cms/special/res/detail?resource_id="+t,headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:d,requestError:specialRseource.errorData};httpRequestData.getData(i),u.dataPriceFlag=!1,u.edit_out_color_glag=!0,u.edit_in_color_glag=!0,u.edit_area_flag=!0,u.edit_area_flag1=!0,u.edit_create_data_flag=!0,u.edit_model_ok_flag=!0,u.edit_file_flag=!0,u.edit_show_price_flag=!0,u.edit_show_price_flag1=!0,u.edit_car_type_flag=!0,u.dataCreateFlag=!1,u.dataStateFlag=!1,u.dataTypeFlag=!1,u.edit_current_change_provice=!1,u.editTrimColor="",u.editShowselectArea=[],(u.editAreaJoin="")==u.modelLists.area_list&&u.edit_area,""==u.modelLists.area_list1&&u.edit_area1,u.editResourceSellerList=[],u.edit_area="",u.edit_area1="",u.current_index=a,u.editproviceData=u.pData,$("#modalEdit").modal(),r({method:"GET",url:BASEURL+"/api2/res/model/colors?modelid=117609&device=1",timeout:1e4}).success(function(e){1==e.status?(u.editColorData=e.list,function(e){var t=$(e).length;$("#resourceEditColor").find("option").remove();for(var a=0;a<t;a++)$("#resourceEditColor").append($("<option value="+e[a].id+" data-rgb="+e[a].rgb+">"+e[a].name+"</option>"));$("#resourceEditColor").selectpicker("refresh")}(u.editColorData)):layer.msg("请求失败",{icon:5})}).error(function(){})},u.editPrice=function(){u.edit_show_price_flag=!1,u.editfavourablepoint="",u.editfavourablemoney="",u.edit_sale_price="",u.dataPriceFlag=!0},u.editCreatData=function(){u.dataCreateFlag=!0,u.edit_create_data_flag=!1},u.editFile=function(){u.dataCreateFlag=!0,u.edit_file_flag=!1},u.editCarType=function(){u.edit_car_type_flag=!1,u.dataTypeFlag=!0},u.editPrice1=function(){u.edit_show_price_flag1=!1,u.dataCreateFlag=!0},u.edit_before_provice_id="",u.edit_before_provice_id1="",u.edit_before_city_id="",u.edit_before_city_id1="",u.edit_whole_province_list=[],u.edit_whole_province_list1=[],u.edit_current_change_provice="",u.edit_current_change_provice1="",u.edit_current_change_city="",u.edit_current_change_city1="",u.edit_first_send=!1,u.edit_first_send1=!1,u.editCityBtnShow=!0,u.editCityBtnShow1=!0,u.edit_has_add_money=!0,u.edit_has_add_point=!0,u.editRequsFlag=!1,u.editJiFlag=!0,u.editJiFlag1=!0,u.editSelectSellerState=!1,u.editSelectProvice=function(e,t){u.editResourceSellerList=[],u.edit_provice_id=t,u.editProviceName=$(e.currentTarget).text(),u.edit_current_change_provice=$(e.currentTarget).text(),u.edit_current_change_city="",(s={}).data={},s.data.cityInfo={},0!=t?0==u.edit_before_provice_id&&u.edit_first_send?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.editShowselectArea=[],u.edit_before_provice_id=t,s.data.pId=u.edit_provice_id,s.data.pName=u.editProviceName,u.editCityBtnShow=!0,c(u.editShowselectArea),r({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.editCityData=e.list,u.editCityData.unshift(n),u.editCityBtnShow=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(u.edit_before_provice_id=t,s.data.pId=u.edit_provice_id,s.data.pName=u.editProviceName,-1==$.inArray(u.edit_provice_id,u.edit_whole_province_list)?r({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.editCityData=e.list,u.editCityData.unshift(n),u.editCityBtnShow=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(u.editCityBtnShow=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===u.edit_before_provice_id?(u.edit_before_provice_id=t,u.edit_first_send=!0,s.data.pId=0,s.data.pName="全国",s.data.cityInfo.cId=0,s.data.cityInfo.cName=" ",u.edit_current_change_provice="全国",u.editShowselectArea.push(s),u.editCityBtnShow=!0,c(u.editShowselectArea)):0==u.edit_before_provice_id||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.edit_before_provice_id=t,u.editShowselectArea=[],s.data.pId=0,s.data.pName="全国",s.data.cityInfo.cId=0,s.data.cityInfo.cName=" ",u.edit_current_change_provice="全国",u.editShowselectArea.push(s),u.editCityBtnShow=!0,c(u.editShowselectArea),u.$apply(),u.edit_first_send=!0},function(e){layer.close(e)})},u.editSelectProvice1=function(e,t){u.editResourceSellerList1=[],u.edit_provice_id1=t,u.editProviceName1=$(e.currentTarget).text(),u.edit_current_change_provice1=$(e.currentTarget).text(),u.edit_current_change_city1="",(o={}).data={},o.data.cityInfo1={},0!=t?0==u.edit_before_provice_id1&&u.edit_first_send1?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.editShowselectArea1=[],u.edit_before_provice_id1=t,o.data.pId1=u.edit_provice_id1,o.data.pName1=u.editProviceName,u.editCityBtnShow1=!0,l(u.editShowselectArea1),r({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.editCityData1=e.list,u.editCityData1.unshift(n),u.editCityBtnShow1=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(u.edit_before_provice_id11=t,o.data.pId1=u.edit_provice_id1,o.data.pName1=u.editProviceName,-1==$.inArray(u.edit_provice_id1,u.edit_whole_province_list1)?r({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(u.editCityData1=e.list,u.editCityData1.unshift(n),u.editCityBtnShow1=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(u.editCityBtnShow1=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===u.edit_before_provice_id1?(u.edit_before_provice_id1=t,u.edit_first_send1=!0,o.data.pId1=0,o.data.pName1="全国",o.data.cityInfo1.cId1=0,o.data.cityInfo1.cName1=" ",u.edit_current_change_provice1="全国",u.editShowselectArea1=[],u.editShowselectArea1.push(o),u.editCityBtnShow1=!0,l(u.editShowselectArea1)):0==u.edit_before_provice_id1||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.edit_before_provice_id1=t,u.editShowselectArea1=[],o.data.pId1=0,o.data.pName1="全国",o.data.cityInfo1.cId1=0,o.data.cityInfo1.cName1=" ",u.edit_current_change_provice1="全国",u.editShowselectArea1=[],u.editShowselectArea1.push(o),u.editCityBtnShow1=!0,l(u.editShowselectArea1),u.$apply(),u.edit_first_send1=!0},function(e){layer.close(e)})},u.editSelectCity=function(e,a){s.data.cityInfo.cId="",s.data.cityInfo.cName="",-1==$.inArray(a,u.editCityList)&&(0!=a?(u.edit_before_city_id=a,u.editCityList.push(a),u.edit_city_id=a,u.editCityName=$(e.currentTarget).text(),u.edit_current_change_city=$(e.currentTarget).text(),s.data.cityInfo.cId=u.edit_city_id,s.data.cityInfo.cName=u.editCityName,u.editCityBtnShow=!0,u.editShowselectArea.push(s),c(u.editShowselectArea)):""==u.edit_before_city_id&&0!=u.edit_before_city_id?(s.data.pId=u.edit_provice_id,s.data.pName=u.editProviceName,s.data.cityInfo.cId=0,s.data.cityInfo.cName="全省",u.edit_current_change_city="全省",u.edit_whole_province_list.push(u.edit_provice_id),u.editShowselectArea.push(s),c(u.editShowselectArea)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+u.editProviceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.edit_before_city_id=a;for(var t=0;t<u.editShowselectArea.length;t++)u.editShowselectArea[t].data.pId==u.edit_provice_id&&(u.editShowselectArea.splice(t,1),t-=1);s.data.pId=u.edit_provice_id,s.data.pName=u.editProviceName,s.data.cityInfo.cId=0,s.data.cityInfo.cName="全省",u.edit_current_change_city="全省",u.edit_whole_province_list.push(u.edit_provice_id),u.editShowselectArea.push(s),c(u.editShowselectArea),u.$apply()},function(e){layer.close(e)}))},u.editSelectCity1=function(e,a){o.data.cityInfo1.cId1="",o.data.cityInfo1.cName1="",-1==$.inArray(a,u.editCityList1)&&(0!=a?(u.edit_before_city_id1=a,u.editCityList1.push(a),u.edit_city_id1=a,u.editCityName1=$(e.currentTarget).text(),u.edit_current_change_city1=$(e.currentTarget).text(),o.data.cityInfo1.cId1=u.edit_city_id1,o.data.cityInfo1.cName1=u.editCityName1,u.editCityBtnShow1=!0,console.log(u.editShowselectArea1),u.editShowselectArea1=[],u.editShowselectArea1.push(o),l(u.editShowselectArea1)):""==u.edit_before_city_id1&&0!=u.edit_before_city_id1?(o.data.pId1=u.edit_provice_id1,o.data.pName1=u.editProviceName1,o.data.cityInfo1.cId1=0,o.data.cityInfo1.cName1="全省",u.edit_current_change_city1="全省",u.edit_whole_province_list1.push(u.edit_provice_id1),u.editShowselectArea1=[],u.editShowselectArea1.push(o),l(u.editShowselectArea1)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+u.editProviceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),u.edit_before_city_id1=a;for(var t=0;t<u.editShowselectArea1.length;t++)u.editShowselectArea1[t].data.pId1==u.edit_provice_id1&&(u.editShowselectArea1.splice(t,1),t-=1);o.data.pId1=u.edit_provice_id1,o.data.pName1=u.editProviceName1,o.data.cityInfo1.cId1=0,o.data.cityInfo1.cName1="全省",u.edit_current_change_city1="全省",u.edit_whole_province_list1.push(u.edit_provice_id1),u.editShowselectArea1=[],u.editShowselectArea1.push(o),l(u.editShowselectArea1),u.$apply()},function(e){layer.close(e)}))},u.editRemoveEle=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;u.editShowselectArea.splice(t,1);for(var i=0;i<u.edit_whole_province_list.length;i++)if(u.edit_whole_province_list[i]==a){u.edit_whole_province_list.splice(i,1);break}u.editCityList.splice(t,1),0==u.editShowselectArea.length&&(u.edit_before_provice_id="",u.edit_before_city_id="",u.edit_whole_province_list=[]),c(u.editShowselectArea)},u.editRemoveEle1=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;u.editShowselectArea1.splice(t,1);for(var i=0;i<u.edit_whole_province_list1.length;i++)if(u.edit_whole_province_list1[i]==a){u.edit_whole_province_list1.splice(i,1);break}u.editCityList1.splice(t,1),0==u.editShowselectArea1.length&&(u.edit_before_provice_id1="",u.edit_before_city_id1="",u.edit_whole_province_list1=[]),l(u.editShowselectArea1)},u.editFavourableMoney=function(e){u.edit_has_add_money=-1==e},u.editFavourablePoint=function(e){u.edit_has_add_point=-1==e},u.$watch("editfavourablemoney",function(e,t){Math.ceil(e);e<0&&null!=e&&""!=e&&(layer.msg("输入的点数必须是数字，且不能小于0！",{time:1500}),u.editfavourablemoney="")}),u.$watch("editfavourablepoint",function(e,t){(100<Math.ceil(e)||e<0)&&null!=e&&""!=e&&(layer.msg("输入的点数必须是数字，且不能小于0或大于100！",{time:1500}),u.editfavourablepoint="")}),u.$watch("edit_sale_price",function(e,t){/[1-9][0-9]*/.test(e)||null==e||""==e||(layer.msg("输入的价格必须是数字，且不能小于0！",{time:1500}),u.edit_sale_price="")}),u.editColorList="",$("#resourceEditColor").on("changed.bs.select",function(e){u.dataColorFlag=!1;for(var t=u.editColorList="",a=e.currentTarget.selectedOptions,i=0;i<$(a).length;i++)0==i?(u.editColorList=a[i].textContent,t=a[i].textContent):(u.editColorList+="|"+a[i].textContent,t+="|"+a[i].textContent);u.colors=t}),u.provice_id=0,u.provice_id1=0,u.proviceName="",u.proviceName1="",u.city_id=0,u.city_id1=0,u.cityName="",u.cityName1="",u.showselectArea=[],u.showselectArea1=[],u.cityList=[],u.cityList1=[],u.areaJoin="",u.areaJoin1="",r({method:"GET",url:BASEURL+"/api2/area/provinces?device=1",timeout:1e4}).success(function(e){1==e.status?(u.proviceData=e.list,u.pData=e.list,u.proviceData.unshift(i)):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}),u.singleSave=function(e){var t={brand_id:"",brand_name:"",sub_brand_id:"",sub_brand_name:"",model_picture:"",model_id:"",model_name:"",colors:"",interior:"",car_type:"",manufacture_time:"",attachment:"",end_time:"",sale_price:"",model_price:"",resource_extra:"",front_price:"",area_list:"",source_area:"",resource_id:u.editresData.resource_id};if(t.brand_id=u.editresData.brand_id,t.brand_name=u.editresData.brand_name,t.sub_brand_id=u.editresData.sub_brand_id,t.sub_brand_name=u.editresData.sub_brand_name,t.model_picture=u.editresData.model_picture,t.model_id=u.editresData.model_id,t.model_name=u.editresData.editModelName,u.edit_out_color_glag?t.colors=u.editresData.edit_out_color:t.colors=$("#resourceEditColor").text(),u.edit_in_color_glag?t.interior=u.editresData.edit_in_color:u.interior=u.edit_in_color,u.dataTypeFlag?t.car_type=u.editcartype:"期车"==u.editresData.edit_car_type?t.car_type="2":t.car_type="1",u.dataCreateFlag?0==u.editManufacture?t.manufacture_time="一年以内":1==u.editManufacture?t.manufacture_time="半年内":2==u.editManufacture?t.manufacture_time="三个月内":t.manufacture_time="一年以上":0==u.editresData.edit_create_data?t.manufacture_time="一年以内":1==u.editresData.edit_create_data?t.manufacture_time="半年内":2==u.editresData.edit_create_data?t.manufacture_time="三个月内":t.manufacture_time="一年以上",u.dataStateFlag?0==u.editattachment?t.attachment="随车发":1==u.editattachment?t.attachment="3天内发":2==u.editattachment?t.attachment="7天内发":t.attachment="":"随车发"==u.editresData.edit_file?t.attachment="随车发":"3天内发"==u.editresData.edit_file?t.attachment="3天内发":"7天内发"==u.editresData.edit_file?t.attachment="7天内发":t.attachment="",u.edit_model_ok_flag)t.end_time=Date.parse(new Date(u.editresData.edit_model));else{var a=angular.element("#edit_expiration_date").val().toString().replace(/-/g,"/");t.end_time=Date.parse(new Date(a))}var i=parseFloat(u.editresData.model_price);u.edit_show_price_flag?t.sale_price=u.editresData.edit_current_price.replace("万",""):"money"==u.editFavourableMode?(""==u.editfavourablemoney&&(u.editfavourablemoney=0),u.edit_has_add_money?t.sale_price=1e4*(i-parseFloat(u.editfavourablemoney)):t.sale_price=1e4*(i+parseFloat(u.editfavourablemoney))):"point"==u.editFavourableMode?(""==u.editfavourablepoint&&(u.editfavourablepoint=0),u.edit_has_add_point?t.sale_price=1e4*(i-i*parseFloat(u.editfavourablepoint)/100):t.sale_price=1e4*(i+i*parseFloat(u.editfavourablepoint)/100)):"price"==u.editFavourableMode?t.sale_price=1e4*u.edit_sale_price:u.editJiFlag=!1,t.model_price=u.editresData.model_price,t.resource_extra=u.editresData.edit_extra,u.edit_show_price_flag1?t.front_price=u.editresData.edit_current_price1.replace("元","")/1e5:t.front_price=u.front_price,u.edit_area_flag?t.area_list=m:t.area_list=u.editAreaJoin,u.edit_area_flag1?t.source_area=p:t.source_area=u.editAreaJoin1,t.resource_extra=u.editresData.edit_extra;var r={req_data:{method:"POST",url:BASEURL+"/res_v1_0_0/cms/special/res/update",params:t,headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:_,requestError:specialRseource.errorData};httpRequestData.getData(r),$("#modalEdit").modal("hide")}}]),app.controller("featuredResourcesListsCtrl",["$scope","httpRequestData","$timeout","$state","$stateParams",function(o,t,e,r,c){var a="",i=function(){var a=this;this.getListUrl=BASEURL+"/cms2/resource/plan/new/query?device=1",this.carSubBrandUrl=BASEURL+"/api2/res/brand",this.carModelUrl=BASEURL+"/api2/res/model",this.defaults={page_index:1,page_size:10,brand_id:"",subrand_id:"",modle_id:"",type:"",time:""},o.changeType=function(){a.defaults.type=o.type},o.changeCarBrand=function(){a.defaults.brand_id=o.brand_id},o.changeSubBrand=function(){a.defaults.subrand_id=o.subrand_id},o.changeModel=function(){a.defaults.modle_id=o.modle_id},o.search=function(){a.defaults.page_index=1,r.go("home.featuredResourcesLists",a.defaults)},o.listDetail=function(e){o.showListDetail=o.resourceLists[e],$("#listDetail").modal("show")},o.listEdit=function(e,t,a){var i={type:e,id:t};a?($("#listDetail").modal("hide"),$("#listDetail").on("hidden.bs.modal",function(e){r.go("home.releaseFeaturedResources",i)})):r.go("home.releaseFeaturedResources",i)},o.listDelete=function(e){console.log(e)},o.changePageUrl=function(e){a.defaults.page_index=o.getPageIndex(e,o.pageNumber,o.pageCount),r.go("home.featuredResourcesLists",a.defaults)},$("#end_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){var t=a.selectData();a.defaults.time=t})};i.prototype={init:function(){this.getDataFromUrl(),this.getResourceLists(),this.getCarBrandLists()},setCarBrandLists:function(e){layer.close(a),1==e.status?o.carBrandLists=e.list:this.dataError(e.msg)},getCarBrandLists:function(){var e={req_data:{url:CAR_BRAND_URL},requestSuccess:this.setCarBrandLists,requestError:this.requestError};a=layer.load(1),t.getData(e)},getDataFromUrl:function(){var e=c.page_index,t=c.page_size,a=c.brand_id,i=c.subrand_id,r=c.modle_id,n=c.type,s=c.time;c.page_index||(e=1),c.page_size||(t=10),c.brand_id||(a=""),c.subrand_id||(i=""),c.modle_id||(r=""),c.type||(n=""),c.time||(s=""),this.defaults.page_index=e,this.defaults.page_size=t,this.defaults.brand_id=a,this.defaults.subrand_id=i,this.defaults.modle_id=r,this.defaults.type=n,this.defaults.time=s,o.type=n,o.brand_id=a,o.subrand_id=i,o.modle_id=r,s&&(o.end_time=o.end_time=this.getLocalTime(s).replace(/\//g,"-"))},getResourceLists:function(){var e={req_data:{url:this.getListUrl,params:this.defaults},requestSuccess:this.setResourceLists,requestError:this.requestError};a=layer.load(1),t.getData(e)},setResourceLists:function(e){layer.close(a),1==e.status?(o.resourceLists=e.list,o.pageNumber=e.page.pageNumber,o.recordCount=e.page.recordCount,o.pageCount=e.page.pageCount,o.pageSize=e.page.pageSize,o.pageList=o.pageNum(o.pageCount,o.pageNumber),o.startData=0==o.recordCount?0:(o.pageNumber-1)*o.pageSize+1,o.endData=e.list.length<o.pageSize?(o.pageNumber-1)*o.pageSize+e.list.length:o.pageNumber*o.pageSize):this.dataError(e.msg)},requestError:function(){layer.close(a),layer.msg("请求数据失败",{icon:5})},dataError:function(e){layer.close(a);var t=e;e||(t="数据格式错误"),layer.msg(t)},selectData:function(){return o.end_time?Date.parse(o.end_time.replace(/-/g,"/")):""},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]}},(new i).init()}]),app.controller("FinanciaLabelListCtrl",["$scope","$stateParams","$state","$timeout","httpRequestData","$http",function(n,s,a,e,r,t){var i=!1,o={province_url:"/api2/area/provinces?device=1",city_url:"/api2/area/cities?device=1",brand_url:"/api2/res/brand/?device=1",list_url:"/res_v1_0_0/cms/policy/datas?out=json",delete_url:"/res_v1_0_0/cms/policy/delete?out=json",listsSendData:{page_index:1,page_size:10,province_id:"",city_id:"",brand_id:"",policy_detail:""},requestError:function(){layer.close(tip),layer.msg("数据请求失败",{icon:5,time:2e3})},getDataFromUrl:function(){var e=s.page_index,t=s.province_id,a=s.city_id,i=s.brand_id,r=s.policy_detail;e||(e=1),n.page_index=e,n.province_id=t,n.city_id=a,n.brand_id=i,n.policy_detail=r,this.listsSendData={page_index:e,page_size:10,province_id:t,city_id:a,brand_id:i,policy_detail:r}},selectData:function(){this.listsSendData.province_id=n.province_id,this.listsSendData.city_id=n.city_id,this.listsSendData.area_id=n.area_id,this.listsSendData.brand_id=n.brand_id,this.listsSendData.policy_detail=n.policy_detail,a.go("home.FinanciaLabelList",this.listsSendData)},getBranduList:function(){var e={req_data:{url:BASEURL+this.brand_url},requestSuccess:this.setBranduList,requestError:this.requestError};r.getData(e)},setBranduList:function(e){1==e.status&&(n.manu_list=e.list)},getProvinceList:function(){var e={req_data:{url:BASEURL+this.province_url},requestSuccess:this.setProvinceList,requestError:this.requestError};r.getData(e)},setProvinceList:function(e){1==e.status&&(n.province_list=e.list)},getCityList:function(e){var t={req_data:{url:BASEURL+this.city_url,params:{province:e}},requestSuccess:this.setCityList,requestError:this.requestError};r.getData(t)},setCityList:function(e){1==e.status&&(n.city_list=e.list)},getFinalList:function(){tip=layer.load(1);var e={req_data:{url:BASEURL+this.list_url,params:this.listsSendData},requestSuccess:this.setFinalList,requestError:this.requestError};r.getData(e)},setFinalList:function(e){console.log(e),layer.close(tip),1==e.status?(n.finanicalData=e.list,console.log(n.finanicalData),n.pageNumber=e.page.pageNumber,n.recordCount=e.page.recordCount,n.pageCount=e.page.pageCount,n.pageSize=e.page.pageSize,n.pageList=n.pageNum(n.pageCount,n.pageNumber),n.startData=0==n.recordCount?0:(n.pageNumber-1)*n.pageSize+1,n.endData=e.list.length<n.pageSize?(n.pageNumber-1)*n.pageSize+e.list.length:n.pageNumber*n.pageSize):layer.msg("请求失败",{icon:5})},delete:function(a){var i=this;layer.confirm("确定删除选此金融标签？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0,anim:4},function(e){var t={req_data:{url:BASEURL+i.delete_url+"&finance_id="+a,method:"POST"},requestSuccess:i.successFn,requestError:i.requestError};r.getData(t)},function(e){layer.close(e)})},successFn:function(e){console.log(e),1==e.status&&(layer.msg(e.data,{icon:1,time:1500}),o.getFinalList())},init:function(){this.getDataFromUrl(),this.getFinalList(),this.getBranduList()}};o.init(),o.getProvinceList(),null!=s.province_id?(o.getCityList(n.province_id),n.city_id=s.city_id):(n.city_id="",n.city_list=[]),n.changeProvince=function(){n.city_id="",n.city_list=[],o.selectData()},n.changeCity=function(){o.selectData()},n.changeBrand=function(){o.selectData()},n.search_policy=function(){o.selectData()},n.$watch("policy_detail",function(){i&&""==n.policy_detail&&o.selectData(),i=!0}),n.changePageUrl=function(e){o.listsSendData.page_index=n.getPageIndex(e,n.pageNumber,n.pageCount),a.go("home.FinanciaLabelList",o.listsSendData)},n.deleteFinanical=function(e){e&&o.delete(e)},n.editFinanical=function(e,t){a.go("home.addFinanciaLabel",{financeid:e})}}]),app.controller("infoCtrl",["$http","$scope","$stateParams","$state","$timeout","$window",function(r,i,a,t,n,s){i.infoData="",i.old_dir_name="";var o={page_index:1};i.getInfoList=function(e){var t=layer.msg("加载中...",{icon:16,time:0});null==a.page_index?e.page_index=1:e.page_index=a.page_index,r({method:"GET",url:BASEURL+"/cms2/counseldir/getall?device=1&page_size=10",params:e}).success(function(e){layer.close(t),1==e.status?(i.infoData=e.list,i.pageNumber=e.page.pageNumber,i.recordCount=e.page.recordCount,i.pageCount=e.page.pageCount,i.pageSize=e.page.pageSize,i.pageList=i.pageNum(i.pageCount,i.pageNumber),i.startData=0==i.recordCount?0:(i.pageNumber-1)*i.pageSize+1,i.endData=e.list.length<i.pageSize?(i.pageNumber-1)*i.pageSize+e.list.length:i.pageNumber*i.pageSize):layer.msg("请求失败",{icon:5})}).error(function(e){})},i.getInfoList(o),i.changePageUrl=function(e){o.page_index=i.getPageIndex(e,i.pageNumber,i.pageCount),t.go("home.info",o)},i.addinfo=function(){var e=$("#name").val();if(!/^[\u4E00-\u9FA5]+$/.test($.trim(e)))return alert("请输入中文"),!1;r({method:"POST",url:BASEURL+"/cms2/counseldir/add?device=1",params:{name:i.name}}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),n(function(){$("#info-model").modal("hide"),i.getInfoList(o)},1500)):layer.msg(e.msg,{icon:5,time:1e3})})},i.infoDelete=function(a){layer.confirm("确认是否删除？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e);var t=layer.msg("数据提交中...",{icon:16,time:0});r({method:"POST",url:BASEURL+"/cms2/counseldir/delete?device=1",params:{dir_id:a}}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),i.getInfoList(o)):layer.msg(e.msg,{icon:5,time:1500})})},function(e){layer.close(e)})},i.editInfoname=function(e,t){i.current_index=e,i.old_dir_name=i.infoData[e].dir_name,$(t.currentTarget).parents("tr").find("input[name=dir_name]").val(i.infoData[e].dir_name)},i.cancelInfoname=function(e){i.current_index=-1,""==$(e.currentTarget).parents("tr").find("input[name=dir_name]").val().trim()&&$(e.currentTarget).parents("tr").find("input[name=dir_name]").val(i.old_dir_name)},i.saveInfoname=function(e){var t=layer.msg("加载中...",{icon:16,time:0}),a=$(e.currentTarget).parents("tr").find("input[name=dir_id]").val().trim(),i=$(e.currentTarget).parents("tr").find("input[name=dir_name]").val().trim();""==i?layer.msg("请填写完整的信息，再点击！",{time:1500}):r({method:"POST",url:BASEURL+"/cms2/counseldir/edit?device=1",params:{dir_id:a,name:i}}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),n(function(){s.location.reload()},1500)):layer.msg(e.msg,{icon:5,time:1500})}).error(function(){})}}]),app.controller("handle4sCtrl",["$http","$scope","$stateParams","$state","$timeout",function(i,r,a,t,e){r.handle4sData="";var n={page_index:1};r.getHandle4sList=function(e){null==a.page_index?e.page_index=1:e.page_index=a.page_index;var t=layer.msg("加载中...",{icon:16,time:0});i({method:"GET",url:BASEURL+"/cms2/supplier/temporary?device=1&page_size=10",params:e}).success(function(e){layer.close(t),1==e.status?(r.handle4sData=e.list,r.pageNumber=e.page.pageNumber,r.recordCount=e.page.recordCount,r.pageCount=e.page.pageCount,r.pageSize=e.page.pageSize,r.pageList=r.pageNum(r.pageCount,r.pageNumber),r.startData=0==r.recordCount?0:(r.pageNumber-1)*r.pageSize+1,r.endData=e.list.length<r.pageSize?(r.pageNumber-1)*r.pageSize+e.list.length:r.pageNumber*r.pageSize):layer.msg("请求失败",{icon:5})}).error(function(e){})},r.getHandle4sList(n),r.changePageUrl=function(e){n.page_index=r.getPageIndex(e,r.pageNumber,r.pageCount),t.go("home.handle4s",n)},r.handle4sDelete=function(a){layer.confirm("确认是否处理完成？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e);var t=layer.msg("数据提交中...",{icon:16,time:0});i({method:"POST",url:BASEURL+"/cms2/supplier/temporary/"+a+"?device=1"}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),r.getHandle4sList(n)):layer.msg(e.msg,{icon:5,time:1500})})},function(e){layer.close(e)})}}]),app.controller("buyInsuranceCtrl",["$scope","$http","$stateParams","$window","httpData","httpRequestData",function(a,e,t,i,r,n){var s=layer.load(1);a.imgUrl=imgUrl,{detail_url:"/cms2/insurace/getByOrderSeq?device=1",errorData:function(){layer.close(s),layer.msg("请求失败",{icon:5,time:1500})},getUserDetail:function(){r.getData("GET",this.detail_url,{orderSeq:t.orderSeq},this.setDetail,this.errorData)},setDetail:function(e){layer.close(s),a.insuranceDetail=e.data},init:function(){this.getUserDetail()}}.getUserDetail();var o={subBrandUrl:"/api2/res/brand/",modelUrl:"/api2/res/model/",init:function(){this.getBrand()},getBrand:function(){var e={req_data:{method:"GET",url:CAR_BRAND_URL},requestSuccess:function(e){layer.close(s),1==e.status&&(a.brand_list=e.list)},requestError:this.httpError};n.getData(e)},getSubBrand:function(e){var t={req_data:{method:"GET",url:BASEURL+this.subBrandUrl+e+"?device=1"},requestSuccess:function(e){1===e.status&&(a.sub_brand_list=e.list)},requestError:this.httpError};n.getData(t)},getModel:function(e){var t={req_data:{method:"GET",url:BASEURL+this.modelUrl+a.brand.id+"/"+e+"?device=1"},requestSuccess:function(e){1==e.status&&(a.model_list=e.list)},requestError:this.httpError};n.getData(t)},stateError:function(e){layer.close(s),a.has_clicked=!1,layer.msg(e)},httpError:function(){layer.close(s),a.has_clicked=!1,layer.msg("请求失败",{icon:5})},uploadWarrantyImgBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},uploadWarrantyImgSuccess:function(e){if(layer.closeAll("dialog"),1==e.status){var t=e.data[0].normal;a.warrantyImg=imgUrl+t,a.policy=t,a.$apply()}else layer.msg("上传失败")}};o.init(),angular.element("#warrantyInput").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:o.uploadWarrantyImgBefore,success:o.uploadWarrantyImgSuccess,xhrFields:{withCredentials:!0}};angular.element("#warrantyForm").ajaxSubmit(e)}),$("#startDate").datetimepicker({format:"yyyy-mm-dd hh:ii"}).on("changeDate",function(e){}),a.changeBrand=function(){a.sub_brand_list="",a.subrand="",a.modle="",a.model_list="",a.brand.id&&o.getSubBrand(a.brand.id)},a.changeSubBrand=function(){a.model_list="",a.modle="",a.subrand.id&&o.getModel(a.subrand.id)},a.cancel=function(){history.back()},a.save=function(){if(a.brand)if(a.subrand)if(a.modle)if(a.engineNumber)if(a.frameNumber)if(a.effective_date)if(a.policy){var e={orderSeq:t.orderSeq,brandId:a.brand.id,brandName:a.brand.name,subBrandId:a.subrand.id,subBrandName:a.subrand.name,modelId:a.modle.id,modelName:a.modle.name,effective_date:a.effective_date+":00",policy:a.policy,frameNumber:a.frameNumber,engineNumber:a.engineNumber};r.getData("POST","/cms2/insurace/buy?device=1",e,function(e){1==e.status?layer.msg("提交成功",{icon:1,end:function(){a.jumpUrl("home.insuranceList")}}):layer.msg(e.msg,{icon:5})},function(){})}else layer.msg("请上传保单照片",{icon:5});else layer.msg("请选择生效时间",{icon:5});else layer.msg("请输入车架号",{icon:5});else layer.msg("请输入发动机号",{icon:5});else layer.msg("请选择车型",{icon:5});else layer.msg("请选择车系",{icon:5});else layer.msg("请选择汽车品牌",{icon:5})}}]),app.controller("insuranceDetailCtrl",["$scope","$http","$stateParams","$window","httpData",function(a,i,e,r,t){var n=layer.load(1);({detail_url:"/cms2/insurace/getByOrderSeq?device=1",errorData:function(){layer.close(n),layer.msg("请求失败",{icon:5,time:1500})},getUserDetail:function(){t.getData("GET",this.detail_url,{orderSeq:e.orderSeq},this.setDetail,this.errorData)},setDetail:function(e){layer.close(n),a.insuranceDetail=e.data},init:function(){this.getUserDetail()}}).getUserDetail(),{detail_url:"//cms2/insuraceLog/list?device=1",errorData:function(){},getLogs:function(){t.getData("GET",this.detail_url,{orderSeq:e.orderSeq},this.setDetail,this.errorData)},setDetail:function(e){a.logs=e.datas},init:function(){this.getLogs()}}.getLogs(),a.pass=function(e,t){i({method:"POST",url:BASEURL+"/cms2/insurace/auditMaterial",timeout:1e4,params:{type:e,device:1,orderSeq:t}}).success(function(e){1==e.status&&layer.msg(e.msg,{icon:1,time:1500})}).error(function(e){}),r.location.reload()},a.auditFaileMaterial=function(e,t){""!=a.remark&&null!=a.remark?i({method:"POST",url:BASEURL+"/cms2/insurace/auditMaterial",timeout:1e4,params:{type:e,msg:a.remark,device:1,orderSeq:t}}).success(function(e){1==e.status&&layer.msg(e.msg,{icon:1,time:1500}),$("#notadopt").modal("hide"),r.location.reload()}).error(function(e){}):alert("原因必填")},a.passRefund=function(e,t){i({method:"POST",url:BASEURL+"/cms2/insurace/refund",timeout:1e4,params:{type:e,device:1,orderSeq:t}}).success(function(e){1==e.status&&layer.msg(e.msg,{icon:1,time:1500})}).error(function(e){}),r.location.reload()},a.rejectRefund=function(e,t){""!=a.remark&&null!=a.remark?i({method:"POST",url:BASEURL+"/cms2/insurace/refund",timeout:1e4,params:{type:e,remark:a.remark,device:1,orderSeq:t}}).success(function(e){1==e.status&&layer.msg(e.msg,{icon:1,time:1500}),$("#notadopt").modal("hide"),r.location.reload()}).error(function(e){}):alert("原因必填")},a.buyFailedRefund=function(e){""!=a.remark&&null!=a.remark?i({method:"POST",url:BASEURL+"/cms2/insurace/buyFailure",timeout:1e4,params:{msg:a.remark,device:1,orderSeq:e}}).success(function(e){1==e.status&&layer.msg(e.msg,{icon:1,time:1500}),$("#notadopt").modal("hide"),r.location.reload()}).error(function(e){}):alert("原因必填")}}]),app.controller("invoiceCtrl",["$http","$scope","requestData","$timeout","$stateParams","$state",function(a,i,e,t,r,n){var s={pageIndex:"",pageSize:10,startDate:"",endDate:"",keywords:"",orderType:"",device:1};i.getInvoiceList=function(e){null==r.pageIndex?e.pageIndex=1:e.pageIndex=r.pageIndex;var t=layer.msg("加载中...",{icon:16,time:0});console.log(e),a({method:"GET",url:BASEURL+"/cms2/invoice/list",params:e}).success(function(e){console.log(e),layer.close(t),1==e.status?(i.invoiceList=e.list,i.pageNumber=e.page.pageNumber,i.recordCount=e.page.recordCount,i.pageCount=e.page.pageCount,i.pageSize=e.page.pageSize,i.pageList=i.pageNum(i.pageCount,i.pageNumber),i.startData=0==i.recordCount?0:(i.pageNumber-1)*i.pageSize+1,i.endData=e.list.length<i.pageSize?(i.pageNumber-1)*i.pageSize+e.list.length:i.pageNumber*i.pageSize):layer.msg("请求失败",{icon:5})}).error(function(e){})},i.getInvoiceList(s),$("#startDate").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){console.log(i.startDate),s.startDate=i.startDate,i.getInvoiceList(s)}),$("#endDate").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){s.endDate=i.endDate,i.getInvoiceList(s)}),i.typeChange=function(){s.orderType=i.orderType,i.getInvoiceList(s)},i.invoice_search=function(){s.keywords=i.keywords,i.getInvoiceList(s)},i.changePageUrl=function(e){s.pageIndex=i.getPageIndex(e,i.pageNumber,i.pageCount),n.go("home.invoice",s)}}]),app.controller("invoiceDetailCtrl",["$http","$scope","requestData","$timeout","$stateParams","$state",function(t,a,e,i,r,n){a.invoiceDetail="",console.log(r),a.getInvoiceDetail=function(e){t({method:"GET",url:BASEURL+"/cms2/invoice/getInvoiceByCode?device=1&invoiceCode="+e}).success(function(e){a.invoiceDetail=e.data}).error(function(e){layer.msg("请求失败",{icon:5})})},a.getInvoiceDetail(r.invoiceCode)}]),app.controller("justRentListsCtrl",["$scope","$stateParams","$state","$timeout","httpRequestData","dateConversion",function(n,s,a,e,r,o){var i=layer.load(1);n.has_clicked=!1,n.resource_list=[];var c={brandUrl:"/api2/res/brand?device=1",subBrandUrl:"/api2/res/brand/",modelUrl:"/api2/res/model/",resource_url:"/res_v1_0_0/cms/rent/res/datas?out=json",del_res_url:"/res_v1_0_0/cms/rent/res/delete?out=json",res_detail_url:"/res_v1_0_0/cms/rent/res/detail?out=json",plan_detail_url:"/cms2/finance/program/calculationg?device=1",listsSendData:{page_index:1,page_size:10,brand_id:"",subrand_id:"",modle_id:"",end_time:""},init:function(){this.getResourceList(),this.getDataFromUrl(),this.getBrand()},stateError:function(e){layer.close(i),n.has_clicked=!1,layer.msg(e)},httpError:function(){layer.close(i),n.has_clicked=!1,layer.msg("请求失败",{icon:5})},getResourceList:function(){var e={req_data:{method:"GET",url:BASEURL+c.resource_url,params:this.listsSendData},requestSuccess:this.setResourceList,requestError:this.httpError};r.getData(e)},recResourceData:function(e){var n=[];return angular.forEach(e,function(e,t){var a=e,i=o.sTot(a.endTime/1e3),r="未发布";o.ns()>a.endTime?r="已过期":1==a.state&&(r="已发布"),a.currentStateTxt=r,a.endTimeTxt=i,n.push(a)}),n},setResourceList:function(e){if(layer.close(i),1==e.status){var t=e;n.resource_list=t.list,n.pageNumber=t.page.pageNumber,n.recordCount=t.page.recordCount,n.pageCount=t.page.pageCount,n.pageSize=t.page.pageSize,n.pageList=n.pageNum(n.pageCount,n.pageNumber),n.startData=0==n.recordCount?0:(n.pageNumber-1)*n.pageSize+1,n.endData=t.list.length<n.pageSize?(n.pageNumber-1)*n.pageSize+t.list.length:n.pageNumber*n.pageSize}else c.stateError(t.msg)},getBrand:function(){top;var e={req_data:{method:"GET",url:BASEURL+this.brandUrl},requestSuccess:this.setBrand,requestError:this.httpError};r.getData(e)},setBrand:function(e){1==e.status&&(n.brand_list=e.list)},getSubBrand:function(e){top;var t={req_data:{method:"GET",url:BASEURL+this.subBrandUrl+e+"?device=1"},requestSuccess:this.setSubBrand,requestError:this.httpError};r.getData(t)},setSubBrand:function(e){1==e.status?n.sub_brand_list=e.list:c.stateError(e.msg)},getModel:function(e){top;var t={req_data:{method:"GET",url:BASEURL+this.modelUrl+n.brand_id+"/"+e+"?device=1"},requestSuccess:this.setModel,requestError:this.httpError};r.getData(t)},setModel:function(e){1==e.status?n.model_list=e.list:c.stateError(e.msg)},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]},getDataFromUrl:function(){var e=s.page_index,t=(s.page_size,s.brand_id),a=s.subrand_id,i=s.modle_id,r=s.end_time;e||(e=1),n.brand_id=t,n.subrand_id=a,n.modle_id=i,r&&(n.end_time=o.sTot(r/1e3,"date")),this.listsSendData.page_index=e,this.listsSendData.page_size=10,this.listsSendData.brand_id=t,this.listsSendData.subrand_id=a,this.listsSendData.modle_id=i,this.listsSendData.end_time=r},selectData:function(){this.listsSendData.brand_id=n.brand_id,this.listsSendData.subrand_id=n.subrand_id,this.listsSendData.modle_id=n.modle_id,this.listsSendData.end_time=n.time_stamps,a.go("home.justRentLists",this.listsSendData)},showDetail:function(e){console.log(e),1==e.status?(n.showDetail=e.data,angular.element("#showResourceDetail").modal()):c.stateError(data.msg)},getDetaile:function(e){top;var t={req_data:{method:"GET",url:BASEURL+c.res_detail_url,params:{resource_id:e}},requestSuccess:this.showDetail,requestError:this.httpError};r.getData(t)},getPlanIds:function(){var a=[];return angular.forEach(n.showDetail.finance,function(e,t){a.push(e.id)}),a.join(",")},getPlanDetai:function(e){var t={price_bill:n.fares,price_sale:n.sale_price,tax:n.engine_num,finance_ids:e},a={req_data:{url:BASEURL+this.plan_detail_url,params:t},requestSuccess:c.setPlanDetail,requestError:c.httpError};r.getData(a)},setPlanDetail:function(e){1==e.status?n.planDetail=e.data:c.stateError(data.msg)},delSuccess:function(e){1==e.status?(layer.msg("操作成功",{icon:1,time:1500}),c.getResourceList()):c.stateError(e.msg)}};c.init(),null!=s.brand_id?(c.getSubBrand(s.brand_id),n.subrand_id=s.subrand_id):(n.sub_brand_list="",n.subrand_id="",n.modle_id="",n.model_list=""),null!=s.subrand_id?(c.getModel(s.subrand_id),n.model_id=s.model_id):(n.model_list="",n.modle_id=""),n.changeBrand=function(){n.sub_brand_list="",n.subrand_id="",n.modle_id="",n.model_list="",c.selectData()},n.changeSubBrand=function(){n.model_list="",n.modle_id="",c.selectData()},n.changeModel=function(){c.selectData()},$("#end_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){n.end_time?n.time_stamps=c.listsSendData.end_time=o.tTos(n.end_time):n.time_stamps=c.listsSendData.end_time="",c.selectData()}),n.changePageUrl=function(e){c.listsSendData.page_index=n.getPageIndex(e,n.pageNumber,n.pageCount),a.go("home.justRentLists",c.listsSendData)},n.deleteResource=function(i){layer.confirm("确定删除该资源？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e);var t={resource_id:i},a={req_data:{method:"POST",url:BASEURL+c.del_res_url,params:t},requestSuccess:c.delSuccess,requestError:c.httpError};r.getData(a)},function(e){layer.close(e)})},n.editResource=function(e){var t={id:e};a.go("home.releaseJustRentProgram",t)},n.getResourceDetail=function(e){e&&c.getDetaile(e)},n.changePlan=function(e,t){if(e.preventDefault(),$(this).tab("show"),2==t){var a=c.getPlanIds();n.fares=n.showDetail.res.modelPrice,n.sale_price=n.showDetail.res.salePrice,n.engine_num=parseFloat(n.showDetail.res.modleEngine),c.getPlanDetai(a)}},n.Refresh=function(){c.init()}}]),app.controller("justRentProgramCtrl",["$scope","$http","$stateParams","$state","$timeout","httpRequestData","dateConversion",function(c,e,l,t,a,i,d){var r=function(){this.company_url="/cms2/company/datas?device=1&co_type=4",this.program_lists_url="/res_v1_0_0/cms/finance/program/datas?out=json",this.del_program_list_url="/res_v1_0_0/cms/finance/program/delete?out=json",this.program_detail_url="/res_v1_0_0/cms/finance/program/detail?out=json",this.default_datas={page_index:1,page_size:10,compamu_id:"",name:"",province_id:"",last_time:"",finance_type:1}};r.prototype={getDataFromUrl:function(){var e=this,t=l.page_index,a=l.page_size,i=l.compamu_id,r=l.name,n=l.province_id,s=l.last_time,o=l.finance_type;t||(t=1),a||(a=10),i||(i=""),n||(n=""),r||(r=""),o||(o=1),s?c.end_time=d.sTot(s/1e3):(s="",c.end_time=""),c.provice_id=parseInt(n),c.company_id=parseInt(i),c.plan_name=r,e.default_datas.page_index=t,e.default_datas.page_size=a,e.default_datas.compamu_id=i,e.default_datas.name=r,e.default_datas.province_id=n,e.default_datas.last_time=s,e.default_datas.finance_type=o},programLists:function(){layer.load(1);var e=this,t={req_data:{method:"GET",url:BASEURL+e.program_lists_url,params:e.default_datas},requestSuccess:e.setProgramList.bind(e),requestError:e.httpError.bind(e)};i.getData(t)},setProgramList:function(e){if(r.call(this),layer.closeAll("loading"),1==e.status){var t=e;c.programData=t.list,c.pageNumber=t.page.pageNumber,c.recordCount=t.page.recordCount,c.pageCount=t.page.pageCount,c.pageSize=t.page.pageSize,c.pageList=c.pageNum(c.pageCount,c.pageNumber),c.startData=0==c.recordCount?0:(c.pageNumber-1)*c.pageSize+1,c.endData=t.list.length<c.pageSize?(c.pageNumber-1)*c.pageSize+t.list.length:c.pageNumber*c.pageSize}else this.stateError(e.data)},stateError:function(e){layer.closeAll("loading"),c.has_clicked=!1,layer.msg(e)},httpError:function(){layer.closeAll("loading"),layer.msg("请求失败",{icon:5})},delSuccess:function(e){layer.closeAll("loading");var t=this;1==e.status?(layer.msg("操作成功",{icon:1,time:1500}),a(function(){t.init()},1600)):t.stateError(e.data)},setProgramDetail:function(e){layer.closeAll("loading");1==e.status?(c.seeProgrammeData=e.data,$("#prevProgramme").modal("show")):this.stateError(e.data)},proviceLists:function(){layer.load(1);var e={req_data:{method:"GET",url:PROVINCE_URL},requestSuccess:this.setProvice.bind(this),requestError:this.httpError.bind(this)};i.getData(e)},setProvice:function(e){layer.closeAll("loading");1==e.status?c.proviceLists=e.list:this.stateError(e.data)},companyList:function(){layer.load(1);var e=this,t={req_data:{method:"GET",url:BASEURL+e.company_url},requestSuccess:e.setCompanyList.bind(e),requestError:e.httpError.bind(e)};i.getData(t)},setCompanyList:function(e){layer.closeAll("loading");1==e.status?c.financialCompanyList=e.list:this.stateError(e.data)},reloadPage:function(){this.default_datas.page_index=1,t.go("home.justRentProgram",this.default_datas)},init:function(){this.getDataFromUrl(),this.programLists(),this.proviceLists(),this.companyList()}};var n=new r;n.init(),c.changePageUrl=function(e){n.default_datas.page_index=c.getPageIndex(e,c.pageNumber,c.pageCount),n.reloadPage()},c.deleteProgram=function(a){layer.confirm("确认删除该方案？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e);var t={req_data:{method:"POST",url:BASEURL+n.del_program_list_url,params:{ids:a}},requestSuccess:n.delSuccess.bind(n),requestError:n.httpError.bind(n)};layer.load(1),i.getData(t)},function(e){layer.close(e)})},c.getProgramDetail=function(e){var t={req_data:{method:"GET",url:BASEURL+n.program_detail_url,params:{id:e}},requestSuccess:n.setProgramDetail.bind(n),requestError:n.httpError.bind(n)};layer.load(1),i.getData(t)},c.selProvice=function(){c.provice_id||(c.provice_id=""),n.default_datas.province_id=c.provice_id,n.reloadPage()},$("#end_time").datetimepicker({format:"yyyy-mm-dd hh:ii",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){c.end_time?n.default_datas.last_time=d.tTos(c.end_time):(c.end_time="",n.default_datas.last_time=""),n.reloadPage()}),c.selProgram=function(){c.company_id||(c.company_id=""),n.default_datas.compamu_id=c.company_id,n.reloadPage()},c.$watch("plan_name",function(){c.plan_name||(c.plan_name=""),n.default_datas.name=c.plan_name,n.reloadPage()}),c.editProgramDetail=function(e){t.go("home.addJustRent",{id:e})}}]),app.controller("largeImgCtrl",["$scope","$stateParams",function(e,t){e.picture=t.url}]),app.controller("mapCtrl",["$scope","$http",function(a,i){function t(e,t,a){var s=new BMap.Map("map"),i=new BMap.Point(e,t);s.centerAndZoom(i,a),s.enableScrollWheelZoom(!0);var r=new BMap.Marker(i);s.addOverlay(r),$("#lng").val(e),$("#lat").val(t);var n=new window.BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_LARGE});s.addControl(n);var o=new window.BMap.OverviewMapControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,isOpen:1});s.addControl(o);var c=new window.BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT});s.addControl(c);var l="当前经度："+e+"<br>当前纬度："+t,d=new BMap.InfoWindow(l);s.openInfoWindow(d,i);var u=new BMap.ContextMenu;u.addItem(new BMap.MenuItem("标记新位置",function(e){var t;t=s.getOverlays(),s.clearOverlays(t),$("#lng").val(e.lng),$("#lat").val(e.lat);var a=new BMap.Point(e.lng,e.lat),i=new BMap.Marker(a);s.addOverlay(i);var r="当前经度："+e.lng+"<br>当前纬度："+e.lat,n=new BMap.InfoWindow(r);s.openInfoWindow(n,a)}.bind(s)));r=new BMap.Marker(i);function m(e){return document.getElementById(e)}s.addOverlay(r),s.addContextMenu(u),r.addEventListener("click",function(){s.openInfoWindow(d,i)});var p,_=new BMap.Autocomplete({input:"suggestId",location:s});_.addEventListener("onhighlight",function(e){var t="",a=e.fromitem.value,i="";-1<e.fromitem.index&&(i=a.province+a.city+a.district+a.street+a.business),t="FromItem<br />index = "+e.fromitem.index+"<br />value = "+i,i="",-1<e.toitem.index&&(i=(a=e.toitem.value).province+a.city+a.district+a.street+a.business),t+="<br />ToItem<br />index = "+e.toitem.index+"<br />value = "+i,m("searchResultPanel").innerHTML=t}),_.addEventListener("onconfirm",function(e){var t=e.item.value;p=t.province+t.city+t.district+t.street+t.business,m("searchResultPanel").innerHTML="onconfirm<br />index = "+e.item.index+"<br />myValue = "+p,function(){var e=s.getOverlays();s.clearOverlays(e);var i=new BMap.LocalSearch(s,{onSearchComplete:function(){var e=i.getResults().getPoi(0).point;s.centerAndZoom(e,12),s.addOverlay(new BMap.Marker(e));var t="当前经度："+e.lng+"<br>当前纬度："+e.lat,a=new BMap.InfoWindow(t);s.openInfoWindow(a,e),$("#lng").val(e.lng),$("#lat").val(e.lat)}});i.search(p)}()})}a.getProvinceList=function(){i({method:"GET",url:BASEURL+"/api2/area/provinces?device=1"}).success(function(e){1==e.status&&(a.province_list=e.list)})},a.getProvinceList(),a.getCityList=function(e){i({method:"GET",url:BASEURL+"/api2/area/cities?device=1&province="+e}).success(function(e){1==e.status&&(a.city_list=e.list)})},a.getCountyList=function(e){i({method:"GET",url:BASEURL+"/api2/area/areas?device=1&province="+e}).success(function(e){1==e.status&&(a.county_list=e.list)})},a.getTownList=function(e){i({method:"GET",url:BASEURL+"/api2/area/town?device=1&province="+e}).success(function(e){1==e.status&&(a.town_list=e.list)})},a.changeProvince=function(){(a.city_id="",a.city_list="",a.county_id="",a.county_list="",a.town_id="",(a.town_list="")!=a.province_id)&&(t($("#provinces option[value="+a.province_id+"]").attr("data-lng"),$("#provinces option[value="+a.province_id+"]").attr("data-lat"),10),a.getCityList(a.province_id))},a.changeCity=function(){if(a.county_id="",a.county_list="",a.town_id="",(a.town_list="")!=a.city_id){var e=$("#cites option[value="+a.city_id+"]");t(e.attr("data-lng"),e.attr("data-lat"),12),a.getCountyList(a.city_id)}},a.changeCounty=function(){(a.town_id="",(a.town_list="")!=a.county_id)&&(t($("#county option[value="+a.county_id+"]").attr("data-lng"),$("#county option[value="+a.county_id+"]").attr("data-lat"),13),a.getTownList(a.county_id))},a.changeTown=function(){""!=a.town_id&&t($("#town option[value="+a.town_id+"]").attr("data-lng"),$("#town option[value="+a.town_id+"]").attr("data-lat"),16)},a.updateMap=function(){if(""==$("#lng").val()||""==$("#lat").val());else{var e="";a.town_id?e=a.town_id:a.county_id&&""==a.town_id?e=a.county_id:a.city_id&&""==a.county_id&&""==a.town_id?e=a.city_id:a.province_id&&""==a.city_id&&""==a.county_id&&""==a.town_id&&(e=a.province_id),layer.confirm("确定使用当前经纬度？",{btn:["确定","取消"],title:"提示",skin:"layui-layer-molv",icon:0,anim:3},function(){var t=layer.msg("数据提交中...",{icon:16,time:0});i({method:"POST",url:BASEURL+"/cms2/area/edit?device=1",params:{id:e,lng:$("#lng").val(),lat:$("#lat").val()}}).success(function(e){layer.close(t),1==e.status&&(layer.msg(e.msg,{icon:1,time:1500}),a.town_id?a.getTownList(a.county_id):a.county_id&&""==a.town_id?a.getCountyList(a.city_id):a.city_id&&""==a.county_id&&""==a.town_id?a.getCityList(a.province_id):a.province_id&&""==a.city_id&&""==a.county_id&&""==a.town_id&&a.getProvinceList())})})}}}]),app.controller("supplierLeaderCtrl",["$http","$scope","$state","$stateParams","$timeout","$window",function(n,i,t,a,s,o){var e=!1;i.leaderData="",i.old_leader_name="",i.old_leader_mobile="",i.provinceId=a.province_id,i.cityId=a.city_id,i.supplier_name=a.supplier_name,null!=a.supplier_name&&$("#supplier_name").focus();var r={page_index:1,province_id:"",city_id:"",supplier_name:""};i.getLeaderList=function(e){console.log(e);var t=layer.msg("加载中...",{icon:16,time:0});null==a.page_index?e.page_index=1:e.page_index=a.page_index,e.province_id=a.province_id,e.city_id=a.city_id,e.supplier_name=a.supplier_name,n({method:"GET",url:BASEURL+"/cms2/supplier/leader/list?device=1&page_size=10",params:e}).success(function(e){layer.close(t),1==e.status&&(i.leaderData=e.list,i.pageNumber=e.page.pageNumber,i.recordCount=e.page.recordCount,i.pageCount=e.page.pageCount,i.pageSize=e.page.pageSize,i.pageList=i.pageNum(i.pageCount,i.pageNumber),i.startData=0==i.recordCount?0:(i.pageNumber-1)*i.pageSize+1,i.endData=e.list.length<i.pageSize?(i.pageNumber-1)*i.pageSize+e.list.length:i.pageNumber*i.pageSize)})},i.getLeaderList(r),i.changePageUrl=function(e){r.page_index=i.getPageIndex(e,i.pageNumber,i.pageCount),t.go("home.leader",r)},i.id="",i.editLeader=function(e,t){i.current_index=e,i.old_leader_name=i.leaderData[e].name,i.old_leader_mobile=i.leaderData[e].mobile,$(t.currentTarget).parents("tr").find("input[name=leader_name]").val(i.leaderData[e].name),$(t.currentTarget).parents("tr").find("input[name=leader_mobile]").val(i.leaderData[e].mobile)},i.cancelLeader=function(e){i.current_index=-1;var t=$(e.currentTarget).parents("tr").find("input[name=leader_name]").val().trim(),a=$(e.currentTarget).parents("tr").find("input[name=leader_mobile]").val().trim();""!=t&&""!=a||($(e.currentTarget).parents("tr").find("input[name=leader_name]").val(i.old_leader_name),$(e.currentTarget).parents("tr").find("input[name=leader_mobile]").val(i.old_leader_mobile))},i.saveLeader=function(e){var t=layer.msg("加载中...",{icon:16,time:0}),a=$(e.currentTarget).parents("tr").find("input[name=supplier_id]").val().trim(),i=$(e.currentTarget).parents("tr").find("input[name=leader_name]").val().trim(),r=$(e.currentTarget).parents("tr").find("input[name=leader_mobile]").val().trim();""==i||""==r?layer.msg("请填写完整的信息，再点击！",{time:1500}):n({method:"POST",url:BASEURL+"/cms2/supplier/leader/edit?device=1",params:{supplier_id:a,supplier_leader_name:i,supplier_leader_mobile:r}}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),s(function(){o.location.reload()},1500)):layer.msg(e.msg,{icon:5,time:1500})}).error(function(){})},n({method:"GET",url:BASEURL+"/api2/area/provinces?device=1",timeout:1e4}).success(function(e){1==e.status?i.provinceList=e.list:layer.msg("请求失败",{icon:5})}).error(function(e){}),i.getCity=function(e){i.cityLists="",i.cityId="",n({method:"GET",url:BASEURL+"/api2/area/cities?province="+e+"&device=1",timeout:1e4}).success(function(e){1==e.status?i.cityLists=e.list:layer.msg("请求失败",{icon:5})}).error(function(){})},null!=a.province_id?(i.getCity(a.province_id),i.cityId=a.city_id):(i.cityLists="",i.cityId=""),i.selectProvince=function(){i.cityLists="",i.cityId="",i.supplier_name="",r.page_index=1,r.province_id=i.provinceId,r.city_id=i.cityId,r.supplier_name=i.supplier_name,t.go("home.leader",r)},i.selectCity=function(){r.page_index=1,r.province_id=i.provinceId,r.city_id=i.cityId,r.supplier_name=i.supplier_name,t.go("home.leader",r)},i.$watch("supplier_name",function(){e&&s(function(){t.go("home.leader",{page_index:1,province_id:i.provinceId,city_id:i.cityId,supplier_name:i.supplier_name})},1e3),e=!0})}]),app.controller("loginCtrl",["$scope","$http","md5","$timeout","$location",function(i,a,r,n,s){i.loginState=!1,i.login=function(){if(i.loginState=!0,""!=i.username&&null!=i.username&&""!=i.password&&null!=i.password){var e=i.username,t=r.createHash(i.password);a({url:BASEURL+"/cms2/user/login?device=1",method:"POST",timeout:1e4,params:{username:e,password:t}}).success(function(e){1==e.status?(sessionStorage.loginname=e.data.loginname,sessionStorage.id=e.data.id,sessionStorage.token=e.data.token,sessionStorage.loginState=!0,sessionStorage.unit_id=e.data.company.unit_id,sessionStorage.company_name=e.data.company.company_name,sessionStorage.company_id=e.data.company.company_id,layer.msg("登录成功",{icon:1,time:1500,offset:"160px"}),n(function(){s.url("/home")},2e3)):(layer.msg("用户名或密码错误",{icon:2,offset:"160px"}),i.loginState=!1)}).error(function(e,t,a){layer.msg("请求超时！",{icon:5,offset:"160px"}),i.loginState=!1})}else layer.msg("请输入用户名或密码！",{icon:0,offset:"160px"}),i.loginState=!1},i.sendMsg=function(e){13==e.keyCode&&(i.loginState=!0,i.login())}}]),app.controller("marketingCtrl",["$scope","requestData","$state","$stateParams",function(a,e,t,i){var r={url:"/cms2/role/more/users?device=1",send_data:{page_index:1,page_size:10,role_id:"1000300010040,1000300010041"},getData:function(){return e.getData("GET",this.url,this.send_data)},getDataFromUrl:function(){var e=i.page_index,t=i.page_size;e||(e=1),t||(t=10),this.send_data.page_index=e,this.send_data.page_size=t},setData:function(e){e.then(function(e){var t=e.data;1==t.status?(a.lists=t.list,a.pageNumber=t.page.pageNumber,a.pageCount=t.page.pageCount,a.recordCount=t.page.recordCount,a.pageSize=t.page.pageSize,a.pageList=a.pageNum(a.pageCount,a.pageNumber),a.startData=0==a.recordCount?0:(a.pageNumber-1)*a.pageSize+1,a.endData=t.list.length<a.pageSize?(a.pageNumber-1)*a.pageSize+t.list.length:a.pageNumber*a.pageSize):layer.msg("请求失败",{icon:5})})},init:function(){this.getDataFromUrl();var e=this.getData();this.setData(e)}};r.init(),a.changePageUrl=function(e){r.send_data.page_index=a.getPageIndex(e,a.pageNumber,a.pageCount),t.go("home.marketing",r.send_data)}}]),app.controller("marketingDetailCtrl",["$scope","$stateParams","requestData","$window","httpData","$timeout",function(l,e,i,t,r,a){l.has_show=!0,l.show_tip=!0,l.has_show_flag=!1;var n=layer.load(1),s={proviceUrl:"/api2/area/provinces?device=1",cityUrl:"/api2/area/cities?device=1",url:"/cms2/user/detail?device=1",areaUrl:"/sales/user/user/watch?device=1",addAreaUrl:"/cms2/user/allocation?device=1",deleteUrl:"/cms2/user/delete/watch?device=1",hasManageUrl:"/cms2/user/follow/state?device=1",hasEditUrl:"/cms2/user/is/edit?device=1",proviceLists:[],updateLayerForm:function(){layui.use("form",function(){layui.form().render()})},areaData:function(){var c=this;layui.use("form",function(){var e=layui.form();e.render(),e.on("checkbox(checkProvice)",function(e){var t=e.elem.checked,a=e.value,i=$(e.elem).attr("title");if(0==a){var r={},n={},s=[];r.id=0,r.name="全国",r.list=[],n.id=0,n.name="全省",r.list.push(n),s.push(r),c.proviceLists=s;var o=c.getProviceData();c.setProviceData(o),c.setCityData(n,0),l.has_show=!0}c.setCheckList(t,a,i)}),e.on("checkbox(checkCity)",function(e){var t=e.elem.checked,a=e.value,i=$(e.elem).attr("title"),r=$(e.elem).attr("data-pid");if(t&&0==a){var n={};return c.proviceLists.forEach(function(e,t,a){if(e.id==r)return n.id=0,n.name="全省",c.proviceLists[t].list=[],void c.proviceLists[t].list.push(n)}),void c.setCityData(n,r)}var s=c.getCityData(r);c.setCityData(s,r),c.selectedData(t,a,i,r)}),e.on("checkbox(checkManage)",function(e){var t=e.elem.checked,a=e.value,i=0;t&&(i=1),c.hasManage(i,a)}),e.on("checkbox(checkEdit)",function(e){var t=e.elem.checked,a=e.value,i=0;t&&(i=1),c.hasEdit(i,a)})}),layui.use("element",function(){layui.element().on("tab(changeCity)",function(e){var t=$(this).attr("data-id"),a=c.getCityData(t);c.setCityData(a,t)})})},hasManage:function(e,t){var a={id:t,state:e};r.getData("POST",this.hasManageUrl,a,this.setSecussData,this.errorData)},hasEdit:function(e,t){var a={id:t,state:e};r.getData("POST",this.hasEditUrl,a,this.setSecussData,this.errorData)},setSecussData:function(e){layer.close(n);var t=e;1==e.status?layer.msg(t.msg,{icon:1,time:1500}):layer.msg(t.msg,{icon:5,time:1500}),setTimeout(function(){s.init()},1800)},errorData:function(e){layer.close(n),layer.msg("操作失败",{icon:5,time:1500})},setCheckList:function(e,i,t){if(e){var r=!0;if(this.proviceLists.forEach(function(e,t,a){e.id!=i||(r=!1)}),r){var a={};a.id=i,a.name=t,a.list=[],this.proviceLists.push(a)}}else this.proviceLists.forEach(function(e,t,a){e.id!=i||a.splice(t,1)});this.setListsData()},selectedData:function(e,r,n,s){e?this.proviceLists.forEach(function(e,t,a){if(e.id==s){var i={};return i.id=r,i.name=n,void e.list.push(i)}}):this.proviceLists.forEach(function(i,e,t){i.id==s&&i.list.forEach(function(e,t,a){e.id!=r||i.list.splice(t,1)})})},getID:function(){l.id=e.id},getProviceData:function(){return i.getData("GET",this.proviceUrl,"")},getCityData:function(e){var t={province:e};return i.getData("GET",this.cityUrl,t)},setCityData:function(e,r){var n=this;try{e.then(function(e){var t=e.data;if(1==t.status){var i="",a=t.list;n.hasSelAllCity(r)?(i='<li class="col-sm-4">',i+='<input type="checkbox" checked data-pid="'+r+'" value="0" name="0" title="全省" lay-skin="primary" lay-filter="checkCity"></li>'):(i+='<li class="col-sm-4">',i+='<input type="checkbox" data-pid="'+r+'" value="0" name="0" title="全省" lay-skin="primary" lay-filter="checkCity"></li>',a.forEach(function(e,t,a){n.hasCitySelected(r,e.id)?(i+='<li class="col-sm-4">',i+='<input type="checkbox" checked data-pid="'+r+'" value="'+e.id+'" name="'+e.id+'" title="'+e.name+'" lay-skin="primary" lay-filter="checkCity"></li>'):(i+='<li class="col-sm-4">',i+='<input type="checkbox" data-pid="'+r+'" value="'+e.id+'" name="'+e.id+'" title="'+e.name+'" lay-skin="primary" lay-filter="checkCity"></li>')})),angular.element("#contentLists").empty().append(i),n.updateLayerForm()}else layer.msg("请求失败",{icon:5})})}catch(e){var t="";n.hasSelAllCity(r)&&(t='<li class="col-sm-4">',t+='<input type="checkbox" checked data-pid="'+r+'" value="0" name="0" title="全省" lay-skin="primary" lay-filter="checkCity"></li>'),angular.element("#contentLists").empty().append(t),n.updateLayerForm()}},hasProviceSelected:function(i){var r=!1;return this.proviceLists.forEach(function(e,t,a){e.id!=i||(r=!0)}),r},hasCitySelected:function(i,r){var n="",s=!1;try{this.proviceLists.forEach(function(e,t,a){e.id!=i||(n=e)}),n.list.forEach(function(e,t,a){e.id!=r||(s=!0)})}catch(e){s=!1}return s},hasSelAllCity:function(i){var r=!1;return this.proviceLists.forEach(function(e,t,a){if(e.id==i&&(1==e.list.length&&0==e.list[0].id))return void(r=!0)}),r},hasSelAllProvice:function(){var e=!1;return 1==this.proviceLists.length&&(e=0==this.proviceLists[0].id),e},setProviceData:function(e){var r=this;e.then(function(e){var t=e.data;if(1==t.status){var a=t.list,i="";r.hasSelAllProvice()?(i+='<li class="col-sm-4">',i+='<input type="checkbox" checked value="0" name="0" title="全国" lay-skin="primary" lay-filter="checkProvice"></li>'):(i+='<li class="col-sm-4">',i+='<input type="checkbox" value="0" name="0" title="全国" lay-skin="primary" lay-filter="checkProvice"></li>',a.forEach(function(e,t,a){r.hasProviceSelected(e.id)?(i+='<li class="col-sm-4">',i+='<input type="checkbox" checked value="'+e.id+'" name="'+e.id+'" title="'+e.name+'" lay-skin="primary" lay-filter="checkProvice"></li>'):(i+='<li class="col-sm-4">',i+='<input type="checkbox" value="'+e.id+'" name="'+e.id+'" title="'+e.name+'" lay-skin="primary" lay-filter="checkProvice"></li>')})),angular.element("#addAreaLists").empty().append(i),r.updateLayerForm()}else layer.msg("请求失败",{icon:5})})},getListsData:function(){var e={id:l.id};return i.getData("GET",this.url,e)},setListsData:function(){var i="";this.proviceLists.forEach(function(e,t,a){0==e.id&&!0,i+=0==t?'<li class="layui-this" data-id="'+e.id+'">'+e.name+"</li>":'<li data-id="'+e.id+'">'+e.name+"</li>"}),this.setCityData(this.proviceLists,0),angular.element("#checkProvice").empty().append(i),this.getFirstTab()},getFirstTab:function(){if(0==this.proviceLists.length)angular.element("#contentLists").empty(),l.has_show=!0,l.$apply();else{l.has_show=!1;var e=this.proviceLists[0].id,t=this.getCityData(e);this.setCityData(t,e)}},setData:function(e){layer.close(n);var o=this;e.then(function(e){var t=e.data;if(1==t.status){l.userAreaData=t.datas;var a="";try{a=t.datas.length}catch(e){a=0}if(0<a){l.show_tip=!1;var r={};t.datas.forEach(function(e,t,a){var i=e.province_id;r.hasOwnProperty(i)||(r[i]=[]),r[i].push(e)});var i=[];for(var n in r){var s={};s.id=n,s.list=[],r[n].forEach(function(e,t,a){var i={};0!=s.id?s.name=e.provinceName:(s.name="全国",l.has_show_flag=!0),i.id=e.city_id,0==e.city_id?i.name="全省":i.name=e.cityName,s.list.push(i)}),i.push(s)}o.proviceLists=i,l.has_show=!1,o.setCheckList(!0,i[0].id,i[0].name)}else l.show_tip=!0}else layer.msg("请求失败",{icon:5})})},addAreaModel:function(){l.has_show=l.has_show_flag,$(".addAreaModal").modal({backdrop:"static"})},getUserData:function(){var e={mobile:l.id};return i.getData("GET",this.areaUrl,e)},addUserArea:function(e,t){var a={mobile:t,sale_area:e};return i.getData("POST",this.addAreaUrl,a)},setUserArea:function(e){e.then(function(e){layer.msg(e.data.msg,{icon:1,time:1500})}),setTimeout(function(){s.init()},1800)},init:function(){this.getID(),this.areaData();var e=this.getUserData();this.setData(e)}};s.init(),l.addArea=function(){s.addAreaModel();var e=s.getProviceData();s.setProviceData(e)},l.deleteData=function(e){var t=e.currentTarget,a={id:$(t).attr("data-id")};i.getData("POST",s.deleteUrl,a).then(function(e){layer.msg(e.data.msg,{icon:1,time:1500}),setTimeout(function(){s.init()},1800)})},l.orderSave=function(){var o=[],c=[];if(s.proviceLists.forEach(function(e,t,a){var n=e.id,s=e.name;0<e.list.length&&e.list.forEach(function(e,t,a){var i={},r=n+","+e.id;i.province_id=n,i.provinceName=s,i.city_id=e.id,i.cityName=e.name,o.push(r),c.push(i)})}),0<o.length){var e=o.join("|"),t=s.addUserArea(e,l.id);s.setUserArea(t)}$(".addAreaModal").modal("hide")}}]),app.controller("marketPriceCtrl",["$scope","$http","httpRequestData","$state","$stateParams",function(o,s,c,a,i){var l=layer.load(1),t={province_url:"/api2/area/provinces?device=1",city_url:"/api2/area/cities?device=1",brand_url:"/api2/res/brand?device=1",subbrand_url:"/api2/res/brand/",supplierAccount_url:"/res_v1_0_0/cms/market/log/list/search",principal_url:"",list_url:"/cms/market/price/datas",listsSendData:{page_index:1,page_size:10,device:1,province_id:"",city_id:"",brand_id:"",sub_brand_id:"",operation_account:"",seeting_price:"",supplier_name:""},requestError:function(){layer.close(l),layer.msg("数据请求失败",{icon:5,time:2e3})},getDataFromUrl:function(){var e=i.page_index;e||(e=1),this.listsSendData={page_index:e,page_size:10}},selectData:function(){var e="",t="";e=o.start_time?Date.parse(o.start_time.replace(/-/g,"/")):"",t=o.end_time?Date.parse(o.end_time.replace(/-/g,"/")):"",this.listsSendData.state=o.counsel_state,this.listsSendData.dir_id=o.counsel_type,this.listsSendData.start_time=e,this.listsSendData.end_time=t,a.go("home.marketPrice",this.listsSendData)},getProvinceList:function(){var e={req_data:{url:BASEURL+this.province_url},requestSuccess:this.setProvinceList,requestError:this.requestError};c.getData(e)},setProvinceList:function(e){1==e.status&&(o.province_list=e.list)},getCityList:function(e){var t={req_data:{url:BASEURL+this.city_url,params:{province:e}},requestSuccess:this.setCityList,requestError:this.requestError};c.getData(t)},setCityList:function(e){1==e.status&&(o.city_list=e.list)},getBrandList:function(){var e={req_data:{url:BASEURL+this.brand_url},requestSuccess:this.setBrandList,requestError:this.requestError};c.getData(e)},setBrandList:function(e){1==e.status&&(o.brand_list=e.list)},getSubbrandList:function(e){var t={req_data:{url:BASEURL+this.subbrand_url+e+"?device=1"},requestSuccess:this.setSubrandList,requestError:this.requestError};c.getData(t)},setSubrandList:function(e){1==e.status&&(o.subbrand_list=e.list)},getSupplierAccounts:function(){var e={req_data:{url:BASEURL+this.supplierAccount_url+"?device=1"},requestSuccess:this.setSupplierAccounts,requestError:this.requestError};c.getData(e)},setSupplierAccounts:function(e){o.accounts_list=e.accounts,console.log(o.accounts_list)},init:function(){this.getDataFromUrl(),this.getBrandList(),this.getProvinceList(),this.getSupplierAccounts()}};o.getPriceList=function(e){null==i.page_index?e.page_index=1:e.page_index=i.page_index;var t=layer.msg("加载中...",{icon:16,time:0});console.log(e),s({method:"GET",url:BASEURL+"/res_v1_0_0/cms/market/price/datas?device=1",params:e}).success(function(e){console.log(e),layer.close(t),o.priceList=e.list,o.pageNumber=e.pageNumber,o.recordCount=e.recordCount,o.pageCount=e.pageCount,o.pageSize=e.pageSize,o.pageList=o.pageNum(o.pageCount,o.pageNumber),o.startData=0==o.recordCount?0:(o.pageNumber-1)*o.pageSize+1,o.endData=e.list.length<o.pageSize?(o.pageNumber-1)*o.pageSize+e.list.length:o.pageNumber*o.pageSize}).error(function(e){layer.msg("请求失败",{icon:5})})},t.init(),o.getPriceList(t.listsSendData),o.changeBrand=function(){t.listsSendData.brand_id=o.brand_id,t.getSubbrandList(o.brand_id),o.getPriceList(t.listsSendData)},o.changeSubbrand=function(){t.listsSendData.subbrand_id=o.subbrand_id,o.getPriceList(t.listsSendData)},o.changeProvince=function(){t.listsSendData.province_id=o.province_id,t.getCityList(o.province_id),o.getPriceList(t.listsSendData)},o.changeCity=function(){t.listsSendData.city_id=o.city_id,o.getPriceList(t.listsSendData)},o.changeAccount=function(){t.listsSendData.operation_account=o.operation_account,o.getPriceList(t.listsSendData)},o.changeSeeting=function(){t.listsSendData.seeting_price=o.seeting_price,o.getPriceList(t.listsSendData)},o.supplier_search=function(){t.supplier_name=o.supplier_name,o.getPriceList(t.listsSendData)},o.changePageUrl=function(e){t.listsSendData.page_index=o.getPageIndex(e,o.pageNumber,o.pageCount),a.go("home.marketPrice",t.listsSendData)},o.modolTitle={subName:"",modName:"",proName:"",markPrice:"",price4sList:"",cityList:""},o.get4sPriceList=function(e){s({method:"GET",url:BASEURL+"/res_v1_0_0/cms/market/price/list/4s?device=1",params:e}).success(function(e){o.modolTitle.price4sList=e.list,console.log(o.modolTitle.price4sList)}).error(function(){})};var d={page_index:1,page_size:10,model_id:"",province_id:""};o.check4sPrice=function(e,t,a,i,r,n){o.modolTitle.subName=e,o.modolTitle.modName=t,o.modolTitle.proName=a,o.modolTitle.markPrice=i,d.model_id=r,d.province_id=n;var s={req_data:{url:BASEURL+"/api2/area/cities?device=1",params:{province:n}},requestSuccess:function(e){o.modolTitle.cityList=e.list},requestError:function(){layer.close(l),layer.msg("数据请求失败",{icon:5,time:2e3})}};c.getData(s),o.get4sPriceList(d)},o.restoreDefault=function(e,t,a){s({method:"POST",url:BASEURL+"/res_v1_0_0/cms/market/price/restore/default/price",params:{market_id:e,model_id:t,province_id:a}}).success(function(e){layer.msg("操作成功",{icon:1})}).error(function(){layer.msg("请求失败",{icon:5})})},o.setPrice=function(e,t){var a={pre_market_id:t,market_id:modId};s({method:"POST",url:BASEURL+"/cms/market/price/set/price",params:a}).success(function(e){layer.msg("操作成功",{icon:1})}).error(function(){layer.msg("请求失败",{icon:5})})},o.change4sCity=function(){d.city_id=o.city_4s,o.get4sPriceList(d)},o.change4sAccount=function(){d.account=o.account_4s,o.get4sPriceList(d)},o.search_4s=function(){d.supplier_name=o.supplier_4s,o.get4sPriceList(d)},o.modolPolicy={subName:"",modName:"",supplierName:"",policyList:""},o.financialPolicy=function(e,t,a,i,r,n){o.modolPolicy.subName=e,o.modolPolicy.modName=t,o.modolPolicy.supplierName=a,policySendData={page_index:1,page_size:10,province_id:i,city_id:r,brand_id:n},s({method:"GET",url:BASEURL+"/res_v1_0_0/cms/policy/datas?device=1",params:policySendData}).success(function(e){o.modolPolicy.policyList=e.list}).error(function(){})}}]),app.controller("priceUpdateDetailCtrl",["$scope","$http","$stateParams",function(t,a,i){console.log(i),$('[data-toggle="popover"]').popover(),t.getLogDetail=function(e){a({method:"GET",url:BASEURL+"/res_v1_0_0/cms/market/log/list/logId?device=1&logId="+i.logId}).success(function(e){console.log(e.data),t.logDetail=e.data}).error(function(e){layer.msg("请求失败",{icon:5})})}}]),app.controller("priceUpdateLogCtrl",["$scope","$http","httpRequestData","$state","$stateParams",function(a,i,r,e,n){new Date;var t={province_url:"/api2/area/provinces?device=1",city_url:"/api2/area/cities?device=1",brand_url:"/api2/res/brand?device=1",supplierAccount_url:"/res_v1_0_0/cms/market/log/list/search",list_url:"/cms/market/price/datas/",listsSendData:{page_index:1,page_size:10,province_id:"",cituy_id:"",brand_id:"",supplier_id:"",operation_account:"",start_time:"",end_time:""},requestError:function(){layer.close(void 0),layer.msg("数据请求失败",{icon:5,time:2e3})},getDataFromUrl:function(){var e=n.page_index;e||(e=1),this.listsSendData.page_index=e,this.listsSendData.page_size=10},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]},selectData:function(){var e="",t="";e=a.start_time?Date.parse(a.start_time.replace(/-/g,"/")):"",t=a.end_time?Date.parse(a.end_time.replace(/-/g,"/")):"",this.listsSendData.dir_id=a.counsel_type,this.listsSendData.start_time=e,this.listsSendData.end_time=t},getProvinceList:function(){var e={req_data:{url:BASEURL+this.province_url},requestSuccess:this.setProvinceList,requestError:this.requestError};r.getData(e)},setProvinceList:function(e){1==e.status&&(a.province_list=e.list)},getCityList:function(e){var t={req_data:{url:BASEURL+this.city_url,params:{province:e}},requestSuccess:this.setCityList,requestError:this.requestError};r.getData(t)},setCityList:function(e){1==e.status&&(a.city_list=e.list)},getBrandList:function(){var e={req_data:{url:BASEURL+this.brand_url},requestSuccess:this.setBrandList,requestError:this.requestError};r.getData(e)},setBrandList:function(e){1==e.status&&(a.brand_list=e.list)},getSupplierAccounts:function(){var e={req_data:{url:BASEURL+this.supplierAccount_url+"?device=1"},requestSuccess:this.setSupplierAccounts,requestError:this.requestError};r.getData(e)},setSupplierAccounts:function(e){console.log(e),a.supplier_list=e.suppliers,a.accounts_list=e.accounts},init:function(){this.getDataFromUrl(),this.getBrandList(),this.getProvinceList(),this.getSupplierAccounts()}};a.getPriceLogList=function(e){null==n.page_index?e.page_index=1:e.page_index=n.page_index;var t=layer.msg("加载中...",{icon:16,time:0});console.log(e),i({method:"GET",url:BASEURL+"/res_v1_0_0/cms/market/log/datas?device=1",params:e}).success(function(e){console.log(e),layer.close(t),a.logList=e.list,a.pageNumber=e.pageNumber,a.recordCount=e.recordCount,a.pageCount=e.pageCount,a.pageSize=e.pageSize,a.pageList=a.pageNum(a.pageCount,a.pageNumber),a.startData=0==a.recordCount?0:(a.pageNumber-1)*a.pageSize+1,a.endData=e.list.length<a.pageSize?(a.pageNumber-1)*a.pageSize+e.list.length:a.pageNumber*a.pageSize}).error(function(e){layer.msg("请求失败",{icon:5})})},t.init(),a.getPriceLogList(t.listsSendData),$("#startDate").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){t.listsSendData.start_time=new Date(a.startTime).getTime(),a.getPriceLogList(t.listsSendData)}),$("#endDate").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){t.listsSendData.end_time=new Date(a.endTime).getTime(),a.getPriceLogList(t.listsSendData)}),a.changeProvince=function(){t.listsSendData.province_id=a.province_id,t.getCityList(a.province_id),a.getPriceLogList(t.listsSendData)},a.changeCity=function(){t.listsSendData.cituy_id=a.city_id,a.getPriceLogList(t.listsSendData)},a.changeBrand=function(){t.listsSendData.brand_id=a.brand_id,t.getSubbrandList(a.brand_id),a.getPriceLogList(t.listsSendData)},a.changeSupplier=function(){t.listsSendData.supplier_id=a.supplier_id,a.getPriceLogList(t.listsSendData)},a.changeAccount=function(){t.listsSendData.operation_account=a.operation_account,a.getPriceLogList(t.listsSendData)}}]),app.controller("menuCategoryCtrl",["$scope","$http","$timeout","httpData","$stateParams","$state",function(a,e,t,i,r,n){var s=layer.load(1);a.category_id="";var o={addUrl:"/cms2/menu/ass/add?device=1",listUrl:"/cms2/menu/ass/query?device=1",deleteUrl:"/cms2/menu/ass/delete?device=1",unbindUrl:"/cms2/menu/ass/unbind?device=1",bindUrl:"/cms2/menu/ass/bind?device=1",menulistUrl:"/cms2/menu/datas?device=1",sendData:{page_index:a.pageIndex=1,page_size:a.pegeSize=10},init:function(){this.getDataFromUrl,this.getCategoryList()},errorData:function(){layer.close(s),a.has_clicked=!1,layer.msg("请求失败",{icon:5})},getDataFromUrl:function(){var e=r.page_index;e||(e=1),this.sendData={page_index:e,page_size:10}},getMenuList:function(e){var t={page_index:a.pageIndex,page_size:a.pageSize,assortment_id:e};i.getData("GET",this.menulistUrl,t,this.setMenuList,this.errorData)},setMenuList:function(e){layer.close(s),1==e.status?(a.menu_list=e.list,a.pageNumber=e.page.pageNumber,a.recordCount=e.page.recordCount,a.pageCount=e.page.pageCount,a.pageSize=e.page.pageSize,a.pageList=a.pageNum(a.pageCount,a.pageNumber),a.startData=0==a.recordCount?0:(a.pageNumber-1)*a.pageSize+1,a.endData=e.list.length<a.pageSize?(a.pageNumber-1)*a.pageSize+e.list.length:a.pageNumber*a.pageSize):layer.msg("请求失败",{icon:5})},getCategoryList:function(){i.getData("GET",this.listUrl,this.sendData,this.setCategoryList,this.errorData)},setCategoryList:function(e){layer.close(s),1==e.status?(a.category_list=e.list,a.pageNumber=e.page.pageNumber,a.recordCount=e.page.recordCount,a.pageCount=e.page.pageCount,a.pageSize=e.page.pageSize,a.pageList=a.pageNum(a.pageCount,a.pageNumber),a.startData=0==a.recordCount?0:(a.pageNumber-1)*a.pageSize+1,a.endData=e.list.length<a.pageSize?(a.pageNumber-1)*a.pageSize+e.list.length:a.pageNumber*a.pageSize):layer.msg("请求失败",{icon:5})},addCategory:function(){i.getData("POST",this.addUrl,{name:a.name,is_new:0},this.addSuccess,this.errorData)},addSuccess:function(e){layer.close(s),1==e.status&&(layer.msg("添加成功",{icon:1,time:1500}),$("#addMenuCategory").modal("hide"),o.getCategoryList())},deleteCategory:function(e){i.getData("POST",this.deleteUrl,{id:e},this.successFn,this.errorData)},successFn:function(e){layer.close(s),1==e.status&&(layer.msg(e.msg,{icon:1,time:1500}),o.getCategoryList())},bindMenu:function(e,t){i.getData("POST",this.bindUrl,{id:e,menu_id:t},this.bindMenuSuc,this.errorData)},bindMenuSuc:function(e){layer.close(s),$("#bind_menu").modal("hide"),1==e.status?layer.msg(e.msg,{icon:1,time:1500}):layer.msg(e.msg)},unbindMenu:function(e,t){i.getData("POST",this.unbindUrl,{id:e,menu_id:t},this.unbindMenuSuc,this.errorData)},unbindMenuSuc:function(e){layer.close(s),$("#menu_list").modal("hide"),1==e.status?layer.msg(e.msg,{icon:1,time:1500}):layer.msg(e.msg)}};o.init(),a.changePageUrl=function(e){o.sendData.page_index=a.getPageIndex(e,a.pageNumber,a.pageCount),n.go("home.menuCategory",o.sendData)},a.menu_id=[],a.selectTemplate=function(e,t){1==e.currentTarget.checked?a.menu_id.push(t):a.menu_id.remove(t)},a.addCategory=function(){a.name?o.addCategory():layer.msg("分类名称不能为空")},a.deleteCategory=function(t){t&&layer.confirm("确定删除该菜单？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0},function(e){layer.close(e),o.deleteCategory(t)})},a.getAllMenu=function(e,t){e.stopPropagation(),a.menu_id=[],a.category_id=t,$("#bind_menu").modal("show"),o.getMenuList("")},a.bindMenu=function(){var e=a.menu_id.join(",");""!=a.category_id&&""!=e?o.bindMenu(a.category_id,e):layer.msg("请至少选择一个菜单")},a.checkMenu=function(e,t){e.stopPropagation(),a.menu_id=[],a.category_id=t,$("#menu_list").modal("show"),o.getMenuList(a.category_id)},a.unbindMenu=function(){var e=a.menu_id.join(",");""!=a.category_id&&""!=e?o.unbindMenu(a.category_id,e):layer.msg("请至少选择一个菜单")},a.changePage=function(e){a.pageIndex=a.getPageIndex(e,a.pageNumber,a.pageCount),o.getMenuList()}}]),app.controller("menuIconCtrl",["$scope","$http","$timeout",function(i,t,e){function r(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})}function n(e){if(layer.closeAll("dialog"),1==e.status){var t=e.data[0].normal;i.edit_icon_obj[i.type]=t,i.$apply()}else layer.msg("上传失败")}i.getIcon=function(){t({method:"GET",url:BASEURL+"/open/config/get?device=1&config_key=home_menu"}).success(function(e){1==e.status&&(i.icon_obj=JSON.parse(e.data))})},i.getIcon(),i.editIcon=function(e){e&&(i.key=e,i.edit_icon_obj=i.icon_obj[e],$("#editIcon").modal("show"))},i.fileChanged=function(e){var t=$(e).attr("data-key");i.type=t;var a={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:r,success:n,xhrFields:{withCredentials:!0}};$("#"+t).ajaxSubmit(a)},i.saveIcon=function(){var e=i.icon_obj;e[i.key]=i.edit_icon_obj,t({method:"POST",url:BASEURL+"/open/config/edit?device=1",headers:{"Content-Type":"text/plain;charset=utf-8"},data:{home_menu:JSON.stringify(e)}}).success(function(e){$("#editIcon").modal("hide"),layer.msg(e.msg,{icon:1,time:1500}),i.getIcon()})}}]),app.controller("noticeListCtrl",["$scope","httpData","$stateParams","$state","$window","$timeout","$http",function(s,a,o,i,e,t,r){var c=layer.load(1),n={note_list_url:"/cms2/message/list/notify?device=1",delete_list_url:"/cms2/message/delete/cache?device=1",send_list_url:"/cms2/message/send/cache?device=1",listsSendData:{page_index:1,page_size:10,send_start_time:"",send_end_time:"",title:"",send_state:""},errorData:function(){layer.close(c),layer.msg("请求失败",{icon:5})},getLocalTime:function(e){var t=new Date(parseInt(e)),a=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),n=t.getHours(),s=t.getMinutes();return 1==String(i).length&&(i="0"+i),1==String(r).length&&(r="0"+r),1==String(n).length&&(n="0"+n),1==String(s).length&&(s="0"+s),a+"-"+i+"-"+r+" "+n+":"+s},setNoteLists:function(e){if(layer.close(c),1===e.status){s.noticeLists=[];for(var t=0,a=e.list.length;t<a;t++){var i=e.list[t].message_param;try{var r=JSON.parse(i),n="暂无";switch(r.action_type){case"message_detail":n="消息详情";break;case"web":n="链接页面";break;case"res_detail":n="详情页面";break;case"log_order":n="物流下单页";break;case"res_home":n="车源首页";break;case"k_home":n="酷兜首页";break;case"my_kudou":n="我的酷兜页";break;case"k_share":n="酷分享页";break;case"ibd_law":n="IBD法务页"}e.list[t].type=n,s.noticeLists.push(e.list[t])}catch(e){}}s.pageNumber=e.page.pageNumber,s.pageCount=e.page.pageCount,s.recordCount=e.page.recordCount,s.pageSize=e.page.pageSize,s.pageList=s.pageNum(s.pageCount,s.pageNumber),s.startData=0==s.recordCount?0:(s.pageNumber-1)*s.pageSize+1,s.endData=e.list.length<s.pageSize?(s.pageNumber-1)*s.pageSize+e.list.length:s.pageNumber*s.pageSize}else layer.msg("数据获取异常",{icon:5})},getNoteList:function(){a.getData("GET",this.note_list_url,this.listsSendData,this.setNoteLists,this.errorData)},getDataFromUrl:function(){var e=o.page_index,t=o.page_size,a=o.send_start_time,i=o.send_end_time,r=o.title,n=o.send_state;e||(e=1),t||(t=10),a?s.start_time=this.getLocalTime(a):a=null,i?s.end_time=this.getLocalTime(i):i=null,r||(r=""),n||(n=""),s.send_state=n,s.title=r,this.listsSendData={page_index:e,page_size:t,send_start_time:a,send_end_time:i,title:r,send_state:n}},setDeleSuccess:function(e){layer.close(c),1===e.status?(layer.msg(e.msg,{icon:1,time:1500}),t(function(){n.init()},1600)):layer.msg(e.msg,{icon:5,time:1500})},deleteNotice:function(e){var t={ids:e};a.getData("POST",this.delete_list_url,t,this.setDeleSuccess,this.errorData)},sendNotice:function(e){var t={id:e};a.getData("POST",this.send_list_url,t,this.setDeleSuccess,this.errorData)},init:function(){this.getDataFromUrl(),this.getNoteList()}};n.init(),$("#start_time").datetimepicker({format:"yyyy-mm-dd hh:ii",autoclose:!0,todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){e.date?n.listsSendData.send_start_time=Date.parse(new Date(e.date)):n.listsSendData.send_start_time=""}),$("#end_time").datetimepicker({format:"yyyy-mm-dd hh:ii",autoclose:!0,todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){e.date?n.listsSendData.send_end_time=Date.parse(new Date(e.date)):n.listsSendData.send_end_time=""}),s.selectState=function(){n.listsSendData.send_state=s.send_state},s.search=function(){n.listsSendData.title=s.title,i.go("home.noticeList",n.listsSendData)},s.deleteNotice=function(e){n.deleteNotice(e)},s.editNotice=function(e,t){sessionStorage.setItem("singleNotice",JSON.stringify(s.noticeLists[t])),i.go("home.editNotice",{sid:e})},s.sendNotice=function(e,t){$(e.currentTarget).attr("disabled",!0),n.sendNotice(t)},s.changePageUrl=function(e){n.listsSendData.page_index=s.getPageIndex(e,s.pageNumber,s.pageCount),i.go("home.noticeList",n.listsSendData)}}]),app.controller("orderCtrl",["$scope","$http","$stateParams","$state","$timeout",function(r,a,t,i,e){var n=!1,s=!1,o=!1;r.state=t.state,r.order_id=t.id,r.account=t.account,r.order_code=t.code,r.orderData="",r.$on("uploadData",function(e,t){var a=(r.orderData=t).page.pageNumber;r.orderPageIndex=t.page.pageNumber;var i=t.page.pageCount;r.orderPageList=r.pageNum(i,a)});var c={page_index:1,id:"",account:"",state:"",code:""};r.requestList=function(e){var t=layer.msg("加载中...",{icon:16,time:0});a({url:BASEURL+"/cms2/order/dataslist?page_size=10&device=1",method:"GET",timeout:1e4,params:e}).success(function(e){layer.close(t),1==e.status?(r.orderData=e.list,r.pageNumber=e.page.pageNumber,r.recordCount=e.page.recordCount,r.pageCount=e.page.pageCount,r.pageSize=e.page.pageSize,r.pageList=r.pageNum(r.pageCount,r.pageNumber),r.startData=0==r.recordCount?0:(r.pageNumber-1)*r.pageSize+1,r.endData=e.list.length<r.pageSize?(r.pageNumber-1)*r.pageSize+e.list.length:r.pageNumber*r.pageSize):layer.msg("请求失败",{icon:5})})},r.getOrderList=function(e){null==t.page_index?e.page_index=1:e.page_index=t.page_index,e.id=t.id,e.account=t.account,e.state=t.state,e.code=t.code,r.requestList(e)},r.getOrderList(c),r.selectOrderChange=function(){i.go("home.order",{page_index:1,state:r.state,id:r.order_id,account:r.account,code:r.order_code})},r.getModelData=function(){var e={page_index:1};return e.id=r.order_id,e.account=r.account,e.state=r.state,e.code=r.order_code,e},r.order_search=function(){if(null==r.order_id&&null==r.account&&null==r.order_code)layer.msg("输入信息再搜索！",{icon:0,time:1500});else{var e=r.getModelData();i.go("home.order",e)}},r.$watch("order_id",function(){if(s&&""==r.order_id){var e=r.getModelData();i.go("home.order",e)}s=!0}),r.$watch("account",function(){if(o&&""==r.account){var e=r.getModelData();i.go("home.order",e)}o=!0}),r.$watch("order_code",function(){if(n&&""==r.order_code){var e=r.getModelData();i.go("home.order",e)}n=!0}),r.changePageUrl=function(e){c.page_index=r.getPageIndex(e,r.pageNumber,r.pageCount),i.go("home.order",c)}}]),app.controller("menuCtrl",["$scope","$http","httpData","$stateParams","$state",function(i,a,t,r,n){Array.prototype.remove=function(e){var t=this.indexOf(e);-1<t&&this.splice(t,1)};var s=layer.load(1);i.has_clicked=!1,i.menu_list=[];var o={menuUrl:"/cms2/menu/datas?device=1",checkPower:"/cms2/menu/power/list?device=1",modelUrl:"/api2/res/model/",deleteUrl:"/cms2/menu/delete?device=1&menu_id",categoryUrl:"/cms2/menu/ass/query?device=1",listsSendData:{page_index:1,page_size:10,assortment_id:""},init:function(){this.getDataFromUrl(),this.getMenuList(),this.getCategoryList()},errorData:function(){layer.close(s),i.has_clicked=!1,layer.msg("请求失败",{icon:5})},uploadBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},uploadTitleSuccess:function(e){layer.closeAll("dialog"),1==e.status?(i.picture=e.data[0].normal,i.$apply()):layer.msg("上传失败")},getCategoryList:function(){t.getData("GET",this.categoryUrl,"",this.setCategoryList,this.errorData)},setCategoryList:function(e){layer.close(s),1==e.status?i.category_list=e.list:layer.msg("请求失败",{icon:5})},getMenuList:function(){t.getData("GET",this.menuUrl,this.listsSendData,this.setMenuList,this.errorData)},setMenuList:function(e){layer.close(s),1==e.status?(i.menu_list=e.list,i.pageNumber=e.page.pageNumber,i.recordCount=e.page.recordCount,i.pageCount=e.page.pageCount,i.pageSize=e.page.pageSize,i.pageList=i.pageNum(i.pageCount,i.pageNumber),i.startData=0==i.recordCount?0:(i.pageNumber-1)*i.pageSize+1,i.endData=e.list.length<i.pageSize?(i.pageNumber-1)*i.pageSize+e.list.length:i.pageNumber*i.pageSize):layer.msg("请求失败",{icon:5})},getMenuPower:function(e){t.getData("GET",this.checkPower,{menu_id:e},this.setMenuPower,this.errorData)},setMenuPower:function(e){1==e.status&&(i.power_list=e.datas)},getDataFromUrl:function(){var e=r.page_index,t=r.assortment_id;e||(e=1),i.assortment_id=t,this.listsSendData={page_index:e,page_size:10,assortment_id:t}},selectData:function(){this.listsSendData.page_index=1,this.listsSendData.assortment_id=i.assortment_id,n.go("home.menu",this.listsSendData)}};o.init(),i.changePageUrl=function(e){o.listsSendData.page_index=i.getPageIndex(e,i.pageNumber,i.pageCount),n.go("home.menu",o.listsSendData)},i.changeCategory=function(){o.selectData()},i.ids=[],i.idsSrting="",i.selectTemplate=function(e,t){1==e.currentTarget.checked?i.ids.push(t):i.ids.remove(t),console.log(i.ids)},i.checkMenuPower=function(e,t){e.stopPropagation(),i.ids=[],$("#menu_power_list").modal("show"),o.getMenuPower(t),i.menu_id=t},i.bindMenuPower=function(e,t){e.stopPropagation(),i.ids=[],i.menu_id=t,$("#add_menu_power").modal("show"),a({method:"GET",url:BASEURL+"/cms2/power/datas?device=1"}).success(function(e){console.log(e),i.allPower=e.list})},angular.element("#icon_input").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:o.uploadBefore,success:o.uploadTitleSuccess,xhrFields:{withCredentials:!0}};angular.element("#icon").ajaxSubmit(e)}),i.editMenu=function(e,t,a){e.stopPropagation(),i.menu_id=t,i.menuData=i.menu_list[a],$("#updateMenu").modal("show"),i.menu_name=i.menu_list[a].name,i.alias_name=i.menu_list[a].alias,i.menu_type=i.menu_list[a].type,i.menu_uri=i.menu_list[a].uri,i.menu_code=i.menu_list[a].code,i.remark=i.menu_list[a].remark,i.menu_type=i.menu_list[a].type+"",i.is_new=i.menu_list[a].is_new,i.picture=i.menu_list[a].picture,i.menu_params=i.menu_list[a].params},i.saveMenu=function(){i.menu_name?i.menu_type?a({method:"POST",url:BASEURL+"/cms2/menu/edit?device=1",params:{menu_id:i.menu_id,parent_id:0,menu_name:i.menu_name,code:i.menu_code,alias_name:i.alias_name,menu_type:i.menu_type,menu_uri:i.menu_uri,remark:i.remark,is_new:i.is_new,picture:i.picture,menu_params:i.menu_params}}).success(function(e){1==e.status?($("#updateMenu").modal("hide"),layer.msg(e.msg,{icon:1,time:1e3}),o.getMenuList()):layer.msg(e.msg,{icon:5,time:1e3})}):layer.msg("请选择菜单类型"):layer.msg("请输入菜单名称")},i.deleteMenu=function(t){layer.confirm("确定删除该菜单？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0},function(e){layer.close(e),a({method:"POST",url:BASEURL+"/cms2/menu/delete?device=1&menu_id="+t}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),i.getMenuList()):layer.msg(e.msg,{icon:5,time:1e3})})})},i.deleteMenuPower=function(){var e=i.ids.join(",");a({method:"POST",url:BASEURL+"/cms2/menu/power/delete?device=1&menu_id="+i.menu_id+"&power_ids="+e}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),$("#menu_power_list").modal("hide")):layer.msg(e.msg,{icon:0,time:1e3})})},i.addMenuPower=function(){var e=i.ids.join(",");a({method:"POST",url:BASEURL+"/cms2/menu/power/allot?device=1&menu_id="+i.menu_id+"&power_ids="+e}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),$("#add_menu_power").modal("hide")):layer.msg(e.msg,{icon:0,time:1e3})})}}]),app.controller("orderDetailCtrl",["$scope","$http","$stateParams","$timeout",function(c,r,n,s){function t(e){1==e.status?(layer.msg("上传成功",{icon:1,time:1500}),c.insurance=e.data[0].normal,angular.element("#adv-img").attr("src",imgUrl+e.data[0].normal)):layer.msg("上传失败",{icon:5,time:1500})}function a(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})}function i(e){1==e.status?(layer.msg("上传成功",{icon:1,time:1500}),c.authcletter=e.data[0].normal,angular.element("#authcletter_img").attr("src",imgUrl+e.data[0].normal)):layer.msg("上传失败",{icon:5,time:1500})}function o(e){1==e.status?(layer.msg("上传成功",{icon:1,time:1500}),c.refund_img=e.data[0].normal,angular.element("#refund_img").attr("src",imgUrl+e.data[0].normal)):layer.msg("上传失败",{icon:5,time:1500})}c.insurance="",c.refundMoney="",angular.element("#sel-adv-img").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:a,success:t,xhrFields:{withCredentials:!0}};angular.element("#uploadAdv").ajaxSubmit(e)}),c.authcletter="",angular.element("#sel_authcletter").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:a,success:i,xhrFields:{withCredentials:!0}};angular.element("#uploadAuthcletter").ajaxSubmit(e)}),c.refund_img="",angular.element("#sel_refund").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:a,success:o,xhrFields:{withCredentials:!0}};angular.element("#uploadRefund").ajaxSubmit(e)}),c.request_url="",c.task_check_order=!1,c.task_check_order_advance=!1,c.task_order_dispatch=!1,c.task_check_car_error=!1,c.task_pay_front_voucher_check=!1,c.task_ser_pay_final=!1,c.task_pay_final_voucher_check=!1,c.task_check_apply_refund=!1,c.task_transport_insurance=!1;c.getOrderDetail=function(){var o=layer.msg("加载中...",{icon:16,time:0});r({method:"GET",url:BASEURL+"/cms2/order/detail/"+n.oid+"?device=1"}).success(function(e){if(layer.close(o),1==e.status){c.orderDetail=e.data,e.data.brand_id,e.data.sub_brand_id,e.data.model_id,sessionStorage.orderDetail=JSON.stringify(e.data),c.autoImages=[];var t=["左前45度","右后45度","发动机舱","铭牌","里程数","备胎","中控台","内饰","验车单"];if(e.data.check_auto_extra)for(var a=e.data.check_auto_extra.split(","),i=0;i<a.length;i++){var r={};r.picture=a[i],r.name=t[i],a[i]&&c.autoImages.push(r)}if(c.finalpayment_voucher=[],e.data.finalpayment_voucher)for(var n=e.data.finalpayment_voucher.split(","),s=0;s<n.length;s++)n[s]&&c.finalpayment_voucher.push(n[s]);switch(e.data.state_process){case"task_check_order":c.task_check_order=!0;break;case"task_order_dispatch":c.task_order_dispatch=!0;break;case"task_check_order_advance":c.task_check_order_advance=!0;break;case"task_check_car_error":c.task_check_car_error=!0;break;case"task_pay_front_voucher_check":c.task_pay_front_voucher_check=!0;break;case"task_ser_pay_final":c.task_ser_pay_final=!0;break;case"task_pay_final_voucher_check":c.task_pay_final_voucher_check=!0;break;case"task_check_apply_refund":c.task_check_apply_refund=!0;break;case"task_transport_insurance":c.task_transport_insurance=!0}}else layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){})},c.getOrderDetail(),c.authcletter="",c.uploadAuthcletter=function(){r({method:"POST",url:BASEURL+"/cms2/order/authcletter",params:{device:1,order_id:n.oid,picture:c.authcletter}}).success(function(e){1==e.status?$("#authcletter_img").attr("src")?($("#authcletter").modal("hide"),angular.element("#authcletter_img").attr("src",""),layer.msg(e.msg,{icon:1,time:1e3}),s(function(){c.getOrderDetail()},1500)):alert("请上传图片"):layer.msg(e.msg,{icon:0,time:1e3})})},c.uploadInsurance=function(){r({method:"POST",url:BASEURL+"/cms2/order/insurance",params:{device:1,order_id:n.oid,picture:c.insurance}}).success(function(e){1==e.status?($("#uploadInsurance").modal("hide"),angular.element("#adv-img").attr("src",""),layer.msg(e.msg,{icon:1,time:1e3}),s(function(){c.task_transport_insurance=!1,c.getOrderDetail()},1500)):layer.msg(e.msg,{icon:0,time:1e3})})},c.checkOrder=function(){c.request_url="/cms2/order/check/base/",c.passed("订单审核是否通过？",c.request_url)},c.checkAdvanced=function(){c.request_url="/cms2/order/check/advanced/",c.passed("垫资金额审核是否通过？",c.request_url)},c.sendOrder=function(){layer.open({title:"选择派单司机",type:1,skin:"layui-layer-molv",btn:["确定","取消"],anim:2,shadeClose:!0,area:"250px",content:$("#driverList"),yes:function(e){if(c.list_id){var t=layer.msg("数据提交中...",{icon:16,time:0});r({method:"POST",url:BASEURL+"/cms2/order/dispatch/driver",timeout:1e4,params:{device:1,order_id:n.oid,driver_id:c.list_id}}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),s(function(){c.task_check_order=!1,c.task_check_order_advance=!1,c.task_order_dispatch=!1,c.task_check_car_error=!1,c.task_pay_front_voucher_check=!1,c.task_ser_pay_final=!1,c.task_pay_final_voucher_check=!1,c.task_check_apply_refund=!1,c.getOrderDetail()},2e3)):layer.msg(e.msg,{icon:5,time:1500})})}else layer.msg("未选择司机",{icon:5,time:1500});layer.close(e)},success:function(){r({method:"GET",url:BASEURL+"/api2/driver/users/idle?device=1",timeout:1e4}).success(function(e){1==e.status?c.driverList=e.list:layer.msg("请求失败",{icon:5})}).error(function(e){})}})},c.solveTestCar=function(){c.request_url="/cms2/order/assist/inspect?order_id=",layer.confirm("验车异常处理结果？",{title:"提示",skin:"layui-layer-molv",btn:["重新验车","编辑订单","退款"],icon:0,btn3:function(e){c.checkRequest(3,"",c.request_url)}},function(e){c.message(1,"请输入理由？",c.request_url)},function(e){c.message(2,"请输入理由？",c.request_url)})},c.checkDownPayment=function(){c.request_url="/cms2/order/check/payment/first?order_id=",c.passed("首付款审核是否通过",c.request_url)},c.FinalPayment=function(){layer.confirm("确定已经完成尾款支付？",{title:"提示",icon:0,skin:"layui-layer-molv",btn:["确定","取消"],shadeClose:!0},function(e){layer.close(e),r({method:"POST",url:BASEURL+"/cms2/order/pay/last/"+n.oid+"?device=1",timeout:1e4}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),s(function(){c.task_check_order=!1,c.task_check_order_advance=!1,c.task_order_dispatch=!1,c.task_check_car_error=!1,c.task_pay_front_voucher_check=!1,c.task_ser_pay_final=!1,c.task_pay_final_voucher_check=!1,c.task_check_apply_refund=!1,c.getOrderDetail()},2e3)):layer.msg(e.msg,{icon:5,time:1500})}).error(function(e){})})},c.checkFinalPayment=function(){c.request_url="/cms2/order/check/payment/last?order_id=",c.passed("尾款审核是否通过",c.request_url)},c.checkRefund=function(){$("#refund_price").modal("show"),r({method:"GET",url:BASEURL+"/cms2/order/"+n.oid+"/refund/detail?device=1",timeout:1e4}).success(function(e){1==e.status?(c.refundDetail=e.data,c.refund_price=e.data.transport_price-e.data.service_price,c.ref_price=c.refund_price,c.service_price=e.data.service_price||0,c.$watch("service_price",function(e){c.ref_price=c.refundDetail.transport_price-e,c.ref_price<0&&(c.ref_price=0),c.ref_price>c.refundDetail.transport_price&&(c.ref_price=c.refundDetail.transport_price)})):layer.msg(e.msg,{icon:5})}).error(function(e){})},c.submitRefund=function(){var e=c.refundDetail.service_price-c.service_price;console.log(e),r({method:"POST",url:BASEURL+"/cms2/order/check/refund",params:{device:1,order_id:n.oid,refund_price:e}}).success(function(e){1==e.status?($("#refund_price").modal("hide"),layer.msg(e.msg,{icon:1,time:1500}),s(function(){c.task_check_order=!1,c.task_check_order_advance=!1,c.task_order_dispatch=!1,c.task_check_car_error=!1,c.task_pay_front_voucher_check=!1,c.task_ser_pay_final=!1,c.task_pay_final_voucher_check=!1,c.task_check_apply_refund=!1,c.getOrderDetail()},2e3)):layer.msg(e.msg,{icon:5,time:1500})})},c.prcie="",c.extra="",c.refund=function(){c.refund_img,c.price,c.extra},c.passed=function(e,a){layer.confirm(e,{title:"提示",icon:0,skin:"layui-layer-molv",btn:["通过","不通过"],shadeClose:!0},function(e){layer.close(e),layer.prompt({title:"备注",formType:2,shadeClose:!0},function(e,t){layer.close(t),c.checkRequest(1,e,a)})},function(e){layer.close(e),c.message(0,"请输入不通过理由",a)})},c.checkRequest=function(e,t,a){var i=layer.msg("数据提交中...",{icon:16,time:0});r({method:"POST",url:BASEURL+a+n.oid,params:{device:1,state:e,message:t}}).success(function(e){layer.close(i),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),s(function(){c.task_check_order=!1,c.task_check_order_advance=!1,c.task_order_dispatch=!1,c.task_check_car_error=!1,c.task_pay_front_voucher_check=!1,c.task_ser_pay_final=!1,c.task_pay_final_voucher_check=!1,c.task_check_apply_refund=!1,c.getOrderDetail()},2e3)):layer.msg(e.msg,{icon:5,time:1500})})},c.message=function(a,e,i){layer.prompt({title:e,formType:2,shadeClose:!0},function(e,t){c.checkRequest(a,e,i),layer.close(t)})},c.checkOrderState=function(){c.jump("/home/orderState/"+n.oid)};var l={user_id:c.commentData="",page_index:"",page_size:""};c.getcomment=function(){null==n.page_index?l.page_index=1:l.page_index=n.page_index;var t=layer.msg("加载中...",{icon:16,time:0});r({method:"GET",url:BASEURL+"/api2/comment/transport?device=1",params:l}).success(function(e){layer.close(t),1==e.status?(c.commentData=e.list,c.pageNumber=e.page.pageNumber,c.recordCount=e.page.recordCount,c.pageCount=e.page.pageCount,c.pageSize=e.page.pageSize,c.pageList=c.pageNum(c.pageCount,c.pageNumber),c.startData=0==c.recordCount?0:(c.pageNumber-1)*c.pageSize+1,c.endData=e.list.length<c.pageSize?(c.pageNumber-1)*c.pageSize+e.list.length:c.pageNumber*c.pageSize):layer.msg("请求失败",{icon:5})}).error(function(e){})},c.commentDisable=function(a){layer.confirm("确认是否禁用评论？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e);var t=layer.msg("数据提交中...",{icon:16,time:0});r({method:"POST",url:BASEURL+"/cms2/supplier/temporary/"+a+"?device=1"}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),c.getcomment(l)):layer.msg(e.msg,{icon:5,time:1500})})},function(e){layer.close(e)})}}]),app.controller("orderStateCtrl",["$http","$scope","$stateParams",function(e,a,i){a.getOrderState=function(){var t=layer.msg("加载中...",{icon:16,time:0});e({method:"GET",url:BASEURL+"/cms2/count/order?device=1&order_id="+i.oid}).success(function(e){layer.close(t),1==e.status&&(a.order_state=e.list)})},a.getOrderState(),a.backDetail=function(){a.jump("/home/orderDetail/"+i.oid)}}]),app.controller("pageStayTimeCtrl",["$scope","$http","$stateParams","$state",function(a,i,r,e){var t=new Date,n=t.getFullYear(),s=t.getMonth()+1;s=s<10?"0"+s:s;var o=t.getDate(),c=n+"-"+s+"-"+(o=o<10?"0"+o:o);a.start_time=c,a.end_time=c;a.getStayTime=function(e){var t=layer.msg("加载中...",{icon:16,time:0});e.start_time=r.start_time,e.end_time=r.end_time,i({method:"GET",url:BASEURL+"/cms2/count/proportion?device=1",params:e}).success(function(e){layer.close(t),1==e.status&&(a.user_num=e.list,""!=e.list[0].proportion&&null!=e.list[0].proportion?a.proportion=e.list[0].proportion+"%":a.proportion="")})},a.getStayTime({start_time:"",end_time:""})}]),app.controller("peopleDetailCtrl",["$scope","$http","$stateParams","$timeout","$state","httpData",function(n,e,a,t,i,r){var s;n.areaList=[],n.select_id_lists=[],console.log(a),n.current_provice_id="",n.current_city_id="",n.current_provice_name="";var o=n.current_city_name="",c={areaListUrl:"/sales/user/user/watch?device=1",province_url:"/api2/area/provinces?device=1",city_url:"/api2/area/cities?device=1",addAreaUrl:"/cms2/user/allocation?device=1",init:function(){this.getAreaList(),this.getProvince()},getAreaList:function(){s=layer.load(1),r.getData("GET",this.areaListUrl,{mobile:a.mobile},this.setAreaList,this.errorData)},setAreaList:function(e){if(layer.close(s),1==e.status){for(var t=e.datas,a=0;a<t.length;a++)n.areaList.push({p_name:t[a].provinceName,c_name:t[a].cityName}),n.select_id_lists.push(t[a].province_id+","+t[a].city_id);console.log(n.areaList,n.select_id_lists)}},addArea:function(e){var t={mobile:a.mobile,sale_area:e};s=layer.load(1),r.getData("POST",this.addAreaUrl,t,this.addAreaSuccess,this.errorData)},addAreaSuccess:function(e){layer.close(s),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),t(function(){i.go("home.peopleManagement")},2e3)):layer.msg(e.msg,{icon:5,time:1500})},errorData:function(){layer.close(s),n.has_clicked=!1,layer.msg("请求失败",{icon:5})},getProvince:function(){r.getData("GET",this.province_url,"",this.setProvince,this.errorData)},setProvince:function(e){1==e.status&&(n.province_list=e.list,n.province_list.unshift({id:0,name:"全国"}))},getCity:function(e){r.getData("GET",this.city_url,{province:e},this.setCity,this.errorData)},setCity:function(e){1==e.status&&(n.city_list=e.list,n.city_list.unshift({id:0,name:"全省"}))},handleAreaData:function(e,t){n.select_id_lists.push(e),n.areaList.push(t)},removeAreaData:function(e){n.select_id_lists.splice(e,1),n.areaList.splice(e,1)},removal:function(){var a=this,e=n.current_provice_id+","+n.current_city_id,t={p_name:n.current_provice_name,c_name:n.current_city_name};if(n.select_id_lists.length<=0)a.handleAreaData(e,t);else{if(0==n.current_provice_id)return n.areaList=[],n.select_id_lists=[],a.handleAreaData(e,t),!1;if(n.select_id_lists.forEach(function(e,t){0==e.split(",")[0]&&a.removeAreaData(t)}),0==n.current_city_id){for(var i=n.select_id_lists.length;i--;){var r=n.select_id_lists[i].split(",")[0];console.log(n.select_id_lists[i]),r==n.current_provice_id&&a.removeAreaData(i)}return this.handleAreaData(e,t),!1}n.select_id_lists.forEach(function(e,t){0==e.split(",")[1]&&a.removeAreaData(t)}),-1==$.inArray(e,n.select_id_lists)?a.handleAreaData(e,t):layer.msg("当前区域已选择！")}console.log(n.areaList,n.select_id_lists)}};c.init(),n.changeProvince=function(){n.city_list=[],n.current_city_id="",n.current_city_name="",0!=n.selectedProvince.id?(n.current_provice_id=n.selectedProvince.id,n.current_provice_name=n.selectedProvince.name,c.getCity(n.selectedProvince.id)):(n.current_provice_id=n.selectedProvince.id,n.current_provice_name=n.selectedProvince.name,n.current_city_id=0)},n.changeCity=function(){n.selectedCity&&(n.current_city_name=n.selectedCity.name,n.current_city_id=n.selectedCity.id)},n.addManagementArea=function(){0==n.selectedProvince.id||n.selectedCity?(c.removal(),o=n.select_id_lists.join("|"),console.log(o)):layer.msg("请选省市之后在添加")},n.removeArea=function(e){c.removeAreaData(e)},n.saveManagementArea=function(){o?c.addArea(o):layer.msg("未选择任何区域")}}]),app.controller("peopleManagementCtrl",["$scope","$http","$stateParams","$timeout","$state","httpData",function(a,e,t,i,r,n){a.page_index=1,a.has_clicked=!1,a.department_id="";var s={people_url:"/cms2/role/more/users?device=1",errorData:function(){a.has_clicked=!1,layer.msg("请求失败",{icon:5})},getPeopleList:function(e){if(e){var t={page_index:a.page_index,page_size:100,role_id:e};a.department_id=e,n.getData("GET",this.people_url,t,this.setPeopleList,this.errorData)}},setPeopleList:function(e){1==e.status&&(a.people_list=e.list,a.pageNumber=e.page.pageNumber,a.recordCount=e.page.recordCount,a.pageCount=e.page.pageCount,a.pageSize=e.page.pageSize,a.pageList=a.pageNum(a.pageCount,a.pageNumber),a.startData=0==a.recordCount?0:(a.pageNumber-1)*a.pageSize+1,a.endData=e.list.length<a.pageSize?(a.pageNumber-1)*a.pageSize+e.list.length:a.pageNumber*a.pageSize)}};a.getPeopleList=function(e){s.getPeopleList(e),a.department_id=e},a.changePageUrl=function(e){a.page_index=a.getPageIndex(e,a.pageNumber,a.pageCount),s.getPeopleList()}}]),app.controller("personAuthCtrl",["$scope","$http","$stateParams","$timeout",function(t,e,a,i){var r={id_card_a:"",id_card_b:""};function n(e,t){$("#"+e).ajaxSubmit({url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,xhrFields:{withCredentials:!0},beforeSubmit:function(e){for(var t=0;t<e.length;t++){if("filedata"!=e[t].name)return;if(""!=e[t].value){var a=e[t].value.type;return}}if("image/png"!=a&&"image/jpeg"!=a&&"image/gif"!=a)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},success:function(e){1==e.status?(layer.msg("上传成功",{icon:1,time:1500}),$("."+t).attr("src",imgUrl+e.data[0].normal),r[t]=e.data[0].normal):layer.msg("上传失败",{icon:5,time:1500})}})}$("#id_card_a").on("change",function(){n("uploadImg1","id_card_a")}),$("#id_card_b").on("change",function(){n("uploadImg2","id_card_b")}),t.saveInfo=function(){e({method:"POST",url:BASEURL+"/cms2/user/cert?device=1",params:{id:a.user_id,name:t.user_name,id_card:t.id_card,idcard_a:r.id_card_a,idcard_b:r.id_card_b}}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),i(function(){t.jump("home/cms/user")},1500)):layer.msg(e.msg)})}}]),app.controller("planManagementListsCtrl",["$scope","$http","$stateParams","$state","$timeout","httpData",function(r,a,n,i,e,t){var s=layer.load(1),o={company_url:"/cms2/company/datas?device=1&co_type=4",list_url:"/cms2/finance/program/query?device=1",listsSendData:{page_index:1,page_size:10,company_id:"",name:"",area:""},init:function(){this.getDataFromUrl(),this.getProgramList(),this.getCompanyList()},getDataFromUrl:function(){var e=n.page_index,t=n.company_id,a=n.name,i=n.area;e||(e=1),r.company_id=t,r.name=a,r.area=i,this.listsSendData={page_index:e,page_size:10,company_id:t,name:a,area:i}},selectData:function(){this.listsSendData.page_index=1,this.listsSendData.company_id=r.company_id,this.listsSendData.name=r.name,this.listsSendData.area=r.area,i.go("home.planManagementLists",this.listsSendData)},errorData:function(){layer.close(s),r.has_clicked=!1,layer.msg("请求失败",{icon:5})},getCompanyList:function(){t.getData("GET",this.company_url,"",this.setCompanyList,this.errorData)},setCompanyList:function(e){layer.close(s),1==e.status?r.financialCompanyList=e.list:layer.msg("请求失败",{icon:5})},getProgramList:function(){t.getData("GET",this.list_url,this.listsSendData,this.setProgramList,this.errorData)},setProgramList:function(e){layer.close(s),1==e.status?(r.programData=e.list,r.pageNumber=e.page.pageNumber,r.recordCount=e.page.recordCount,r.pageCount=e.page.pageCount,r.pageSize=e.page.pageSize,r.pageList=r.pageNum(r.pageCount,r.pageNumber),r.startData=0==r.recordCount?0:(r.pageNumber-1)*r.pageSize+1,r.endData=e.list.length<r.pageSize?(r.pageNumber-1)*r.pageSize+e.list.length:r.pageNumber*r.pageSize):layer.msg("请求失败",{icon:5})}};o.init(),r.changePageUrl=function(e){o.listsSendData.page_index=r.getPageIndex(e,r.pageNumber,r.pageCount),i.go("home.planManagementLists",o.listsSendData)},r.selectProgramChange=function(){o.selectData()},r.program_search=function(){o.selectData()};var c=!1;r.$watch("name",function(){c&&""==r.name&&o.selectData(),c=!0}),r.deleteProgram=function(t){layer.confirm("确认删除该方案？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),a({method:"POST",url:BASEURL+"/cms2/finance/program/delete?device=1",params:{ids:t},timeout:1e3}).success(function(e){console.log(e),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),r.getProgramList(selectProgramData)):layer.msg(e.msg,{icon:0,time:1500})}).error(function(){layer.msg("请求失败",{icon:5})})},function(e){layer.close(e)})},r.getProgramDetail=function(e){$("#prevProgramme").modal("show"),r.seeProgrammeData=r.programData[e]},r.programListEdit=function(e,t){var a={type:1,id:e};i.go("home.addPlan",a)}}]),app.controller("printInfoCtrl",["$scope",function(e){var t=sessionStorage.orderDetail;e.order=JSON.parse(t);var a=new Date,i=a.getFullYear(),r=a.getMonth()+1,n=a.getDate();e.tabulateDate=i+"-"+r+"-"+n,e.lister=sessionStorage.nickname}]),app.controller("powerCtrl",["$http","$scope",function(a,i){i.power_list="",i.getPowerList=function(){a({method:"GET",url:BASEURL+"/cms2/power/datas?device=1"}).success(function(e){1==e.status&&(i.power_list=e.list)})},i.getPowerList(),i.power_id="",i.editPower=function(e,t){$("#editPowerModal").modal("show"),i.power_data=i.power_list[t],i.power_id=e},i.savePower=function(){a({method:"POST",url:BASEURL+"/cms2/power/edit?device=1",params:{power_id:i.power_id,name:i.power_data.name,permission:i.power_data.permission,remark:i.power_data.remark}}).success(function(e){1==e.status?($("#editPowerModal").modal("hide"),layer.msg(e.msg,{icon:1,time:1e3}),i.getPowerList()):layer.msg(e.msg,{icon:5,time:1e3})})},i.deletePower=function(t){layer.confirm("确定删除该权限？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0},function(e){layer.close(e),a({method:"POST",url:BASEURL+"/cms2/power/delete?device=1&power_id="+t}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),i.getPowerList()):layer.msg(e.msg,{icon:5,time:1e3})})},function(e){layer.close(e)})},i.power_name="",i.power_flag="",i.remark="",i.addPower=function(){if(""!=i.power_name&&""!=i.permission){var e={name:i.power_name,permission:i.permission,remark:i.remark};a({method:"POST",url:BASEURL+"/cms2/power/add?device=1",params:e}).success(function(e){1==e.status&&(layer.msg("创建成功",{icon:1,time:1e3}),$("#addPowerModal").modal("hide"),i.power_name="",i.permission="",i.remark="",i.getPowerList())})}else layer.msg("权限名称或权限标识为空",{icon:0,time:1e3})}}]),app.controller("releaseBackResourceCtrl",["$scope","$window","$timeout","httpRequestData","$stateParams","dateConversion","$state",function(r,t,a,i,n,s,o){var c=layer.load(1);$("#resEffectiveData").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0,startDate:new Date}),r.orderSelectProgrammeData=[],r.selectObj=[],r.selectProgrammeData=[],r.selectData=[],r.showProgrammeLists=[],r.programme_id_lists=[],r.pageIndex=1,r.pageSize=10;var l={cityUrl:"/api2/area/cities?device=1",subBrandUrl:"/api2/res/brand/",modelUrl:"/api2/res/model/",releaseResourceUrl:"/res_v1_0_0/cms/back/rent/insert?out=json",updateResourceUrl:"/res_v1_0_0/cms/back/rent/update?out=json",programmeUrl:"/cms2/finance/program/query?device=1",programmeDetailUrl:"/cms2/finance/program/calculationg?device=1",res_detail_url:"/res_v1_0_0/cms/back/res/detail?out=json",httpError:function(){layer.close(c),r.has_clicked=!1,layer.msg("请求失败",{icon:5})},stateError:function(e){layer.close(c),r.has_clicked=!1,layer.msg(e)},setBrandData:function(e){layer.close(c),1===e.status?r.brandList=e.list:l.stateError(e.msg)},setSubBrandData:function(e){layer.close(c),1===e.status?r.subBrandList=e.list:l.stateError(e.msg)},setModelData:function(e){layer.close(c),1===e.status?(r.modelList=e.list,n.id&&(e.list.forEach(function(e,t){if(e.id==r.model_id)return r.engine=e.engine,void(r.engine_num=parseFloat(e.engine))}),l.getProgrammes(),l.getProgrammeDetail())):l.stateError(e.msg)},setProgrammesData:function(e){if(layer.close(c),1===e.status){var i=e.list;n.id&&(r.selectData=[]),r.selectProgrammeData.forEach(function(a,e){i.forEach(function(e,t){if(a==e.id)return i[t].has_check=!0,void(n.id&&r.selectData.push(e))})}),r.programmeLists=i,r.pageNumber=e.page.pageNumber,r.recordCount=e.page.recordCount,r.pageCount=e.page.pageCount,r.pageSize=e.page.pageSize,r.pageList=r.pageNum(r.pageCount,r.pageNumber),r.startData=0==r.recordCount?0:(r.pageNumber-1)*r.pageSize+1,r.endData=e.list.length<r.pageSize?(r.pageNumber-1)*r.pageSize+e.list.length:r.pageNumber*r.pageSize}else l.stateError(e.msg)},setReleaseResourceData:function(e){if(layer.close(c),1===e.status){if(layer.msg(e.msg,{icon:1,time:1500}),n.id)return void a(function(){o.go("home.backResource")},1600);r.has_click_release=!0,a(function(){layer.confirm("是否继续发布？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),t.location.reload()},function(e){layer.close(e),o.go("home.backResource")})},1600)}else l.stateError(e.msg)},setProgrammesDetailData:function(e){layer.close(c),angular.element("#programmeShow").removeClass("hide"),1===e.status?r.showProgrammeLists=e.data.program_item_list:l.stateError(e.msg)},getProvince:function(){var e={req_data:{method:"GET",url:PROVINCE_URL},requestSuccess:this.setProvince.bind(this),requestErroe:this.httpError.bind(this)};i.getData(e)},setProvince:function(e){layer.close(c),1==e.status?r.provinceLists=e.list:l.stateError(data.msg)},getCityLists:function(){var e={province:r.province_id},t={req_data:{method:"GET",url:BASEURL+l.cityUrl,params:e},requestSuccess:this.setCity.bind(this),requestErroe:this.httpError.bind(this)};i.getData(t)},setCity:function(e){layer.close(c),1==e.status?r.cityLists=e.list:l.stateError(data.msg)},getBrand:function(){var e={req_data:{method:"GET",url:CAR_BRAND_URL},requestSuccess:this.setBrandData.bind(this),requestErroe:this.httpError.bind(this)};i.getData(e)},getSubBrand:function(e){var t={req_data:{method:"GET",url:BASEURL+this.subBrandUrl+e+"?device=1"},requestSuccess:this.setSubBrandData.bind(this),requestErroe:this.httpError.bind(this)};i.getData(t)},getModel:function(e){var t={req_data:{method:"GET",url:BASEURL+this.modelUrl+r.brand_id+"/"+e+"?device=1"},requestSuccess:this.setModelData.bind(this),requestErroe:this.httpError.bind(this)};i.getData(t)},releaseResource:function(e){var t={req_data:{method:"POST",url:BASEURL+this.releaseResourceUrl,data:e},requestSuccess:this.setReleaseResourceData.bind(this),requestErroe:this.httpError.bind(this)};i.getData(t)},updateResource:function(e){var t={req_data:{method:"POST",url:BASEURL+this.updateResourceUrl,data:e},requestSuccess:this.setReleaseResourceData.bind(this),requestErroe:this.httpError.bind(this)};i.getData(t)},getProgrammes:function(){var e={page_index:r.pageIndex,page_size:r.pageSize},t={req_data:{method:"GET",url:BASEURL+this.programmeUrl,params:e},requestSuccess:this.setProgrammesData.bind(this),requestErroe:this.httpError.bind(this)};i.getData(t)},getProgrammeDetail:function(){var e={price_bill:1e4*r.fares,price_sale:1e4*r.sale_price,tax:r.engine_num,finance_ids:r.programme_id_lists.join(",")},t={req_data:{method:"GET",url:BASEURL+this.programmeDetailUrl,params:e},requestSuccess:this.setProgrammesDetailData.bind(this),requestErroe:this.httpError.bind(this)};i.getData(t)},selCarDataById:function(e,a){var i={};try{angular.forEach(e,function(e,t){e.id!=a||(i=e)})}catch(e){}return i},getDataFromUrl:function(){var e=n.id,t=!1;return r.title="发布回租资源",e&&(t=!0,r.title="编辑回租资源"),t},getDetailById:function(e){var t={resource_id:e},a={req_data:{method:"GET",url:BASEURL+this.res_detail_url,params:t},requestSuccess:this.setDetail.bind(this),requestError:this.httpError.bind(this)};i.getData(a)},setDetail:function(e){if(1==e.status){var t=e.data.res[0];r.brand_id=t.brandId,r.brand_name=t.brandName,r.sub_brand_id=t.subBrandId,r.sub_brand_name=t.subBrandName,r.model_id=t.modelId,r.model_name=t.modelName,r.engin=t.modleEngine,r.model_rice=t.modelPrice/1e6,r.model_picture=t.modelPicture,r.sale_price=t.salePrice/1e6,r.fares=t.facePrice/1e6,r.extra=t.resourceExtra,r.manufacture=t.manufactureTime;try{var a=t.sourceArea.split(",");r.province_id=a[0],r.city_id=a[1]}catch(e){r.province_id="",r.city_id=""}r.expiration_date=s.sTot(t.endTime/1e3,"date"),e.data.finance.forEach(function(e,t){r.selectProgrammeData.push(e.id),r.programme_id_lists.push(e.id)}),r.orderSelectProgrammeData=r.selectProgrammeData,r.brand_id&&l.getSubBrand(r.brand_id),r.sub_brand_id&&l.getModel(r.sub_brand_id),r.province_id&&l.getCityLists()}else l.stateError(e.msg)},init:function(){this.getBrand(),this.getProvince(),this.getDataFromUrl()&&this.getDetailById(n.id)}};l.init(),r.selectProgramme=function(){r.currentSelectProgramme=[],r.model_id?r.sale_price?r.fares?(l.getProgrammes(),$("#programmeModal").modal({backdrop:"static",keyboard:!1})):layer.msg("请输入开票价",{icon:5,time:1500}):layer.msg("请输入销售价",{icon:5,time:1500}):layer.msg("请选择车型",{icon:5,time:1500})},r.changeModel=function(){var e=l.selCarDataById(r.modelList,r.model_id);r.engine=e.engine,r.engine_num=parseFloat(e.engine),r.model_rice=parseFloat(e.refer_price),r.model_name=e.name,r.model_picture=e.car_img},r.changePrice=function(){r.has_click_release=!1,0<r.orderSelectProgrammeData.length&&l.getProgrammeDetail()},r.focusPrice=function(){r.has_click_release=!0},r.orderProgramme=function(){var e=r.selectData.length;if($("#programmeModal").modal("hide"),0<e){r.programme_id_lists=[],r.orderSelectProgrammeData=r.selectProgrammeData,r.selectObj=r.selectData;var t=r.orderSelectProgrammeData.length;if(0<t){angular.element("#programmeShow").removeClass("hide");for(var a=0;a<t;a++)r.programme_id_lists.push(r.selectObj[a].id)}else angular.element("#programmeShow").addClass("hide");l.getProgrammeDetail()}else r.showProgrammeLists=[]},r.changeBrand=function(){var e=l.selCarDataById(r.brandList,r.brand_id);r.brand_name=e.name,l.getSubBrand(r.brand_id),r.modelList=[]},r.changeSubBrand=function(){var e=l.selCarDataById(r.subBrandList,r.sub_brand_id);r.sub_brand_name=e.name,l.getModel(r.sub_brand_id)},r.sendAddInfo=function(){r.has_click_release=!0;var e={resourceId:"",brandId:r.brand_id,brandName:r.brand_name,subBrandId:r.sub_brand_id,subBrandName:r.sub_brand_name,modelId:r.model_id,modelName:r.model_name,modleEngine:r.engine,modelPrice:Math.round(1e6*parseFloat(r.model_rice)),modelPicture:r.model_picture,salePrice:"",facePrice:r.fares,financeIds:"",resourceExtra:r.extra,manufactureTime:r.manufacture,endTime:"",sourceArea:r.province_id+","+r.city_id};if(!r.expiration_date)return layer.msg("请选择车源有效期",{icon:5,time:1500}),void(r.has_click_release=!1);var t=r.expiration_date.replace(/-/g,"/");return e.endTime=Date.parse(new Date(t)),r.model_id?(e.modelId=r.model_id,r.sale_price?(e.salePrice=Math.round(1e6*r.sale_price),0<r.orderSelectProgrammeData.length?(e.financeIds=r.orderSelectProgrammeData.join(","),r.fares?(e.facePrice=Math.round(1e6*r.fares),r.manufacture?(e.manufactureTime=r.manufacture,r.province_id&&r.city_id?void(n.id?(e.resourceId=n.id,l.updateResource(e)):l.releaseResource(e)):(layer.msg("请选择资源所在地",{icon:5,time:1500}),void(r.has_click_release=!1))):(layer.msg("请选择出厂日期",{icon:5,time:1500}),void(r.has_click_release=!1))):(layer.msg("请输入开票价",{icon:5,time:1500}),void(r.has_click_release=!1))):(layer.msg("请选择方案",{icon:5,time:1500}),void(r.has_click_release=!1))):(layer.msg("请输入销售价",{icon:5,time:1500}),void(r.has_click_release=!1))):(layer.msg("请选择车型",{icon:5,time:1500}),void(r.has_click_release=!1))},r.getProgramme=function(e,t){var a=e.currentTarget,i=$(a).attr("data-id");$(a).hasClass("programme-content-bg")?($(a).removeClass("programme-content-bg"),r.selectProgrammeData.forEach(function(e,t){if(e==i)return r.selectProgrammeData.splice(t,1),void r.selectData.splice(t,1)})):($(a).addClass("programme-content-bg"),r.selectProgrammeData.push(i),r.selectData.push(r.programmeLists[t]))},r.deleteProgramme=function(e,a){r.programme_id_lists.forEach(function(e,t){if(e==a)return r.selectProgrammeData.splice(t,1),r.programme_id_lists.splice(t,1),void r.selectData.splice(t,1)}),r.showProgrammeLists.splice(e,1),r.showProgrammeLists.length<=0&&angular.element("#programmeShow").addClass("hide")},r.closeProgrammesModel=function(){$("#programmeModal").modal("hide")},r.seeProgramme=function(e){r.seeProgrammeData=r.selectData[e],$("#prevProgramme").modal("show")},r.modelPreview=function(){$("#prevAll").modal("show")},r.seleProvince=function(){l.getCityLists()},r.changePageUrl=function(e){r.pageIndex=r.getPageIndex(e,r.pageNumber,r.pageCount),l.getProgrammes()}}]),app.controller("releaseFeaturedResourcesCtrl",["$scope","httpData","$window","$timeout","$stateParams","httpRequestData",function(r,e,t,a,i,n){var s=layer.load(1),o=i.type;r.type=o,r.title=1==o?"发布回租资源":"发布正租资源",$("#resEffectiveData").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0,startDate:new Date}),r.orderSelectProgrammeData=[],r.selectObj=[],r.selectProgrammeData=[],r.selectData=[],r.showProgrammeLists=[],r.programme_id_lists=[],r.pageIndex=1,r.pageSize=10,r.has_lighlights_edit=!0;var c={brandUrl:"/api2/res/brand?device=1",subBrandUrl:"/api2/res/brand/",modelUrl:"/api2/res/model/",releaseResourceUrl:"/cms2/resource/plan/new/add?device=1",programmeUrl:"/cms2/finance/program/query?device=1",programmeDetailUrl:"/cms2/finance/program/calculationg?device=1",errorAlert:function(){layer.msg("请求失败",{icon:5})},setError:function(e){layer.close(s),r.has_clicked=!1,c.errorAlert()},setBrandData:function(e){layer.close(s),1===e.status?r.brandList=e.list:c.errorAlert()},setSubBrandData:function(e){layer.close(s),1===e.status?r.subBrandList=e.list:c.errorAlert()},setModelData:function(e){layer.close(s),1===e.status?r.modelList=e.list:c.errorAlert()},setProgrammesData:function(e){if(layer.close(s),1===e.status){var i=e.list;r.selectProgrammeData.forEach(function(a,e){i.forEach(function(e,t){a!=e.id||(i[t].has_check=!0)})}),r.programmeLists=i,r.pageNumber=e.page.pageNumber,r.recordCount=e.page.recordCount,r.pageCount=e.page.pageCount,r.pageSize=e.page.pageSize,r.pageList=r.pageNum(r.pageCount,r.pageNumber),r.startData=0==r.recordCount?0:(r.pageNumber-1)*r.pageSize+1,r.endData=e.list.length<r.pageSize?(r.pageNumber-1)*r.pageSize+e.list.length:r.pageNumber*r.pageSize}else c.errorAlert()},setReleaseResourceData:function(e){layer.close(s),1===e.status?(layer.msg(e.msg,{icon:1,time:1500}),r.has_click_release=!0,a(function(){layer.confirm("是否继续发布？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),t.location.reload()},function(e){layer.close(e),t.location.reload()})},1600)):c.errorAlert()},setProgrammesDetailData:function(e){layer.close(s),console.log(e),1===e.status?r.showProgrammeLists=e.data.program_item_list:c.errorAlert()},getBrand:function(){var e={req_data:{url:BASEURL+this.brandUrl},requestSuccess:this.setBrandData,requestError:this.setError};n.getData(e)},getSubBrand:function(e){var t={req_data:{url:BASEURL+this.subBrandUrl+e+"?device=1"},requestSuccess:this.setSubBrandData,requestError:this.setError};n.getData(t)},getModel:function(e){var t={req_data:{url:BASEURL+this.modelUrl+r.brand_id+"/"+e+"?device=1"},requestSuccess:this.setModelData,requestError:this.setError};n.getData(t)},releaseResource:function(e){var t={req_data:{url:BASEURL+this.releaseResourceUrl},requestSuccess:this.setReleaseResourceData,requestError:this.setError};n.getData(t)},getProgrammes:function(){var e={page_index:r.pageIndex,page_size:r.pageSize},t={req_data:{url:BASEURL+this.programmeUrl,params:e},requestSuccess:this.setProgrammesData,requestError:this.setError};n.getData(t)},getProgrammeDetail:function(){var e={price_bill:r.fares,price_sale:r.sale_price,tax:r.engine,finance_ids:r.programme_id_lists.join(",")},t={req_data:{url:BASEURL+this.programmeDetailUrl,params:e},requestSuccess:this.setProgrammesDetailData,requestError:this.setError};n.getData(t)},init:function(){this.getBrand()}};c.init(),r.selectProgramme=function(){r.currentSelectProgramme=[],r.model_id?r.sale_price?r.fares?(c.getProgrammes(),$("#programmeModal").modal({backdrop:"static",keyboard:!1})):layer.msg("请输入开票价",{icon:5,time:1500}):layer.msg("请输入销售价",{icon:5,time:1500}):layer.msg("请选择车型",{icon:5,time:1500})},r.changeModel=function(){r.modelList.forEach(function(e,t){if(e.id==r.model_id)return r.engine=parseFloat(e.engine),void(r.guidance_price=parseFloat(e.refer_price))}),0<r.selectProgrammeData.length&&c.showProgrammeLists(),r.modelName=$("option[value="+r.model_id+"]").text().replace(/(^\s*)|(\s*$)/g,"")},r.changePrice=function(){r.has_click_release=!1,0<r.orderSelectProgrammeData.length&&c.getProgrammeDetail()},r.focusPrice=function(){r.has_click_release=!0},r.orderProgramme=function(){var e=r.selectData.length;if($("#programmeModal").modal("hide"),0<e){r.programme_id_lists=[],r.orderSelectProgrammeData=r.selectProgrammeData,r.selectObj=r.selectData;var t=r.orderSelectProgrammeData.length;if(0<t){angular.element("#programmeShow").removeClass("hide");for(var a=0;a<t;a++)r.programme_id_lists.push(r.selectObj[a].id)}else angular.element("#programmeShow").addClass("hide");c.getProgrammeDetail()}else r.showProgrammeLists=[]},r.changeBrand=function(){c.getSubBrand(r.brand_id),r.brandName=$("option[data-brand="+r.brand_id+"]").text().replace(/(^\s*)|(\s*$)/g,""),r.modelList=[]},r.changeSubBrand=function(){c.getModel(r.sub_brand_id),r.subBrandName=$("option[data-subbrand="+r.sub_brand_id+"]").text().replace(/(^\s*)|(\s*$)/g,"")},r.sendAddInfo=function(){r.has_click_release=!0;var e={model_id:"",sale_price:"",finance_ids:"",fares:"",manufacture:"",end_time:"",remark:"",recommend_flag:0};if(r.has_recommend&&(e.recommend_flag=1),e.remark=r.extra,!r.expiration_date)return layer.msg("请选择车源有效期",{icon:5,time:1500}),void(r.has_click_release=!1);var t=r.expiration_date.replace(/-/g,"/");return e.end_time=Date.parse(new Date(t)),r.model_id?(e.model_id=r.model_id,r.sale_price?(e.sale_price=1e4*r.sale_price,0<r.orderSelectProgrammeData.length?(e.finance_ids=r.orderSelectProgrammeData.join(","),r.fares?(e.fares=1e4*r.fares,r.manufacture?(e.manufacture=r.manufacture,void c.releaseResource(e)):(layer.msg("请选择出厂日期",{icon:5,time:1500}),void(r.has_click_release=!1))):(layer.msg("请输入开票价",{icon:5,time:1500}),void(r.has_click_release=!1))):(layer.msg("请选择方案",{icon:5,time:1500}),void(r.has_click_release=!1))):(layer.msg("请输入销售价",{icon:5,time:1500}),void(r.has_click_release=!1))):(layer.msg("请选择车型",{icon:5,time:1500}),void(r.has_click_release=!1))},r.getProgramme=function(e,t){var a=e.currentTarget,i=$(a).attr("data-id");$(a).hasClass("programme-content-bg")?($(a).removeClass("programme-content-bg"),r.selectProgrammeData.forEach(function(e,t){if(e==i)return r.selectProgrammeData.splice(t,1),void r.selectData.splice(t,1)})):($(a).addClass("programme-content-bg"),r.selectProgrammeData.push(i),r.selectData.push(r.programmeLists[t]))},r.deleteProgramme=function(e,a){r.programme_id_lists.forEach(function(e,t){if(e==a)return r.selectProgrammeData.splice(t,1),r.programme_id_lists.splice(t,1),void r.selectData.splice(t,1)}),r.showProgrammeLists.splice(e,1),r.showProgrammeLists.length<=0&&angular.element("#programmeShow").addClass("hide")},r.closeProgrammesModel=function(){$("#programmeModal").modal("hide")},r.seeProgramme=function(e){r.seeProgrammeData=r.selectObj[e],$("#prevProgramme").modal("show")},r.modelPreview=function(){$("#prevAll").modal("show")},r.changePageUrl=function(e){r.pageIndex=r.getPageIndex(e,r.pageNumber,r.pageCount),c.getProgrammes()},r.highlightsEdit=function(){function l(e,t){var r=document.createElement(t);return $(e).find("*").each(function(e,t){var a=t.tagName;if(a){var i=document.createElement(a);"img"===a.toLowerCase()?i.setAttribute("src",t.src):"a"===a.toLowerCase()?i.setAttribute("href",t.href):i.innerText=$.trim(t.innerText),r.appendChild(i)}}),r}$("#highlightsEdit").summernote({focus:!0,height:350,lang:"zh-CN",toolbar:[["style",["style","bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["insert",["link","picture","video","codeview"]],["table",["table"]],["hr",["hr"]],["image",["undo","redo","removeMedia","help"]]],callbacks:{onPaste:function(e){var c=((e.originalEvent||e).clipboardData||window.clipboardData).getData("text/html");e.preventDefault?e.preventDefault():e.returnValue=!1,setTimeout(function(){for(var e=/<body(([\s\S])*?)<\/body>/.exec(c)[0].replace(/style=\"(([\s\S])*?)\"/g,""),t=$(e),a=document.createElement("div"),i=0,r=t.length;i<r;i++){var n="",s=t[i],o=s.tagName;o&&("img"==(o=o.toLowerCase())?(n=document.createElement("img")).setAttribute("src",s.src):$(s).find("*").length<1?("a"==o?(n=document.createElement("a")).setAttribute("href",s.href):n=document.createElement(o),n.innerText=$.trim(s.innerText)):n=l(s,o),a.appendChild(n))}$("#highlightsEdit").summernote("code",a)},10)}}}),r.has_lighlights_edit=!1},r.highlightsClear=function(){$("#highlightsEdit").summernote("destroy"),r.has_lighlights_edit=!0}}]),app.controller("releaseJustRentProgramCtrl",["$scope","$window","$timeout","$stateParams","httpRequestData","dateConversion","imageTool","$state",function(s,t,a,n,i,o,r,c){var l=layer.load(1);function d(){var e=s.overEditProgrammeList.length;return 4<=s.programme_id_lists.length+e?(s.has_select_programe=!1,!0):(s.has_select_programe=!0,!1)}s.eidtProgrammeData={programmeName:"",serviceCharge:"",rebate:"",carAscription:"",buyNotice:"",proExplain:"",editprogrammeData:null,area:"",areaName:"",age:"",incomeInfo:"",basicInfo:""},s.overEditProgrammeList=[],$("#resEffectiveData").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0,startDate:new Date}),s.orderSelectProgrammeData=[],s.selectObj=[],s.selectProgrammeData=[],s.selectData=[],s.showProgrammeLists=[],s.programme_id_lists=[],s.pageIndex=1,s.pageSize=10,s.has_lighlights_edit=!0,s.current_index=-1,s.has_select_programe=!0,s.dateLists=["三个月之内","一年内","一年以上"];var u={cityUrl:"/api2/area/cities?device=1",brandUrl:"/api2/res/brand?device=1",subBrandUrl:"/api2/res/brand/",modelUrl:"/api2/res/model/",releaseResourceUrl:"/res_v1_0_0/cms/rent/res/insert?out=json",updateResourceUrl:"/res_v1_0_0/cms/rent/res/update?out=json",programmeUrl:"/cms2/finance/program/query?device=1",programmeDetailUrl:"/cms2/finance/program/calculationg?device=1",res_detail_url:"/res_v1_0_0/cms/rent/res/detail?out=json",httpError:function(){layer.close(l),s.has_clicked=!1,layer.msg("请求失败",{icon:5})},stateError:function(e){layer.close(l),s.has_clicked=!1,layer.msg(e)},getProvince:function(){var e={req_data:{method:"GET",url:PROVINCE_URL},requestSuccess:u.setProvince.bind(u),requestError:u.httpError.bind(u)};i.getData(e)},setProvince:function(e){layer.close(l),1==e.status?s.provinceLists=e.list:u.stateError(data.msg)},getCityLists:function(){var e={province:s.province_id},t={req_data:{method:"GET",url:BASEURL+u.cityUrl,params:e},requestSuccess:u.setCity.bind(u),requestError:u.httpError.bind(u)};i.getData(t)},setCity:function(e){layer.close(l),1==e.status?s.aresCityLists=e.list:u.stateError(data.msg)},setBrandData:function(e){layer.close(l),1===e.status?s.brandList=e.list:u.stateError(e.msg)},setSubBrandData:function(e){layer.close(l),1===e.status?s.subBrandList=e.list:u.stateError(e.msg)},setModelData:function(e){layer.close(l),1===e.status?(s.modelList=e.list,n.id&&(e.list.forEach(function(e,t){if(e.id==s.model_id)return s.engine=e.engine,void(s.engine_num=parseFloat(e.engine))}),u.getProgrammes(),u.getProgrammeDetail())):u.stateError(e.msg)},setProgrammesData:function(e){if(layer.close(l),1===e.status){var i=e.list;n.id&&(s.selectData=[]),s.selectProgrammeData.forEach(function(a,e){i.forEach(function(e,t){if(a==e.id)return i[t].has_check=!0,void(n.id&&s.selectData.push(e))})}),s.programmeLists=i,s.pageNumber=e.page.pageNumber,s.recordCount=e.page.recordCount,s.pageCount=e.page.pageCount,s.pageSize=e.page.pageSize,s.pageList=s.pageNum(s.pageCount,s.pageNumber),s.startData=0==s.recordCount?0:(s.pageNumber-1)*s.pageSize+1,s.endData=e.list.length<s.pageSize?(s.pageNumber-1)*s.pageSize+e.list.length:s.pageNumber*s.pageSize}else u.stateError(e.msg)},setReleaseResourceData:function(e){if(layer.close(l),1==e.status){if(layer.msg("操作成功",{icon:1,time:1500}),n.id)return void $setTimeout(function(){c.go("home.justRentLists")},1600);a(function(){layer.confirm("是否继续发布？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),t.location.reload()},function(e){layer.close(e),c.go("home.justRentLists")})},1600)}else u.stateError(e.msg)},setProgrammesDetailData:function(e){layer.close(l),1===e.status?s.showProgrammeLists=e.data.program_item_list:u.stateError(e.msg)},getBrand:function(){var e={req_data:{url:BASEURL+this.brandUrl},requestSuccess:u.setBrandData.bind(u),requestError:u.httpError.bind(u)};i.getData(e)},getSubBrand:function(e){var t={req_data:{url:BASEURL+this.subBrandUrl+e+"?device=1"},requestSuccess:u.setSubBrandData.bind(u),requestError:u.httpError.bind(u)};i.getData(t)},getModel:function(e){var t={req_data:{url:BASEURL+this.modelUrl+s.brand_id+"/"+e+"?device=1"},requestSuccess:u.setModelData.bind(u),requestError:u.httpError.bind(u)};i.getData(t)},releaseResource:function(e){var t={req_data:{method:"POST",url:BASEURL+u.releaseResourceUrl,data:e},requestSuccess:u.setReleaseResourceData.bind(u),requestError:u.httpError.bind(u)};i.getData(t)},updateResource:function(e){var t={req_data:{method:"POST",url:BASEURL+this.updateResourceUrl,data:e},requestSuccess:this.setReleaseResourceData.bind(this),requestErroe:this.httpError.bind(this)};i.getData(t)},getProgrammes:function(){var e={page_index:s.pageIndex,page_size:s.pageSize},t={req_data:{url:BASEURL+this.programmeUrl,params:e},requestSuccess:u.setProgrammesData.bind(u),requestError:u.httpError.bind(u)};i.getData(t)},getProgrammeDetail:function(){var e={price_bill:s.fares,price_sale:s.sale_price,tax:s.engine_num,finance_ids:s.programme_id_lists.join(",")},t={req_data:{url:BASEURL+this.programmeDetailUrl,params:e},requestSuccess:u.setProgrammesDetailData.bind(u),requestError:u.httpError.bind(u)};i.getData(t)},selCarDataById:function(e,a){var i={};try{angular.forEach(e,function(e,t){e.id!=a||(i=e)})}catch(e){}return i},getDataFromUrl:function(){var e=n.id,t=!1;return s.title="发布正租资源",e&&(t=!0,s.title="编辑正租资源"),t},getDetailById:function(e){var t={resource_id:e},a={req_data:{method:"GET",url:BASEURL+u.res_detail_url,params:t},requestSuccess:u.setDetail.bind(u),requestError:u.httpError.bind(u)};i.getData(a)},summernoteInit:function(){$("#highlightsEdit").summernote({focus:!0,height:350,lang:"zh-CN",toolbar:[["style",["style","bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["insert",["link","picture","video","codeview"]],["table",["table"]],["hr",["hr"]],["image",["undo","redo","removeMedia","help"]]],callbacks:{onPaste:function(e){var c=((e.originalEvent||e).clipboardData||window.clipboardData).getData("text/html");e.preventDefault?e.preventDefault():e.returnValue=!1,setTimeout(function(){for(var e=/<body(([\s\S])*?)<\/body>/.exec(c)[0].replace(/style=\"(([\s\S])*?)\"/g,""),t=$(e),a=document.createElement("div"),i=0,r=t.length;i<r;i++){var n="",s=t[i],o=s.tagName;o&&("img"==(o=o.toLowerCase())?(n=document.createElement("img")).setAttribute("src",s.src):$(s).find("*").length<1?("a"==o?(n=document.createElement("a")).setAttribute("href",s.href):n=document.createElement(o),n.innerText=$.trim(s.innerText)):n=removeDefaultStyle(s,o),a.appendChild(n))}$("#highlightsEdit").summernote("code",a)},10)},onImageUpload:function(e){r.upload(e[0]).then(function(e){layer.close(l);var t=document.createElement("img");t.src=imgUrl+e,$("#highlightsEdit").summernote("insertNode",t)},function(e){layer.close(l),layer.msg("图片上上传失败")})}}})},getPlanIds:function(e){var a=[];return angular.forEach(e,function(e,t){a.push(e.id)}),a},setDetail:function(e){if(1==e.status){var t=e.data.res,a=e.data.line;s.brand_id=t.brandId,s.brand_name=t.brandName,s.sub_brand_id=t.subBrandId,s.sub_brand_name=t.subBrandName,s.model_id=t.modelId,s.model_name=t.modelName,s.colors=t.colors,s.interior=t.interior,s.engin=t.modleEngine,s.engine_num=parseFloat(t.modleEngine),s.model_rice=t.modelPrice/1e6,s.model_picture=t.modelPicture,t.modelPicture||(s.model_picture=""),s.face_price=t.facePrice/1e6,s.sale_price=t.salePrice/1e6,s.fares=t.facePrice/1e6,s.extra=t.resourceExtra,s.luminous_point=t.resourceExtra;var i=s.dateLists.indexOf(t.manufactureTime);s.manufacture=i<0?"":i+"";try{s.province_id=e.data.sourceArea[0].provinceId,s.city_id=e.data.sourceArea[0].cityId,u.getCityLists()}catch(e){s.province_id="",s.city_id=""}s.expiration_date=t.endTime,e.data.finance.forEach(function(e,t){s.selectProgrammeData.push(e.id),s.programme_id_lists.push(e.id)}),u.summernoteInit(),s.has_lighlights_edit=!1,s.luminous_point=t.luminousPoint,$("#highlightsEdit").summernote("code",t.luminousPoint),s.orderSelectProgrammeData=s.selectProgrammeData,s.brand_id&&u.getSubBrand(s.brand_id),s.sub_brand_id&&u.getModel(s.sub_brand_id),s.province_id&&u.getCityLists(),s.programme_id_lists=u.getPlanIds(e.data.finance),u.getProgrammeDetail(),angular.forEach(a,function(e,t){var a={},i=angular.fromJson(e.programCondition.replace(/\'/g,'"'));a.programmeName=e.name,a.serviceCharge=e.proceduresPay/100,a.rebate=e.commissionPrice/100,a.carAscription=e.carAscription,a.buyNotice=e.carNeed,a.proExplain=e.programExplain,a.age=i.age,a.basicInfo=i.basicInfo,a.incomeInfo=i.incomeInfo;var r=[],n=[];angular.forEach(e.lineSaleAreas.area,function(e,t){var a=e.provinceId+","+e.cityId+","+e.districtId,i={};i.p_name=e.provinceName,i.c_name=e.cityName,i.t_name=e.districtName,r.push(a),n.push(i)}),a.areaName=n,s.orderSelectAraeData=s.showOrderSelectAraeData=n,s.select_id_lists=r,a.areaIdLists=r,a.editprogrammeData=[],angular.forEach(e.programInfo,function(e,t){var i={};i.downPayments=e.firstPrice/1e4,i.monthPayments=e.monthPrice/100,i.periods=e.numberPeriods,i.type=e.programFinally[t].finalPayment,i.money=e.programFinally[t].returnPrice,i.retainage=[],angular.forEach(e.programFinally,function(e,t){var a={};a.num=e.numberPeriods,a.year=e.numberPeriods,a.money=e.returnPrice,i.retainage.push(a)}),a.editprogrammeData.push(i)}),s.overEditProgrammeList.push(a)})}else u.stateError(e.msg)},selCarDataById:function(e,a){var i={};try{angular.forEach(e,function(e,t){e.id!=a||(i=e)})}catch(e){}return i},init:function(){this.getBrand(),this.getProvince(),this.getDataFromUrl()&&this.getDetailById(n.id)}};s.conceptualLists=[{downPayments:"",monthPayments:"",periods:"",type:1,money:"",retainage:[]}],u.init(),s.selectProgramme=function(){s.currentSelectProgramme=[],s.model_id?s.sale_price?s.fares?(u.getProgrammes(),$("#programmeModal").modal({backdrop:"static",keyboard:!1})):layer.msg("请输入开票价",{icon:5,time:1500}):layer.msg("请输入销售价",{icon:5,time:1500}):layer.msg("请选择车型",{icon:5,time:1500})},s.changeModel=function(){var e=u.selCarDataById(s.modelList,s.model_id);s.engine=e.engine,s.engine_num=parseFloat(e.engine),s.model_rice=parseFloat(e.refer_price),s.model_name=e.name,s.model_picture=e.car_img},s.changePrice=function(){s.has_click_release=!1,0<s.orderSelectProgrammeData.length&&u.getProgrammeDetail()},s.focusPrice=function(){s.has_click_release=!0},s.orderProgramme=function(){var e=s.selectData.length;if($("#programmeModal").modal("hide"),0<e){s.programme_id_lists=[],s.orderSelectProgrammeData=s.selectProgrammeData,s.selectObj=s.selectData;var t=s.orderSelectProgrammeData.length;if(0<t)for(var a=0;a<t;a++)s.programme_id_lists.push(s.selectObj[a].id);d(),u.getProgrammeDetail()}else s.showProgrammeLists=[]},s.changeBrand=function(){var e=u.selCarDataById(s.brandList,s.brand_id);s.brand_name=e.name,u.getSubBrand(s.brand_id),s.modelList=[]},s.changeSubBrand=function(){var e=u.selCarDataById(s.subBrandList,s.sub_brand_id);s.sub_brand_name=e.name,u.getModel(s.sub_brand_id)},s.sendAddInfo=function(){s.has_click_release=!0;var e={resourceId:"",brandId:s.brand_id,brandName:s.brand_name,subBrandId:s.sub_brand_id,subBrandName:s.sub_brand_name,modelId:"",modelName:"",modelPicture:"",colors:s.colors,interior:s.interior,manufactureTime:s.dateLists[s.manufacture],endTime:"",salePrice:Math.round(1e6*s.sale_price),modelPrice:Math.round(1e6*s.fares),facePrice:Math.round(1e6*s.face_price),modleEngine:"",luminousPoint:s.luminous_point,financeIds:"",lineProgramList:[],resourceExtra:s.extra,sourceArea:s.province_id+","+s.city_id};if(!s.expiration_date)return layer.msg("请选择车源有效期",{icon:5,time:1500}),void(s.has_click_release=!1);if(e.endTime=o.tTos(s.expiration_date),!s.model_id)return layer.msg("请选择车型",{icon:5,time:1500}),void(s.has_click_release=!1);if(e.modelId=s.model_id,e.modelName=s.model_name,e.modleEngine=s.engine,e.modelPicture=s.model_picture,!s.sale_price)return layer.msg("请输入销售价",{icon:5,time:1500}),void(s.has_click_release=!1);e.salePrice=Math.round(1e6*s.sale_price);var t=s.orderSelectProgrammeData.length,a=s.overEditProgrammeList.length;if(!(0<t+a))return layer.msg("请选择方案",{icon:5,time:1500}),void(s.has_click_release=!1);if(e.financeIds=s.orderSelectProgrammeData.join(","),0<a){var r=[];angular.forEach(s.overEditProgrammeList,function(e,t){var a={};a.name=e.programmeName,a.proceduresPay=e.serviceCharge,a.commissionPrice=e.rebate,a.carAscription=e.carAscription,a.programExplain=e.proExplain,a.carNeed=e.buyNotice;var i={age:e.age,basicInfo:e.basicInfo,incomeInfo:e.incomeInfo};a.programCondition=JSON.stringify(i),a.programInfo=[],1==e.areaIdLists.length?a.saleArea=e.areaIdLists[0]:1<e.areaIdLists.length?a.saleArea=e.areaIdLists.join("|"):a.saleArea="",angular.forEach(e.editprogrammeData,function(i,e){var r={};r.firstPrice=Math.round(1e6*i.downPayments),r.monthPrice=Math.round(100*i.monthPayments),r.numberPeriods=i.periods,0<i.retainage.length&&(r.programFinally=[],angular.forEach(i.retainage,function(e,t){var a={};2==i.type?a.returnPrice=Math.round(100*i.money):a.returnPrice=Math.round(100*e.money),a.numberPeriods=e.num,a.finalPayment=i.type,3==i.type&&(a.numberPeriods=e.year),r.programFinally.push(a)})),a.programInfo.push(r)}),r.push(a)}),e.lineProgramList=r}return s.fares?(e.modelPrice=Math.round(1e6*s.fares),s.manufacture&&0!==s.manufacture?(e.manufactureTime=s.dateLists[s.manufacture],s.province_id&&s.city_id?void(n.id?(e.resourceId=n.id,u.updateResource(e)):u.releaseResource(e)):(layer.msg("请选择资源所在地",{icon:5,time:1500}),void(s.has_click_release=!1))):(layer.msg("请选择出厂日期",{icon:5,time:1500}),void(s.has_click_release=!1))):(layer.msg("请输入开票价",{icon:5,time:1500}),void(s.has_click_release=!1))},s.getProgramme=function(e,t){var a=e.currentTarget,i=$(a).attr("data-id");if($(a).hasClass("programme-content-bg"))$(a).removeClass("programme-content-bg"),s.selectProgrammeData.forEach(function(e,t){if(e==i)return s.selectProgrammeData.splice(t,1),void s.selectData.splice(t,1)});else{var r=s.overEditProgrammeList.length;s.showProgrammeLists.length;if(4<=r+s.selectProgrammeData.length)return void layer.msg("选择方案已有4个！");$(a).addClass("programme-content-bg"),s.selectProgrammeData.push(i),s.selectData.push(s.programmeLists[t])}},s.deleteProgramme=function(e,a){s.programme_id_lists.forEach(function(e,t){if(e==a)return s.selectProgrammeData.splice(t,1),s.programme_id_lists.splice(t,1),void s.selectData.splice(t,1)}),s.showProgrammeLists.splice(e,1),d()},s.closeProgrammesModel=function(){$("#programmeModal").modal("hide")},s.seeProgramme=function(e){s.seeProgrammeData=s.selectObj[e],$("#prevProgramme").modal("show")},s.modelPreview=function(){$("#prevAll").modal("show")},s.changePageUrl=function(e){s.pageIndex=s.getPageIndex(e,s.pageNumber,s.pageCount),u.getProgrammes()},s.highlightsEdit=function(){u.summernoteInit(),s.has_lighlights_edit=!1},s.highlightsClear=function(){$("#highlightsEdit").summernote("destroy"),s.has_lighlights_edit=!0},s.editProgramme=function(){s.current_index=-1,$("#editProgramme").modal({keyboard:!1,backdrop:"static"})},s.addConceptual=function(){s.conceptualLists.push({downPayments:"",monthPayments:"",periods:"",type:1,money:"",retainage:[]})},s.changeRetainageType=function(e){s.conceptualLists[e].retainage=[];var t={};3==s.conceptualLists[e].type&&(t.year="",t.money=""),4==s.conceptualLists[e].type&&(t.num="",t.money=""),s.conceptualLists[e].retainage.push(t)},s.addRetainage=function(e){var t={};3==s.conceptualLists[e].type&&(t.year="",t.money=""),4==s.conceptualLists[e].type&&(t.num="",t.money=""),s.conceptualLists[e].retainage.push(t)},s.deleteConceptual=function(e){if(s.conceptualLists.length<=1){s.conceptualLists=[{downPayments:"",monthPayments:"",periods:"",type:1,money:"",retainage:[]}]}else s.conceptualLists.splice(e,1)},s.deleteRetainage=function(e,t){if(s.conceptualLists[e].retainage.length<=1){var a={};3==s.conceptualLists[e].type&&(a.year="",a.money=""),4==s.conceptualLists[e].type&&(a.num="",a.money=""),s.conceptualLists[e].retainage=[],s.conceptualLists[e].retainage.push(a)}else s.conceptualLists[e].retainage.splice(t,1)},s.saveProgramme=function(){var e={programmeName:angular.copy(s.programmeName),serviceCharge:angular.copy(s.serviceCharge),rebate:angular.copy(s.rebate),carAscription:angular.copy(s.carAscription),age:angular.copy(s.age),basicInfo:angular.copy(s.basicInfo),incomeInfo:angular.copy(s.incomeInfo),buyNotice:angular.copy(s.buyNotice),proExplain:angular.copy(s.proExplain),area:m,areaName:angular.copy(s.showOrderSelectAraeData),areaIdLists:angular.copy(s.select_id_lists),editprogrammeData:angular.copy(s.conceptualLists)};-1==s.current_index?s.overEditProgrammeList.push(e):s.overEditProgrammeList[s.current_index]=e,$("#editProgramme").modal("hide"),d()},s.closedEditModel=function(){$("#editProgramme").modal("hide")},s.highlightsSave=function(){s.luminous_point=$("#highlightsEdit").summernote("code")},s.seleProvince=function(){u.getCityLists()},s.showListProgramme=function(e){s.showProgrammeData=s.overEditProgrammeList[e],console.log(s.showProgrammeData),angular.element("#showProgramme").modal("show")},s.deleteListProgramme=function(e){s.overEditProgrammeList.splice(e,1),d()},s.editListProgramme=function(e){s.current_index=e;var t=s.overEditProgrammeList[e];s.programmeName=t.programmeName,s.serviceCharge=t.serviceCharge,s.rebate=t.rebate,s.carAscription=t.carAscription,s.age=t.age,s.basicInfo=t.basicInfo,s.incomeInfo=t.incomeInfo,s.buyNotice=t.buyNotice,s.proExplain=t.proExplain,s.showOrderSelectAraeData=t.areaName,s.select_id_lists=t.areaIdLists,s.conceptualLists=t.editprogrammeData,m=t.area,$("#editProgramme").modal({keyboard:!1,backdrop:"static"})},s.orderSelectAraeData=[],s.showOrderSelectAraeData=[],s.select_id_lists=[],s.current_provice_id="over",s.current_city_id=0,s.current_town_id=0,s.current_provice_name="全国",s.current_city_name="全省",s.current_town_name="全城",s.isShow=!1;var m="",p={cityUrl:"/api2/area/cities?device=1",townUrl:"/api2/area/areas?device=1",errorAlert:function(e){layer.msg(e,{icon:5})},setProvice:function(e){1===e.status&&(s.proviceLists=e.list,s.proviceLists.unshift({id:0,name:"全国"}))},setCity:function(e){1===e.status&&(s.cityLists=e.list,s.cityLists.unshift({id:0,name:"全省"}))},setTown:function(e){1===e.status&&(s.townLists=e.list,s.townLists.unshift({id:0,name:"全城"}))},getProvice:function(){var e={req_data:{method:"GET",url:PROVINCE_URL},requestSuccess:p.setProvice,requestError:p.httpError};i.getData(e)},getCity:function(e){var t={province:e},a={req_data:{method:"GET",url:BASEURL+this.cityUrl,params:t},requestSuccess:p.setCity,requestError:p.httpError};i.getData(a)},getTown:function(e){var t={province:e},a={req_data:{method:"GET",url:BASEURL+this.townUrl,params:t},requestSuccess:p.setTown,requestError:p.httpError};i.getData(a)},modify:function(e,t){s.select_id_lists.push(e),s.orderSelectAraeData.push(t),s.showOrderSelectAraeData=s.orderSelectAraeData},trimData:function(e){s.select_id_lists.splice(e,1),s.orderSelectAraeData.splice(e,1),s.showOrderSelectAraeData=s.orderSelectAraeData},removal:function(){var i=this,e=s.current_provice_id+","+s.current_city_id+","+s.current_town_id,t={p_name:s.current_provice_name,c_name:s.current_city_name,t_name:s.current_town_name};if(s.select_id_lists.length<=0)i.modify(e,t);else{if(0==s.current_provice_id)return s.orderSelectAraeData=[],s.select_id_lists=[],i.modify(e,t),!1;if(s.select_id_lists.forEach(function(e,t){0==e.split(",")[0]&&i.trimData(t)}),0==s.current_city_id){for(var a=s.select_id_lists.length;a--;){(r=s.select_id_lists[a].split(",")[0])==s.current_provice_id&&i.trimData(a)}return this.modify(e,t),!1}if(0==s.current_town_id){for(a=s.select_id_lists.length;a--;){var r=s.select_id_lists[a].split(",")[0],n=s.select_id_lists[a].split(",")[1];n!=s.current_city_id&&0!=n||r!=s.current_provice_id||i.trimData(a)}return s.select_id_lists.forEach(function(e,t){e.split(",")[1]==s.current_city_id&&i.trimData(t)}),this.modify(e,t),!1}s.select_id_lists.forEach(function(e,t){var a=e.split(",")[0];0==e.split(",")[2]&&a==s.current_provice_id&&i.trimData(t)}),-1==$.inArray(e,s.select_id_lists)?i.modify(e,t):layer.msg("当前区域已选择！",{icon:1})}},init:function(){this.getProvice()}};p.init(),s.selectProvice=function(e,t,a){s.cityLists=[],s.townLists=[],s.current_city_id=0,s.current_town_id=0,s.current_city_name="全省",s.current_town_name="全城";var i=e.currentTarget;$(i).hasClass("active")?($(i).removeClass("active"),s.current_provice_id="over"):($(i).addClass("active"),$(i).siblings().removeClass("active"),0!=t?(s.current_provice_id=t,s.current_provice_name=a,p.getCity(t)):(s.current_provice_id=0,s.current_provice_name="全国"))},s.selectCity=function(e,t,a){s.townLists=[],s.current_town_id=0,s.current_town_name="全城";var i=e.currentTarget;$(i).hasClass("active")?($(i).removeClass("active"),s.current_city_id=0,s.current_city_name="全省"):($(i).addClass("active"),$(i).siblings().removeClass("active"),s.current_city_name=a,0!=t?(p.getTown(t),s.current_city_id=t):s.current_city_id=0)},s.selectTown=function(e,t,a){var i=e.currentTarget;$(i).hasClass("active")?($(i).removeClass("active"),s.current_town_name="全城",s.current_town_id=0):($(i).addClass("active"),$(i).siblings().removeClass("active"),s.current_town_name=a,s.current_town_id=t)},s.orderSelectArea=function(){"over"!=s.current_provice_id?(p.removal(),m=s.select_id_lists.join("|")):layer.msg("请求选择区域",{icon:5,time:1e3})},s.delete=function(e){p.trimData(e),m=s.select_id_lists.join("|")},s.showSelectArea=function(){s.isShow=!1}}]),app.controller("releaseManagementCtrl",["$scope","httpData","$timeout","$window","$http",function(i,e,r,t,a){i.releaseTitle="",i.titLen=0,i.has_save=!1,i.has_prev=!1;var n=layer.load(1),s={addCounselUrl:"/cms2/counsel/add?device=1",classificationUrl:"/cms2/counseldir/getall?device=1",errorData:function(){layer.close(n),i.has_clicked=!1,layer.msg("请求失败",{icon:5})},uploadeFaceBefore:function(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})},uploadeListFaceSuccess:function(e){layer.closeAll("dialog"),1==e.status?(company_id_image=e.data[0].normal,i.listFace=imgUrl+company_id_image,i.listFaceAddress=company_id_image,i.$apply()):layer.msg("上传失败")},uploadeLinkFaceSuccess:function(e){layer.closeAll("dialog"),1==e.status?(company_id_image=e.data[0].normal,i.linkFace=imgUrl+company_id_image,i.linkFaceAddress=company_id_image,i.$apply()):layer.msg("上传失败")},setSuccessAddCounsel:function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),r(function(){layer.confirm("是否继续添加？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e),t.location.reload()},function(e){i.jumpUrl("home.counselManagement")})},1600)):layer.msg(e.msg,{icon:5,time:1500})},getNowFormatDate:function(){var e=new Date,t=e.getMonth()+1,a=e.getDate();return 1<=t&&t<=9&&(t="0"+t),0<=a&&a<=9&&(a="0"+a),e.getFullYear()+"-"+t+"-"+a+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},setSuccessClassification:function(e){layer.close(n),1===e.status?i.classificationLists=e.list:layer.msg(e.msg,{icon:5,time:1500})},getClassification:function(){e.getData("GET",this.classificationUrl,"",this.setSuccessClassification,this.errorData)},init:function(){this.getClassification()}};s.init(),i.inputTit=function(){var e=i.releaseTitle.length;38<=(i.titLen=e)&&(i.releaseTitle=i.releaseTitle.substr(0,37))},angular.element("#list_face_input").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:s.uploadeFaceBefore,success:s.uploadeListFaceSuccess,xhrFields:{withCredentials:!0}};angular.element("#list_face").ajaxSubmit(e)}),angular.element("#link_face_input").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:s.uploadeFaceBefore,success:s.uploadeLinkFaceSuccess,xhrFields:{withCredentials:!0}};angular.element("#link_face").ajaxSubmit(e)});$("#summernote").summernote({height:700,lang:"zh-CN",toolbar:[["style",["style","bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["insert",["link","picture","video","codeview"]],["table",["table"]],["hr",["hr"]],["image",["undo","redo","removeMedia","help"]],["mybutton",["preview"]]],buttons:{preview:function(e){return $.summernote.ui.button({contents:'<i class="icon-columns"/> 预览',tooltip:"预览",click:function(){var e=$("#summernote").summernote("code"),t={title:i.releaseTitle,content:encodeURIComponent(e)};sessionStorage.preview_content=JSON.stringify(t),window.open("views/test/show.html","预览","width=360,height=640")}}).render()},save:function(e){return $.summernote.ui.button({contents:'<i class="icon-save"/> 保存',tooltip:"保存",click:function(){}}).render()}}}),i.save=function(e){if(i.has_save=!0,i.has_prev=!0,r(function(){i.has_save=!1,i.has_prev=!1},1500),i.releaseTitle)if(i.select_type)if(i.describe)if(i.linkFaceAddress){var t={title:"",cover_a:" ",cover_b:" ",content:" ",is_passed:0,dir_id:"",des:"",file_name:"preview",host_img:imgUrl},a=$("#summernote").summernote("code");t.is_passed=e,t.title=i.releaseTitle,t.cover_a=i.listFaceAddress,t.cover_b=i.linkFaceAddress,t.content=encodeURIComponent(a),t.dir_id=i.select_type,t.des=i.describe,$.ajax({type:"POST",headers:{"Content-Type":"application/json;charset=UTF-8"},url:BASEURL+s.addCounselUrl,data:JSON.stringify(t),timeout:1e4,success:function(e){s.setSuccessAddCounsel(e)},error:function(e,t,a,i){s.errorData(e,t,a,i)}})}else layer.msg("请选择链接封面",{icon:5});else layer.msg("请填写咨讯描述",{icon:5});else layer.msg("请选择咨讯分类",{icon:5});else layer.msg("请填写标题",{icon:5})}}]),app.controller("resOrderCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state","$http",function(u,t,e,a,m,i,r){new Date;var n=layer.load(1);u.has_clicked=!1,u.orderData=[];var s={province_url:"/api2/area/provinces?device=1",city_url:"/api2/area/cities?device=1",county_url:"/api2/area/areas?device=1",order_url:"/cms2/order/res/query?device=1",province_id:"",city_id:"",county_id:"",listsSendData:{page_index:1,page_size:10,state:-1,order_code:"",order_type:"",user_name:"",user_mobile:"",start_time:"",end_time:"",province_id:"",city_id:"",area_id:""},init:function(){this.getDataFromUrl(),this.getProvince(),this.getOrderList()},errorData:function(){layer.close(n),u.has_clicked=!1,layer.msg("请求失败",{icon:5})},getOrderList:function(){t.getData("GET",this.order_url,this.listsSendData,this.setOrderList,this.errorData)},setOrderList:function(e){layer.close(n),1==e.status&&(1==e.status?(u.orderData=e.list,u.pageNumber=e.page.pageNumber,u.recordCount=e.page.recordCount,u.pageCount=e.page.pageCount,u.pageSize=e.page.pageSize,u.pageList=u.pageNum(u.pageCount,u.pageNumber),u.startData=0==u.recordCount?0:(u.pageNumber-1)*u.pageSize+1,u.endData=e.list.length<u.pageSize?(u.pageNumber-1)*u.pageSize+e.list.length:u.pageNumber*u.pageSize):layer.msg("请求失败",{icon:5}))},getProvince:function(){t.getData("GET",this.province_url,"",this.setProvince,this.errorData)},setProvince:function(e){1==e.status&&(u.province_list=e.list)},getCity:function(e){t.getData("GET",this.city_url,{province:e},this.setCity,this.errorData)},setCity:function(e){1==e.status&&(u.city_list=e.list)},getCounty:function(e){t.getData("GET",this.county_url,{province:e},this.setCounty,this.errorData)},setCounty:function(e){1==e.status&&(u.county_list=e.list)},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]},getDataFromUrl:function(){var e=m.page_index,t=m.start_time,a=m.end_time,i=m.state,r=m.order_type,n=m.order_code,s=m.user_name,o=m.user_mobile,c=m.province_id,l=m.city_id,d=m.area_id;e||(e=1),t?u.start_time=this.getLocalTime(t).replace(/\//g,"-"):t=null,a?u.end_time=this.getLocalTime(a).replace(/\//g,"-"):a=null,i||(i=-1),u.state=i,u.order_code=n,u.order_type=r,u.province_id=c,u.city_id=l,u.area_id=d,u.user_name=s,u.user_mobile=o,this.listsSendData={page_index:e,page_size:10,state:i,order_code:n,order_type:r,user_name:s,user_mobile:o,start_time:t,end_time:a,province_id:c,city_id:l,area_id:d}},selectData:function(){var e="",t="";e=u.start_time?Date.parse(u.start_time.replace(/-/g,"/")):"",t=u.end_time?Date.parse(u.end_time.replace(/-/g,"/")):"",this.listsSendData.state=u.state,this.listsSendData.order_code=u.order_code,this.listsSendData.order_type=u.order_type,this.listsSendData.province_id=u.province_id,this.listsSendData.city_id=u.city_id,this.listsSendData.area_id=u.area_id,this.listsSendData.user_name=u.user_name,this.listsSendData.user_mobile=u.user_mobile,this.listsSendData.start_time=e,this.listsSendData.end_time=t,i.go("home.resOrder",this.listsSendData)}};s.init(),null!=m.province_id?(s.getCity(m.province_id),u.city_id=m.city_id):(u.city_list="",u.city_id="",u.area_id="",u.county_list=""),null!=m.city_id?(s.getCounty(m.city_id),u.area_id=m.area_id):(u.county_list="",u.area_id=""),u.changeState=function(){s.selectData()},u.changeType=function(){s.selectData()},u.changeProvince=function(){u.area_id="",u.county_list="",u.city_id="",u.city_list="",s.selectData()},u.changeCity=function(){u.area_id="",u.county_list="",s.selectData()},u.changeCounty=function(){s.selectData()},$("#start_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){s.selectData()}),$("#end_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){s.selectData()});var o=!1,c=!1,l=!1;u.order_search=function(){s.selectData()},u.$watch("user_mobile",function(){c&&""==u.user_mobile&&s.selectData(),c=!0}),u.$watch("user_name",function(){l&&""==u.user_name&&s.selectData(),l=!0}),u.$watch("order_code",function(){o&&""==u.order_code&&s.selectData(),o=!0}),u.changePageUrl=function(e){s.listsSendData.page_index=u.getPageIndex(e,u.pageNumber,u.pageCount),i.go("home.resOrder",s.listsSendData)}}]),app.controller("resOrderDetailCtrl",["$scope","$http","$stateParams","$timeout",function(c,r,n,s){function l(e){1===e.status&&(c.showProgrammeLists=e.data.program_item_list)}function d(){layer.msg("请求失败",{icon:5,time:1500})}c.getOrderDetail=function(){var o=layer.msg("加载中...",{icon:16,time:0});r({method:"GET",url:BASEURL+"/cms2/order/res/detail?device=1&order_id="+n.oid}).success(function(e){if(layer.close(o),1==e.status){c.orderDetail=e.data.order,0<e.data.log.length&&(c.log=e.data.log),c.enclosure_picture=[];var t=["身份证正面照","身份证反面照","驾驶证正本","驾驶证副本"];if(e.data.order.enclosure_picture)for(var a=e.data.order.enclosure_picture.split(","),i=0;i<a.length;i++){var r={};a[i]&&(r.img=a[i],r.name=t[i],c.enclosure_picture.push(r))}c.area="暂无";t=[];var n=e.data.area;if(0<n.length){for(i=0;i<n.length;i++)t[i]!={}&&t.push(n[i].province_name+n[i].city_name);c.area=t.join("、")}if(c.engine=parseFloat(e.data.order.modle_engine),c.program=e.data.program,console.log(e.data.order.fares,e.data.order.brand_resource_price,e.data.order.modle_engine),e.data.program.id&&c.engine&&e.data.order.brand_resource_price&&e.data.order.fares){e={price_bill:e.data.order.fares,price_sale:e.data.order.brand_resource_price,tax:c.engine,finance_ids:e.data.program.id};s=e,httpData.getData("GET","/cms2/finance/program/calculationg?device=1",s,l,d)}}else layer.msg("请求失败",{icon:5,time:1500});var s}).error(function(e){})},c.getOrderDetail(),c.checkOrder=function(t){c.request_url="/cms2/order/res/edit",console.log(t),3==t?c.message(t,"请输入拒绝理由",c.request_url):4==t?c.message(t,"请输入条件",c.request_url):layer.confirm("确定切换订单状态",{title:"提示",icon:0,skin:"layui-layer-molv",btn:["是","否"],shadeClose:!0},function(e){layer.close(e),c.checkRequest(t,"",c.request_url)},function(e){layer.close(e)})},c.checkRequest=function(e,t,a){var i=layer.msg("数据提交中...",{icon:16,time:0});r({method:"POST",url:BASEURL+a,params:{device:1,state:e,message:t,id:n.oid}}).success(function(e){layer.close(i),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),s(function(){c.getOrderDetail()},2e3)):layer.msg(e.msg,{icon:5,time:1500})})},c.message=function(a,e,i){layer.prompt({title:e,formType:2,shadeClose:!0},function(e,t){c.checkRequest(a,e,i),layer.close(t)})},c.manager_name="",c.manager_mobile="",c.addManager=function(){if(""==c.manager_name)layer.msg("请输入姓名");else if(""==c.manager_mobile)layer.msg("请输入电话");else{var t=layer.msg("数据提交中...",{icon:16,time:0});r({method:"POST",url:BASEURL+"/cms2/order/res/edit/manager",params:{device:1,manager_name:c.manager_name,manager_mobile:c.manager_mobile,id:n.oid}}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),s(function(){c.getOrderDetail(),c.manager_name="",c.manager_mobile=""},2e3)):layer.msg(e.msg,{icon:5,time:1500})})}}}]),app.controller("resourceListCtrl",["$http","$scope","$stateParams","$state",function(a,i,r,t){i.resourceList="";var n=!1,s=!1,o=!1,c=!1,l=!1;i.code=r.code,i.sub_brand=r.sub_brand,i.model_name=r.model_name,i.user_name=r.user_name,i.mobile=r.mobile;var d={page_index:1,sub_brand:"",model_name:"",user_name:"",mobile:"",code:""};i.getResourceList=function(e){var t=layer.msg("加载中...",{icon:16,time:0});null==r.page_index?e.page_index=1:e.page_index=r.page_index,e.sub_brand=r.sub_brand,e.model_name=r.model_name,e.user_name=r.user_name,e.mobile=r.mobile,e.code=r.code,a({method:"GET",url:BASEURL+"/cms2/resource/datas?device=1&page_size=10",params:e}).success(function(e){layer.close(t),1==e.status&&(i.resourceData=e.list,i.pageNumber=e.page.pageNumber,i.recordCount=e.page.recordCount,i.pageCount=e.page.pageCount,i.pageSize=e.page.pageSize,i.pageList=i.pageNum(i.pageCount,i.pageNumber),i.startData=0==i.recordCount?0:(i.pageNumber-1)*i.pageSize+1,i.endData=e.list.length<i.pageSize?(i.pageNumber-1)*i.pageSize+e.list.length:i.pageNumber*i.pageSize)})},i.getResourceList(d),i.refreshResource=function(){var t=layer.msg("数据刷新中...",{icon:16,time:0});a({method:"GET",url:BASEURL+"/cms2/resource/refresh/index?device=1"}).success(function(e){layer.close(t),1==e.status?(layer.msg("刷新完成",{icon:1,time:1500}),i.getResourceList(d)):layer.msg("刷新失败",{icon:5,time:1500})})},i.selectResource=function(){var e={page_index:1};return e.sub_brand=i.sub_brand,e.model_name=i.model_name,e.user_name=i.user_name,e.mobile=i.mobile,e.code=i.code,e},i.resource_search=function(){if(null==i.sub_brand&&null==i.model_name&&null==i.user_name&&null==i.mobile&&null==i.code)layer.msg("输入信息再搜索！",{icon:0,time:1500});else{var e=i.selectResource();t.go("home.resource",e)}},i.$watch("code",function(){if(n&&""==i.code){var e=i.selectResource();t.go("home.resource",e)}n=!0}),i.$watch("sub_brand",function(){if(s&&""==i.sub_brand){var e=i.selectResource();t.go("home.resource",e)}s=!0}),i.$watch("model_name",function(){if(o&&""==i.model_name){var e=i.selectResource();t.go("home.resource",e)}o=!0}),i.$watch("user_name",function(){if(c&&""==i.user_name){var e=i.selectResource();t.go("home.resource",e)}c=!0}),i.$watch("mobile",function(){if(l&&""==i.mobile){var e=i.selectResource();t.go("home.resource",e)}l=!0}),i.changePageUrl=function(e){d.page_index=i.getPageIndex(e,i.pageNumber,i.pageCount),t.go("home.resource",d)},i.checkResource=function(){a({method:"GET",url:BASEURL+"/cms2/resource/cert/all?device=1",timeout:1e3}).success(function(e){1==e.status?layer.msg(e.msg,{icon:1,time:1500}):layer.msg(e.msg,{icon:0,time:1500})})}}]),app.controller("resourceApplyCtrl",["$http","$scope","requestData","$timeout","$stateParams","$state",function(a,i,e,t,r,n){i.applyList="",i.state=r.state;var s={page_index:"",page_size:10,state:"",device:1};i.getApplyList=function(e){null==r.page_index?e.page_index=1:e.page_index=r.page_index,e.state=r.state;var t=layer.msg("加载中...",{icon:16,time:0});a({method:"GET",url:BASEURL+"/cms2/resource/dataslist",params:e}).success(function(e){layer.close(t),1==e.status?(i.applyList=e.list,i.pageNumber=e.page.pageNumber,i.recordCount=e.page.recordCount,i.pageCount=e.page.pageCount,i.pageSize=e.page.pageSize,i.pageList=i.pageNum(i.pageCount,i.pageNumber),i.startData=0==i.recordCount?0:(i.pageNumber-1)*i.pageSize+1,i.endData=e.list.length<i.pageSize?(i.pageNumber-1)*i.pageSize+e.list.length:i.pageNumber*i.pageSize):layer.msg("请求失败",{icon:5})}).error(function(e){})},i.getApplyList(s),i.selectApplyChange=function(){n.go("home.resourceApply",{page_index:1,state:i.state})},i.changePageUrl=function(e){s.page_index=i.getPageIndex(e,i.pageNumber,i.pageCount),n.go("home.resourceApply",s)}}]),app.controller("resourceApplyDetailCtrl",["$http","$scope","requestData","$timeout","$stateParams","$state",function(i,r,e,n,s,t){r.applyDetail="",r.getComplainDetail=function(e){i({method:"GET",url:BASEURL+"/cms2/resource/data/detail?device=1&id="+e}).success(function(e){1==e.status?r.applyDetail=e.data:layer.msg("请求失败",{icon:5})}).error(function(e){})},r.getComplainDetail(s.id),r.manageApply=function(){layer.prompt({formType:2,title:"请输入处理备注"},function(e,t,a){i({method:"POST",url:BASEURL+"/cms2/resource/edit/resource/data",params:{device:1,id:s.id,state:1,remark:e}}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),n(function(){r.getComplainDetail(s.id)},1500)):layer.msg(e.msg,{icon:5,time:1e3})}),layer.close(t)})}}]),app.controller("resourceDetailCtrl",["$http","$state","$scope","$stateParams","$timeout",function(i,e,r,n,s){r.getResourceDetail=function(){var t=layer.msg("加载中...",{icon:16,time:0});i({method:"GET",url:BASEURL+"/api2/auto/resources/query/detail?device=1&res_id="+n.rid}).success(function(e){layer.close(t),r.resourceDetail=e.data})},r.getResourceDetail(),r.checkResource=function(){layer.confirm("确认该资源是否通过审核？",{btn:["通过","不通过"],title:"提示",icon:0,skin:"layui-layer-molv"},function(e){layer.close(e);var t=layer.msg("数据提交中...",{icon:16,time:0});i({method:"POST",url:BASEURL+"/cms2/resource/check?device=1",params:{id:n.rid,state:1},timeout:1e4}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),s(function(){r.getResourceDetail()},2e3)):layer.msg(e.msg,{icon:5,time:1500})}).error(function(e){})},function(){layer.prompt({title:"请输入审核不通过理由",formType:2},function(e,t){var a=layer.msg("数据提交中...",{icon:16,time:0});i({method:"POST",url:BASEURL+"/cms2/resource/check?device=1",params:{id:n.rid,state:2,message:e},timeout:1e4}).success(function(e){layer.close(a),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),s(function(){r.getResourceDetail()},2e3)):layer.msg(e.msg,{icon:5,time:1500})}).error(function(e){}),layer.close(t)})})},r.deleteResource=function(){layer.confirm("确认删除该资源？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e);var t=layer.msg("数据提交中...",{icon:16,time:0});i({method:"POST",url:BASEURL+"/cms2/resource/delete/"+n.rid+"?device=1",timeout:1e4}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),s(function(){r.jump("/home/cms/resource")},2e3)):layer.msg(e.msg,{icon:5,time:1500})}).error(function(e){})},function(e){layer.close(e)})},r.enableResource=function(a){var e="";e=0==a?"确认启用该资源？":"确认禁用该资源？",layer.confirm(e,{btn:["确定","取消"],title:"提示",skin:"layui-layer-molv",icon:0,anim:3},function(e){layer.close(e);var t=layer.msg("数据提交中...",{icon:16,time:0});i({method:"POST",url:BASEURL+"/cms2/resource/enable?device=1",params:{id:n.rid,enable:a},timeout:1e4}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),s(function(){r.getResourceDetail()},2e3)):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)})}}]),app.controller("resourcesOrderDetailCtrl",["$scope","$state","$stateParams","$timeout","httpRequestData",function(r,t,e,a,n){r.imgNameLists=["身份证正面照","身份证反面照","驾驶证正本","驾驶证副本"],r.overColor={color:"#169bd5"},r.current_plan_index=0;var i=function(){this.token="27f27d07-016d-4dd9-8cea-79bdb897a309",this.detail_url=BASEURL+"/order_v1_0_0/api/order/resource/mortgage/{orderId}/detail?out=json",this.edit_area_leader=BASEURL+"/order_v1_0_0/cms/order/resource/mortgage/edit/arealeader?out=json",this.edit_order_state=BASEURL+"/order_v1_0_0/cms/order/resource/mortgage/edit/state?out=json",this.rent_resource_url=BASEURL+"/res_v1_0_0/cms/rent/res/detail?out=json",this.back_resource_url=BASEURL+"/res_v1_0_0/cms/back/res/detail?out=json",this.back_program_url=BASEURL+"/res_v1_0_0/cms/finance/program/detail?out=json"};i.prototype={constructor:i,stateError:function(e){layer.closeAll("loading"),r.hasClicked=!1,layer.msg(e)},httpError:function(){layer.closeAll("loading"),r.hasClicked=!1,layer.msg("请求失败",{icon:5})},getIdFromUrl:function(){r.id=e.oid},getDetailFromId:function(e){var t={req_data:{method:"POST",url:e},requestSuccess:this.setDetailFromId.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(t)},setDetailFromId:function(e){layer.closeAll("loading"),1==e.status?(r.orderDetail=e.data,r.orderId=e.data.id,r.resourceId=e.data.resourceId,r.resourceType=e.data.resourceType,r.remoteRes=e.data.progams.remoteRes,r.programId=e.data.programId,r.subMitData=[],e.data.enclosurePicture.split(",").forEach(function(e,t){if(e){var a=imgUrl+"/"+$.trim(e);r.subMitData.push(a)}})):this.stateError(e.data)},addAreaLeader:function(){var e={id:r.orderId,name:r.leader_name,mobile:r.leader_mobile},t={req_data:{method:"POST",url:this.edit_area_leader,params:e},requestSuccess:this.addAreaLeaderSuccess.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(t)},addAreaLeaderSuccess:function(e){var t=this;layer.closeAll("loading"),1==e.status?(layer.alert("操作成功",{icon:6,time:1500}),a(function(){r.leader_name="",r.leader_mobile="",t.init()},1600)):this.stateError(e.data)},changeOrderState:function(e,t){var a={id:r.orderId,state:e,message:t},i={req_data:{method:"POST",url:this.edit_order_state,params:a},requestSuccess:this.changeOrderStateSucuess.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(i)},changeOrderStateSucuess:function(e){var t=this;layer.closeAll("loading"),1==e.status?(layer.alert("操作成功",{icon:6,time:1500}),a(function(){t.init()},1600)):this.stateError(e.data)},getPlanDetail:function(){var e={resource_id:r.resourceId},t={req_data:{method:"GET",url:this.rent_resource_url,params:e},requestSuccess:this.setPlanDetail.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(t)},setPlanDetail:function(e){layer.closeAll("loading"),1==e.status?(r.resourceDetail=e.data,r.resourceId=e.data.res.resourceId,angular.element("#planDetail").modal()):this.stateError(e.data)},getBackPlanDetail:function(){var e={resource_id:r.resourceId},t={req_data:{method:"GET",url:this.back_resource_url,params:e},requestSuccess:this.setBandPlanDetail.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(t)},setBandPlanDetail:function(e){layer.closeAll("loading"),1==e.status?(r.backResourceDetail=e.data,angular.element("#backPlanDetail").modal()):this.stateError(e.data)},getProgrammeDetail:function(e){var t={id:e},a={req_data:{method:"GET",url:this.back_program_url,params:t},requestSuccess:this.setProgrammeDetail.bind(this),requestError:this.httpError.bind(this)};layer.load(1),n.getData(a)},setProgrammeDetail:function(e){layer.closeAll("loading"),1==e.status?(r.programDetail=e.data,angular.element("#programDetail").modal()):this.stateError(e.data)},init:function(){if(this.getIdFromUrl(),r.id){var e=this.detail_url.replace("{orderId}",r.id);this.getDetailFromId(e)}}};var s=new i;s.init(),r.addAreaLeader=function(){""!=r.leader_name?""!=r.leader_mobile?s.addAreaLeader():layer.msg("请输入电话"):layer.msg("请输入姓名")},r.message=function(a,e,t){layer.prompt({title:e,formType:2,shadeClose:!0},function(e,t){s.changeOrderState(a,e),layer.close(t)})},r.checkOrder=function(t){3==t?r.message(t,"请输入拒绝理由",r.request_url):4==t?r.message(t,"请输入条件",r.request_url):layer.confirm("确定切换订单状态",{title:"提示",icon:0,skin:"layui-layer-molv",btn:["是","否"],shadeClose:!0},function(e){layer.close(e),s.changeOrderState(t,"")},function(e){layer.close(e)})},r.showDetail=function(){1===parseInt(r.resourceType)?s.getPlanDetail():2===parseInt(r.resourceType)&&s.getBackPlanDetail()},r.selectPlan=function(e){r.current_plan_index=e},r.editPlan=function(){var e={id:r.resourceId};t.go("home.releaseJustRentProgram",e)},r.showBackDetail=function(){s.getProgrammeDetail(r.programId)},r.showOneDetail=function(e){s.getProgrammeDetail(e)}}]),app.controller("resourcesOrderListsCtrl",["$scope","httpRequestData","dateConversion","$state","$stateParams","$timeout",function(a,i,t,e,r,n){a.selectData={page_index:1,page_size:10,state:"",order_code:"",resource_type:"",user_name:"",user_mobile:"",start_time:"",end_time:"",province_id:"",city_id:"",area_id:""},a.hasSearchClick=!1;var s=function(){this.res_order_lists_url=BASEURL+"/order_v1_0_0/cms/order/resource/mortgage/list?out=json",this.city_lists_url=BASEURL+"/api2/area/cities?device=1",this.townUrl="/api2/area/areas?device=1",$("#start_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){e.date?a.selectData.start_time=t.tTos(a.start_time_show):a.selectData.start_time=""}),$("#end_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){e.date?a.selectData.end_time=t.tTos(a.end_time_show):a.selectData.end_time=""})};s.prototype={constructor:s,stateError:function(e){layer.closeAll("loading"),a.hasClicked=!1,layer.msg(e)},httpError:function(){layer.closeAll("loading"),a.hasClicked=!1,layer.msg("请求失败",{icon:5})},getProData:function(){var e={req_data:{method:"GET",url:PROVINCE_URL},requestSuccess:this.setProData.bind(this),requestError:this.httpError.bind(this)};layer.load(1),i.getData(e)},setProData:function(e){layer.closeAll("loading"),1==e.status?a.proLists=e.list:this.stateError(e.msg)},getCityData:function(){var e={province:a.selectData.province_id},t={req_data:{method:"GET",url:this.city_lists_url,params:e},requestSuccess:this.setCityData.bind(this),requestError:this.httpError.bind(this)};layer.load(1),i.getData(t)},setCityData:function(e){layer.closeAll("loading"),1==e.status?a.cityLists=e.list:this.stateError(e.msg)},getTownData:function(){var e={province:a.selectData.city_id},t={req_data:{method:"GET",url:this.city_lists_url,params:e},requestSuccess:this.setTownData.bind(this),requestError:this.httpError.bind(this)};layer.load(1),i.getData(t)},setTownData:function(e){layer.closeAll("loading"),1==e.status?a.townLists=e.list:this.stateError(e.msg)},getResOrderLists:function(){var e={req_data:{method:"GET",url:this.res_order_lists_url,params:a.selectData},requestSuccess:this.setResOrderLists.bind(this),requestError:this.httpError.bind(this)};layer.load(1),i.getData(e)},setResOrderLists:function(e){layer.closeAll("loading"),1==e.status?(a.resOrderLists=e.list,a.resPageNumber=e.page.pageNumber,a.resPageCount=e.page.pageCount,a.resPageSize=e.page.pageSize,a.resRecordCount=e.page.recordCount,a.resListsLength=e.list.length):this.stateError(e.msg)},getDataFromUrl:function(){a.selectData.province_id=parseInt(r.province_id),a.selectData.province_id||(a.selectData.province_id=""),a.selectData.city_id=parseInt(r.city_id),a.selectData.city_id?this.getCityData():a.selectData.city_id="",a.selectData.area_id=parseInt(r.area_id),a.selectData.area_id?this.getTownData():a.selectData.area_id="",a.selectData.page_index=r.page_index,a.selectData.page_index||(a.selectData.page_index=1),a.selectData.page_size=r.page_size,a.selectData.page_size||(a.selectData.page_size=10),a.selectData.state=r.state,a.selectData.state||(a.selectData.state=""),a.selectData.order_code=r.order_code,a.selectData.order_code||(a.selectData.order_code=""),a.selectData.resource_type=r.resource_type,a.selectData.resource_type||(a.selectData.resource_type=""),a.selectData.user_name=r.user_name,a.selectData.user_name||(a.selectData.user_name=""),a.selectData.user_mobile=r.user_mobile,a.selectData.user_mobile||(a.selectData.user_mobile=""),a.selectData.start_time=r.start_time,a.selectData.start_time?a.start_time_show=t.sTot(r.start_time/1e3,"date"):(a.selectData.start_time="",a.start_time_show=""),a.selectData.end_time=r.end_time,a.selectData.end_time?a.end_time_show=t.sTot(r.end_time/1e3,"date"):(a.selectData.end_time="",a.end_time_show=""),this.getResOrderLists()},goPage:function(){a.selectData.page_index=1,e.go("home.resourcesOrderLists",a.selectData)},init:function(){this.getDataFromUrl(),this.getProData()}};var o=new s;o.init(),a.changeResPage=function(){o.getResOrderLists()},a.selProvince=function(){a.selectData.province_id?o.getCityData():(a.selectData.province_id="",a.selectData.city_id="",a.selectData.area_id="",a.proLists=[],a.cityLists=[],a.townLists=[])},a.changeCity=function(){a.selectData.city_id?o.getTownData():(a.selectData.city_id="",a.selectData.area_id="",a.cityLists=[],a.townLists=[])},a.order_search=function(){a.selectData.area_id="",a.hasSearchClick=!0,o.goPage(),n(function(){a.hasSearchClick=!1},1e3)}}]),app.controller("seekCtrl",["$http","$scope","$stateParams","$state","$timeout",function(r,a,i,t,n){a.seekData="";var s={page_index:1};a.getSeekList=function(e){null==i.page_index?e.page_index=1:e.page_index=i.page_index;var t=layer.msg("加载中...",{icon:16,time:0});r({method:"GET",url:BASEURL+"/cms2/resource/seek/datas?device=1&page_size=10",params:e}).success(function(e){layer.close(t),1==e.status?(a.seekData=e.list,a.pageNumber=e.page.pageNumber,a.recordCount=e.page.recordCount,a.pageCount=e.page.pageCount,a.pageSize=e.page.pageSize,a.pageList=a.pageNum(a.pageCount,a.pageNumber),a.startData=0==a.recordCount?0:(a.pageNumber-1)*a.pageSize+1,a.endData=e.list.length<a.pageSize?(a.pageNumber-1)*a.pageSize+e.list.length:a.pageNumber*a.pageSize):layer.msg("请求失败",{icon:5})}).error(function(e){})},a.getSeekList(s),a.changePageUrl=function(e){s.page_index=a.getPageIndex(e,a.pageNumber,a.pageCount),t.go("home.seek",s)},a.seekDelete=function(a){layer.confirm("确认删除该寻车记录？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e);var t=layer.msg("数据提交中...",{icon:16,time:0});r({method:"POST",url:BASEURL+"/cms2/resource/seek/"+a+"?device=1"}).success(function(e){layer.close(t),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),n(function(){window.location.reload()},2e3)):layer.msg(e.msg,{icon:5,time:1500})})},function(e){layer.close(e)})},a.seekResult=function(i){layer.prompt({title:"请输入处理结果",formType:2,shadeClose:!0},function(e,t){var a=layer.msg("数据提交中...",{icon:16,time:0});r({method:"POST",url:BASEURL+"/cms2/resource/seek/result?device=1",params:{id:i,message:e}}).success(function(e){layer.close(a),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),n(function(){window.location.reload()},2e3)):layer.msg(e.msg,{icon:5,time:1500})}),layer.close(t)})}}]),app.controller("sidebarCtrl",["$scope","$http","$timeout","$location","requestData",function(i,e,t,a,r){var n={getData:function(){return r.getData("GET","/cms2/user/info?device=1","")},setData:function(e,t){var a,i=[];for(var r in e)e[r].parent_id==t&&(i.push(e[r]),0<(a=this.setData(e,e[r].menu_id)).length&&(e[r].childrens=a));return i},setSession:function(e,t){sessionStorage[e]=t}};n.getData().then(function(e){if(1==e.data.status){var t=e.data.data;n.setSession("nickname",t.nickname),i.userName=t.nickname;var a=n.setData(t.menus,"");i.navLists=a}})}]),app.controller("specialResourcesDetailCtrl",["$http","$state","$scope","$stateParams","$timeout","httpRequestData","$window",function(r,e,n,a,t,s,i){n.requsFlag=!1,n.modelDeleteShow="",n.pinLists=!0,n.modelisthasshow=!0,n.modelLists=[];n.subPinBtn=!0;n.exteriorColor="",n.trimColor="",n.cityBtnShow=!0,n.cityBtnShow1=!0,n.favourableMode="money",n.editFavourableMode="money",n.current_index="",n.has_use_click=!0,n.has_use_attr_click=!0,n.has_use_attr_click=!0,n.attachment="",n.editattachment="",n.has_send_btn=!0,n.editFlag=!0,n.edit_btn=!1,n.editOverList=[];var o={id:0,name:"全国"},c={id:0,name:"全省"};n.publishObj=[],n.resourceDetail=[];var l={errorData:function(){layer.msg("请求失败",{icon:5})},timestamp:function(e){return Date.parse(e.replace(/-/g,"/"))},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]},setResourceDetail:function(e){1==e.status&&(n.resourceDetail=e.data);var t=(new Date).getTime();e.data.res.endTime<t&&(n.resourceDetail.res.state=2)},getResourceDetail:function(e){var t={req_data:{method:"GET",url:BASEURL+"/res_v1_0_0/cms/special/res/detail?resource_id="+a.rid+"&out=json",headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:this.setResourceDetail,requestError:this.errorData};s.getData(t)},upResourceSuccess:function(e){1==e.status&&(layer.msg(e.data,{icon:1,time:1500}),t(function(){l.init()},1500))},upResource:function(e,t){var a={req_data:{method:"POST",url:BASEURL+"/res_v1_0_0/cms/special/res/isshow?resource_id="+e+"&state=1&out=json",headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:this.upResourceSuccess,requestError:this.errorData};s.getData(a)},downResourceSuccess:function(e){console.log(e),1==e.status&&(layer.msg(e.data,{icon:1,time:1500}),t(function(){l.init()},1e3))},downResource:function(e,t){console.log(this);var a={req_data:{method:"POST",url:BASEURL+"/res_v1_0_0/cms/special/res/isshow?resource_id="+e+"&state=0&out=json",headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:this.downResourceSuccess,requestError:this.errorData};s.getData(a)},deletesuccess:function(){layer.close(tip),1==data.status&&(layer.msg("删除成功",{icon:1,time:1500}),s.getData(DELETERSDATA))},deleteResource:function(e){var t={req_data:{method:"POST",url:BASEURL+"/cms/special/res/isshow?device=1&resource_id="+rid+"&state="+state,headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:this.deletesuccess,requestError:this.errorData};layer.confirm("确认是否删除？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e);layer.msg("数据提交中...",{icon:16,time:0});s.getData(t)},function(e){layer.close(e)})},init:function(){this.getResourceDetail()}};l.init(),n.speicalResourceUp=function(e,t){l.upResource(e,t)},n.speicalResourceDown=function(e,t){l.downResource(e,t)},layui.use(["element","form","laydate"],function(){var e=layui.element(),t=layui.form();layui.laydate();e.init(),t.render(),n.allModelList={},n.dataStateFlag=!0,n.dataColorFlag=!0,n.dataCreateFlag=!0,n.dataPriceFlag=!1,n.dataTypeFlag=!0,e.on("tab(favourable)",function(e){switch(e.index){case 0:n.favourableMode="money",n.favourablepoint="",n.sale_price="";break;case 1:n.favourableMode="point",n.favourablemoney="",n.sale_price="";break;default:n.favourableMode="price",n.favourablepoint="",n.favourablemoney=""}}),t.on("select(car_type)",function(e){n.car_type=e.value}),t.on("select(manufacture)",function(e){n.manufacture=e.value}),t.on("select(editattachment)",function(e){switch(n.dataCreateFlag=!0,n.editattachment=e.value,parseInt(e.value)){case 0:n.attachment="随车发",n.editattachment=0;break;case 1:n.attachment="3天内发",n.editattachment=1;break;case 2:n.attachment="7天内发",n.editattachment=2}}),t.on("select(editmanufacture)",function(e){switch(n.dataCreateFlag=!0,n.editManufacture=e.value,e.value){case 0:n.modelLists[n.current_index].modelInfoData.manufacture="一年以内",n.editManufacture=0;break;case 1:n.modelLists[n.current_index].modelInfoData.manufacture="半年内",n.editManufacture=1;break;case 2:n.modelLists[n.current_index].modelInfoData.manufacture="三个月内",n.editManufacture=2;break;default:n.modelLists[n.current_index].modelInfoData.manufacture="一年以上",n.editManufacture=3}}),t.on("select(editcartype)",function(e){n.editcartype=e.value}),e.on("tab(editfavourable)",function(e){switch(e.index){case 0:n.editFavourableMode="money",n.editFavourablepoint="";break;case 1:n.editFavourableMode="point",n.editFavourablemoney="";break;default:n.editFavourableMode="price",n.editFavourablepoint="",n.editFavourablemoney=""}})}),n.edit_out_color="",n.edit_out_color_glag=!0,n.edit_shoudong_color="",n.edit_out_color_glag1=!0,n.edit_in_color="",n.edit_in_color_glag=!0,n.edit_area="",n.edit_area1="",n.edit_area_flag=!0,n.edit_area_flag1=!0,n.edit_create_data="",n.edit_create_data_flag=!0,n.edit_model="",n.edit_model_ok_flag=!0,n.edit_car_type="",n.edit_car_type_flag=!0,n.edit_file="",n.edit_file_flag=!0,n.edit_show_price="",n.edit_show_price_flag=!0,n.edit_show_price1="",n.edit_show_price_flag1=!0,n.edit_provice_id=0,n.edit_provice_id1=0,n.editProviceName="",n.editProviceName1="",n.edit_city_id=0,n.edit_city_id1=0,n.editCityName="",n.editCityName1="";var d={},u={};function m(e){n.editAreaJoin="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo.cId,i=(e[t].data.cityInfo.cName,e[t].data.pId);e[t].data.pName;0!=t?n.editAreaJoin+="|"+i+","+a:n.editAreaJoin=i+","+a}n.editCityBtnShow=!0}function p(e){n.editAreaJoin1="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo1.cId1,i=(e[t].data.cityInfo1.cName1,e[t].data.pId1);e[t].data.pName1;0!=t?n.editAreaJoin1+="|"+i+","+a:n.editAreaJoin1=i+","+a}n.editCityBtnShow1=!0}n.editShowselectArea=[],n.editShowselectArea1=[],n.editCityList=[],n.editCityList1=[],n.editAreaJoin="",n.editAreaJoin1="",$("#resourceEditColor").selectpicker({noneSelectedText:"—请选择车型颜色—",tickIcon:"icon-ok",style:"btn-default",selectAllText:"选择全部",deselectAllText:"取消全选"}),n.editresData={brand_id:"",brand_name:"",sub_brand_id:"",sub_brand_name:"",model_picture:"",model_id:"",editModelName:"",edit_in_color:"",edit_out_color:"",edit_car_type:"",edit_create_data:"",edit_file:"",edit_model:"",edit_current_price:"",model_price:"",edit_extra:"",edit_current_price1:"",edit_area:"",edit_area1:"",resource_id:""};var _="",g="";function f(e){var t;console.log(e),n.editresData.resource_id=e.res.resourceId,n.editresData.brand_id=e.res.brandId,n.editresData.brand_name=e.res.brandName,n.editresData.sub_brand_id=e.res.subBrandId,n.editresData.sub_brand_name=e.res.subBrandName,n.editresData.model_picture=e.res.modelPicture,n.editresData.model_id=e.res.modelId,n.editresData.model_price=e.res.modelPrice,n.editresData.editModelName=e.res.modelName,n.editresData.edit_out_color=e.res.colors,n.editresData.edit_in_color=e.res.interior,1==e.res.carType?n.editresData.edit_car_type="现车":n.editresData.edit_car_type="期车",n.editresData.edit_file=e.res.attachment,n.editresData.edit_create_data=e.res.manufactureTime,n.editresData.edit_model=(t=e.res.endTime,(t=new Date(t)).getFullYear()+"-"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())),n.editresData.edit_create_data=e.res.manufactureTime,n.editresData.edit_current_price=e.res.salePrice/1e4+"万",n.editresData.edit_current_price1=e.res.frontPrice+"元",n.editresData.edit_extra=e.res.resourceExtra;for(var a=e.saleArea,i=[],r=0;r<a.length;r++)i.push(a[r].provinceName+"-"+a[r].cityName),0!=r?_+="|"+a[r].provinceId+","+a[r].cityId:_=a[r].provinceId+","+a[r].cityId;n.editresData.edit_area=i.toString(),n.editresData.edit_area1=e.res.provinceName+"-"+e.res.cityName,g=e.res.provinceId+","+e.res.cityId}function h(e){1==e.status&&(layer.msg(e.data,{icon:1,time:1500}),t(function(){l.init()},1500))}n.speicalResourceEdit=function(e,t,a){e.stopPropagation();var i={req_data:{method:"GET",url:BASEURL+"/res_v1_0_0/cms/special/res/detail?resource_id="+t,headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:f,requestError:l.errorData};s.getData(i),n.dataPriceFlag=!1,n.edit_out_color_glag=!0,n.edit_in_color_glag=!0,n.edit_area_flag=!0,n.edit_area_flag1=!0,n.edit_create_data_flag=!0,n.edit_model_ok_flag=!0,n.edit_file_flag=!0,n.edit_show_price_flag=!0,n.edit_show_price_flag1=!0,n.edit_car_type_flag=!0,n.dataCreateFlag=!1,n.dataStateFlag=!1,n.dataTypeFlag=!1,n.edit_current_change_provice=!1,n.editTrimColor="",n.editShowselectArea=[],(n.editAreaJoin="")==n.modelLists.area_list&&n.edit_area,""==n.modelLists.area_list1&&n.edit_area1,n.editResourceSellerList=[],n.edit_area="",n.edit_area1="",n.current_index=a,n.editproviceData=n.pData,$("#modalEdit").modal(),r({method:"GET",url:BASEURL+"/api2/res/model/colors?modelid="+n.editresData.model_id+"&device=1",timeout:1e4}).success(function(e){1==e.status?(n.editColorData=e.list,function(e){var t=$(e).length;$("#resourceEditColor").find("option").remove();for(var a=0;a<t;a++)$("#resourceEditColor").append($("<option value="+e[a].id+" data-rgb="+e[a].rgb+">"+e[a].name+"</option>"));$("#resourceEditColor").selectpicker("refresh")}(n.editColorData)):layer.msg("请求失败",{icon:5})}).error(function(){})},n.editPrice=function(){n.edit_show_price_flag=!1,n.editfavourablepoint="",n.editfavourablemoney="",n.edit_sale_price="",n.dataPriceFlag=!0},n.editCreatData=function(){n.dataCreateFlag=!0,n.edit_create_data_flag=!1},n.editFile=function(){n.dataCreateFlag=!0,n.edit_file_flag=!1},n.editCarType=function(){n.edit_car_type_flag=!1,n.dataTypeFlag=!0},n.editPrice1=function(){n.edit_show_price_flag1=!1,n.dataCreateFlag=!0},n.edit_before_provice_id="",n.edit_before_provice_id1="",n.edit_before_city_id="",n.edit_before_city_id1="",n.edit_whole_province_list=[],n.edit_whole_province_list1=[],n.edit_current_change_provice="",n.edit_current_change_provice1="",n.edit_current_change_city="",n.edit_current_change_city1="",n.edit_first_send=!1,n.edit_first_send1=!1,n.editCityBtnShow=!0,n.editCityBtnShow1=!0,n.edit_has_add_money=!0,n.edit_has_add_point=!0,n.editRequsFlag=!1,n.editJiFlag=!0,n.editJiFlag1=!0,n.editSelectSellerState=!1,n.editSelectProvice=function(e,t){n.editResourceSellerList=[],n.edit_provice_id=t,n.editProviceName=$(e.currentTarget).text(),n.edit_current_change_provice=$(e.currentTarget).text(),n.edit_current_change_city="",(d={}).data={},d.data.cityInfo={},0!=t?0==n.edit_before_provice_id&&n.edit_first_send?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),n.editShowselectArea=[],n.edit_before_provice_id=t,d.data.pId=n.edit_provice_id,d.data.pName=n.editProviceName,n.editCityBtnShow=!0,m(n.editShowselectArea),r({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(n.editCityData=e.list,n.editCityData.unshift(c),n.editCityBtnShow=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(n.edit_before_provice_id=t,d.data.pId=n.edit_provice_id,d.data.pName=n.editProviceName,-1==$.inArray(n.edit_provice_id,n.edit_whole_province_list)?r({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(n.editCityData=e.list,n.editCityData.unshift(c),n.editCityBtnShow=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(n.editCityBtnShow=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===n.edit_before_provice_id?(n.edit_before_provice_id=t,n.edit_first_send=!0,d.data.pId=0,d.data.pName="全国",d.data.cityInfo.cId=0,d.data.cityInfo.cName=" ",n.edit_current_change_provice="全国",n.editShowselectArea.push(d),n.editCityBtnShow=!0,m(n.editShowselectArea)):0==n.edit_before_provice_id||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),n.edit_before_provice_id=t,n.editShowselectArea=[],d.data.pId=0,d.data.pName="全国",d.data.cityInfo.cId=0,d.data.cityInfo.cName=" ",n.edit_current_change_provice="全国",n.editShowselectArea.push(d),n.editCityBtnShow=!0,m(n.editShowselectArea),n.$apply(),n.edit_first_send=!0},function(e){layer.close(e)})},n.editSelectProvice1=function(e,t){n.editResourceSellerList1=[],n.edit_provice_id1=t,n.editProviceName1=$(e.currentTarget).text(),n.edit_current_change_provice1=$(e.currentTarget).text(),n.edit_current_change_city1="",(u={}).data={},u.data.cityInfo1={},0!=t?0==n.edit_before_provice_id1&&n.edit_first_send1?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),n.editShowselectArea1=[],n.edit_before_provice_id1=t,u.data.pId1=n.edit_provice_id1,u.data.pName1=n.editProviceName,n.editCityBtnShow1=!0,p(n.editShowselectArea1),r({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(n.editCityData1=e.list,n.editCityData1.unshift(c),n.editCityBtnShow1=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(n.edit_before_provice_id11=t,u.data.pId1=n.edit_provice_id1,u.data.pName1=n.editProviceName,-1==$.inArray(n.edit_provice_id1,n.edit_whole_province_list1)?r({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(n.editCityData1=e.list,n.editCityData1.unshift(c),n.editCityBtnShow1=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(n.editCityBtnShow1=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===n.edit_before_provice_id1?(n.edit_before_provice_id1=t,n.edit_first_send1=!0,u.data.pId1=0,u.data.pName1="全国",u.data.cityInfo1.cId1=0,u.data.cityInfo1.cName1=" ",n.edit_current_change_provice1="全国",n.editShowselectArea1=[],n.editShowselectArea1.push(u),n.editCityBtnShow1=!0,p(n.editShowselectArea1)):0==n.edit_before_provice_id1||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),n.edit_before_provice_id1=t,n.editShowselectArea1=[],u.data.pId1=0,u.data.pName1="全国",u.data.cityInfo1.cId1=0,u.data.cityInfo1.cName1=" ",n.edit_current_change_provice1="全国",n.editShowselectArea1=[],n.editShowselectArea1.push(u),n.editCityBtnShow1=!0,p(n.editShowselectArea1),n.$apply(),n.edit_first_send1=!0},function(e){layer.close(e)})},n.editSelectCity=function(e,a){d.data.cityInfo.cId="",d.data.cityInfo.cName="",-1==$.inArray(a,n.editCityList)&&(0!=a?(n.edit_before_city_id=a,n.editCityList.push(a),n.edit_city_id=a,n.editCityName=$(e.currentTarget).text(),n.edit_current_change_city=$(e.currentTarget).text(),d.data.cityInfo.cId=n.edit_city_id,d.data.cityInfo.cName=n.editCityName,n.editCityBtnShow=!0,n.editShowselectArea.push(d),m(n.editShowselectArea)):""==n.edit_before_city_id&&0!=n.edit_before_city_id?(d.data.pId=n.edit_provice_id,d.data.pName=n.editProviceName,d.data.cityInfo.cId=0,d.data.cityInfo.cName="全省",n.edit_current_change_city="全省",n.edit_whole_province_list.push(n.edit_provice_id),n.editShowselectArea.push(d),m(n.editShowselectArea)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+n.editProviceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),n.edit_before_city_id=a;for(var t=0;t<n.editShowselectArea.length;t++)n.editShowselectArea[t].data.pId==n.edit_provice_id&&(n.editShowselectArea.splice(t,1),t-=1);d.data.pId=n.edit_provice_id,d.data.pName=n.editProviceName,d.data.cityInfo.cId=0,d.data.cityInfo.cName="全省",n.edit_current_change_city="全省",n.edit_whole_province_list.push(n.edit_provice_id),n.editShowselectArea.push(d),m(n.editShowselectArea),n.$apply()},function(e){layer.close(e)}))},n.editSelectCity1=function(e,a){u.data.cityInfo1.cId1="",u.data.cityInfo1.cName1="",-1==$.inArray(a,n.editCityList1)&&(0!=a?(n.edit_before_city_id1=a,n.editCityList1.push(a),n.edit_city_id1=a,n.editCityName1=$(e.currentTarget).text(),n.edit_current_change_city1=$(e.currentTarget).text(),u.data.cityInfo1.cId1=n.edit_city_id1,u.data.cityInfo1.cName1=n.editCityName1,n.editCityBtnShow1=!0,console.log(n.editShowselectArea1),n.editShowselectArea1=[],n.editShowselectArea1.push(u),p(n.editShowselectArea1)):""==n.edit_before_city_id1&&0!=n.edit_before_city_id1?(u.data.pId1=n.edit_provice_id1,u.data.pName1=n.editProviceName1,u.data.cityInfo1.cId1=0,u.data.cityInfo1.cName1="全省",n.edit_current_change_city1="全省",n.edit_whole_province_list1.push(n.edit_provice_id1),n.editShowselectArea1=[],n.editShowselectArea1.push(u),p(n.editShowselectArea1)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+n.editProviceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),n.edit_before_city_id1=a;for(var t=0;t<n.editShowselectArea1.length;t++)n.editShowselectArea1[t].data.pId1==n.edit_provice_id1&&(n.editShowselectArea1.splice(t,1),t-=1);u.data.pId1=n.edit_provice_id1,u.data.pName1=n.editProviceName1,u.data.cityInfo1.cId1=0,u.data.cityInfo1.cName1="全省",n.edit_current_change_city1="全省",n.edit_whole_province_list1.push(n.edit_provice_id1),n.editShowselectArea1=[],n.editShowselectArea1.push(u),p(n.editShowselectArea1),n.$apply()},function(e){layer.close(e)}))},n.editRemoveEle=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;n.editShowselectArea.splice(t,1);for(var i=0;i<n.edit_whole_province_list.length;i++)if(n.edit_whole_province_list[i]==a){n.edit_whole_province_list.splice(i,1);break}n.editCityList.splice(t,1),0==n.editShowselectArea.length&&(n.edit_before_provice_id="",n.edit_before_city_id="",n.edit_whole_province_list=[]),m(n.editShowselectArea)},n.editRemoveEle1=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;n.editShowselectArea1.splice(t,1);for(var i=0;i<n.edit_whole_province_list1.length;i++)if(n.edit_whole_province_list1[i]==a){n.edit_whole_province_list1.splice(i,1);break}n.editCityList1.splice(t,1),0==n.editShowselectArea1.length&&(n.edit_before_provice_id1="",n.edit_before_city_id1="",n.edit_whole_province_list1=[]),p(n.editShowselectArea1)},n.editFavourableMoney=function(e){n.edit_has_add_money=-1==e},n.editFavourablePoint=function(e){n.edit_has_add_point=-1==e},n.$watch("editfavourablemoney",function(e,t){Math.ceil(e);e<0&&null!=e&&""!=e&&(layer.msg("输入的点数必须是数字，且不能小于0！",{time:1500}),n.editfavourablemoney="")}),n.$watch("editfavourablepoint",function(e,t){(100<Math.ceil(e)||e<0)&&null!=e&&""!=e&&(layer.msg("输入的点数必须是数字，且不能小于0或大于100！",{time:1500}),n.editfavourablepoint="")}),n.$watch("edit_sale_price",function(e,t){/[1-9][0-9]*/.test(e)||null==e||""==e||(layer.msg("输入的价格必须是数字，且不能小于0！",{time:1500}),n.edit_sale_price="")}),n.editColorList="",$("#resourceEditColor").on("changed.bs.select",function(e){n.dataColorFlag=!1;for(var t=n.editColorList="",a=e.currentTarget.selectedOptions,i=0;i<$(a).length;i++)0==i?(n.editColorList=a[i].textContent,t=a[i].textContent):(n.editColorList+="|"+a[i].textContent,t+="|"+a[i].textContent);n.colors=t}),n.provice_id=0,n.provice_id1=0,n.proviceName="",n.proviceName1="",n.city_id=0,n.city_id1=0,n.cityName="",n.cityName1="",n.showselectArea=[],n.showselectArea1=[],n.cityList=[],n.cityList1=[],n.areaJoin="",n.areaJoin1="",r({method:"GET",url:BASEURL+"/api2/area/provinces?device=1",timeout:1e4}).success(function(e){1==e.status?(n.proviceData=e.list,n.pData=e.list,n.proviceData.unshift(o)):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}),n.singleSave=function(){var e={brand_id:"",brand_name:"",sub_brand_id:"",sub_brand_name:"",model_picture:"",model_id:"",model_name:"",colors:"",interior:"",car_type:"",manufacture_time:"",attachment:"",end_time:"",sale_price:"",model_price:"",resource_extra:"",front_price:"",area_list:"",source_area:"",resource_id:n.editresData.resource_id};if(e.brand_id=n.editresData.brand_id,e.brand_name=n.editresData.brand_name,e.sub_brand_id=n.editresData.sub_brand_id,e.sub_brand_name=n.editresData.sub_brand_name,e.model_picture=n.editresData.model_picture,e.model_id=n.editresData.model_id,e.model_name=n.editresData.editModelName,n.edit_out_color_glag?e.colors=n.editresData.edit_out_color:e.colors=$("#resourceEditColor").text(),n.edit_in_color_glag?e.interior=n.editresData.edit_in_color:e.interior=n.edit_in_color,n.dataTypeFlag?e.car_type=n.editcartype:"期车"==n.editresData.edit_car_type?e.car_type="2":e.car_type="1",n.dataCreateFlag?0==n.editManufacture?e.manufacture_time="一年以内":1==n.editManufacture?e.manufacture_time="半年内":2==n.editManufacture?e.manufacture_time="三个月内":e.manufacture_time="一年以上":0==n.editresData.edit_create_data?e.manufacture_time="一年以内":1==n.editresData.edit_create_data?e.manufacture_time="半年内":2==n.editresData.edit_create_data?e.manufacture_time="三个月内":e.manufacture_time="一年以上",n.edit_file_flag?e.attachment=n.editresData.edit_file:e.attachment=n.attachment,n.edit_model_ok_flag)e.end_time=Date.parse(new Date(n.editresData.edit_model));else{var t=angular.element("#edit_expiration_date").val().toString().replace(/-/g,"/");e.end_time=Date.parse(new Date(t))}var a=n.editresData.model_price;n.edit_show_price_flag?e.sale_price=1e4*parseFloat(n.editresData.edit_current_price):"money"==n.editFavourableMode?(""!=n.editfavourablemoney&&null!=n.editfavourablemoney||(n.editfavourablemoney=0),n.edit_has_add_money?e.sale_price=a-parseFloat(1e4*n.editfavourablemoney):e.sale_price=a+parseFloat(1e4*n.editfavourablemoney)):"point"==n.editFavourableMode?(""!=n.editfavourablepoint&&null!=n.editfavourablepoint||(n.editfavourablepoint=0),n.edit_has_add_point?e.sale_price=a-a*parseFloat(n.editfavourablepoint)/100:e.sale_price=a+a*parseFloat(n.editfavourablepoint)/100):"price"==n.editFavourableMode?e.sale_price=1e4*n.edit_sale_price:n.editJiFlag=!1,e.model_price=n.editresData.model_price,e.resource_extra=n.editresData.edit_extra,n.edit_show_price_flag1?e.front_price=parseInt(n.editresData.edit_current_price1):e.front_price=n.front_price,n.edit_area_flag?e.area_list=_:e.area_list=n.editAreaJoin,n.edit_area_flag1?e.source_area=g:e.source_area=n.editAreaJoin1;var i={req_data:{method:"POST",url:BASEURL+"/res_v1_0_0/cms/special/res/update?out=json",params:e,headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:h,requestError:l.errorData};s.getData(i),$("#modalEdit").modal("hide")}}]),app.controller("enteringOrder",["$scope","httpData","$window","$timeout","$stateParams","$state","$http","httpRequestData",function(e,t,a,i,r,n,s,o){console.log(1111111111111)}]),app.controller("resOrderCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state","$http","httpRequestData",function(i,t,e,a,r,n,s,o){i.has_clicked=!1,i.orderData=[];var c={province_url:"/api2/area/provinces?device=1",city_url:"/api2/area/cities?device=1",county_url:"/api2/area/areas?device=1",order_url:BASEURL+"/order_v1_0_0/cms/order/resource/special/list",count_url:BASEURL+"/order_v1_0_0/cms/order/resource/special/count",backLog_url:BASEURL+"/order_v1_0_0/cms/order/resource/special/count/backlog",subBrandUrl:"/api2/res/brand/",modelUrl:"/api2/res/model/",listsSendData:{page_index:1,page_size:10,state:"",finish:"",order_code:"",resource_type:"",user_name:"",user_mobile:"",start_time:"",end_time:"",province_id:"",city_id:"",area_id:""},init:function(){this.getProvince(),this.getOrderList(),this.getBrand(),this.getBackLog(),this.getCount(2,0,function(e){i.hasPayCount=e}),this.getCount(6,0,function(e){i.backMoneyCount=e}),this.getCount(1,0,function(e){i.waitPay=e})},errorData:function(){i.has_clicked=!1,layer.msg("请求失败",{icon:5})},getCount:function(e,t,a){var i={req_data:{method:"GET",url:c.count_url,params:{state:e,finish_state:t}},requestSuccess:a,requestError:c.errorData};o.getData(i)},getBackLog:function(){var e={req_data:{method:"GET",url:c.backLog_url,params:{finish_state:0}},requestSuccess:function(e){i.backLog=e},requestError:c.errorData};o.getData(e)},getOrderList:function(){var e={req_data:{method:"GET",url:c.order_url,params:c.listsSendData},requestSuccess:c.setOrderList,requestError:c.errorData};o.getData(e)},setOrderList:function(e){i.orderData=e.list,i.pageNumber=e.pageNumber,i.recordCount=e.recordCount,i.pageCount=e.pageCount,i.pageSize=e.pageSize,i.pageList=i.pageNum(i.pageCount,i.pageNumber),i.startData=0==i.recordCount?0:(i.pageNumber-1)*i.pageSize+1,i.endData=e.list.length<i.pageSize?(i.pageNumber-1)*i.pageSize+e.list.length:i.pageNumber*i.pageSize},getProvince:function(){t.getData("GET",this.province_url,"",this.setProvince,this.errorData)},setProvince:function(e){1==e.status&&(i.province_list=e.list)},getCity:function(e){t.getData("GET",this.city_url,{province:e},this.setCity,this.errorData)},setCity:function(e){1==e.status&&(i.city_list=e.list)},getCounty:function(e){t.getData("GET",this.county_url,{province:e},this.setCounty,this.errorData)},setCounty:function(e){1==e.status&&(i.county_list=e.list)},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]},selectData:function(){var e="",t="";e=i.start_time?Date.parse(i.start_time.replace(/-/g,"/")):"",t=i.end_time?Date.parse(i.end_time.replace(/-/g,"/")):"";var a=i.state&&i.state.split(",");this.listsSendData.province_id=i.province_id,this.listsSendData.city_id=i.city_id,this.listsSendData.area_id=i.area_id,this.listsSendData.user_mobile=i.user_mobile,this.listsSendData.start_time=e,this.listsSendData.end_time=t,this.listsSendData.brand_id=i.brand_id,this.listsSendData.sub_brand_id=i.sub_brand_id,this.listsSendData.model_id=i.model_id,this.listsSendData.state=a?a[0]:"",this.listsSendData.finish=a?a[1]:"",this.listsSendData.page_index=1},getBrand:function(){var e={req_data:{method:"GET",url:CAR_BRAND_URL},requestSuccess:function(e){1===e.status&&(i.brand_list=e.list)},requestError:this.errorData};o.getData(e)},getSubBrand:function(e){var t={req_data:{method:"GET",url:BASEURL+this.subBrandUrl+e+"?device=1"},requestSuccess:function(e){1===e.status&&(i.sub_brand_list=e.list)},requestError:this.errorData};o.getData(t)},getModel:function(e){var t={req_data:{method:"GET",url:BASEURL+this.modelUrl+i.brand_id+"/"+e+"?device=1"},requestSuccess:function(e){1===e.status&&(i.model_list=e.list)},requestError:this.errorData};o.getData(t)}};c.init(),null!=r.province_id?(c.getCity(r.province_id),i.city_id=r.city_id):(i.city_list="",i.city_id="",i.area_id="",i.county_list=""),null!=r.city_id?(c.getCounty(r.city_id),i.area_id=r.area_id):(i.county_list="",i.area_id=""),i.changeState=function(){c.selectData()},i.changeType=function(){c.selectData()},i.changeProvince=function(){i.area_id="",i.county_list="",i.city_id="",i.city_list="",c.selectData()},i.changeCity=function(){i.area_id="",i.county_list="",c.selectData()},i.changeCounty=function(){c.selectData()},$("#start_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){}),$("#end_time").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0}).on("changeDate",function(e){});var l=!1,d=!1,u=!1;function m(e){1===e.status?c.getOrderList():layer.msg(e.msg,{icon:5,time:2e3}),$(".modal").modal("hide")}i.order_search=function(){c.selectData()},i.$watch("user_mobile",function(){d&&""==i.user_mobile&&c.selectData(),d=!0}),i.$watch("user_name",function(){u&&""==i.user_name&&c.selectData(),u=!0}),i.$watch("order_code",function(){l&&""==i.order_code&&c.selectData(),l=!0}),i.changeProvince=function(){c.getCity(i.province_id),i.city_id="",i.area_id=""},i.changeCity=function(){c.getCounty(i.city_id),i.area_id=""},i.changeBrand=function(){c.getSubBrand(i.brand_id),i.sub_brand_id="",i.model_id=""},i.changeSubBrand=function(){c.getModel(i.sub_brand_id),i.model_id=""},i.selectState=function(e,t){i.state=e+","+t,i.search()},i.search=function(){c.selectData(),c.getOrderList()},i.changePageUrl=function(e){c.listsSendData.page_index=i.getPageIndex(e,i.pageNumber,i.pageCount),i.pageNumber=i.getPageIndex(e,i.pageNumber,i.pageCount),c.getOrderList()},i.delOrder=function(a){layer.confirm("确定删除该资源？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e);var t={req_data:{method:"DELETE",url:BASEURL+"/order_v1_0_0/api/order/resource/special/"+a},requestSuccess:m};o.getData(t)},function(e){layer.close(e)})},i.agreeRefund=function(a){layer.confirm("确定同意退款？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e);var t={req_data:{method:"POST",url:BASEURL+"/order_v1_0_0/cms/order/resource/special/refund/check?out=json",params:{orderId:a,state:1,extra:""}},requestSuccess:m};o.getData(t)},function(e){layer.close(e)})},i.rejectRefund=function(){if(i.remark){var e={req_data:{method:"POST",url:BASEURL+"/order_v1_0_0/cms/order/resource/special/refund/check?out=json",params:{orderId:i.orderId,state:0,extra:i.remark}},requestSuccess:m};o.getData(e)}else layer.msg("退款原因必填",{icon:5,time:2e3})},i.hasPay=function(a){layer.confirm("确认定金已支付4S店？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e);var t={req_data:{method:"POST",url:BASEURL+"/order_v1_0_0/cms/order/resource/special/apply4s?out=json&orderId="+a},requestSuccess:m};o.getData(t)},function(e){layer.close(e)})},i.end=function(a){layer.confirm("确认完成？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e);var t={req_data:{method:"POST",url:BASEURL+"/order_v1_0_0/cms/order/resource/special/over?out=json&orderId="+a},requestSuccess:function(e){}};o.getData(t)},function(e){layer.close(e)})},i.tip=function(i){layer.confirm("确定提醒买家？？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e);var t={resource_id:i};tip;var a={req_data:{method:"POST",url:BASEURL+resource.del_res_url,params:t},requestSuccess:resource.delSuccess,requestError:resource.httpError};o.getData(a)},function(e){layer.close(e)})},i.showModal=function(e,t){i.orderId=t,$("#"+e).modal()},i.refund=function(){if(i.remark){var e={req_data:{method:"POST",url:BASEURL+"/order_v1_0_0/cms/order/resource/special/apply/refund?out=json",params:{orderId:i.orderId,extra:i.remark}},requestSuccess:m};o.getData(e)}else layer.msg("退款原因必填",{icon:5,time:2e3})}}]),app.controller("specialResOrderDetail",["$scope","httpData","$window","$timeout","$stateParams","$state","$http","httpRequestData",function(t,e,a,i,r,n,s,o){var c=r.orderId,l={req_data:{method:"GET",url:BASEURL+"/order_v1_0_0/cms/order/resource/special/detail?order_id="+c},requestSuccess:function(e){t.detail=e.orderRes,t.logs=e.logList}};function d(e){1===e.status?order.getOrderList():layer.msg(e.msg,{icon:5,time:2e3}),$(".modal").modal("hide")}o.getData(l),t.delOrder=function(){layer.confirm("确定删除该资源？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e);var t={req_data:{method:"DELETE",url:BASEURL+"/order_v1_0_0/api/order/resource/special/"+c},requestSuccess:d};o.getData(t)},function(e){layer.close(e)})},t.agreeRefund=function(){layer.confirm("确定同意退款？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e);var t={req_data:{method:"POST",url:BASEURL+"/order_v1_0_0/cms/order/resource/special/refund/check?out=json",params:{orderId:c,state:1,extra:""}},requestSuccess:d};o.getData(t)},function(e){layer.close(e)})},t.rejectRefund=function(){if(t.remark){var e={req_data:{method:"POST",url:BASEURL+"/order_v1_0_0/cms/order/resource/special/refund/check?out=json",params:{orderId:c,state:0,extra:t.remark}},requestSuccess:d};o.getData(e)}else layer.msg("退款原因必填",{icon:5,time:2e3})},t.hasPay=function(){layer.confirm("确认定金已支付4S店？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e);var t={req_data:{method:"POST",url:BASEURL+"/order_v1_0_0/cms/order/resource/special/apply4s?out=json&orderId="+c},requestSuccess:d};o.getData(t)},function(e){layer.close(e)})},t.end=function(){layer.confirm("确认完成？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e);var t={req_data:{method:"POST",url:BASEURL+"/order_v1_0_0/cms/order/resource/special/over?out=json&orderId="+c},requestSuccess:function(e){}};o.getData(t)},function(e){layer.close(e)})},t.tip=function(){layer.confirm("确定提醒买家？？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4,closeBtn:0},function(e){layer.close(e)},function(e){layer.close(e)})},t.showModal=function(e){$("#"+e).modal()},t.refund=function(){if(t.remark){var e={req_data:{method:"POST",url:BASEURL+"/order_v1_0_0/cms/order/resource/special/apply/refund?out=json",params:{orderId:c,extra:t.remark}},requestSuccess:d};o.getData(e)}else layer.msg("退款原因必填",{icon:5,time:2e3})}}]),app.controller("specialResourcesListsCtrl",["$http","$scope","$stateParams","$state","httpRequestData","$timeout","httpData","$window",function(r,o,c,a,n,t,i,e){var s=layer.load(1);o.requsFlag=!1,o.modelDeleteShow="",o.pinLists=!0,o.modelisthasshow=!0,o.modelLists=[];o.subPinBtn=!0;o.exteriorColor="",o.trimColor="",o.cityBtnShow=!0,o.cityBtnShow1=!0,o.favourableMode="money",o.editFavourableMode="money",o.current_index="",o.has_use_click=!0,o.has_use_attr_click=!0,o.has_use_attr_click=!0,o.attachment="",o.editattachment="",o.has_send_btn=!0,o.editFlag=!0,o.edit_btn=!1;var l={id:0,name:"全国"},d={id:0,name:"全省"};o.publishObj=[],o.resourceData=[];var u={province_url:"/api2/area/provinces?device=1",city_url:"/api2/area/cities?device=1",province_id:"",city_id:"",brand_id:"",sub_brand_id:"",state:"",specialRseourceData:{page_index:1,page_size:10,province_id:"",city_id:"",brand_id:"",sub_brand_id:"",model_id:"",state:""},init:function(){this.getDataFromUrl(),this.getResourceList(),this.getProvince(),this.getBrand()},errorData:function(){layer.close(s),layer.msg("请求失败",{icon:5})},setResourceList:function(e){if(console.log(e),layer.close(s),1==e.status){o.resourceData=e.list;for(var t=(new Date).getTime(),a=0;a<e.list.length;a++)u.timestamp(e.list[a].endTime)<t&&(o.resourceData[a].state=2),console.log(o.resourceData[a].state);o.pageNumber=e.page.pageNumber,o.recordCount=e.page.recordCount,o.pageCount=e.page.pageCount,o.pageSize=e.page.pageSize,o.pageList=o.pageNum(o.pageCount,o.pageNumber),o.startData=0==o.recordCount?0:(o.pageNumber-1)*o.pageSize+1,o.endData=e.list.length<o.pageSize?(o.pageNumber-1)*o.pageSize+e.list.length:o.pageNumber*o.pageSize}else layer.msg("请求失败",{icon:5})},getResourceList:function(){var e={req_data:{method:"GET",url:BASEURL+"/res_v1_0_0/cms/special/res/datas?out=json",params:this.specialRseourceData,headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:this.setResourceList,requestError:this.errorData};n.getData(e)},setBrand:function(e){1==e.status&&(o.brandData=e.list)},getBrand:function(){var e={req_data:{method:"GET",url:BASEURL+"/api2/res/brand?device=1",headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:this.setBrand,requestError:this.errorData};n.getData(e)},setSubBrand:function(e){1==e.status&&(o.carmodelList=e.list)},getSubBrand:function(e){var t={req_data:{method:"GET",url:BASEURL+"/api2/res/brand/"+e+"?device=1",headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:this.setSubBrand,requestError:this.errorData};n.getData(t)},setModelSubBrand:function(e){1==e.status&&(o.modelList=e.list)},getModelSubBrand:function(e,t){var a={req_data:{method:"GET",url:BASEURL+"/api2/res/model/"+e+"/"+t+"?device=1",headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:this.setModelSubBrand,requestError:this.errorData};n.getData(a)},getProvince:function(){i.getData("GET",this.province_url,"",this.setProvince,this.errorData)},setProvince:function(e){1==e.status&&(o.provinceData=e.list)},getCity:function(e){i.getData("GET",this.city_url,{province:e},this.setCity,this.errorData)},setCity:function(e){1==e.status&&(o.cityLists=e.list)},timestamp:function(e){return Date.parse(e.replace(/-/g,"/"))},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]},getDataFromUrl:function(){var e=c.page_index,t=(c.page_size,c.province_id),a=c.city_id,i=c.brand_id,r=c.sub_brand_id,n=c.model_id,s=c.state;e||(e=1),o.province_id=t,o.city_Id=a,o.brand_id=i,o.sub_brand_id=r,o.model_id=n,o.state=s,this.specialRseourceData={page_index:e,page_size:10,province_id:t,city_id:a,brand_id:i,sub_brand_id:r,model_id:n,state:s}},selectData:function(){this.specialRseourceData.province_id=o.province_id,this.specialRseourceData.city_id=o.city_Id,this.specialRseourceData.brand_id=o.brand_id,this.specialRseourceData.sub_brand_id=o.sub_brand_id,this.specialRseourceData.model_id=o.model_id,this.specialRseourceData.state=o.state,a.go("home.specialResourcesLists",this.specialRseourceData)},deleteResourceSuccess:function(e){1==e.status&&(layer.msg(e.data,{icon:1,time:1500}),t(function(){u.init()},1e3))},deleteResource:function(e){var t={req_data:{method:"POST",url:BASEURL+"/res_v1_0_0/cms/special/res/delete?resource_id="+e+"&out=json",headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e3},requestSuccess:this.deleteResourceSuccess,requestError:this.errorData};layer.confirm("确认是否删除？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e);layer.msg("数据提交中...",{icon:16,time:0});n.getData(t)},function(e){layer.close(e)})},upResourceSuccess:function(e){console.log(e),1==e.status&&(layer.msg(e.data,{icon:1,time:1500}),t(function(){u.init()},1e3))},upResource:function(e,t){var a={req_data:{method:"POST",url:BASEURL+"/res_v1_0_0/cms/special/res/isshow?resource_id="+e+"&state=1&out=json",headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:this.upResourceSuccess,requestError:this.errorDat};n.getData(a)},downResourceSuccess:function(e){1==e.status&&(layer.msg(e.data,{icon:1,time:1500}),t(function(){u.init()},1e3))},downResource:function(e,t){var a={req_data:{method:"POST",url:BASEURL+"/res_v1_0_0/cms/special/res/isshow?resource_id="+e+"&state=0&out=json",headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:this.downResourceSuccess,requestError:this.errorData};n.getData(a)}};u.init(),null!=c.province_id?(u.getCity(c.province_id),o.city_Id=c.city_id):(o.cityLists="",o.city_id=""),null!=c.brand_id?(u.getSubBrand(c.brand_id),o.sub_brand_id=c.sub_brand_id):(o.carmodelList="",o.sub_brand_id="",o.modelList="",o.model_id=""),null!=c.sub_brand_id?(u.getModelSubBrand(c.brand_id,c.sub_brand_id),o.model_id=c.model_id):(o.modelList="",o.model_id=""),o.changeProvince=function(){o.city_Id="",o.cityLists="",u.selectData()},o.changeCity=function(){o.sub_brand_id="",o.carmodelList="",o.model_id="",o.modelList="",u.selectData()},o.changeBrand=function(){o.model_id="",o.modelList="",o.sub_brand_id="",o.carmodelList="",u.selectData()},o.changeCarModel=function(){o.model_id="",o.modelList="",u.selectData()},o.changeModel=function(){u.selectData()},o.changeType=function(){u.selectData()},o.specialUp=function(e,t,a){e.stopPropagation(),u.upResource(t,a)},o.specialDown=function(e,t,a){e.stopPropagation(),u.downResource(t,a)},layui.use(["element","form","laydate"],function(){var e=layui.element(),t=layui.form();layui.laydate();e.init(),t.render(),o.allModelList={},o.dataStateFlag=!0,o.dataColorFlag=!0,o.dataCreateFlag=!0,o.dataPriceFlag=!1,o.dataTypeFlag=!0,e.on("tab(favourable)",function(e){switch(e.index){case 0:o.favourableMode="money",o.favourablepoint="",o.sale_price="";break;case 1:o.favourableMode="point",o.favourablemoney="",o.sale_price="";break;default:o.favourableMode="price",o.favourablepoint="",o.favourablemoney=""}}),t.on("select(car_type)",function(e){o.car_type=e.value}),t.on("select(manufacture)",function(e){o.manufacture=e.value}),t.on("select(editattachment)",function(e){switch(o.dataCreateFlag=!0,o.editattachment=e.value,parseInt(e.value)){case 0:o.attachment="随车发",o.editattachment=0;break;case 1:o.attachment="3天内发",o.editattachment=1;break;case 2:o.attachment="7天内发",o.editattachment=2}}),t.on("select(editmanufacture)",function(e){switch(o.dataCreateFlag=!0,o.editManufacture=e.value,e.value){case 0:o.modelLists[o.current_index].modelInfoData.manufacture="一年以内",o.editManufacture=0;break;case 1:o.modelLists[o.current_index].modelInfoData.manufacture="半年内",o.editManufacture=1;break;case 2:o.modelLists[o.current_index].modelInfoData.manufacture="三个月内",o.editManufacture=2;break;default:o.modelLists[o.current_index].modelInfoData.manufacture="一年以上",o.editManufacture=3}}),t.on("select(editcartype)",function(e){o.editcartype=e.value}),e.on("tab(editfavourable)",function(e){switch(e.index){case 0:o.editFavourableMode="money",o.editFavourablepoint="";break;case 1:o.editFavourableMode="point",o.editFavourablemoney="";break;default:o.editFavourableMode="price",o.editFavourablepoint="",o.editFavourablemoney=""}})}),o.edit_out_color="",o.edit_out_color_glag=!0,o.edit_shoudong_color="",o.edit_out_color_glag1=!0,o.edit_in_color="",o.edit_in_color_glag=!0,o.edit_area="",o.edit_area1="",o.edit_area_flag=!0,o.edit_area_flag1=!0,o.edit_create_data="",o.edit_create_data_flag=!0,o.edit_model="",o.edit_model_ok_flag=!0,o.edit_car_type="",o.edit_car_type_flag=!0,o.edit_file="",o.edit_file_flag=!0,o.edit_show_price="",o.edit_show_price_flag=!0,o.edit_show_price1="",o.edit_show_price_flag1=!0,o.edit_provice_id=0,o.edit_provice_id1=0,o.editProviceName="",o.editProviceName1="",o.edit_city_id=0,o.edit_city_id1=0,o.editCityName="",o.editCityName1="";var m={},p={};function _(e){o.editAreaJoin="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo.cId,i=(e[t].data.cityInfo.cName,e[t].data.pId);e[t].data.pName;0!=t?o.editAreaJoin+="|"+i+","+a:o.editAreaJoin=i+","+a}o.editCityBtnShow=!0}function g(e){o.editAreaJoin1="";for(var t=0;t<$(e).length;t++){var a=e[t].data.cityInfo1.cId1,i=(e[t].data.cityInfo1.cName1,e[t].data.pId1);e[t].data.pName1;0!=t?o.editAreaJoin1+="|"+i+","+a:o.editAreaJoin1=i+","+a}o.editCityBtnShow1=!0}o.editShowselectArea=[],o.editShowselectArea1=[],o.editCityList=[],o.editCityList1=[],o.editAreaJoin="",o.editAreaJoin1="",$("#resourceEditColor").selectpicker({noneSelectedText:"—请选择车型颜色—",tickIcon:"icon-ok",style:"btn-default",selectAllText:"选择全部",deselectAllText:"取消全选"}),o.editresData={brand_id:"",brand_name:"",sub_brand_id:"",sub_brand_name:"",model_picture:"",model_id:"",editModelName:"",edit_in_color:"",edit_out_color:"",edit_car_type:"",edit_create_data:"",edit_file:"",edit_model:"",edit_current_price:"",model_price:"",edit_extra:"",edit_current_price1:"",edit_area:"",edit_area1:"",resource_id:""};var f="",h="";function y(e){var t;console.log(e),o.editresData.resource_id=e.res.resourceId,o.editresData.brand_id=e.res.brandId,o.editresData.brand_name=e.res.brandName,o.editresData.sub_brand_id=e.res.subBrandId,o.editresData.sub_brand_name=e.res.subBrandName,o.editresData.model_picture=e.res.modelPicture,o.editresData.model_id=e.res.modelId,console.log(o.editresData.model_id),o.editresData.model_price=e.res.modelPrice,o.editresData.editModelName=e.res.modelName,o.editresData.edit_out_color=e.res.colors,o.editresData.edit_in_color=e.res.interior,1==e.res.carType?o.editresData.edit_car_type="现车":o.editresData.edit_car_type="期车",o.editresData.edit_file=e.res.attachment,o.editresData.edit_create_data=e.res.manufactureTime,o.editresData.edit_model=(t=e.res.endTime,(t=new Date(t)).getFullYear()+"-"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())),o.editresData.edit_create_data=e.res.manufactureTime,o.editresData.edit_current_price=e.res.salePrice/1e4+"万",o.editresData.edit_current_price1=e.res.frontPrice+"元",o.editresData.edit_extra=e.res.resourceExtra;for(var a=e.saleArea,i=[],r=0;r<a.length;r++)i.push(a[r].provinceName+"-"+a[r].cityName),0!=r?f+="|"+a[r].provinceId+","+a[r].cityId:f=a[r].provinceId+","+a[r].cityId;o.editresData.edit_area=i.toString(),o.editresData.edit_area1=e.res.provinceName+"-"+e.res.cityName,h=e.res.provinceId+","+e.res.cityId}o.specialEdit=function(e,t,a){e.stopPropagation();var i={req_data:{method:"GET",url:BASEURL+"/res_v1_0_0/cms/special/res/detail?resource_id="+t,headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:y,requestError:u.errorData};n.getData(i),o.dataPriceFlag=!1,o.edit_out_color_glag=!0,o.edit_in_color_glag=!0,o.edit_area_flag=!0,o.edit_area_flag1=!0,o.edit_create_data_flag=!0,o.edit_model_ok_flag=!0,o.edit_file_flag=!0,o.edit_show_price_flag=!0,o.edit_show_price_flag1=!0,o.edit_car_type_flag=!0,o.dataCreateFlag=!1,o.dataStateFlag=!1,o.dataTypeFlag=!1,o.edit_current_change_provice=!1,o.editTrimColor="",o.editShowselectArea=[],(o.editAreaJoin="")==o.modelLists.area_list&&o.edit_area,""==o.modelLists.area_list1&&o.edit_area1,o.editResourceSellerList=[],o.edit_area="",o.edit_area1="",o.current_index=a,o.editproviceData=o.pData,$("#modalEdit").modal(),r({method:"GET",url:BASEURL+"/api2/res/model/colors?modelid="+o.editresData.model_id+"&device=1",timeout:1e4}).success(function(e){console.log(e),1==e.status?(o.editColorData=e.list,function(e){var t=$(e).length;$("#resourceEditColor").find("option").remove();for(var a=0;a<t;a++)$("#resourceEditColor").append($("<option value="+e[a].id+" data-rgb="+e[a].rgb+">"+e[a].name+"</option>"));$("#resourceEditColor").selectpicker("refresh")}(o.editColorData)):layer.msg("请求失败",{icon:5})}).error(function(){})},o.editPrice=function(){o.edit_show_price_flag=!1,o.editfavourablepoint="",o.editfavourablemoney="",o.edit_sale_price="",o.dataPriceFlag=!0},o.editCreatData=function(){o.dataCreateFlag=!0,o.edit_create_data_flag=!1},o.editFile=function(){o.dataCreateFlag=!0,o.edit_file_flag=!1},o.editCarType=function(){o.edit_car_type_flag=!1,o.dataTypeFlag=!0},o.editPrice1=function(){o.edit_show_price_flag1=!1,o.dataCreateFlag=!0},o.edit_before_provice_id="",o.edit_before_provice_id1="",o.edit_before_city_id="",o.edit_before_city_id1="",o.edit_whole_province_list=[],o.edit_whole_province_list1=[],o.edit_current_change_provice="",o.edit_current_change_provice1="",o.edit_current_change_city="",o.edit_current_change_city1="",o.edit_first_send=!1,o.edit_first_send1=!1,o.editCityBtnShow=!0,o.editCityBtnShow1=!0,o.edit_has_add_money=!0,o.edit_has_add_point=!0,o.editRequsFlag=!1,o.editJiFlag=!0,o.editJiFlag1=!0,o.editSelectSellerState=!1,o.editSelectProvice=function(e,t){o.editResourceSellerList=[],o.edit_provice_id=t,o.editProviceName=$(e.currentTarget).text(),o.edit_current_change_provice=$(e.currentTarget).text(),o.edit_current_change_city="",(m={}).data={},m.data.cityInfo={},0!=t?0==o.edit_before_provice_id&&o.edit_first_send?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),o.editShowselectArea=[],o.edit_before_provice_id=t,m.data.pId=o.edit_provice_id,m.data.pName=o.editProviceName,o.editCityBtnShow=!0,_(o.editShowselectArea),r({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(o.editCityData=e.list,o.editCityData.unshift(d),o.editCityBtnShow=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(o.edit_before_provice_id=t,m.data.pId=o.edit_provice_id,m.data.pName=o.editProviceName,-1==$.inArray(o.edit_provice_id,o.edit_whole_province_list)?r({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(o.editCityData=e.list,o.editCityData.unshift(d),o.editCityBtnShow=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(o.editCityBtnShow=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===o.edit_before_provice_id?(o.edit_before_provice_id=t,o.edit_first_send=!0,m.data.pId=0,m.data.pName="全国",m.data.cityInfo.cId=0,m.data.cityInfo.cName=" ",o.edit_current_change_provice="全国",o.editShowselectArea.push(m),o.editCityBtnShow=!0,_(o.editShowselectArea)):0==o.edit_before_provice_id||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),o.edit_before_provice_id=t,o.editShowselectArea=[],m.data.pId=0,m.data.pName="全国",m.data.cityInfo.cId=0,m.data.cityInfo.cName=" ",o.edit_current_change_provice="全国",o.editShowselectArea.push(m),o.editCityBtnShow=!0,_(o.editShowselectArea),o.$apply(),o.edit_first_send=!0},function(e){layer.close(e)})},o.editSelectProvice1=function(e,t){o.editResourceSellerList1=[],o.edit_provice_id1=t,o.editProviceName1=$(e.currentTarget).text(),o.edit_current_change_provice1=$(e.currentTarget).text(),o.edit_current_change_city1="",(p={}).data={},p.data.cityInfo1={},0!=t?0==o.edit_before_provice_id1&&o.edit_first_send1?layer.confirm("选择省份，全国将被取消，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),o.editShowselectArea1=[],o.edit_before_provice_id1=t,p.data.pId1=o.edit_provice_id1,p.data.pName1=o.editProviceName,o.editCityBtnShow1=!0,g(o.editShowselectArea1),r({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(o.editCityData1=e.list,o.editCityData1.unshift(d),o.editCityBtnShow1=!1):layer.msg("请求失败",{icon:5})}).error(function(e){})},function(e){layer.close(e)}):(o.edit_before_provice_id11=t,p.data.pId1=o.edit_provice_id1,p.data.pName1=o.editProviceName,-1==$.inArray(o.edit_provice_id1,o.edit_whole_province_list1)?r({method:"GET",url:BASEURL+"/api2/area/cities?province="+t+"&device=1",timeout:1e4}).success(function(e){1==e.status?(o.editCityData1=e.list,o.editCityData1.unshift(d),o.editCityBtnShow1=!1):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){}):(o.editCityBtnShow1=!0,layer.msg("已选择全省",{icon:0,time:1500}))):""===o.edit_before_provice_id1?(o.edit_before_provice_id1=t,o.edit_first_send1=!0,p.data.pId1=0,p.data.pName1="全国",p.data.cityInfo1.cId1=0,p.data.cityInfo1.cName1=" ",o.edit_current_change_provice1="全国",o.editShowselectArea1=[],o.editShowselectArea1.push(p),o.editCityBtnShow1=!0,g(o.editShowselectArea1)):0==o.edit_before_provice_id1||layer.confirm("选择全国，前面的选择将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),o.edit_before_provice_id1=t,o.editShowselectArea1=[],p.data.pId1=0,p.data.pName1="全国",p.data.cityInfo1.cId1=0,p.data.cityInfo1.cName1=" ",o.edit_current_change_provice1="全国",o.editShowselectArea1=[],o.editShowselectArea1.push(p),o.editCityBtnShow1=!0,g(o.editShowselectArea1),o.$apply(),o.edit_first_send1=!0},function(e){layer.close(e)})},o.editSelectCity=function(e,a){m.data.cityInfo.cId="",m.data.cityInfo.cName="",-1==$.inArray(a,o.editCityList)&&(0!=a?(o.edit_before_city_id=a,o.editCityList.push(a),o.edit_city_id=a,o.editCityName=$(e.currentTarget).text(),o.edit_current_change_city=$(e.currentTarget).text(),m.data.cityInfo.cId=o.edit_city_id,m.data.cityInfo.cName=o.editCityName,o.editCityBtnShow=!0,o.editShowselectArea.push(m),_(o.editShowselectArea)):""==o.edit_before_city_id&&0!=o.edit_before_city_id?(m.data.pId=o.edit_provice_id,m.data.pName=o.editProviceName,m.data.cityInfo.cId=0,m.data.cityInfo.cName="全省",o.edit_current_change_city="全省",o.edit_whole_province_list.push(o.edit_provice_id),o.editShowselectArea.push(m),_(o.editShowselectArea)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+o.editProviceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),o.edit_before_city_id=a;for(var t=0;t<o.editShowselectArea.length;t++)o.editShowselectArea[t].data.pId==o.edit_provice_id&&(o.editShowselectArea.splice(t,1),t-=1);m.data.pId=o.edit_provice_id,m.data.pName=o.editProviceName,m.data.cityInfo.cId=0,m.data.cityInfo.cName="全省",o.edit_current_change_city="全省",o.edit_whole_province_list.push(o.edit_provice_id),o.editShowselectArea.push(m),_(o.editShowselectArea),o.$apply()},function(e){layer.close(e)}))},o.editSelectCity1=function(e,a){p.data.cityInfo1.cId1="",p.data.cityInfo1.cName1="",-1==$.inArray(a,o.editCityList1)&&(0!=a?(o.edit_before_city_id1=a,o.editCityList1.push(a),o.edit_city_id1=a,o.editCityName1=$(e.currentTarget).text(),o.edit_current_change_city1=$(e.currentTarget).text(),p.data.cityInfo1.cId1=o.edit_city_id1,p.data.cityInfo1.cName1=o.editCityName1,o.editCityBtnShow1=!0,console.log(o.editShowselectArea1),o.editShowselectArea1=[],o.editShowselectArea1.push(p),g(o.editShowselectArea1)):""==o.edit_before_city_id1&&0!=o.edit_before_city_id1?(p.data.pId1=o.edit_provice_id1,p.data.pName1=o.editProviceName1,p.data.cityInfo1.cId1=0,p.data.cityInfo1.cName1="全省",o.edit_current_change_city1="全省",o.edit_whole_province_list1.push(o.edit_provice_id1),o.editShowselectArea1=[],o.editShowselectArea1.push(p),g(o.editShowselectArea1)):layer.confirm('选择全省，之前 <em style="font-style: normal; font-weight: bold; color: #d9534f">'+o.editProviceName+"</em> 下选择的城市将被清空，是否选择？",{skin:"layui-layer-lan",btn:["确定","取消"],anim:2},function(e){layer.close(e),o.edit_before_city_id1=a;for(var t=0;t<o.editShowselectArea1.length;t++)o.editShowselectArea1[t].data.pId1==o.edit_provice_id1&&(o.editShowselectArea1.splice(t,1),t-=1);p.data.pId1=o.edit_provice_id1,p.data.pName1=o.editProviceName1,p.data.cityInfo1.cId1=0,p.data.cityInfo1.cName1="全省",o.edit_current_change_city1="全省",o.edit_whole_province_list1.push(o.edit_provice_id1),o.editShowselectArea1=[],o.editShowselectArea1.push(p),g(o.editShowselectArea1),o.$apply()},function(e){layer.close(e)}))},o.editRemoveEle=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;o.editShowselectArea.splice(t,1);for(var i=0;i<o.edit_whole_province_list.length;i++)if(o.edit_whole_province_list[i]==a){o.edit_whole_province_list.splice(i,1);break}o.editCityList.splice(t,1),0==o.editShowselectArea.length&&(o.edit_before_provice_id="",o.edit_before_city_id="",o.edit_whole_province_list=[]),_(o.editShowselectArea)},o.editRemoveEle1=function(e,t){var a=$(e.target).parent("li")[0].attributes[2].value;o.editShowselectArea1.splice(t,1);for(var i=0;i<o.edit_whole_province_list1.length;i++)if(o.edit_whole_province_list1[i]==a){o.edit_whole_province_list1.splice(i,1);break}o.editCityList1.splice(t,1),0==o.editShowselectArea1.length&&(o.edit_before_provice_id1="",o.edit_before_city_id1="",o.edit_whole_province_list1=[]),g(o.editShowselectArea1)},o.editFavourableMoney=function(e){o.edit_has_add_money=-1==e},o.editFavourablePoint=function(e){o.edit_has_add_point=-1==e},o.$watch("editfavourablemoney",function(e,t){Math.ceil(e);e<0&&null!=e&&""!=e&&(layer.msg("输入的点数必须是数字，且不能小于0！",{time:1500}),o.editfavourablemoney="")}),o.$watch("editfavourablepoint",function(e,t){(100<Math.ceil(e)||e<0)&&null!=e&&""!=e&&(layer.msg("输入的点数必须是数字，且不能小于0或大于100！",{time:1500}),o.editfavourablepoint="")}),o.$watch("edit_sale_price",function(e,t){/[1-9][0-9]*/.test(e)||null==e||""==e||(layer.msg("输入的价格必须是数字，且不能小于0！",{time:1500}),o.edit_sale_price="")}),o.editColorList="",$("#resourceEditColor").on("changed.bs.select",function(e){o.dataColorFlag=!1;for(var t=o.editColorList="",a=e.currentTarget.selectedOptions,i=0;i<$(a).length;i++)0==i?(o.editColorList=a[i].textContent,t=a[i].textContent):(o.editColorList+="|"+a[i].textContent,t+="|"+a[i].textContent);o.colors=t}),o.provice_id=0,o.provice_id1=0,o.proviceName="",o.proviceName1="",o.city_id=0,o.city_id1=0,o.cityName="",o.cityName1="",o.showselectArea=[],o.showselectArea1=[],o.cityList=[],o.cityList1=[],o.areaJoin="",o.areaJoin1="",r({method:"GET",url:BASEURL+"/api2/area/provinces?device=1",timeout:1e4}).success(function(e){1==e.status?(o.proviceData=e.list,o.pData=e.list,o.proviceData.unshift(l)):layer.msg("请求失败",{icon:5,time:1500})}).error(function(e){});var v={};function b(e){1==e.status&&(layer.msg(e.data,{icon:1,time:1500}),t(function(){u.init()},1500))}function D(e){1==e.status&&(layer.msg(e.data,{icon:1,time:1500}),t(function(){u.init()}))}o.singleSave=function(){if((v={brand_id:"",brand_name:"",sub_brand_id:"",sub_brand_name:"",model_picture:"",model_id:"",model_name:"",colors:"",interior:"",car_type:"",manufacture_time:"",attachment:"",end_time:"",sale_price:"",model_price:"",resource_extra:"",front_price:"",area_list:"",source_area:"",resource_id:o.editresData.resource_id}).brand_id=o.editresData.brand_id,v.brand_name=o.editresData.brand_name,v.sub_brand_id=o.editresData.sub_brand_id,v.sub_brand_name=o.editresData.sub_brand_name,v.model_picture=o.editresData.model_picture,v.model_id=o.editresData.model_id,v.model_name=o.editresData.editModelName,o.edit_out_color_glag?v.colors=o.editresData.edit_out_color:v.colors=$("#resourceEditColor").text(),o.edit_in_color_glag?v.interior=o.editresData.edit_in_color:v.interior=o.edit_in_color,o.dataTypeFlag?v.car_type=o.editcartype:"期车"==o.editresData.edit_car_type?v.car_type="2":v.car_type="1",o.dataCreateFlag?0==o.editManufacture?v.manufacture_time="一年以内":1==o.editManufacture?v.manufacture_time="半年内":2==o.editManufacture?v.manufacture_time="三个月内":v.manufacture_time="一年以上":0==o.editresData.edit_create_data?v.manufacture_time="一年以内":1==o.editresData.edit_create_data?v.manufacture_time="半年内":2==o.editresData.edit_create_data?v.manufacture_time="三个月内":v.manufacture_time="一年以上",o.edit_file_flag?v.attachment=o.editresData.edit_file:v.attachment=o.attachment,o.edit_model_ok_flag)v.end_time=Date.parse(new Date(o.editresData.edit_model));else{var e=angular.element("#edit_expiration_date").val().toString().replace(/-/g,"/");v.end_time=Date.parse(new Date(e))}var t=o.editresData.model_price;o.edit_show_price_flag?v.sale_price=1e4*parseFloat(o.editresData.edit_current_price):"money"==o.editFavourableMode?(""!=o.editfavourablemoney&&null!=o.editfavourablemoney||(o.editfavourablemoney=0),o.edit_has_add_money?v.sale_price=t-parseFloat(1e4*o.editfavourablemoney):v.sale_price=t+parseFloat(1e4*o.editfavourablemoney)):"point"==o.editFavourableMode?(""!=o.editfavourablepoint&&null!=o.editfavourablepoint||(o.editfavourablepoint=0),o.edit_has_add_point?v.sale_price=t-t*parseFloat(o.editfavourablepoint)/100:v.sale_price=t+t*parseFloat(o.editfavourablepoint)/100):"price"==o.editFavourableMode?v.sale_price=1e4*o.edit_sale_price:o.editJiFlag=!1,v.model_price=o.editresData.model_price,v.resource_extra=o.editresData.edit_extra,o.edit_show_price_flag1?v.front_price=parseInt(o.editresData.edit_current_price1):v.front_price=o.front_price,o.edit_area_flag?v.area_list=f:v.area_list=o.editAreaJoin,o.edit_area_flag1?v.source_area=h:v.source_area=o.editAreaJoin1;var a={req_data:{method:"POST",url:BASEURL+"/res_v1_0_0/cms/special/res/update?out=json",params:v,headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:b,requestError:u.errorData};n.getData(a),$("#modalEdit").modal("hide")};var S=!0;o.submitData=function(){if(S){console.log(111);var e={req_data:{method:"POST",url:BASEURL+"/res_v1_0_0/cms/special/res/insert?out=json",params:o.editresData,headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:D,requestError:u.errorData};n.getData(e),S=!1,$("#modalEdit").modal("hide")}else{console.log(22);var t={req_data:{method:"POST",url:BASEURL+"/res_v1_0_0/cms/special/res/insert?out=json",params:v,headers:{"Content-Type":"application/json;charset=UTF-8"},timeout:1e4},requestSuccess:D,requestError:u.errorData};n.getData(t),S=!0,$("#modalEdit").modal("hide")}},o.specialDelete=function(e,t){e.stopPropagation(),u.deleteResource(t)},o.jumpDetail=function(e,t){e.stopPropagation(),a.go("home.specialResourcesDetail",{rid:t})},o.changePageUrl=function(e){u.specialRseourceData.page_index=o.getPageIndex(e,o.pageNumber,o.pageCount),a.go("home.specialResourcesLists",u.specialRseourceData)}}]),app.controller("storeSortCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state",function(i,t,e,a,r,n){var s=layer.load(1);i.sortLit=[],i.name="",i.id="";var o={sortListUrl:"/cms2/assortment/datas?device=1",editSortUrl:"/cms2/assortment/edit",deleteSortUrl:"/cms2/assortment/delete",addSortUrl:"/cms2/assortment/add",moveUpUrl:"/cms2/assortment/up",moveDownUrl:"/cms2/assortment/down",init:function(){this.getSortList()},getSortList:function(){t.getData("GET",this.sortListUrl,"",this.setSortList,this.errorData)},setSortList:function(e){layer.close(s),1==e.status&&(i.sortLit=e.datas)},addSort:function(){t.getData("POST",this.addSortUrl,{name:i.name,device:1},this.addSortSuccess,this.errorData)},addSortSuccess:function(e){layer.close(s),1==e.status&&($("#addSort").modal("hide"),i.name="",o.getSortList(),layer.msg("新增成功",{icon:1,time:1500}))},editSort:function(e){t.getData("POST",this.editSortUrl,{id:e,name:i.name,device:1},this.editSortSuccess,this.errorData)},editSortSuccess:function(e){layer.close(s),1==e.status&&($("#editSort").modal("hide"),i.name="",i.id="",o.getSortList(),layer.msg(e.msg,{icon:1,time:1500}))},delteSort:function(e){t.getData("POST",this.deleteSortUrl,{id:e,device:1},this.deleteSortSuccess,this.errorData)},deleteSortSuccess:function(e){1==e.status&&(layer.msg(e.msg,{icon:1,time:1500}),o.getSortList())},moveUP:function(e){t.getData("POST",this.moveUpUrl,{id:e,device:1},this.moveSuccess,this.errorData)},moveDown:function(e){t.getData("POST",this.moveDownUrl,{id:e,device:1},this.moveSuccess,this.errorData)},moveSuccess:function(e){layer.close(s),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),o.getSortList()):layer.msg(e.msg,{icon:0,time:1500})},errorData:function(){layer.close(s),layer.msg("请求失败",{icon:5})}};o.init(),i.addSort=function(){""==i.name?layer.msg("请输入分类名称"):o.addSort()},i.editSortBtn=function(e){$("#editSort").modal("show");var t=$(e.currentTarget).attr("data-id"),a=$(e.currentTarget).attr("data-name");i.name=a,i.id=t},i.editSort=function(){""==i.name?layer.msg("请输入分类名称"):o.editSort(i.id)},i.deleteSort=function(e){layer.confirm("确定删除该条分类？",{btn:["确定","取消"],title:"提示",skin:"layui-layer-molv",icon:0,anim:3},function(){o.delteSort(e)},function(e){layer.close(e)})},i.moveUp=function(e){console.log(e),o.moveUP(e)},i.moveDown=function(e){o.moveDown(e)}}]),app.controller("storeTemplateCtrl",["$scope","httpData","$window","$timeout","$stateParams","$state",function(a,i,e,t,r,n){var s=layer.load(1);a.templateLit=[],a.sortLit=[],a.ids=[],a.idsSrting="",a.assortment_id=r.assortment_id,a.is_up=r.is_up,Array.prototype.remove=function(e){var t=this.indexOf(e);-1<t&&this.splice(t,1)};var o={sortListUrl:"/cms2/assortment/datas?device=1",templateListUrl:"/cms2/template/datas?device=1",putawayUrl:"/cms2/template/edit/up",soldOutUrl:"/cms2/template/edit/up",deleteUrl:"/cms2/template/delete",topUrl:"/cms2/template/top",send_data:{page_index:1,page_size:12,is_up:r.is_up,assortment_id:r.assortment_id},init:function(){this.getTemplateList(),this.getSortList()},is_Array:function(e){return"[object Array]"==Object.prototype.toString.call(e)},selectData:function(){this.send_data.assortment_id=a.assortment_id,this.send_data.is_up=a.is_up,n.go("home.storeTemplate",this.send_data)},getSortList:function(){i.getData("GET",this.sortListUrl,"",this.setSortList,this.errorData)},setSortList:function(e){layer.close(s),1==e.status&&(a.sortLit=e.datas)},getTemplateList:function(){null==r.page_index?this.send_data.page_index=1:this.send_data.page_index=r.page_index,i.getData("GET",this.templateListUrl,this.send_data,this.setTemplateList,this.errorData)},setTemplateList:function(e){layer.close(s),1==e.status&&(a.templateLit=e.list,a.pageNumber=e.page.pageNumber,a.pageCount=e.page.pageCount,a.recordCount=e.page.recordCount,a.pageSize=e.page.pageSize,a.pageList=a.pageNum(a.pageCount,a.pageNumber),a.startData=0==a.recordCount?0:(a.pageNumber-1)*a.pageSize+1,a.endData=e.list.length<a.pageSize?(a.pageNumber-1)*a.pageSize+e.list.length:a.pageNumber*a.pageSize)},templatePutaway:function(e){i.getData("POST",this.putawayUrl,{ids:e,state:1,device:1},this.success,this.errorData)},templateSoldOut:function(e){i.getData("POST",this.soldOutUrl,{ids:e,state:0,device:1},this.success,this.errorData)},templateDelete:function(e){i.getData("POST",this.deleteUrl,{ids:e,device:1},this.success,this.errorData)},setTOp:function(e,t){i.getData("POST",this.topUrl,{id:e,top:t,device:1},this.success,this.errorData)},success:function(e){layer.close(s),1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),a.idsSrting="",a.ids=[],o.getTemplateList()):(layer.close(s),layer.msg(e.msg,{icon:0,time:1500}))},errorData:function(){layer.close(s),layer.msg("请求失败",{icon:5})}};o.init(),a.selectTempalteSort=function(){o.selectData()},a.selectTemplate=function(e,t){1==e.currentTarget.checked?a.ids.push(t):a.ids.remove(t),0<a.ids.length&&(a.idsSrting=a.ids.join(","))},a.setTOp=function(e,t){o.setTOp(e,t)},a.templatePutaway=function(e){o.templatePutaway(e)},a.templateSoldOut=function(e){o.templateSoldOut(e)},a.templateDelete=function(t){layer.confirm("确定删除选中模板？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){o.templateDelete(t)},function(e){})},a.changePageUrl=function(e){o.send_data.page_index=a.getPageIndex(e,a.pageNumber,a.pageCount),n.go("home.storeTemplate",o.send_data)}}]),app.controller("supplierCtrl",["$scope","$http","$stateParams","$state","$timeout",function(a,i,r,t,e){var n=!1;a.provinceId=r.province_id,a.cityId=r.city_id,a.supplier_name=r.supplier_name,null!=r.supplier_name&&$("#supplier_name").focus();var s={pageindex:1,province_id:"",city_id:"",supplier_name:""};a.getSupplierList=function(e){var t=layer.msg("加载中...",{icon:16,time:0});null==r.pageindex?e.pageindex=1:e.pageindex=r.pageindex,e.province_id=r.province_id,e.city_id=r.city_id,e.supplier_name=r.supplier_name,i({method:"GET",url:BASEURL+"/cms2/supplier/datas?pagesize=10&device=1",timeout:1e4,params:e}).success(function(e){layer.close(t),1==e.status?(a.supplierData=e.list,a.pageNumber=e.page.pageNumber,a.recordCount=e.page.recordCount,a.pageCount=e.page.pageCount,a.pageSize=e.page.pageSize,a.pageList=a.pageNum(a.pageCount,a.pageNumber),a.startData=0==a.recordCount?0:(a.pageNumber-1)*a.pageSize+1,a.endData=e.list.length<a.pageSize?(a.pageNumber-1)*a.pageSize+e.list.length:a.pageNumber*a.pageSize):layer.msg("请求失败",{icon:5})}).error(function(e){layer.msg("请求超时！",{icon:5})})},a.getSupplierList(s),i({method:"GET",url:BASEURL+"/api2/area/provinces?device=1",timeout:1e4}).success(function(e){1==e.status?a.provinceList=e.list:layer.msg("请求失败",{icon:5})}).error(function(e){}),a.getCity=function(e){a.cityLists="",a.cityId="",i({method:"GET",url:BASEURL+"/api2/area/cities?province="+e+"&device=1",timeout:1e4}).success(function(e){1==e.status?a.cityLists=e.list:layer.msg("请求失败",{icon:5})}).error(function(){})},null!=r.province_id?(a.getCity(r.province_id),a.cityId=r.city_id):(a.cityLists="",a.cityId=""),a.selectProvince=function(){a.cityLists="",a.cityId="",a.supplier_name="",s.pageindex=1,s.province_id=a.provinceId,s.city_id=a.cityId,s.supplier_name=a.supplier_name,t.go("home.supplier",s)},a.selectCity=function(){s.pageindex=1,s.province_id=a.provinceId,s.city_id=a.cityId,s.supplier_name=a.supplier_name,t.go("home.supplier",s)},a.$watch("supplier_name",function(){n&&e(function(){t.go("home.supplier",{pageindex:1,province_id:a.provinceId,city_id:a.cityId,supplier_name:a.supplier_name})},1e3),n=!0}),a.changePageUrl=function(e){s.pageindex=a.getPageIndex(e,a.pageNumber,a.pageCount),t.go("home.supplier",s)},a.ids=[],Array.prototype.remove=function(e){var t=this.indexOf(e);-1<t&&this.splice(t,1)},a.selectTemplate=function(e,t){e.stopPropagation(),console.log(t),1==e.currentTarget.checked?a.ids.push(t):a.ids.remove(t),0<a.ids.length&&(a.idsSrting=a.ids.join(","))},a.deleteResource=function(e){layer.confirm("确定删除选中4s店发布的资源？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0,anim:4},function(e){i({method:"POST",url:BASEURL+"/cms2/supplier/delete/res?device=1&supplier_id="+a.idsSrting,timeout:1e3}).success(function(e){1==e.status?layer.msg(e.msg,{icon:1,time:1500}):layer.msg(e.msg,{icon:0,time:1500})}).error(function(){layer.msg("请求失败",{icon:5,time:1500})})},function(e){layer.close(e)})}}]),app.controller("supplierDetailCtrl",["$scope","$http","$stateParams","$timeout",function(a,i,r,t){var n="";a.getSupplierDetail=function(){var t=layer.msg("加载中...",{icon:16,time:0});i({method:"GET",url:BASEURL+"/cms2/insurace/getByOrderSeq",timeout:1e4}).success(function(e){layer.close(t),1==e.status?a.supplierDetail=e.data:layer.msg("请求失败",{icon:5})}).error(function(){})},a.getSupplierDetail(),a.supplierDelete=function(){layer.confirm("确认删除该商家？",{btn:["确定","取消"],title:"提示",icon:0,skin:"layui-layer-molv",anim:4},function(e){layer.close(e),i({method:"POST",url:BASEURL+"/cms2/supplier/delete/"+r.sid+"?device=1",timeout:1e4}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),t(function(){a.jump("/home/cms/supplier")},2e3)):layer.msg(e.msg,{icon:5,time:1500})}).error(function(e){})},function(e){layer.close(e)})},a.update=!1,a.manuList="",a.supplierUpdate=function(){$("#manuInfo-model").modal("show"),i({url:BASEURL+"/cms2/supplier/manu?device=1",method:"GET",timeout:1e4}).success(function(e){1==e.status?a.manuList=e.list:layer.msg("请求失败",{icon:5})}).error(function(e){})},a.manuInfo=function(e){i({method:"GET",url:BASEURL+"/cms2/supplier/manufactor/data?device=1&supplier_id="+(n=e)}).success(function(e){1==e.status?a.manuInfoData=e.datas:layer.msg("请求失败",{icon:5})}).error(function(e){})},a.deletemanuInfo=function(t){layer.confirm("确定将此厂商删除？",{title:"提示",icon:0,skin:"layui-layer-molv",btn:["确定","取消"],shadeClose:!0},function(e){layer.close(e),i({method:"POST",url:BASEURL+"/cms2/supplier/manufactor/delete?device=1",params:{manufactor_id:t,supplier_id:r.sid}}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),a.manuInfo(n)):layer.msg(e.msg,{icon:5,time:1500})}).error(function(e){})})},a.addmanuInfo=function(){i({method:"POST",url:BASEURL+"/cms2/supplier/manufactor/add?device=1",params:{manufactor_id:a.manufactor_id,supplier_id:r.sid}}).success(function(e){1==e.status?(layer.msg("新增成功",{icon:1,time:1e3}),t(function(){$("#manuInfo-model").modal("hide"),a.manuInfo(n)},1500)):layer.msg("新增失败",{icon:5,time:1e3})})}}]),app.controller("unitCtrl",["$scope","$http","$timeout","$state","$stateParams",function(r,s,e,t,i){null==i.unit_id&&(i.unit_id=sessionStorage.unit_id),null==i.co_name&&(i.co_name=sessionStorage.company_name),r.unit_id=i.unit_id,r.co_name=i.co_name,r.addRoleBtn=!0,r.addUserBtn=!0;var o=r.role_name="",a="",c="",n="",l="",d="",u={$unit:null,$role:null,init:function(){this.$unit=$("#unit_list"),this.$role=$("#role_list"),this.$updateUnit=$("#updateUnit"),this.getUnitList(i.unit_id),this.$unit.on("click","tr>td span:first-child",this.showHideSubUnit),this.$unit.on("click",".editUnit",function(e){e.stopPropagation(),$("#editUnit").modal("show");var t=$(this).parents("tr[data-parent-id]");c=t.attr("data-unit-id"),a=t.attr("data-parent-id"),l=t.children().find("span:last-child").text(),$('input[name="unit_name"]').val(l)}),this.$unit.on("click",".deleteUnit",function(e){e.stopPropagation();var t=$(this).parents("tr[data-parent-id]");c=t.attr("data-unit-id"),layer.confirm("确定删除该组织？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0},function(e){layer.close(e),s({method:"POST",url:BASEURL+"/cms2/unit/delete?device=1&unit_id="+c}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),u.getUnitList(i.unit_id),r.role_list=""):layer.msg(e.msg,{icon:5,time:1e3})})})}),this.$unit.on("click",".checkUnitPower",function(e){e.stopPropagation(),$("#unit_power_list").modal("show");var t=$(this).parents("tr[data-parent-id]");c=t.attr("data-unit-id"),a=t.attr("data-parent-id"),u.getPowerList("unit",c)}),this.$unit.on("click","tr:not(.none)",function(){c=$(this).attr("data-unit-id"),$(this).addClass("choose").siblings(".choose").removeClass("choose"),u.getRoleList(c)}),this.$unit.on("click",".bindUnitPower",this.getAllPower),this.$role.on("click",".editRole",this.editRole),this.$role.on("click",".deleteRole",this.deleteRole),this.$role.on("click",".checkRolePower",function(e){e.stopPropagation(),$("#role_power_list").modal("show");var t=$(this).parents("tr[data-parent-id]");n=t.attr("data-role-id"),t.attr("data-parent-id"),u.getPowerList("role",n)}),this.$role.on("click",".bindRolePower",function(e){e.stopPropagation();var t=$(this).parents("tr[data-parent-id]");n=t.attr("data-role-id"),$("#add_role_power").modal("show"),u.getPowerList("unit",c)}),this.$role.on("click","tr:not(.none)",function(){n=$(this).attr("data-role-id"),$(this).addClass("choose").siblings(".choose").removeClass("choose"),u.getUserList(n)})},getUnitList:function(e){var a="";s({method:"GET",url:BASEURL+"/cms2/unit/datas?device=1&page_index=1&page_size=100&parent_id="+e}).success(function(e){1==e.status&&(a='<tr data-unit-id="'+i.unit_id+'"><td><span class="sub-unfold"></span><span>'+i.co_name+"</span></td><td></td><td></td></tr>",0==e.list.length?$("#unit_list").html(a):$.each(e.list,function(e,t){o=1==t.has_children?"icon-caret-right":"",a+='<tr data-parent-id="'+t.parent_id+'"data-unit-id="'+t.unit_id+'" data-children="'+t.has_children+'"><td class="menu-0"><span class="sub-unfold '+o+'"></span><span>'+t.name+"</span></td><td>"+t.last_time+'</td><td><a  class="checkUnitPower" title="查看权限"><i class="icon-cogs"></i></a><a  class="bindUnitPower" title="绑定权限"><i class="icon-plus"></i></a><a  class="edit editUnit" title="编辑"><i class="icon-edit"></i></a><a  class="delete deleteUnit" title="删除"><i class="icon-trash"></i></a></td></tr>'}),$("#unit_list").html(a))})},getSubUnitList:function(t,i,r,e){var n="";s({method:"GET",url:BASEURL+"/cms2/unit/datas?device=1&parent_id="+e}).success(function(a){if(1==a.status){i.removeClass("icon-caret-right").addClass("icon-caret-down"),$.each(a.list,function(e,t){o=1==a.list[e].has_children?"icon-caret-right":"",n+='<tr data-parent-id="'+t.parent_id+'" data-unit-id="'+t.unit_id+'" data-children="'+t.has_children+'"><td class="menu-'+r+'"><span class="sub-unfold '+o+'"></span><span>'+t.name+"</span></td><td>"+t.last_time+'</td><td><a  class="checkUnitPower" title="查看权限"><i class="icon-cogs"></i></a><a  class="bindUnitPower" title="绑定权限"><i class="icon-plus"></i></a><a  class="edit editUnit" title="编辑"><i class="icon-edit"></i></a><a  class="delete deleteUnit" title="删除"><i class="icon-trash"></i></a></td></tr>'}),t.after(n);var e=30*r+"px";$("#unit_list .menu-"+r).css({"padding-left":e})}})},showHideSubUnit:function(e){e.stopPropagation();var t=$(this),a=t.parent().parent(),i=a.attr("data-children");c=a.attr("data-unit-id");var r=t.parent().attr("class"),n=r.lastIndexOf("-"),s=parseInt(r.slice(n+1))+1;1==i&&(t.hasClass("icon-caret-right")?u.getSubUnitList(a,t,s,c):t.hasClass("icon-caret-down")&&(t.removeClass("icon-caret-down").addClass("icon-caret-right"),$('#unit_list>tr[data-parent-id="'+c+'"]').each(function(){var e=$(this).attr("data-unit-id");$('#unit_list>tr[data-parent-id="'+e+'"]').each(function(){var e=$(this).attr("data-unit-id");$('#unit_list>tr[data-parent-id="'+e+'"]').each(function(){$(this).attr("data-unit-id");$(this).remove()}),$(this).remove()}),$(this).remove()})))},getPowerList:function(t,e){s({method:"GET",url:BASEURL+"/cms2/"+t+"/power?device=1&"+t+"_id="+e}).success(function(e){1==e.status&&(r.data_list=e.list,str=t)})},getRoleList:function(e){var i="";s({method:"GET",url:BASEURL+"/cms2/unit/role?device=1&unit_id="+e}).success(function(a){1==a.status&&(r.addRoleBtn=!1,0==a.list.length?$("#role_list").html('<tr class="none"><td colspan="3">该组织下暂无角色...</td></tr>'):($.each(a.list,function(e,t){o=1==a.list[e].has_children?"icon-caret-right":"",i+='<tr data-parent-id="'+t.parent_id+'" data-role-id="'+t.role_id+'"><td class="menu-0"><span class="sub-unfold '+o+'"></span><span>'+t.name+"</span></td><td>"+t.last_time+'</td><td><a  class="checkRolePower" title="查看权限"><i class="icon-cogs"></i></a><a  class="bindRolePower" title="绑定权限"><i class="icon-plus"></i></a><a  class="edit editRole" title="编辑"><i class="icon-edit"></i></a><a  class="delete deleteRole" title="删除"><i class="icon-trash"></i></a></td></tr>'}),$("#role_list").html(i)))})},getAllPower:function(e){e.stopPropagation();var t=$(this).parents("tr[data-parent-id]");c=t.attr("data-unit-id"),a=t.attr("data-parent-id"),$("#add_unit_power").modal("show"),s({method:"GET",url:BASEURL+"/cms2/power/datas?device=1"}).success(function(e){r.allPower=e.list})},editRole:function(e){e.stopPropagation(),$("#editRole").modal("show");var t=$(this).parents("tr[data-parent-id]");n=t.attr("data-role-id"),t.attr("data-parent-id"),d=t.children().find("span:last-child").text(),$('input[name="role_name"]').val(d)},deleteRole:function(e){var t=$(this).parents("tr[data-parent-id]");n=t.attr("data-role-id"),e.stopPropagation(),layer.confirm("确定删除该角色？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0},function(e){layer.close(e),s({method:"POST",url:BASEURL+"/cms2/role/delete?device=1&role_id="+n}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),u.getRoleList(c)):layer.msg(e.msg,{icon:5,time:1e3})})})},getUserList:function(e){s({method:"GET",url:BASEURL+"/cms2/role/users?device=1&role_id="+e}).success(function(e){1==e.status&&(r.user_list=e.list,r.addUserBtn=!1)})}};u.init(),r.updateUnit=function(){s({method:"POST",url:BASEURL+"/cms2/unit/edit?device=1",params:{id:c,parent_id:a,name:$('input[name="unit_name"]').val()}}).success(function(e){1==e.status?($("#editUnit").modal("hide"),layer.msg(e.msg,{icon:1,time:1e3}),u.getUnitList(i.uid)):layer.msg(e.msg,{icon:5,time:1e3})})},$("#unit_power_list").on("click",".checkAll",function(){1==$(this).is(":checked")?$("#unit_power_list input[class=checkSingle]").each(function(){$(this).prop("checked",!0)}):$("#unit_power_list input[class=checkSingle]").each(function(){$(this).prop("checked",!1)})}),$("#unit_power_list").on("click",".checkSingle",function(){var e=$("#unit_power_list input[class='checkSingle']").size();$(this).is(":checked"),$("#unit_power_list .checkSingle:checked").length==e?$("#unit_power_list .checkAll").prop("checked",!0):$("#unit_power_list .checkAll").prop("checked",!1)}),r.deleteUnitPower=function(){var e=[];$('#unit_power_list input[class="checkSingle"]:checked').each(function(){e.push($(this).val())}),r.delete_power_ids=e.join(","),layer.confirm("确定删除选中权限？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0},function(e){layer.close(e),r.delete_power_request("unit",c,r.delete_power_ids)})},$("#add_unit_power").on("click",".checkAll",function(){1==$(this).is(":checked")?$("#add_unit_power input[class=checkSingle]").each(function(){$(this).prop("checked",!0)}):$("#add_unit_power input[class=checkSingle]").each(function(){$(this).prop("checked",!1)})}),$("#add_unit_power").on("click",".checkSingle",function(){var e=$("#add_unit_power input[class='checkSingle']").size();$(this).is(":checked"),$("#add_unit_power .checkSingle:checked").length==e?$("#add_unit_power .checkAll").prop("checked",!0):$("#add_unit_power .checkAll").prop("checked",!1)}),r.addUnitPower=function(){var e=[];$('#add_unit_power input[class="checkSingle"]:checked').each(function(){e.push($(this).val())}),r.power_ids=e.join(","),r.add_power_request("unit",c,r.power_ids)},r.createRole=function(){""==n&&(n=0),s({method:"POST",url:BASEURL+"/cms2/role/add?device=1",params:{name:r.role_name,parent_id:n,unit_id:c}}).success(function(e){1==e.status&&(layer.msg(e.msg,{icon:1,time:1e3}),$("#addRoleModal").modal("hide"),r.role_name="",u.getRoleList(c))})},r.updateRole=function(){s({method:"POST",url:BASEURL+"/cms2/role/edit?device=1",params:{role_id:n,name:$('input[name="role_name"]').val()}}).success(function(e){1==e.status?($("#editRole").modal("hide"),layer.msg(e.msg,{icon:1,time:1e3}),u.getRoleList(c)):layer.msg(e.msg,{icon:5,time:1e3})})},$("#role_power_list").on("click",".checkAll",function(){1==$(this).is(":checked")?$("#role_power_list input[class=checkSingle]").each(function(){$(this).prop("checked",!0)}):$("#role_power_list input[class=checkSingle]").each(function(){$(this).prop("checked",!1)})}),$("#role_power_list").on("click",".checkSingle",function(){var e=$("#role_power_list input[class='checkSingle']").size();$(this).is(":checked"),$("#role_power_list .checkSingle:checked").length==e?$("#role_power_list .checkAll").prop("checked",!0):$("#role_power_list .checkAll").prop("checked",!1)}),r.deleteRolePower=function(){var e=[];$('#role_power_list input[class="checkSingle"]:checked').each(function(){e.push($(this).val())}),r.delete_power_ids=e.join(","),layer.confirm("确定删除选中权限？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0},function(e){layer.close(e),s({method:"POST",url:BASEURL+"/cms2/role/power/disable?device=1&power_ids="+r.delete_power_ids+"&role_id="+n}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),$("#role_power_list").modal("hide")):layer.msg(e.msg,{icon:0,time:1e3})})})},$("#add_role_power").on("click",".checkAll",function(){1==$(this).is(":checked")?$("#add_role_power input[class=checkSingle]").each(function(){$(this).prop("checked",!0)}):$("#add_role_power input[class=checkSingle]").each(function(){$(this).prop("checked",!1)})}),$("#add_role_power").on("click",".checkSingle",function(){var e=$("#add_unit_power input[class='checkSingle']").size();$(this).is(":checked"),$("#add_role_power .checkSingle:checked").length==e?$("#add_role_power .checkAll").prop("checked",!0):$("#add_role_power .checkAll").prop("checked",!1)}),r.addRolePower=function(){var e=[];$('#add_role_power input[class="checkSingle"]:checked').each(function(){e.push($(this).val())}),r.add_power_ids=e.join(","),r.add_power_request("role",n,r.add_power_ids)},r.deleteUser=function(t){layer.confirm("确定删除该用户？",{title:"提示",skin:"layui-layer-molv",btn:["确定","取消"],icon:0},function(e){layer.close(e),s({method:"POST",url:BASEURL+"/cms2/role/user/unbind?device=1&user_ids="+t+"&role_id="+n}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),u.getUserList(n)):layer.msg(e.msg,{icon:0,time:1e3})})})},r.bindUser=function(){""!=r.account&&s({method:"POST",url:BASEURL+"/cms2/company/bind?device=1&mobile="+r.account+"&role_id="+n}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),u.getUserList(n)):layer.msg(e.msg,{icon:0,time:1e3})})},r.add_power_request=function(t,e,a){s({method:"POST",url:BASEURL+"/cms2/"+t+"/power/allot?device=1&"+t+"_id="+e+"&power_ids="+a}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),$("#add_"+t+"_power").modal("hide")):layer.msg(e.msg,{icon:0,time:1e3})})},r.delete_power_request=function(t,e,a){s({method:"POST",url:BASEURL+"/cms2/"+t+"/power/unbind?device=1&"+t+"_id="+e+"&power_ids="+a}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1e3}),$("#"+t+"_power_list").modal("hide")):layer.msg(e.msg,{icon:0,time:1e3})})}}]),app.controller("userCtrl",["$scope","$http","$stateParams","$timeout","$state","httpData",function(o,e,c,t,a,i){o.userInfoStatus=[{key:0,val:"未认证"},{key:1,val:"待审核"},{key:2,val:"已认证"},{key:3,val:"未通过"}];var r=layer.load(1);o.userData=[];var n={user_url:"/cms2/user/datas?device=1",listsSendData:{pageIndex:1,pageSize:10,statePerson:"",stateCompany:"",stateManager:"",staff_state:"",account:"",co_name:""},init:function(){this.getDataFromUrl(),this.getUserList()},errorData:function(){layer.close(r),o.has_clicked=!1,layer.msg("请求失败",{icon:5})},getUserList:function(){i.getData("GET",this.user_url,this.listsSendData,this.setUserList,this.errorData)},setUserList:function(e){layer.close(r),1==e.status&&(1==e.status?(o.userData=e.list,o.pageNumber=e.page.pageNumber,o.recordCount=e.page.recordCount,o.pageCount=e.page.pageCount,o.pageSize=e.page.pageSize,o.pageList=o.pageNum(o.pageCount,o.pageNumber),o.startData=0==o.recordCount?0:(o.pageNumber-1)*o.pageSize+1,o.endData=e.list.length<o.pageSize?(o.pageNumber-1)*o.pageSize+e.list.length:o.pageNumber*o.pageSize):layer.msg("请求失败",{icon:5}))},getLocalTime:function(e){return new Date(parseInt(e)).toLocaleString().split(" ")[0]},getDataFromUrl:function(){var e=c.pageIndex,t=c.statePerson,a=c.stateCompany,i=c.stateManager,r=c.staff_state,n=c.account,s=c.co_name;e||(e=1),o.statePerson=t,o.stateCompany=a,o.stateManager=i,o.staff_state=r,o.account=n,o.co_name=s,this.listsSendData={pageIndex:e,pageSize:10,statePerson:t,stateCompany:a,stateManager:i,staff_state:r,account:n,co_name:s}},selectData:function(){this.listsSendData.pageIndex=1,this.listsSendData.statePerson=o.statePerson,this.listsSendData.stateCompany=o.stateCompany,this.listsSendData.stateManager=o.stateManager,this.listsSendData.staff_state=o.staff_state,this.listsSendData.account=o.account,this.listsSendData.co_name=o.co_name,a.go("home.user",this.listsSendData)}};n.init(),o.selectUserChange=function(){n.selectData()};var s=!1,l=!1;o.user_search=function(){n.selectData()},o.$watch("account",function(){s&&""==o.account&&n.selectData(),s=!0}),o.$watch("co_name",function(){l&&""==o.co_name&&n.selectData(),l=!0}),o.changePageUrl=function(e){n.listsSendData.pageIndex=o.getPageIndex(e,o.pageNumber,o.pageCount),a.go("home.user",n.listsSendData)},o.mobile="",o.addUser=function(){e({method:"POST",url:BASEURL+"/cms2/user/register?device=1&mobile="+o.mobile}).success(function(e){1==e.status&&(layer.msg("添加成功",{icon:1,time:1e3}),$("#addUser").modal("hide"),o.mobile="",n.getUserList())})},o.checkUser=function(e,t){e.stopPropagation(),o.jump("/home/cms/checkUser/"+t)}}]),app.controller("userDetailCtrl",["$scope","$http","$stateParams","$window","httpData",function(l,i,r,e,t){var n=layer.load(1);({detail_url:"/cms2/user/detail?device=1",edit_url:"",errorData:function(){layer.close(n),layer.msg("请求失败",{icon:5,time:1500})},getUserDetail:function(){t.getData("GET",this.detail_url,{id:r.uid},this.setDetail,this.errorData)},setDetail:function(e){if(layer.close(n),console.log(e),1==e.status){if(l.userDetail=e.data,l.contract_image=[],e.data.userInfo.contract_image)for(var t=e.data.userInfo.contract_image.split(","),a=0;a<t.length;a++)t[a]&&l.contract_image.push(t[a]);if(l.cert_letter=[],e.data.userInfo.co_apply_letter){var i=e.data.userInfo.co_apply_letter.split(",");for(a=0;a<i.length;a++)i[a]&&l.cert_letter.push(i[a])}}else layer.msg(e.msg,{icon:5})},init:function(){this.getUserDetail()}}).init(),l.personAuth=!1,l.authentication=!1,l.getUserDetail=function(){var c=layer.msg("加载中...",{icon:16,time:0});i({method:"GET",url:BASEURL+"/cms2/user/detail",timeout:1e4,params:{id:r.uid,device:1}}).success(function(e){if(layer.close(c),1==e.status){l.userDetail=e.data;var t=e.data.cert_person_state,a=e.data.cert_company_state,i=e.data.cert_company_manager_state,r=e.data.cert_staff_state;if(l.contract_image=[],e.data.userInfo.contract_image)for(var n=e.data.userInfo.contract_image.split(","),s=0;s<n.length;s++)n[s]&&l.contract_image.push(n[s]);if(l.cert_letter=[],e.data.userInfo.co_apply_letter){var o=e.data.userInfo.co_apply_letter.split(",");for(s=0;s<o.length;s++)o[s]&&l.cert_letter.push(o[s])}l.authentication=1==t||2==t&&1==a||2==t&&2==a&&1==i,0==t&&(l.personAuth=!0),1==r&&(l.toexamine=!0)}else layer.msg("请求失败",{icon:5})}).error(function(e){})},l.getUserDetail(),l.auth=function(){l.jump("/home/cms/authentication/"+r.uid)},l.deleteRoleGroup=function(){layer.confirm("确定将用户从该角色组删除？",{title:"提示",icon:0,skin:"layui-layer-molv",btn:["确定","取消"],shadeClose:!0},function(e){layer.close(e),i({method:"POST",url:BASEURL+"",params:{device:1},timeout:1e4}).success(function(e){1==e.status?(layer.msg(e.msg,{icon:1,time:1500}),$timeout(function(){l.getUserDetail()},2e3)):layer.msg(e.msg,{icon:5,time:1500})}).error(function(e){})})},l.adopt=!1,l.notadopt=!1,l.toexaMine=function(){l.adopt=!0,l.notadopt=!0,l.toexamine=!1},$("#idcard_validity").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",todayHighlight:1,clearBtn:!0,startDate:new Date}),l.pass=function(e){var t=l.idcard_validity,a=Date.parse(new Date(t));i({method:"POST",url:BASEURL+"/cms2/user/cert/staff",timeout:1e4,params:{state:e,user_id:r.uid,driver_apply_time:l.driver,id_card_time:a,device:1}}).success(function(e){1==e.status&&layer.msg(e.msg,{icon:1,time:1500}),$("#adopt").modal("hide"),l.adopt=!1,l.notadopt=!1}).error(function(e){})},l.refuse=function(e){i({method:"POST",url:BASEURL+"/cms2/user/cert/staff",timeout:1e4,params:{state:e,user_id:r.uid,message:l.remark,device:1}}).success(function(e){1==e.status&&layer.msg(e.msg,{icon:1,time:1500}),$("#notadopt").modal("hide"),l.adopt=!1,l.notadopt=!1}).error(function(e){})},l.calloff=function(){l.driver="",l.remark=""}}]),app.controller("userNumCtrl",["$scope","$http","$stateParams","$state",function(a,i,r,t){a.start_time="",a.end_time="",a.user_num="",a.start_time=r.start_time,a.end_time=r.end_time;a.getUserNum=function(e){var t=layer.msg("加载中...",{icon:16,time:0});e.start_time=r.start_time,e.end_time=r.end_time,i({method:"GET",url:BASEURL+"/cms2/count/proportion?device=1",params:e}).success(function(e){layer.close(t),1==e.status&&(a.user_num=e.list,""!=e.list[0].proportion&&null!=e.list[0].proportion?a.proportion=e.list[0].proportion+"%":a.proportion="")})},a.getUserNum({start_time:"",end_time:""}),a.selectUserNum=function(){var e={};null!=a.start_time&&null!=a.end_time?(e.start_time=a.start_time,e.end_time=a.end_time,t.go("home.userNum",e)):""!=a.start_time&&""!=a.end_time||(a.start="",a.end_time="",e.start_time="",e.end_time="",t.go("home.userNum",e))}}]),app.controller("withdrawDepositCtrl",["$http","$scope","requestData","$timeout","$stateParams","$state",function(a,i,e,t,r,n){i.withdrawDepositList="";var s={pagesize:10,device:1};function o(e){1==e.status?(layer.msg("上传成功",{icon:1,time:1500}),i.picture=e.data[0].normal,angular.element("#adv-img").attr("src",imgUrl+i.picture)):layer.msg("上传失败",{icon:5,time:1500})}function c(e){var t=e[0].value.type;if("image/png"!=t&&"image/jpeg"!=t&&"image/gif"!=t)return layer.msg("图片格式不对，请上传正确格式的图片！"),!1;layer.msg("图片上传中...",{icon:16,time:0})}i.getwithdrawDepositList=function(e){null==r.page_index?e.pageindex=1:e.pageindex=r.page_index;var t=layer.msg("加载中...",{icon:16,time:0});a({method:"GET",url:BASEURL+"/cms2/company/withdraw/money/datas",params:e}).success(function(e){layer.close(t),1==e.status?(i.withdrawDepositList=e.list,i.pageNumber=e.page.pageNumber,i.recordCount=e.page.recordCount,i.pageCount=e.page.pageCount,i.pageSize=e.page.pageSize,i.pageList=i.pageNum(i.pageCount,i.pageNumber),i.startData=0==i.recordCount?0:(i.pageNumber-1)*i.pageSize+1,i.endData=e.list.length<i.pageSize?(i.pageNumber-1)*i.pageSize+e.list.length:i.pageNumber*i.pageSize):layer.msg("请求失败",{icon:5})}).error(function(e){})},i.getwithdrawDepositList(s),i.changePageUrl=function(e){s.page_index=i.getPageIndex(e,i.pageNumber,i.pageCount),n.go("home.withdrawDeposit",s)},i.withdrawDeposit_id="",i.showwithdrawDeposit=function(e){i.withdrawDeposit_id=e,$("#manage_withdrawDeposit").modal("show")},i.picture="",angular.element("#sel-adv-img").on("change",function(){var e={url:BASEURL+"/api2/file/upload?device=1",type:"POST",resetForm:!0,beforeSubmit:c,success:o,xhrFields:{withCredentials:!0}};angular.element("#uploadAdv").ajaxSubmit(e)}),i.manageWithdrawDeposit=function(){a({method:"POST",url:BASEURL+"/cms2/company/withdraw/money/"+i.withdrawDeposit_id,params:{device:1,picture:i.picture,extra:i.extra}}).success(function(e){1==e.status?(i.withdrawDeposit_id="",layer.msg(e.msg,{icon:1,time:1e3}),t(function(){$("#manage_withdrawDeposit").modal("hide"),i.getwithdrawDepositList(s)},1500)):layer.msg(e.msg,{icon:5,time:1e3})})}}]),$(function(){pageInitModule.setWidth(),pageInitModule.setCarousel()}),$(window).resize(function(){pageInitModule.setWidth()}),$(window).scroll(function(){pageInitModule.setScrollToTop()});var pageInitModule=function(e){return e.setCarousel=function(){try{$(".carousel").hammer().on("swipeleft",function(){$(this).carousel("next")}),$(".carousel").hammer().on("swiperight",function(){$(this).carousel("prev")})}catch(e){}},e.setWidth=function(){$(window).width()<768?($(".sidebar").animate({left:-160}),$(".all").animate({marginLeft:0})):($(".sidebar").animate({left:0}),$(".all").animate({marginLeft:160}))},e.setScrollToTop=function(){$(window).scrollTop()<60?$("#goTop").hide():$("#goTop").show()},e.setSidebar=function(e){$(e).parent().hasClass("has-sub")?$(e).parent().find(".sub-menu").slideToggle().end().siblings().find(".sub-menu").slideUp():($(e).parents("ul").hasClass("sub-menu")||$(e).parent().siblings().find(".sub-menu").slideUp(),this.setWidth())},e.changeSide=function(){0==$(".sidebar").offset().left?($(".sidebar").animate({left:-160}),$(".all").animate({marginLeft:0})):($(".sidebar").animate({left:0}),$(".all").animate({marginLeft:160})),$("#navbar").css({height:"1px"}).removeClass("in").addClass("collapse")},e.goTop=function(){$(document.body).animate({scrollTop:"0"})},e}(window.pageInitModule||{});